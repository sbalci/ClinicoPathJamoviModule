<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding Plots • ClinicoPath</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Adding Plots">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">ClinicoPath</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.32.01</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../dev/index.html"><span class="fa fa-cogs"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_analysis-definition.html">Analysis Definition</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_module-definition.html">Module Definition</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_results-definition.html">Results Definition</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_results-elements.html">Results Elements</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_table.html">Table</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/api_ui-definition.html">User-interface Definition</a></li>
    <li><a class="dropdown-item" href="../../articles/developer_guide.html">jamovi Module Development Guide</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/index.html">Home</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/info_project-structure.html">project structure</a></li>
    <li><a class="dropdown-item" href="../../articles/module-development-jamovi.html">ClinicoPath Module Development Guide</a></li>
    <li><a class="dropdown-item" href="../../articles/pathology-jamovi.html">Using jamovi for the Common Statistical Analysis in Pathology</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0101-getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0102-creating-a-module.html">Creating a Module</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0103-creating-an-analysis.html">Creating an Analysis</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0104-implementing-an-analysis.html">Implementing an Analysis</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0105-creating-rich-results.html">Creating Rich Results</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0105-debugging-an-analysis.html">Debugging an Analysis</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0106-adding-plots.html">Adding Plots</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0107-distributing-modules.html">Distributing Modules</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0108-additional-notes.html">Additional Notes</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0201-data-binding.html">Tables</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0201-dynamic-tables.html">Dynamic Tables</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0202-handling-data.html">Handling Data</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/tuts0203-state.html">State</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-advanced-customisation.html">Advanced customisation of the options UI</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-advanced-design.html">Advanced UI Design</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-basecontrol.html">BaseControl</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-basic-design.html">UI Design</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-checkbox.html">CheckBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-collapsebox.html">CollapseBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-combobox.html">ComboBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-custom-format.html">Custom Formats</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-label.html">Label</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-layoutbox.html">LayoutBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-listbox.html">ListBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-optioncontrol.html">OptionControl</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-parentcontrol.html">ParentControl</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-radiobutton.html">RadioButton</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-standard-formats.html">Standard UI Formats</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-supplier.html">Supplier</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-targetlayoutbox.html">TargetLayoutBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-termlabel.html">TermLabel</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-textbox.html">TextBox</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-variablelabel.html">VariableLabel</a></li>
    <li><a class="dropdown-item" href="../../articles/dev.jamovi.org-master/ui-variablesupplier.html">VariableSupplier</a></li>
    <li><a class="dropdown-item" href="../../articles/users-of-ClinicoPath.html">Users of ClinicoPath</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/serdarbalci"><span class="fa fab fa-twitter fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/sbalci/ClinicoPathJamoviModule/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adding Plots</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sbalci/ClinicoPathJamoviModule/blob/HEAD/vignettes/dev.jamovi.org-master/tuts0106-adding-plots.Rmd" class="external-link"><code>vignettes/dev.jamovi.org-master/tuts0106-adding-plots.Rmd</code></a></small>
      <div class="d-none name"><code>tuts0106-adding-plots.Rmd</code></div>
    </div>

    
    
<p>In this section, we’ll add a plot to the t-test analysis we’ve been
developing in this series. A plot is another item to appear in the
results, so we’ll add another entry into our <code>ttest.r.yaml</code>
file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at">  ttest</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">title</span><span class="kw">:</span><span class="at"> Independent Samples T-Test</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">jrs</span><span class="kw">:</span><span class="at">   </span><span class="st">'1.1'</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">items</span><span class="kw">:</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at">  ttest</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">      </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Independent Samples T-Test</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Table</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="at">      </span><span class="fu">rows</span><span class="kw">:</span><span class="at">  </span><span class="dv">1</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="at">      </span><span class="fu">columns</span><span class="kw">:</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> var</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="at">          </span><span class="fu">title</span><span class="kw">:</span><span class="at"> </span><span class="st">''</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> text</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> t</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> number</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> df</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> integer</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="at">        </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> p</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="at">          </span><span class="fu">type</span><span class="kw">:</span><span class="at"> number</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="at">          </span><span class="fu">format</span><span class="kw">:</span><span class="at"> zto,pvalue</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="at">    </span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> plot</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="at">      </span><span class="fu">title</span><span class="kw">:</span><span class="at"> Descriptives Plot</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="at">      </span><span class="fu">type</span><span class="kw">:</span><span class="at"> Image</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="at">      </span><span class="fu">width</span><span class="kw">:</span><span class="at">  </span><span class="dv">400</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="at">      </span><span class="fu">height</span><span class="kw">:</span><span class="at"> </span><span class="dv">300</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="at">      </span><span class="fu">renderFun</span><span class="kw">:</span><span class="at"> .plot</span></span></code></pre></div>
<p>Same as before, we define an item with a <code>name</code>,
<code>title</code> and a <code>type</code>; in this case the type is
<code>Image</code>. Additionally, we define <code>renderFun</code> which
is the name of the function responsible for rendering the image.
Whatever we specify as the render function, we must add as a <em>private
member function</em> to <code>ttestClass</code> in
<code>ttest.b.R</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">ttestClass</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>    <span class="st">"ttestClass"</span>,</span>
<span>    inherit <span class="op">=</span> <span class="va">ttestBase</span>,</span>
<span>    private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        .run <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span>, <span class="st">'~'</span>, <span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span>            <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">table</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">ttest</span></span>
<span>            <span class="va">table</span><span class="op">$</span><span class="fu">setRow</span><span class="op">(</span>rowNo<span class="op">=</span><span class="fl">1</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                var<span class="op">=</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span>,</span>
<span>                t<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">statistic</span>,</span>
<span>                df<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">parameter</span>,</span>
<span>                p<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">p.value</span></span>
<span>            <span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        .plot<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">image</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>  <span class="co"># &lt;-- the plot function</span></span>
<span>        </span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="adding-ggplot2">Adding ggplot2<a class="anchor" aria-label="anchor" href="#adding-ggplot2"></a>
</h2>
<p>We’re going to use <code>ggplot2</code> for plotting, so make sure
you have that installed. To use ggplot2 in this package/module, we need
to add some entries into the DESCRIPTION and NAMESPACE files. We add
ggplot2 to the imports line in the DESCRIPTION, so it reads:</p>
<pre><code>Imports: jmvcore, R6, ggplot2</code></pre>
<p>and we’ll add the following line into NAMESPACE:</p>
<pre><code><span><span class="fu">import</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span></code></pre>
<p>These entries are standard for using R code from other packages in a
package. More information is available in <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html" class="external-link">Writing
R Extensions</a>.</p>
<p>Now we have ggplot2 ready, we can proceed with using it in our
analysis.</p>
</div>
<div class="section level2">
<h2 id="implementing-plots">Implementing Plots<a class="anchor" aria-label="anchor" href="#implementing-plots"></a>
</h2>
<p>In jamovi modules, plotting occurs in two stages; first the data for
the plot is prepared, then the plot is rendered. The two stages mean
that if the image is resized, or the user requests a different file
format, only the rendering needs to be performed again — the data
preparation needs only to occur once.</p>
<p>For the t-test, we’re going to plot a mean for each of the groups,
and the standard errors. In <code>ggplot2</code>, we’re required to
assemble these ‘plot points’ into a data frame, which we will do as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">means</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span>, <span class="va">mean</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">ses</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">sel</span>    <span class="op">&lt;-</span> <span class="va">means</span> <span class="op">-</span> <span class="va">ses</span>  <span class="co"># standard error lower bound</span></span>
<span>    <span class="va">seu</span>    <span class="op">&lt;-</span> <span class="va">means</span> <span class="op">+</span> <span class="va">ses</span>  <span class="co"># standard error upper bound</span></span>
<span>    <span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>level<span class="op">=</span><span class="va">levels</span>, mean<span class="op">=</span><span class="va">means</span>, sel<span class="op">=</span><span class="va">sel</span>, seu<span class="op">=</span><span class="va">seu</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   level     mean      sel      seu</span></span>
<span><span class="co">## 1    OJ 20.66333 19.45733 21.86934</span></span>
<span><span class="co">## 2    VC 16.96333 15.45417 18.47250</span></span></code></pre>
<p>This plot data we assign to the image using the
<code>setState()</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">image</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">plot</span></span>
<span>    <span class="va">image</span><span class="op">$</span><span class="fu">setState</span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span></span></code></pre></div>
<p>Next, we’ll add the plotting code into the <code>.plot()</code>
function we created:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">.plot</span><span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">image</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="va">state</span></span>
<span>        <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plotData</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">level</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">sel</span>, ymax<span class="op">=</span><span class="va">seu</span>, width<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">level</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>        <span class="cn">TRUE</span></span>
<span>    <span class="op">}</span></span></code></pre></div>
<p>The plot function accepts an argument <code>image</code>, which
corresponds to the image object we called <code>setState()</code> on. We
can retrieve the state object from this image with
<code>image$state</code>, which we can see is being assigned to
<code>plotData</code>.</p>
<p>Following this are a number of calls to <code>ggplot2</code>
functions. A full discussion of how to use ggplot2 is <strong>well and
truly</strong> beyond the scope of this document, but there are many
excellent resources available online.</p>
<p>Next we explicitly print the ggplot object. When using ggplot
interactively in an R session, calling <code>ggplot()</code> leads to
the creation of the plot, however, when calling ggplot from inside a
function, it is necessary to explicitly call <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>.</p>
<p>The final statement is <code>TRUE</code> which is the return value.
Don’t forget this! Returning true notifies the rendering system that you
have plotted something. If you don’t return true, your plot will not
appear. There are situations where the user may not have specified
enough information for plotting, in which case the function should
return <code>FALSE</code>.</p>
<p>So this is our final <code>ttest.b.R</code> file:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">ttestClass</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>    <span class="st">"ttestClass"</span>,</span>
<span>    inherit <span class="op">=</span> <span class="va">ttestBase</span>,</span>
<span>    private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        .run <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span>, <span class="st">'~'</span>, <span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">group</span><span class="op">)</span></span>
<span>            <span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html" class="external-link">t.test</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">table</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">ttest</span></span>
<span>            <span class="va">table</span><span class="op">$</span><span class="fu">setRow</span><span class="op">(</span>rowNo<span class="op">=</span><span class="fl">1</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                var<span class="op">=</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span>,</span>
<span>                t<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">statistic</span>,</span>
<span>                df<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">parameter</span>,</span>
<span>                p<span class="op">=</span><span class="va">results</span><span class="op">$</span><span class="va">p.value</span></span>
<span>            <span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">means</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span>, <span class="va">mean</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>            <span class="va">ses</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">formula</span>, <span class="va">self</span><span class="op">$</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span>            <span class="va">sel</span>    <span class="op">&lt;-</span> <span class="va">means</span> <span class="op">-</span> <span class="va">ses</span>  <span class="co"># standard error lower bound</span></span>
<span>            <span class="va">seu</span>    <span class="op">&lt;-</span> <span class="va">means</span> <span class="op">+</span> <span class="va">ses</span>  <span class="co"># standard error upper bound</span></span>
<span>            <span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>level<span class="op">=</span><span class="va">levels</span>, mean<span class="op">=</span><span class="va">means</span>, sel<span class="op">=</span><span class="va">sel</span>, seu<span class="op">=</span><span class="va">seu</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">image</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">plot</span></span>
<span>            <span class="va">image</span><span class="op">$</span><span class="fu">setState</span><span class="op">(</span><span class="va">plotData</span><span class="op">)</span></span>
<span>        <span class="op">}</span>,</span>
<span>        .plot<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">image</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">plotData</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="va">state</span></span>
<span>            <span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">plotData</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">level</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fu">geom_errorbar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin<span class="op">=</span><span class="va">sel</span>, ymax<span class="op">=</span><span class="va">seu</span>, width<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">level</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="va">self</span><span class="op">$</span><span class="va">options</span><span class="op">$</span><span class="va">dep</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span>            <span class="cn">TRUE</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And these are our final results, including the plot:</p>
<p><img src="tuts0106-adding-plots-final.png" width="441"></p>
<p>Next: <a href="tuts0107-distributing-modules.html">Distributing
Modules</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.serdarbalci.com/" class="external-link">Serdar Balci</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
