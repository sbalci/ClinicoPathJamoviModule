% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/multisurvival.h.R
\name{multisurvival}
\alias{multisurvival}
\title{Multivariable Survival Analysis}
\usage{
multisurvival(
  data,
  elapsedtime = NULL,
  tint = FALSE,
  dxdate = NULL,
  fudate = NULL,
  timetypedata = "ymd",
  timetypeoutput = "months",
  uselandmark = FALSE,
  landmark = 3,
  outcome = NULL,
  outcomeLevel,
  dod,
  dooc,
  awd,
  awod,
  analysistype = "overall",
  explanatory = NULL,
  contexpl = NULL,
  multievent = FALSE,
  hr = FALSE,
  sty = "t1",
  ph_cox = FALSE,
  km = FALSE,
  endplot = 60,
  byplot = 12,
  ci95 = FALSE,
  risktable = FALSE,
  censored = FALSE,
  medianline = "none",
  pplot = FALSE,
  cutp = "12, 36, 60",
  calculateRiskScore = FALSE,
  numRiskGroups = "four",
  plotRiskGroups = FALSE,
  ac = FALSE,
  adjexplanatory = NULL,
  ac_method = "average",
  showNomogram = FALSE,
  use_modelSelection = FALSE,
  modelSelection = "enter",
  selectionCriteria = "aic",
  pEntry = 0.05,
  pRemoval = 0.1,
  use_stratify = FALSE,
  stratvar = NULL,
  use_aft = FALSE,
  aft_distribution = "weibull",
  aft_show_hr_equivalent = FALSE,
  aft_show_interpretation = FALSE,
  person_time = FALSE,
  time_intervals = "12, 36, 60",
  rate_multiplier = 100,
  show_survmetrics = FALSE,
  survmetrics_timepoints = "12, 24, 36, 60",
  survmetrics_ibs_points = 100,
  survmetrics_show_plots = FALSE,
  showExplanations = FALSE,
  showSummaries = TRUE
)
}
\arguments{
\item{data}{The dataset to be analyzed, provided as a data frame. Must
contain the variables specified in the options below.}

\item{elapsedtime}{The numeric variable representing follow-up time until
the event or last observation. If \code{tint} = false, this should be a
pre-calculated numeric time variable. If \code{tint} = true, \code{dxdate}
and \code{fudate} will be used to calculate this time.}

\item{tint}{If true, survival time will be calculated from \code{dxdate}
and \code{fudate}. If false, \code{elapsedtime} should be provided as a
pre-calculated numeric variable.}

\item{dxdate}{Date of diagnosis. Required if \code{tint} = true. Accepts:
(1) Date/datetime text, (2) Numeric Unix epoch seconds (from DateTime
Converter's corrected_datetime_numeric output), (3) Numeric datetime values
from R. Time intervals calculated as difference from follow-up date.}

\item{fudate}{Follow-up date or date of last observation. Required if
\code{tint} = true. Accepts: (1) Date/datetime text, (2) Numeric Unix epoch
seconds (from DateTime Converter's corrected_datetime_numeric output), (3)
Numeric datetime values from R. Must be in same format as diagnosis date.}

\item{timetypedata}{Specifies the format of the date variables in the input
data. This is critical if \code{tint = true}, as \code{dxdate} and
\code{fudate} will be parsed according to this format to calculate survival
time. For example, if your data files record dates as "YYYY-MM-DD", select
\code{ymd}.}

\item{timetypeoutput}{The units in which survival time is reported in the
output. Choose from days, weeks, months, or years.}

\item{uselandmark}{If true, applies a landmark analysis starting at a
specified time point.}

\item{landmark}{The time point (in the units defined by
\code{timetypeoutput}) at which to start landmark analyses. Only used if
\code{uselandmark} = true.}

\item{outcome}{The outcome variable. Typically indicates event status
(e.g., death, recurrence). For survival analysis, this may be a factor or
numeric event indicator.}

\item{outcomeLevel}{The level of \code{outcome} considered as the event.
For example, if \code{outcome} is a factor, specify which level indicates
the event occurrence.}

\item{dod}{The level of \code{outcome} corresponding to death due to
disease, if applicable.}

\item{dooc}{The level of \code{outcome} corresponding to death due to other
causes, if applicable.}

\item{awd}{The level of \code{outcome} corresponding to alive with disease,
if applicable.}

\item{awod}{The level of \code{outcome} corresponding to alive without
disease, if applicable.}

\item{analysistype}{Type of survival analysis: - overall: All-cause
survival - cause: Cause-specific survival - compete: Competing risks
analysis}

\item{explanatory}{Categorical explanatory (predictor) variables included
in the Cox model.}

\item{contexpl}{Continuous explanatory (predictor) variables included in
the Cox model.}

\item{multievent}{If true, multiple event levels will be considered for
competing risks analysis. Requires specifying \code{dod}, \code{dooc}, etc.}

\item{hr}{If true, generates a plot of hazard ratios for each explanatory
variable in the Cox model.}

\item{sty}{The style of the hazard ratio (forest) plot. "finalfit" or
"survminer forestplot".}

\item{ph_cox}{If true, tests the proportional hazards assumption for the
Cox model. Use if you suspect violations of the PH assumption.}

\item{km}{If true, produces a Kaplan-Meier survival plot. Useful for
visualization of survival functions without covariate adjustment.}

\item{endplot}{The maximum follow-up time (in units defined by
\code{timetypeoutput}) to display on survival plots.}

\item{byplot}{The interval (in units defined by \code{timetypeoutput}) at
which time points or labels are shown on plots.}

\item{ci95}{If true, displays 95\\% confidence intervals around the survival
estimates on plots.}

\item{risktable}{If true, displays the number of subjects at risk at each
time point below the survival plot.}

\item{censored}{If true, marks censored observations (e.g., using tick
marks) on the survival plot.}

\item{medianline}{If true, displays a line indicating the median survival
time on the survival plot.}

\item{pplot}{If true, displays the p-value from the survival comparison
test on the survival plot.}

\item{cutp}{.}

\item{calculateRiskScore}{If true, calculates a risk score from the Cox
model coefficients for each individual.}

\item{numRiskGroups}{Select the number of risk groups to create from the
risk scores. The data will be divided into equal quantiles based on this
selection.}

\item{plotRiskGroups}{If true, stratifies individuals into risk groups
based on their calculated risk scores and plots their survival curves.}

\item{ac}{.}

\item{adjexplanatory}{.}

\item{ac_method}{Method for computing adjusted survival curves}

\item{showNomogram}{.}

\item{use_modelSelection}{(DEPRECATED - Not used) Model selection is
controlled by the 'modelSelection' option below. Set modelSelection to
'forward', 'backward', or 'both' to enable selection, or 'enter' to include
all variables without selection. This boolean flag is maintained for
backward compatibility but has no effect on the analysis.}

\item{modelSelection}{The method used to select variables: - enter:
Includes all variables (no selection) - forward: Adds variables one at a
time if they improve the model - backward: Removes variables that do not
significantly contribute - both: Combination of forward and backward steps}

\item{selectionCriteria}{The criterion used for adding or removing
variables in model selection: - aic: Balances model fit and complexity -
lrt: Uses likelihood ratio tests to decide inclusion/removal}

\item{pEntry}{Significance level at which a variable enters the model
during forward or stepwise selection.}

\item{pRemoval}{Significance level at which a variable is removed from the
model during backward or stepwise selection.}

\item{use_stratify}{If true, uses stratification to handle variables that
violate the proportional hazards assumption. Stratification creates
separate baseline hazard functions for different groups.}

\item{stratvar}{Variables used for stratification. When proportional
hazards are not met, stratification can adjust the model to better fit the
data by allowing different baseline hazards.}

\item{use_aft}{If true, fits an Accelerated Failure Time (AFT) model
instead of Cox Proportional Hazards. AFT models provide intuitive "Time
Ratios" (TR) showing how covariates accelerate or decelerate survival time.
Useful when PH assumption is violated or for more interpretable results
(e.g., "treatment makes patients live 1.5x longer").}

\item{aft_distribution}{Distribution family for survival times in AFT
model. Weibull is most flexible and can represent both PH and AFT
frameworks. Log-normal and log-logistic allow non-monotonic hazards. Choice
should be guided by Kaplan-Meier curve shape and diagnostic plots.}

\item{aft_show_hr_equivalent}{If true (and using Weibull distribution),
shows equivalent Hazard Ratios alongside Time Ratios for comparison with
Cox model results.}

\item{aft_show_interpretation}{If true, adds a column to the AFT results
table with natural language interpretation of Time Ratios (e.g.,
"Associated with 50\\% longer survival time").}

\item{person_time}{Enable this option to calculate and display person-time
metrics, including total follow-up time and incidence rates. These metrics
help quantify the rate of events per unit of time in your study population.}

\item{time_intervals}{Specify time intervals for stratified person-time
analysis. Enter a  comma-separated list of time points to create intervals.
For example,  "12, 36, 60" will create intervals 0-12, 12-36, 36-60, and
60+.}

\item{rate_multiplier}{Specify the multiplier for incidence rates (e.g.,
100 for rates per 100 person-years, 1000 for rates per 1000 person-years).}

\item{show_survmetrics}{Calculate comprehensive survival model performance
metrics using the SurvMetrics package. Includes Concordance Index, Brier
Score, Integrated Brier Score, and prediction accuracy metrics.}

\item{survmetrics_timepoints}{Comma-separated time points at which to
calculate Brier Score. Should correspond to clinically meaningful follow-up
times.}

\item{survmetrics_ibs_points}{Number of time points to use for calculating
Integrated Brier Score. More points provide smoother estimates but increase
computation time.}

\item{survmetrics_show_plots}{Generate plots of model performance metrics
over time (Brier Score, calibration).}

\item{showExplanations}{Display detailed explanations for each analysis
component to help interpret the statistical methods and results.}

\item{showSummaries}{Display natural language summaries alongside tables
and plots. These summaries provide plain-language interpretations of the
statistical results. Recommended for clinical users. Turn off to reduce
visual clutter when summaries are not needed.}
}
\value{
A results object containing:
\tabular{llllll}{
\code{results$todo} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$text} \tab \tab \tab \tab \tab a html \cr
\code{results$text2} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$multivariableCoxSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$glossaryPanel} \tab \tab \tab \tab \tab a html \cr
\code{results$assumptionsPanel} \tab \tab \tab \tab \tab a html \cr
\code{results$aftModelHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$aftModelTable} \tab \tab \tab \tab \tab a table \cr
\code{results$aftSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$aftSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$aftModelInfo} \tab \tab \tab \tab \tab a html \cr
\code{results$survMetricsHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$survMetricsTable} \tab \tab \tab \tab \tab a table \cr
\code{results$survMetricsSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$survMetricsSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$survMetricsPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$personTimeHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$personTimeTable} \tab \tab \tab \tab \tab a table \cr
\code{results$personTimeSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$personTimeSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$survivalPlotsHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot} \tab \tab \tab \tab \tab an image \cr
\code{results$plot3} \tab \tab \tab \tab \tab an image \cr
\code{results$cox_ph} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot8} \tab \tab \tab \tab \tab an image \cr
\code{results$plotKM} \tab \tab \tab \tab \tab an image \cr
\code{results$risk_score_analysis} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$risk_score_analysis2} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$riskScoreSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$riskScoreTable} \tab \tab \tab \tab \tab a table \cr
\code{results$riskScoreSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreMetrics} \tab \tab \tab \tab \tab a html \cr
\code{results$riskGroupPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$stratificationExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$calculatedtime} \tab \tab \tab \tab \tab an output \cr
\code{results$outcomeredefined} \tab \tab \tab \tab \tab an output \cr
\code{results$addRiskScore} \tab \tab \tab \tab \tab an output \cr
\code{results$addRiskGroup} \tab \tab \tab \tab \tab an output \cr
\code{results$adjustedSurvivalHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot_adj} \tab \tab \tab \tab \tab an image \cr
\code{results$adjustedSurvivalSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$adjustedSurvivalSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot_nomogram} \tab \tab \tab \tab \tab an image \cr
\code{results$nomogram_display} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$nomogramSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxHeading3} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$adjustedSurvivalExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$personTimeExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$stratifiedAnalysisExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$survivalPlotsHeading3} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$survivalPlotsExplanation} \tab \tab \tab \tab \tab a html \cr
}

Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:

\code{results$aftModelTable$asDF}

\code{as.data.frame(results$aftModelTable)}
}
\description{
Performs multivariable survival analysis using Cox proportional hazards
regression. In multivariable survival analysis, person-time follow-up is
crucial for properly adjusting for covariates while accounting for varying
observation periods. The Cox proportional hazards model incorporates
person-time by modeling the hazard function, which represents the
instantaneous event rate per unit of person-time. When stratifying analyses
or examining multiple predictors, the model accounts for how these factors
influence event rates relative to the person-time at risk in each subgroup.
}
\examples{
# Example 1: Basic multivariable Cox regression
library(survival)
data(colon)

multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("sex", "obstruct", "perfor"),
    contexpl = c("age", "nodes"),
    timetypeoutput = "days",
    hr = TRUE  # Show hazard ratio plot
)

# Example 2: Using dates to calculate survival time
# Assuming you have diagnosis and follow-up dates
multisurvival(
    data = mydata,
    tint = TRUE,
    dxdate = "diagnosis_date",
    fudate = "last_followup_date",
    timetypedata = "ymd",
    timetypeoutput = "months",
    outcome = "vital_status",
    outcomeLevel = "Dead",
    explanatory = c("stage", "grade"),
    contexpl = "age"
)

# Example 3: Risk stratification analysis
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("sex", "obstruct"),
    contexpl = c("age", "nodes"),
    calculateRiskScore = TRUE,
    numRiskGroups = "three",
    plotRiskGroups = TRUE,
    addRiskScore = TRUE,  # Add risk score to data
    addRiskGroup = TRUE   # Add risk group to data
)

# Example 4: Model with stratification for non-proportional hazards
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("obstruct", "perfor"),
    contexpl = c("age", "nodes"),
    use_stratify = TRUE,
    stratvar = "sex",  # Stratify by sex if PH assumption violated
    ph_cox = TRUE      # Test proportional hazards assumption
)

# Example 5: Stepwise model selection
# multisurvival(
#     data = colon,
#     elapsedtime = "time",
#     outcome = "status",
#     outcomeLevel = "1",
#     explanatory = c("sex", "obstruct", "perfor", "adhere"),
#     contexpl = c("age", "nodes"),
#     use_modelSelection = TRUE,
#     modelSelection = "both",  # Stepwise selection
#     selectionCriteria = "aic",
#     pEntry = 0.05,
#     pRemoval = 0.10
# )

# Example 6: Person-time analysis
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = "sex",
    contexpl = "age",
    person_time = TRUE,
    time_intervals = "180, 365, 730",  # 6mo, 1yr, 2yr
    rate_multiplier = 1000  # Rate per 1000 person-days
)

}
