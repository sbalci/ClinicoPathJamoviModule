% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/multisurvival.h.R
\name{multisurvival}
\alias{multisurvival}
\title{Multivariable Survival Analysis}
\usage{
multisurvival(
  data,
  elapsedtime = NULL,
  tint = FALSE,
  dxdate = NULL,
  fudate = NULL,
  timetypedata = "ymd",
  timetypeoutput = "months",
  uselandmark = FALSE,
  landmark = 3,
  outcome = NULL,
  outcomeLevel,
  dod,
  dooc,
  awd,
  awod,
  analysistype = "overall",
  explanatory = NULL,
  contexpl = NULL,
  multievent = FALSE,
  hr = FALSE,
  sty = "t1",
  ph_cox = FALSE,
  km = FALSE,
  endplot = 60,
  byplot = 12,
  ci95 = FALSE,
  risktable = FALSE,
  censored = FALSE,
  medianline = "none",
  pplot = FALSE,
  cutp = "12, 36, 60",
  calculateRiskScore = FALSE,
  numRiskGroups = "four",
  plotRiskGroups = FALSE,
  ac = FALSE,
  adjexplanatory = NULL,
  ac_method = "average",
  showNomogram = FALSE,
  use_stratify = FALSE,
  stratvar = NULL,
  person_time = FALSE,
  time_intervals = "12, 36, 60",
  rate_multiplier = 100,
  use_tree = FALSE,
  min_node = 20,
  complexity = 0.01,
  max_depth = 5,
  show_terminal_nodes = FALSE,
  use_time_dependent = FALSE,
  td_format = "wide",
  time_dep_vars = NULL,
  change_times = "6, 12, 18",
  td_suffix_pattern = "_t{time}",
  start_time_var = NULL,
  stop_time_var = NULL,
  use_frailty = FALSE,
  frailty_var = NULL,
  frailty_distribution = "gamma",
  use_splines = FALSE,
  spline_vars = NULL,
  spline_df = 3,
  spline_type = "pspline",
  showExplanations = FALSE,
  showSummaries = FALSE,
  ml_method = "none",
  ml_validation = "cv",
  ml_cv_folds = 5,
  ml_feature_selection = FALSE,
  ml_importance = FALSE,
  ml_calibration = FALSE,
  ml_performance = FALSE,
  ml_shap = FALSE,
  ml_hyperparameter_tuning = FALSE,
  ml_ensemble_weights = "equal"
)
}
\arguments{
\item{data}{The dataset to be analyzed, provided as a data frame. Must
contain the variables specified in the options below.}

\item{elapsedtime}{The numeric variable representing follow-up time until
the event or last observation. If \code{tint} = false, this should be a
pre-calculated numeric time variable. If \code{tint} = true, \code{dxdate}
and \code{fudate} will be used to calculate this time.}

\item{tint}{If true, survival time will be calculated from \code{dxdate}
and \code{fudate}. If false, \code{elapsedtime} should be provided as a
pre-calculated numeric variable.}

\item{dxdate}{Date of diagnosis. Required if \code{tint} = true. Must match
the format specified in \code{timetypedata}.}

\item{fudate}{Follow-up date or date of last observation. Required if
\code{tint} = true. Must match the format specified in \code{timetypedata}.}

\item{timetypedata}{Specifies the format of the date variables in the input
data. This is critical if \code{tint = true}, as \code{dxdate} and
\code{fudate} will be parsed according to this format to calculate survival
time. For example, if your data files record dates as "YYYY-MM-DD", select
\code{ymd}.}

\item{timetypeoutput}{The units in which survival time is reported in the
output. Choose from days, weeks, months, or years.}

\item{uselandmark}{If true, applies a landmark analysis starting at a
specified time point.}

\item{landmark}{The time point (in the units defined by
\code{timetypeoutput}) at which to start landmark analyses. Only used if
\code{uselandmark} = true.}

\item{outcome}{The outcome variable. Typically indicates event status
(e.g., death, recurrence). For survival analysis, this may be a factor or
numeric event indicator.}

\item{outcomeLevel}{The level of \code{outcome} considered as the event.
For example, if \code{outcome} is a factor, specify which level indicates
the event occurrence.}

\item{dod}{The level of \code{outcome} corresponding to death due to
disease, if applicable.}

\item{dooc}{The level of \code{outcome} corresponding to death due to other
causes, if applicable.}

\item{awd}{The level of \code{outcome} corresponding to alive with disease,
if applicable.}

\item{awod}{The level of \code{outcome} corresponding to alive without
disease, if applicable.}

\item{analysistype}{Type of survival analysis: - overall: All-cause
survival - cause: Cause-specific survival - compete: Competing risks
analysis}

\item{explanatory}{Categorical explanatory (predictor) variables included
in the Cox model.}

\item{contexpl}{Continuous explanatory (predictor) variables included in
the Cox model.}

\item{multievent}{If true, multiple event levels will be considered for
competing risks analysis. Requires specifying \code{dod}, \code{dooc}, etc.}

\item{hr}{If true, generates a plot of hazard ratios for each explanatory
variable in the Cox model.}

\item{sty}{The style of the hazard ratio (forest) plot. "finalfit" or
"survminer forestplot".}

\item{ph_cox}{If true, tests the proportional hazards assumption for the
Cox model. Use if you suspect violations of the PH assumption.}

\item{km}{If true, produces a Kaplan-Meier survival plot. Useful for
visualization of survival functions without covariate adjustment.}

\item{endplot}{The maximum follow-up time (in units defined by
\code{timetypeoutput}) to display on survival plots.}

\item{byplot}{The interval (in units defined by \code{timetypeoutput}) at
which time points or labels are shown on plots.}

\item{ci95}{If true, displays 95\\% confidence intervals around the survival
estimates on plots.}

\item{risktable}{If true, displays the number of subjects at risk at each
time point below the survival plot.}

\item{censored}{If true, marks censored observations (e.g., using tick
marks) on the survival plot.}

\item{medianline}{If true, displays a line indicating the median survival
time on the survival plot.}

\item{pplot}{If true, displays the p-value from the survival comparison
test on the survival plot.}

\item{cutp}{.}

\item{calculateRiskScore}{If true, calculates a risk score from the Cox
model coefficients for each individual.}

\item{numRiskGroups}{Select the number of risk groups to create from the
risk scores. The data will be divided into equal quantiles based on this
selection.}

\item{plotRiskGroups}{If true, stratifies individuals into risk groups
based on their calculated risk scores and plots their survival curves.}

\item{ac}{.}

\item{adjexplanatory}{.}

\item{ac_method}{Method for computing adjusted survival curves}

\item{showNomogram}{.}

\item{use_stratify}{If true, uses stratification to handle variables that
violate the proportional hazards assumption. Stratification creates
separate baseline hazard functions for different groups.}

\item{stratvar}{Variables used for stratification. When proportional
hazards are not met, stratification can adjust the model to better fit the
data by allowing different baseline hazards.}

\item{person_time}{Enable this option to calculate and display person-time
metrics, including total follow-up time and incidence rates. These metrics
help quantify the rate of events per unit of time in your study population.}

\item{time_intervals}{Specify time intervals for stratified person-time
analysis. Enter a  comma-separated list of time points to create intervals.
For example,  "12, 36, 60" will create intervals 0-12, 12-36, 36-60, and
60+.}

\item{rate_multiplier}{Specify the multiplier for incidence rates (e.g.,
100 for rates per 100 person-years, 1000 for rates per 1000 person-years).}

\item{use_tree}{If true, fits a survival decision tree to identify
subgroups with different survival outcomes. Decision trees provide an
intuitive alternative to Cox regression for identifying risk factors.}

\item{min_node}{The minimum number of observations required in a terminal
node. Larger values create simpler trees that may be more generalizable but
potentially miss important subgroups.}

\item{complexity}{The complexity parameter for tree pruning. Higher values
result in smaller trees. This parameter controls the trade-off between tree
size and goodness of fit.}

\item{max_depth}{The maximum depth of the decision tree. Limits the
complexity of the tree to avoid overfitting.}

\item{show_terminal_nodes}{If true, displays Kaplan-Meier survival curves
for each terminal node of the decision tree.}

\item{use_time_dependent}{Enable time-dependent covariates for Cox
regression. This allows modeling variables that change values at specific
time points during follow-up (e.g., treatment changes, biomarker
measurements, disease progression).}

\item{td_format}{Specify whether your data is in wide format (one row per
subject with time points as separate variables) or long format (multiple
rows per subject with time intervals).}

\item{time_dep_vars}{Variables that change values over time. In wide
format, these are baseline variables that will be updated at change points.
In long format, these are the time-varying variables.}

\item{change_times}{Time points (in same units as survival time) when
time-dependent variables change. For wide format data, specify
comma-separated time points (e.g., "6, 12, 18"). The function will create
intervals and update covariate values at these times.}

\item{td_suffix_pattern}{For wide format: Pattern for time-specific
variable names. Use {time} as placeholder. Example: if baseline variable is
'treatment' and pattern is '_t{time}',  the function looks for
'treatment_t6', 'treatment_t12', etc.}

\item{start_time_var}{For long format only: Variable indicating the start
time of each interval. Leave empty for wide format data.}

\item{stop_time_var}{For long format only: Variable indicating the stop
time of each interval. Leave empty for wide format data.}

\item{use_frailty}{Add a frailty term to account for unobserved
heterogeneity or clustering in the data. Frailty models add random effects
to the Cox model.}

\item{frailty_var}{Clustering variable for the frailty term (e.g.,
hospital, family, or study center). Each level represents a cluster with
shared frailty.}

\item{frailty_distribution}{Distribution of the frailty term. Gamma is most
commonly used and assumes multiplicative effect on the hazard. Gaussian
assumes additive effect on log-hazard.}

\item{use_splines}{Use penalized splines to model time-varying effects
(non-proportional hazards). This is an alternative to stratification for
handling PH violations.}

\item{spline_vars}{Variables to model with time-varying coefficients using
splines. These are variables that violate the proportional hazards
assumption.}

\item{spline_df}{Degrees of freedom for the spline functions. Higher values
allow more flexible time-varying effects but may lead to overfitting.}

\item{spline_type}{Type of spline basis to use. Penalized splines provide
smooth functions with automatic smoothness selection. Natural splines are
constrained to be linear at the boundaries.}

\item{showExplanations}{Display detailed explanations for each analysis
component to help interpret the statistical methods and results.}

\item{showSummaries}{Display natural language summaries alongside tables
and plots. These summaries provide plain-language interpretations of the
statistical results. Turn off to reduce visual clutter when summaries are
not needed.}

\item{ml_method}{Machine learning survival analysis method}

\item{ml_validation}{Model validation approach}

\item{ml_cv_folds}{CV fold count}

\item{ml_feature_selection}{Enable feature selection}

\item{ml_importance}{Show variable importance}

\item{ml_calibration}{Generate calibration plot}

\item{ml_performance}{Show performance metrics}

\item{ml_shap}{Compute SHAP values}

\item{ml_hyperparameter_tuning}{Enable hyperparameter tuning}

\item{ml_ensemble_weights}{Ensemble model weights}
}
\value{
A results object containing:
\tabular{llllll}{
\code{results$todo} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$text} \tab \tab \tab \tab \tab a html \cr
\code{results$text2} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$multivariableCoxSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$personTimeHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$personTimeTable} \tab \tab \tab \tab \tab a table \cr
\code{results$personTimeSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$personTimeSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$survivalPlotsHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot} \tab \tab \tab \tab \tab an image \cr
\code{results$plot3} \tab \tab \tab \tab \tab an image \cr
\code{results$cox_ph} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot8} \tab \tab \tab \tab \tab an image \cr
\code{results$plotKM} \tab \tab \tab \tab \tab an image \cr
\code{results$risk_score_analysis} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$risk_score_analysis2} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$riskScoreSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$riskScoreTable} \tab \tab \tab \tab \tab a table \cr
\code{results$riskScoreSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreMetrics} \tab \tab \tab \tab \tab a html \cr
\code{results$riskGroupPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$stratificationExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$calculatedtime} \tab \tab \tab \tab \tab an output \cr
\code{results$outcomeredefined} \tab \tab \tab \tab \tab an output \cr
\code{results$addRiskScore} \tab \tab \tab \tab \tab an output \cr
\code{results$addRiskGroup} \tab \tab \tab \tab \tab an output \cr
\code{results$adjustedSurvivalHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot_adj} \tab \tab \tab \tab \tab an image \cr
\code{results$adjustedSurvivalSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$adjustedSurvivalSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$plot_nomogram} \tab \tab \tab \tab \tab an image \cr
\code{results$nomogram_display} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$nomogramSummary} \tab \tab \tab \tab \tab a html \cr
\code{results$mydataview_survivaldecisiontree} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$survivalTreeHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$treeSummaryHeading} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$tree_summary} \tab \tab \tab \tab \tab a html \cr
\code{results$tree_plot} \tab \tab \tab \tab \tab an image \cr
\code{results$node_survival_plots} \tab \tab \tab \tab \tab an image \cr
\code{results$multivariableCoxExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$multivariableCoxHeading3} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$adjustedSurvivalExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$riskScoreExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$nomogramExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$personTimeExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$stratifiedAnalysisExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$survivalPlotsHeading3} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$survivalPlotsExplanation} \tab \tab \tab \tab \tab a html \cr
\code{results$ml_variable_importance} \tab \tab \tab \tab \tab a table \cr
\code{results$ml_performance_metrics} \tab \tab \tab \tab \tab a html \cr
\code{results$ml_feature_selection_results} \tab \tab \tab \tab \tab a table \cr
\code{results$ml_ensemble_summary} \tab \tab \tab \tab \tab a html \cr
\code{results$ml_prediction_intervals} \tab \tab \tab \tab \tab a table \cr
\code{results$ml_cross_validation_summary} \tab \tab \tab \tab \tab a html \cr
}

Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:

\code{results$personTimeTable$asDF}

\code{as.data.frame(results$personTimeTable)}
}
\description{
Performs multivariable survival analysis using Cox proportional hazards
regression. In multivariable survival analysis, person-time follow-up is
crucial for properly adjusting for covariates while accounting for varying
observation periods. The Cox proportional hazards model incorporates
person-time by modeling the hazard function, which represents the
instantaneous event rate per unit of person-time. When stratifying analyses
or examining multiple predictors, the model accounts for how these factors
influence event rates relative to the person-time at risk in each subgroup.
}
\examples{
# Example 1: Basic multivariable Cox regression
library(survival)
data(colon)

multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("sex", "obstruct", "perfor"),
    contexpl = c("age", "nodes"),
    timetypeoutput = "days",
    hr = TRUE  # Show hazard ratio plot
)

# Example 2: Using dates to calculate survival time
# Assuming you have diagnosis and follow-up dates
multisurvival(
    data = mydata,
    tint = TRUE,
    dxdate = "diagnosis_date",
    fudate = "last_followup_date",
    timetypedata = "ymd",
    timetypeoutput = "months",
    outcome = "vital_status",
    outcomeLevel = "Dead",
    explanatory = c("stage", "grade"),
    contexpl = "age"
)

# Example 3: Risk stratification analysis
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("sex", "obstruct"),
    contexpl = c("age", "nodes"),
    calculateRiskScore = TRUE,
    numRiskGroups = "three",
    plotRiskGroups = TRUE,
    addRiskScore = TRUE,  # Add risk score to data
    addRiskGroup = TRUE   # Add risk group to data
)

# Example 4: Model with stratification for non-proportional hazards
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = c("obstruct", "perfor"),
    contexpl = c("age", "nodes"),
    use_stratify = TRUE,
    stratvar = "sex",  # Stratify by sex if PH assumption violated
    ph_cox = TRUE      # Test proportional hazards assumption
)

# Example 5: Stepwise model selection
# multisurvival(
#     data = colon,
#     elapsedtime = "time",
#     outcome = "status",
#     outcomeLevel = "1",
#     explanatory = c("sex", "obstruct", "perfor", "adhere"),
#     contexpl = c("age", "nodes"),
#     use_modelSelection = TRUE,
#     modelSelection = "both",  # Stepwise selection
#     selectionCriteria = "aic",
#     pEntry = 0.05,
#     pRemoval = 0.10
# )

# Example 6: Person-time analysis
multisurvival(
    data = colon,
    elapsedtime = "time",
    outcome = "status",
    outcomeLevel = "1",
    explanatory = "sex",
    contexpl = "age",
    person_time = TRUE,
    time_intervals = "180, 365, 730",  # 6mo, 1yr, 2yr
    rate_multiplier = 1000  # Rate per 1000 person-days
)

}
