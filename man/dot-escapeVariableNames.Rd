% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/crosstable.b.R, R/decisionpanel.b.R,
%   R/nogoldstandard.b.R, R/survival.b.R, R/venn.b.R
\name{.escapeVariableNames}
\alias{.escapeVariableNames}
\title{Cross Table for Clinicopathological Comparisons}
\usage{
.escapeVariableNames(var_names)

.escapeVariableNames(var_names)

.escapeVariableNames(var_names)

.escapeVariableNames(var_names)

.escapeVariableNames(var_names)
}
\arguments{
\item{vars}{A set of variables used as the dependent variables (rows).}

\item{group}{A variable (factor) used as the grouping variable (columns).}

\item{sty}{A string indicating the desired table style.
Options include: "arsenal", "finalfit", "gtsummary", "nejm", "lancet", "hmisc".}

\item{excl}{Logical. If TRUE, rows with missing values will be excluded.}

\item{cont}{A string ("mean" or "median") to specify the central tendency metric.}

\item{pcat}{A string ("chisq" or "fisher") to specify the primary test.}

\item{data}{The data as a data frame}

\item{elapsedtime}{Numeric variable containing survival time (time to event or censoring)}

\item{tint}{Logical. Use dates to calculate survival time from diagnosis and follow-up dates}

\item{dxdate}{Date variable for diagnosis date (when tint = TRUE)}

\item{fudate}{Date variable for follow-up/event date (when tint = TRUE)}

\item{explanatory}{Factor variable for group comparisons (e.g., treatment groups, risk categories)}

\item{outcome}{Event indicator variable (binary: 0=censored, 1=event) or factor for multi-state outcomes}

\item{outcomeLevel}{Event level when using factor outcome variable}

\item{dod}{Dead of disease level (for competing risks analysis)}

\item{dooc}{Dead of other causes level (for competing risks analysis)}

\item{awd}{Alive with disease level (for competing risks analysis)}

\item{awod}{Alive without disease level (for competing risks analysis)}

\item{analysistype}{Type of survival analysis: "overall", "cause", or "compete"}

\item{cutp}{Time points for survival probability estimation (comma-separated)}

\item{timetypedata}{Date format in data: "ymd", "dmy", "mdy", etc.}

\item{timetypeoutput}{Time unit for output: "days", "weeks", "months", "years"}

\item{uselandmark}{Logical. Perform landmark analysis}

\item{landmark}{Landmark time point for conditional survival analysis}

\item{pw}{Logical. Perform pairwise group comparisons}

\item{padjustmethod}{Multiple testing correction method for pairwise comparisons}

\item{ph_cox}{Logical. Test proportional hazards assumption}

\item{stratified_cox}{Logical. Use stratified Cox regression}

\item{strata_variable}{Variable for Cox model stratification}

\item{rmst_analysis}{Logical. Calculate Restricted Mean Survival Time}

\item{rmst_tau}{Time horizon for RMST calculation (uses 75th percentile if NULL)}

\item{residual_diagnostics}{Logical. Calculate and display model residuals}

\item{export_survival_data}{Logical. Export survival estimates for external analysis}

\item{person_time}{Logical. Calculate person-time metrics and incidence rates}

\item{time_intervals}{Time intervals for stratified person-time analysis}

\item{rate_multiplier}{Multiplier for incidence rates (e.g., 100 for per 100 person-years)}

\item{sc}{Logical. Display survival curve plot}

\item{ce}{Logical. Display cumulative events plot}

\item{ch}{Logical. Display cumulative hazard plot}

\item{kmunicate}{Logical. Display KMunicate-style plot}

\item{loglog}{Logical. Display log-log plot for proportional hazards assessment}

\item{endplot}{Maximum time for plot x-axis}

\item{ybegin_plot}{Minimum value for plot y-axis}

\item{yend_plot}{Maximum value for plot y-axis}

\item{byplot}{Time interval for plot axis breaks}

\item{multievent}{Logical. Use multiple event levels for competing risks}

\item{ci95}{Logical. Display 95\% confidence intervals on plots}

\item{risktable}{Logical. Display risk table below survival curves}

\item{censored}{Logical. Display censoring marks on survival curves}

\item{pplot}{Logical. Display p-value on plots}

\item{medianline}{Type of median survival line: "none", "h", "v", "hv"}
}
\value{
The function produces an HTML table output, and if requested, an additional
downloadable CSV export.

A comprehensive results object containing survival analysis outputs

The function produces a Venn diagram and an Upset diagram.
}
\description{
This function generates cross tables comparing a dependent variable (rows)
with a grouping variable (columns) and automatically selects hypothesis tests
appropriate for clinical research. The output tables are rendered in various
styles (e.g., arsenal, finalfit, gtsummary, NEJM, Lancet, hmisc) and are intended
for pathologists and oncologists. In addition to visualizing associations,
this function now optionally provides an exportable CSV version of the cross table.

Performs comprehensive univariate and stratified survival analysis comparing survival between groups.
This analysis calculates person-time follow-up for each group and uses this to derive accurate
survival estimates and incidence rates that account for varying follow-up durations across groups.
The Cox proportional hazards model incorporates person-time by modeling the hazard function,
which represents the instantaneous event rate per unit of person-time.

\strong{Key Features:}
\itemize{
\item Kaplan-Meier survival curves with multiple plot types
\item Cox proportional hazards regression (univariate and stratified)
\item Median survival time with confidence intervals
\item Restricted Mean Survival Time (RMST) analysis
\item Person-time analysis with incidence rates
\item Competing risks and cause-specific survival
\item Landmark analysis for conditional survival
\item Proportional hazards assumption testing
\item Model residual diagnostics
\item Pairwise group comparisons with multiple testing correction
}

\strong{Statistical Methods:}
\itemize{
\item Kaplan-Meier estimator for survival probabilities
\item Log-rank test for group comparisons
\item Cox proportional hazards model for risk assessment
\item Competing risks analysis using cumulative incidence functions
\item RMST for robust survival comparisons
}

\strong{Visualization Options:}
\itemize{
\item Standard survival curves
\item Cumulative events and hazard plots
\item KMunicate-style plots for publication
\item Log-log plots for proportional hazards assessment
\item Residual diagnostic plots
}

Generates a Venn Diagram and an Upset diagram from selected categorical variables.
This function converts specified variables to logical values based on a chosen "true" level.
Two visual outputs are produced: a Venn diagram (via ggvenn) and an Upset plot (via UpSetR or ComplexUpset).
Additionally, a summary table of "true" counts for each variable is provided.

ComplexUpset features include advanced styling, statistical annotations, custom sorting,
and enhanced theming options for publication-ready figures.
}
\details{
The function cleans variable names and applies original labels. It then builds
a formula based on the cleaned data and performs the appropriate statistical
test (e.g. chi-square or Fisherâ€™s exact test). Detailed user guidance is provided
via HTML to-do messages.

\strong{Analysis Types:}
\itemize{
\item \strong{Overall Survival}: Time from study entry to death from any cause
\item \strong{Cause-Specific Survival}: Time to death from specific cause (censoring other deaths)
\item \strong{Competing Risks}: Accounts for multiple types of events that prevent observation of the primary outcome
}

\strong{Person-Time Analysis:}
Calculates incidence rates accounting for varying follow-up times. Particularly useful for:
\itemize{
\item Studies with differential loss to follow-up
\item Comparison of event rates across populations
\item Assessment of time-varying risk
}

\strong{Restricted Mean Survival Time (RMST):}
Alternative to median survival when survival curves don't reach 50\% or for comparing
survival over a specific time horizon. Represents the area under the survival curve
up to a specified time point.

\strong{Model Diagnostics:}
\itemize{
\item Proportional hazards assumption testing using Schoenfeld residuals
\item Martingale and deviance residuals for outlier detection
\item Log-log plots for visual assessment of proportional hazards
}
}
\examples{
\donttest{
# Basic survival analysis
data("histopathologySurvival", package = "ClinicoPathJamoviModule")

# Standard survival analysis with median and survival probabilities
survival_result <- survival(
  data = histopathologySurvival,
  elapsedtime = "OverallSurvival_indays",
  outcome = "Outcome",
  outcomeLevel = "Dead",
  explanatory = "Grade",
  timetypeoutput = "months",
  cutp = "12, 36, 60",
  sc = TRUE,
  pw = TRUE
)

# Survival analysis with person-time metrics
survival_with_pt <- survival(
  data = histopathologySurvival,
  elapsedtime = "OverallSurvival_indays", 
  outcome = "Outcome",
  outcomeLevel = "Dead",
  explanatory = "Stage",
  person_time = TRUE,
  time_intervals = "365, 1095, 1825",
  rate_multiplier = 1000
)

# RMST analysis for non-proportional hazards
rmst_analysis <- survival(
  data = histopathologySurvival,
  elapsedtime = "OverallSurvival_indays",
  outcome = "Outcome", 
  outcomeLevel = "Dead",
  explanatory = "Treatment",
  rmst_analysis = TRUE,
  rmst_tau = 1095  # 3 years
)

# Competing risks analysis
competing_risks <- survival(
  data = cancer_data,
  elapsedtime = "survival_days",
  outcome = "death_cause",
  multievent = TRUE,
  dod = "Cancer",
  dooc = "Other",
  awd = "Alive_Disease",
  awod = "Alive_Free",
  analysistype = "compete",
  explanatory = "risk_group"
)

# Landmark analysis for conditional survival
landmark_survival <- survival(
  data = histopathologySurvival,
  elapsedtime = "OverallSurvival_indays",
  outcome = "Outcome",
  outcomeLevel = "Dead", 
  explanatory = "Grade",
  uselandmark = TRUE,
  landmark = 365  # 1-year conditional survival
)

# Date-based survival calculation
date_survival <- survival(
  data = clinical_data,
  tint = TRUE,
  dxdate = "diagnosis_date",
  fudate = "last_contact_date",
  timetypedata = "ymd",
  timetypeoutput = "months",
  outcome = "vital_status",
  outcomeLevel = "Dead",
  explanatory = "treatment_arm"
)
}

\dontrun{
# Example 1: Basic 2-variable Venn diagram
data("mtcars")
mtcars$vs <- factor(mtcars$vs, levels = c(0, 1), labels = c("V-shaped", "Straight"))
mtcars$am <- factor(mtcars$am, levels = c(0, 1), labels = c("Automatic", "Manual"))

# Create Venn diagram showing overlap between V-shaped engines and Manual transmission
venn(data = mtcars, var1 = "vs", var1true = "V-shaped",
     var2 = "am", var2true = "Manual")

# Example 2: 3-variable Venn diagram with penguins data
library(palmerpenguins)
data("penguins")
penguins$large_bill <- factor(ifelse(penguins$bill_length_mm > 45, "Large", "Small"))
penguins$heavy_weight <- factor(ifelse(penguins$body_mass_g > 4000, "Heavy", "Light"))
penguins$adelie_species <- factor(ifelse(penguins$species == "Adelie", "Adelie", "Other"))

venn(data = penguins,
     var1 = "large_bill", var1true = "Large",
     var2 = "heavy_weight", var2true = "Heavy",
     var3 = "adelie_species", var3true = "Adelie")

# Example 3: Variable names with spaces and numbers (requires careful handling)
# jamovi GUI automatically handles most problematic names
# When calling directly in R, variable names with spaces/numbers need backticks:
# venn(data = mydata, var1 = "`Rater 1`", var1true = "Positive",
#      var2 = "`Score 2A`", var2true = "High")

# Note: Names like "Rater 1", "Score 2A", "Item 3B" may cause parsing issues
# at the jamovi interface level. Solutions:
# 1. Use jamovi GUI for variable selection (recommended)
# 2. Rename variables to avoid spaces + numbers: "Rater1", "Score2A", "Item3B"
# 3. In R console, use backticks: `Rater 1` or quote properly

# Example 4: Clinical biomarker analysis
data("biomarkers")  # Hypothetical clinical dataset
venn(data = biomarkers,
     var1 = "ER_positive", var1true = "Positive",
     var2 = "PR_positive", var2true = "Positive",
     var3 = "HER2_amplified", var3true = "Amplified",
     show_ggVennDiagram = TRUE,
     regionLabels = "both",
     clinicalSummary = TRUE)

# Example 5: Medical/Clinical comorbidity analysis
# Create sample clinical data
clinical_data <- data.frame(
  patient_id = 1:100,
  diabetes = sample(c("Yes", "No"), 100, replace = TRUE, prob = c(0.3, 0.7)),
  hypertension = sample(c("Yes", "No"), 100, replace = TRUE, prob = c(0.4, 0.6)),
  obesity = sample(c("Yes", "No"), 100, replace = TRUE, prob = c(0.25, 0.75))
)

# Analyze comorbidity patterns
venn(data = clinical_data,
     var1 = "diabetes", var1true = "Yes",
     var2 = "hypertension", var2true = "Yes",
     var3 = "obesity", var3true = "Yes")

# Example 4: Using ComplexUpset for advanced features
venn(data = clinical_data,
     var1 = "diabetes", var1true = "Yes",
     var2 = "hypertension", var2true = "Yes",
     var3 = "obesity", var3true = "Yes",
     show_complexUpset = TRUE,
     sortBy = "freq",
     minSize = 5,
     showAnnotations = TRUE)

# Example 5: Advanced customization using ggVennDiagram
venn(data = clinical_data,
     var1 = "diabetes", var1true = "Yes",
     var2 = "hypertension", var2true = "Yes",
     var3 = "obesity", var3true = "Yes",
     show_ggVennDiagram = TRUE,
     regionLabels = "both",
     colorPalette = "Set1",
     labelSize = 3.5,
     setNameSize = 4.5)

# Example 6: 5-variable Venn diagram using ggVennDiagram
# Add more clinical variables
clinical_data$smoking <- sample(c("Yes", "No"), 100, replace = TRUE, prob = c(0.2, 0.8))
clinical_data$family_history <- sample(c("Yes", "No"), 100, replace = TRUE, prob = c(0.35, 0.65))

venn(data = clinical_data,
     var1 = "diabetes", var1true = "Yes",
     var2 = "hypertension", var2true = "Yes",
     var3 = "obesity", var3true = "Yes",
     var4 = "smoking", var4true = "Yes",
     var5 = "family_history", var5true = "Yes",
     show_ggVennDiagram = TRUE,
     regionLabels = "percent",
     colorPalette = "viridis")
}
}
\references{
Klein JP, Moeschberger ML (2003). Survival Analysis: Techniques for Censored and Truncated Data. Springer.

Therneau TM, Grambsch PM (2000). Modeling Survival Data: Extending the Cox Model. Springer.

Royston P, Parmar MK (2013). Restricted mean survival time: an alternative to the hazard ratio for the design and analysis of randomized trials with a time-to-event outcome. BMC Medical Research Methodology 13:152.
}
