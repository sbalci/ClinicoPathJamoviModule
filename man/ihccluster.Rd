% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ihccluster.h.R
\name{ihccluster}
\alias{ihccluster}
\title{IHC Clustering Analysis}
\usage{
ihccluster(
  data,
  catVars = NULL,
  contVars = NULL,
  caseId = NULL,
  spatialCompartment = NULL,
  performSpatialAnalysis = FALSE,
  spatialComparisonMode = "both",
  method = "pam",
  distanceMethod = "gower",
  linkageMethod = "ward",
  nClusters = 3,
  autoSelectK = TRUE,
  kRange = "medium",
  scaleContVars = TRUE,
  weights = "",
  handleMissing = "pairwise",
  consensusClustering = FALSE,
  nBootstrap = 100,
  seed = 42,
  showSilhouette = TRUE,
  showHeatmap = TRUE,
  heatmapScale = "row",
  showDendrogram = TRUE,
  showPCAPlot = TRUE,
  showBoxplots = TRUE,
  markerSummary = TRUE,
  clusterProfiles = TRUE,
  associationTests = TRUE,
  multipleTestingCorrection = "bonferroni",
  markerOptimization = FALSE,
  showMarkerCorrelation = FALSE,
  clusterQualityMetrics = TRUE,
  iterativeRefinement = FALSE,
  refinementIterations = 3,
  reproducibilityTest = FALSE,
  nSplits = 10,
  supervisedClustering = FALSE,
  supervisedVariable = NULL,
  calculateRatios = FALSE,
  ratioNumerator = NULL,
  ratioDenominator = NULL,
  ratioName = "Marker_Ratio",
  ratioClassification = FALSE,
  ratioLowCutoff = 1,
  ratioHighCutoff = 2,
  exportClusters = FALSE,
  knownDiagnosis = NULL,
  calculateDiagnosticMetrics = FALSE,
  identifyOptimalPanel = FALSE,
  panelSize = "pairs",
  flagOutliers = TRUE,
  outlierThreshold = 0.25,
  clinicalVars = NULL,
  survivalTime = NULL,
  survivalEvent = NULL,
  colorPalette = "default",
  fontSize = "medium",
  plotContrast = FALSE,
  showInterpretation = FALSE,
  showTechnicalNotes = FALSE
)
}
\arguments{
\item{data}{The data as a data frame.}

\item{catVars}{Binary (pos/neg) or ordinal (0/1/2/3) stain results}

\item{contVars}{H-scores (0-300), \\% positivity (0-100), or other
continuous measures}

\item{caseId}{Case identifier for tracking}

\item{spatialCompartment}{Groups cases by spatial location (e.g.,
Central/Invasive, Preinvasive/Invasive, Primary/Metastatic)}

\item{performSpatialAnalysis}{Compare clustering patterns across spatial
compartments}

\item{spatialComparisonMode}{How to analyze spatial compartments}

\item{method}{Clustering algorithm to use}

\item{distanceMethod}{Distance metric for clustering}

\item{linkageMethod}{Hierarchical clustering linkage method}

\item{nClusters}{Leave blank for automatic selection using silhouette}

\item{autoSelectK}{Use silhouette width to find optimal number of clusters}

\item{kRange}{Range to test when auto-selecting k}

\item{scaleContVars}{Z-score continuous markers before clustering}

\item{weights}{Comma-separated weights for markers (e.g., "1,1,2,1" for 4
markers)}

\item{handleMissing}{How to handle missing values}

\item{consensusClustering}{Use bootstrap resampling for stable clusters}

\item{nBootstrap}{Number of bootstrap samples for consensus}

\item{seed}{For reproducibility}

\item{showSilhouette}{Show silhouette width plot for cluster quality}

\item{showHeatmap}{Show clustered heatmap of IHC expression}

\item{heatmapScale}{How to scale heatmap values}

\item{showDendrogram}{Show dendrogram for hierarchical clustering}

\item{showPCAPlot}{Show dimension reduction plot with clusters}

\item{showBoxplots}{Show boxplots of continuous markers by cluster}

\item{markerSummary}{Summary statistics for each marker by cluster}

\item{clusterProfiles}{Characteristic features of each cluster}

\item{associationTests}{Test marker-cluster associations}

\item{multipleTestingCorrection}{Correction method for marker association
tests}

\item{markerOptimization}{Analyze marker importance and identify optimal
panel}

\item{showMarkerCorrelation}{Display correlation structure between markers}

\item{clusterQualityMetrics}{Calculate PPV, purity, and cluster quality
measures}

\item{iterativeRefinement}{Perform iterative clustering with marker
selection (advanced)}

\item{refinementIterations}{Number of iterative refinement cycles}

\item{reproducibilityTest}{Random split validation with Cohen kappa
(Sterlacci 2019)}

\item{nSplits}{Number of random splits for reproducibility testing}

\item{supervisedClustering}{Cluster within each known diagnosis group
separately}

\item{supervisedVariable}{Variable defining groups (e.g., histotype,
diagnosis)}

\item{calculateRatios}{Calculate ratios between continuous markers (e.g.,
CD4/CD8 ratio)}

\item{ratioNumerator}{Numerator marker for ratio calculation}

\item{ratioDenominator}{Denominator marker for ratio calculation}

\item{ratioName}{Name for the computed ratio variable}

\item{ratioClassification}{Classify ratio as Low/Intermediate/High using
cutoffs}

\item{ratioLowCutoff}{Values ≤ this are classified as Low}

\item{ratioHighCutoff}{Values ≥ this are classified as High}

\item{exportClusters}{Save cluster assignments to dataset}

\item{knownDiagnosis}{Known diagnoses for calculating marker performance
metrics (sensitivity, specificity, PPV, NPV)}

\item{calculateDiagnosticMetrics}{Compute sensitivity, specificity, PPV,
NPV for each marker when diagnosis is known}

\item{identifyOptimalPanel}{Find minimal marker combinations with maximum
diagnostic discrimination}

\item{panelSize}{Size of antibody panel combinations to evaluate}

\item{flagOutliers}{Identify cases with ambiguous/atypical immunoprofiles
based on silhouette scores}

\item{outlierThreshold}{Silhouette score threshold below which cases are
flagged as outliers}

\item{clinicalVars}{Clinical variables to compare across clusters}

\item{survivalTime}{Time variable for survival analysis}

\item{survivalEvent}{Event variable for survival analysis}

\item{colorPalette}{Color palette for plots (colorblind-safe options
available)}

\item{fontSize}{Base font size for all text elements}

\item{plotContrast}{Enable high contrast mode for better visibility}

\item{showInterpretation}{Display clinical interpretation guide}

\item{showTechnicalNotes}{Display technical notes about the analysis}
}
\value{
A results object containing:
\tabular{llllll}{
\code{results$todo} \tab \tab \tab \tab \tab a html \cr
\code{results$binaryConversionNote} \tab \tab \tab \tab \tab a html \cr
\code{results$summary} \tab \tab \tab \tab \tab a html \cr
\code{results$clusterSizes} \tab \tab \tab \tab \tab a table \cr
\code{results$silhouetteStats} \tab \tab \tab \tab \tab a table \cr
\code{results$clusterProfiles} \tab \tab \tab \tab \tab a table \cr
\code{results$markerSummary} \tab \tab \tab \tab \tab a table \cr
\code{results$associationTests} \tab \tab \tab \tab \tab a table \cr
\code{results$clinicalComparison} \tab \tab \tab \tab \tab a table \cr
\code{results$consensusStats} \tab \tab \tab \tab \tab a table \cr
\code{results$reproducibilityStats} \tab \tab \tab \tab \tab a table \cr
\code{results$supervisedSummary} \tab \tab \tab \tab \tab a table \cr
\code{results$supervisedResults} \tab \tab \tab \tab \tab a html \cr
\code{results$ratioSummary} \tab \tab \tab \tab \tab a table \cr
\code{results$ratioClassificationTable} \tab \tab \tab \tab \tab a table \cr
\code{results$markerImportance} \tab \tab \tab \tab \tab a table \cr
\code{results$clusterQuality} \tab \tab \tab \tab \tab a table \cr
\code{results$refinementHistory} \tab \tab \tab \tab \tab a table \cr
\code{results$markerPerformance} \tab \tab \tab \tab \tab Sensitivity, specificity, PPV, NPV for each marker by diagnosis \cr
\code{results$optimalPanels} \tab \tab \tab \tab \tab Ranked marker combinations for differential diagnosis \cr
\code{results$outlierCases} \tab \tab \tab \tab \tab Cases with ambiguous cluster assignment or low silhouette scores \cr
\code{results$silhouettePlot} \tab \tab \tab \tab \tab an image \cr
\code{results$heatmapPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$dendrogramPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$pcaContributions} \tab \tab \tab \tab \tab a table \cr
\code{results$pcaVariablePlot} \tab \tab \tab \tab \tab an image \cr
\code{results$pcaPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$boxplotPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$markerCorrelationPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$survivalPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$medoidInfo} \tab \tab \tab \tab \tab a table \cr
\code{results$interpretationGuide} \tab \tab \tab \tab \tab a html \cr
\code{results$technicalNotes} \tab \tab \tab \tab \tab a html \cr
\code{results$executiveSummary} \tab \tab \tab \tab \tab a preformatted \cr
\code{results$spatialCompartmentSummary} \tab \tab \tab \tab \tab a table \cr
\code{results$spatialConcordance} \tab \tab \tab \tab \tab a table \cr
\code{results$spatialClusterComparison} \tab \tab \tab \tab \tab a table \cr
\code{results$spatialMarkerDifferences} \tab \tab \tab \tab \tab a table \cr
\code{results$spatialHeatmapPlot} \tab \tab \tab \tab \tab an image \cr
\code{results$sizes} \tab \tab \tab \tab \tab a table \cr
\code{results$distr} \tab \tab \tab \tab \tab a table \cr
\code{results$assoc} \tab \tab \tab \tab \tab a table \cr
\code{results$text} \tab \tab \tab \tab \tab a preformatted \cr
}

Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:

\code{results$clusterSizes$asDF}

\code{as.data.frame(results$clusterSizes)}
}
\description{
Clusters cases based on immunohistochemistry (IHC) staining patterns.
}
\details{
\strong{Variable Types:}
\itemize{
\item Categorical: pos/neg, intensity levels (0/1/2/3), ordinal scales
\item Continuous: H-scores (0-300), \\% positivity (0-100), expression levels
\item Mixed: Any combination of categorical and continuous markers
}

Uses Gower distance to handle mixed data types appropriately.
}
