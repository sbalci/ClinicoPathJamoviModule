---
name: ihcscoring
title: IHC Scoring Standardization
menuGroup: OncoPathologyT
version: '1.0.0'
jas: '1.2'

options:
    - name: data
      type: Data
      description:
          R: the data as a data frame

    - name: intensity_var
      title: Intensity Variable
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            staining intensity scores (typically 0-3 scale)

    - name: proportion_var
      title: Proportion Variable
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            percentage of positive cells (0-100%)

    - name: sample_id_var
      title: Sample ID Variable (Optional)
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
        - id
      description:
          R: >
            unique identifier for each sample

    - name: group_var
      title: Group Variable (Optional)
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
      description:
          R: >
            grouping variable for comparative analysis

    - name: scoring_method
      title: Primary Scoring Method
      type: List
      options:
        - name: hscore
          title: 'H-score (Histoscore)'
        - name: allred
          title: 'Allred Score'
        - name: both
          title: 'Both H-score and Allred'
      default: both
      description:
          R: >
            primary scoring methodology to emphasize

    - name: binary_cutpoint
      title: Binary Classification Cutpoint
      type: Number
      min: 0
      max: 300
      default: 100
      description:
          R: >
            H-score cutpoint for positive/negative classification

    - name: allred_cutpoint
      title: Allred Score Cutpoint
      type: Number
      min: 0
      max: 8
      default: 3
      description:
          R: >
            Allred score cutpoint for positive/negative classification

    - name: intensity_scale
      title: Intensity Scale
      type: List
      options:
        - name: standard
          title: '0-3 Standard Scale'
        - name: extended
          title: '0-4 Extended Scale'
        - name: custom
          title: 'Custom Scale'
      default: standard
      description:
          R: >
            intensity scoring scale used

    - name: biomarker_type
      title: Biomarker Type
      type: List
      options:
        - name: er
          title: 'Estrogen Receptor (ER)'
        - name: pr
          title: 'Progesterone Receptor (PR)'
        - name: her2
          title: 'HER2'
        - name: ki67
          title: 'Ki-67'
        - name: pdl1
          title: 'PD-L1'
        - name: other
          title: 'Other Biomarker'
      default: other
      description:
          R: >
            specific biomarker being analyzed

    - name: show_plots
      title: Show Distribution Plots
      type: Bool
      default: true
      description:
          R: >
            display scoring distribution and correlation plots

    - name: show_agreement_plots
      title: Show Agreement Plots
      type: Bool
      default: true
      description:
          R: >
            display method agreement analysis plots

    - name: include_statistics
      title: Include Descriptive Statistics
      type: Bool
      default: true
      description:
          R: >
            calculate comprehensive descriptive statistics

    - name: include_digital_validation
      title: Include Digital Validation Framework
      type: Bool
      default: false
      description:
          R: >
            include digital pathology validation metrics

    - name: agreement_analysis
      title: Perform Agreement Analysis
      type: Bool
      default: true
      description:
          R: >
            calculate inter-method agreement statistics

    - name: quality_control
      title: Quality Control Assessment
      type: Bool
      default: true
      description:
          R: >
            perform quality control checks and outlier detection

    - name: clinical_interpretation
      title: Clinical Interpretation
      type: Bool
      default: true
      description:
          R: >
            provide clinical context and interpretation

    - name: export_results
      title: Export Results for External Use
      type: Bool
      default: false
      description:
          R: >
            format results for external analysis or reporting

    # Multiple Cut-off Analysis Options
    - name: multiple_cutoffs
      title: Enable Multiple Cut-off Analysis
      type: Bool
      default: false
      description:
          R: >
            analyze biomarker positivity across multiple pre-specified cut-off values

    - name: cutoff_values
      title: Cut-off Values (%)
      type: String
      default: "1, 5, 10, 25, 50"
      description:
          R: >
            comma-separated list of percentage cut-off values for positivity analysis

    - name: cps_analysis
      title: Enable CPS (Combined Positive Score) Analysis
      type: Bool
      default: false
      description:
          R: >
            calculate Combined Positive Score for PD-L1 assessment

    - name: immune_cells_var
      title: Immune Cells Variable (for CPS)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            percentage of PD-L1+ immune cells (required for CPS calculation)

    - name: tumor_cells_var
      title: Tumor Cells Variable (for CPS)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            percentage of PD-L1+ tumor cells (required for CPS calculation)

    - name: cutoff_comparison
      title: Compare Across Cut-offs
      type: Bool
      default: true
      description:
          R: >
            perform statistical comparisons across different cut-off values

    - name: confidence_level
      title: Confidence Level
      type: Number
      min: 0.80
      max: 0.99
      default: 0.95
      description:
          R: >
            confidence level for statistical intervals

    - name: bootstrap_n
      title: Bootstrap Replicates
      type: Integer
      min: 100
      max: 5000
      default: 1000
      description:
          R: >
            number of bootstrap replicates for confidence intervals

    # Automated Quantification Options
    - name: automated_analysis
      title: Enable Automated Image Analysis
      type: Bool
      default: false
      description:
          R: >
            enable automated quantification from histological images

    - name: segmentation_method
      title: Segmentation Method
      type: List
      options:
        - name: manual
          title: 'Manual Annotation'
        - name: stardist
          title: 'StarDist (Deep Learning)'
        - name: cellpose
          title: 'CellPose (Deep Learning)'
        - name: watershed
          title: 'Watershed Transform'
      default: manual
      description:
          R: >
            method for nuclear segmentation in automated analysis

    - name: color_deconvolution
      title: Apply Color Deconvolution
      type: Bool
      default: true
      description:
          R: >
            separate DAB and hematoxylin channels for better quantification

    - name: dab_thresholds
      title: DAB Intensity Thresholds
      type: String
      default: "0.1, 0.3, 0.6"
      description:
          R: >
            optical density thresholds for weak, moderate, and strong DAB staining (comma-separated)

    - name: minimum_nuclear_area
      title: Minimum Nuclear Area (pixels)
      type: Number
      min: 10
      max: 1000
      default: 50
      description:
          R: >
            minimum area threshold for nuclear detection

    - name: maximum_nuclear_area
      title: Maximum Nuclear Area (pixels)
      type: Number
      min: 100
      max: 10000
      default: 2000
      description:
          R: >
            maximum area threshold for nuclear detection

    - name: batch_processing
      title: Enable Batch Processing
      type: Bool
      default: false
      description:
          R: >
            process multiple image files in batch mode

    - name: image_format
      title: Expected Image Format
      type: List
      options:
        - name: tiff
          title: 'TIFF'
        - name: jpg
          title: 'JPEG'
        - name: png
          title: 'PNG'
        - name: svs
          title: 'Aperio SVS'
        - name: ndpi
          title: 'Hamamatsu NDPI'
      default: tiff
      description:
          R: >
            format of input histological images

    - name: validation_metrics
      title: Calculate Validation Metrics
      type: Bool
      default: true
      description:
          R: >
            compare automated results with manual scoring when available

    # Molecular Classification Options
    - name: molecular_classification
      title: Enable Molecular Subtyping
      type: Bool
      default: false
      description:
          R: >
            perform molecular subtype classification based on marker combinations

    - name: classification_system
      title: Classification System
      type: List
      options:
        - name: bladder_mibc
          title: 'Bladder MIBC (GATA3/CK5/6/p16)'
        - name: breast_cancer
          title: 'Breast Cancer Subtypes'
        - name: lung_cancer
          title: 'Lung Cancer Subtypes'
        - name: custom
          title: 'Custom Classification'
      default: bladder_mibc
      description:
          R: >
            molecular classification system to apply

    - name: primary_marker1
      title: Primary Marker 1 (e.g., GATA3)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            first primary marker for molecular classification

    - name: primary_marker2
      title: Primary Marker 2 (e.g., CK5/6)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            second primary marker for molecular classification

    - name: secondary_marker
      title: Secondary Marker (e.g., p16)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            secondary marker for subtype refinement

    - name: classification_cutoffs
      title: Classification Cut-off Values (%)
      type: String
      default: "20, 20, 70"
      description:
          R: >
            comma-separated cut-off values for each marker in order (primary1, primary2, secondary)

    - name: pd1_marker
      title: PD-1 Expression Variable
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            PD-1 expression scores for immune checkpoint analysis

    - name: pdl1_marker
      title: PD-L1 Expression Variable
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            PD-L1 expression scores for immune checkpoint analysis

    - name: checkpoint_cutoffs
      title: Checkpoint Inhibitor Cut-offs (%)
      type: String
      default: "1, 10"
      description:
          R: >
            comma-separated cut-off values for PD-1/PD-L1 positivity analysis

    - name: subtype_statistics
      title: Perform Subtype Statistical Analysis
      type: Bool
      default: true
      description:
          R: >
            calculate statistical comparisons between molecular subtypes

    - name: subtype_visualization
      title: Generate Subtype Visualization
      type: Bool
      default: true
      description:
          R: >
            create plots showing molecular subtype distributions and associations

...