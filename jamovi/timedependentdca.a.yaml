---
name: timedependentdca
title: Time-Dependent Decision Curve Analysis
menuGroup: meddecideT1
menuSubgroup: Medical Decision Analysis
menuTitle: Time-Dependent DCA
menuSubtitle: Net benefit for survival and longitudinal data
version: '0.0.32'
jas: '1.2'

description:
    main: |
        Time-Dependent Decision Curve Analysis (tdDCA) extends standard DCA to
        evaluate the clinical utility of prognostic models with time-to-event outcomes.

        This method calculates net benefit at specific time points, accounting for
        censoring and time-varying risk predictions. It's essential for evaluating
        survival models, recurrence prediction models, and other longitudinal outcomes.

        Common applications: Serial biopsy surveillance, recurrence vs death prediction,
        time-varying treatment decisions.

    R:
        dontrun: false
        usage: |
            # Example with survival outcome
            library(survival)
            data <- lung

            timedependentdca(
              data = data,
              time = 'time',
              event = 'status',
              predictor = 'ph.ecog',
              time_points = c(180, 365, 730),
              reference_strategy = 'treat_all'
            )

completeWhenFilled: true

options:
    - name: data
      type: Data
      description:
          R: the data as a data frame

    - name: time
      title: Time Variable
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            a string naming the time-to-event variable

    - name: event
      title: Event Indicator
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
        - numeric
      description:
          R: >
            a string naming the event indicator (1=event, 0=censored)

    - name: predictor
      title: Risk Predictor (Continuous)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            a string naming the risk score or prediction variable

    - name: time_points
      title: Time Points for Evaluation
      type: String
      default: "365, 730, 1095"
      description:
          R: >
            comma-separated time points at which to calculate net benefit (e.g., "365, 730" for 1 and 2 years)

    - name: threshold_range_min
      title: Minimum Threshold Probability
      type: Number
      min: 0
      max: 0.5
      default: 0.01
      description:
          R: >
            minimum threshold probability for decision curve

    - name: threshold_range_max
      title: Maximum Threshold Probability
      type: Number
      min: 0.5
      max: 0.99
      default: 0.99
      description:
          R: >
            maximum threshold probability for decision curve

    - name: threshold_steps
      title: Number of Threshold Steps
      type: Number
      min: 10
      max: 200
      default: 100
      description:
          R: >
            number of threshold probabilities to evaluate

    - name: reference_strategy
      title: Reference Strategy
      type: List
      options:
        - name: treat_all
          title: Treat All
        - name: treat_none
          title: Treat None
        - name: both
          title: Both (Treat All and Treat None)
      default: both
      description:
          R: >
            reference strategy for comparison

    - name: estimate_survival
      title: Estimate Survival Probabilities
      type: List
      options:
        - name: kaplan_meier
          title: Kaplan-Meier
        - name: cox
          title: Cox Proportional Hazards
        - name: direct
          title: Direct (predictor is probability)
      default: kaplan_meier
      description:
          R: >
            method for estimating event probabilities from predictor

    - name: smoothing
      title: Apply Smoothing to Curves
      type: Bool
      default: false
      description:
          R: >
            apply LOESS smoothing to decision curves for visualization

    - name: use_bootstrap
      title: Calculate Bootstrap Confidence Intervals
      type: Bool
      default: false
      description:
          R: >
            calculate 95% confidence intervals for net benefit using bootstrap resampling (computationally intensive)

    - name: bootstrap_iterations
      title: Bootstrap Iterations
      type: Number
      min: 100
      max: 10000
      default: 500
      description:
          R: >
            number of bootstrap iterations for confidence interval calculation

    - name: ci_level
      title: Confidence Level
      type: Number
      min: 0.80
      max: 0.99
      default: 0.95
      description:
          R: >
            confidence level for bootstrap intervals (e.g., 0.95 for 95% CI)

    - name: plot_net_benefit
      title: Plot Net Benefit Curves
      type: Bool
      default: false
      description:
          R: >
            plot net benefit curves across threshold probabilities

    - name: plot_by_timepoint
      title: Separate Plot for Each Time Point
      type: Bool
      default: false
      description:
          R: >
            create separate plots for each time point (vs. overlay)

    - name: plot_interventions_avoided
      title: Plot Interventions Avoided
      type: Bool
      default: false
      description:
          R: >
            plot number of interventions avoided per 100 patients

    - name: random_seed
      title: Random Seed
      type: Number
      min: 1
      max: 999999
      default: 42
      description:
          R: >
            random seed for reproducible bootstrap sampling
...
