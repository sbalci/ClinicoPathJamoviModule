title: Advanced TNM Stage Migration Analysis
name: stagemigration
jus: '3.0'
stage: 0
compilerMode: tame
children:

  # ===================================================================
  # CORE DATA VARIABLES (Always Visible)
  # ===================================================================
  - type: VariableSupplier
    persistentItems: false
    stretchFactor: 1
    children:
      - type: TargetLayoutBox
        label: "üìä Original TNM Staging System"
        children:
          - type: VariablesListBox
            name: oldStage
            maxItemCount: 1
            isTarget: true
      - type: TargetLayoutBox
        label: "üìä New/Revised TNM Staging System"
        children:
          - type: VariablesListBox
            name: newStage
            maxItemCount: 1
            isTarget: true
      - type: TargetLayoutBox
        label: "‚è∞ Survival Time (months)"
        children:
          - type: VariablesListBox
            name: survivalTime
            maxItemCount: 1
            isTarget: true
      - type: TargetLayoutBox
        label: "üéØ Event Status (Death/Outcome)"
        children:
          - type: VariablesListBox
            name: event
            maxItemCount: 1
            isTarget: true
          - type: LevelSelector
            name: eventLevel

  # ===================================================================
  # QUICK SETUP & CLINICAL PRESETS (Collapsed by Default)
  # ===================================================================
  - type: CollapseBox
    label: "üöÄ Quick Setup & Clinical Presets"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: ComboBox
            name: clinicalPreset
            label: "Clinical Workflow Preset"
          - type: ComboBox
            name: analysisType
            label: "Analysis Depth"
          - type: ComboBox
            name: cancerType
            label: "Cancer Type (for optimized thresholds)"
          - type: CheckBox
            name: enableGuidedMode
            label: "üß≠ Enable Guided Mode (recommended for new users)"
          - type: CheckBox
            name: generateCopyReadyReport
            label: "üìÑ Generate Copy-Ready Clinical Summary"

  # ===================================================================
  # CORE ANALYSIS OPTIONS (Expanded by Default)
  # ===================================================================
  - type: CollapseBox
    label: "üìà Core Migration Analysis"
    collapsed: false
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Essential Migration Tables"
          - type: CheckBox
            name: showMigrationOverview
            label: "Migration Overview (patient counts & percentages)"
          - type: CheckBox
            name: showMigrationMatrix
            label: "Migration Matrix (detailed cross-tabulation)"
          - type: CheckBox
            name: showStageDistribution
            label: "Stage Distribution Comparison"
          - type: CheckBox
            name: showMigrationSummary
            label: "Statistical Migration Summary"
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Statistical Comparison Metrics"
          - type: CheckBox
            name: showStatisticalComparison
            label: "C-index & Performance Metrics"
          - type: CheckBox
            name: showConcordanceComparison
            label: "Concordance Comparison Details"
          - type: CheckBox
            name: calculatePseudoR2
            label: "Pseudo R-squared Measures"

  # ===================================================================
  # ADVANCED STATISTICAL METHODS (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üî¨ Advanced Statistical Methods"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Reclassification & Discrimination"
          - type: CheckBox
            name: calculateNRI
            label: "Net Reclassification Improvement (NRI)"
          - type: TextBox
            name: nriTimePoints
            label: "NRI Time Points (months)"
            format: string
          - type: CheckBox
            name: calculateIDI
            label: "Integrated Discrimination Improvement (IDI)"
          - type: CheckBox
            name: performROCAnalysis
            label: "Time-dependent ROC Analysis"
          - type: TextBox
            name: rocTimePoints
            label: "ROC Time Points (months)"
            format: string
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Clinical Utility Assessment"
          - type: CheckBox
            name: performDCA
            label: "Decision Curve Analysis"
          - type: CheckBox
            name: performCalibration
            label: "Calibration Analysis"
          - type: CheckBox
            name: performClinicalUtilityAnalysis
            label: "Clinical Utility Index Analysis"

  # ===================================================================
  # VALIDATION & ROBUSTNESS (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "‚úÖ Validation & Robustness"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Internal Validation"
          - type: CheckBox
            name: performBootstrap
            label: "Bootstrap Validation"
          - type: TextBox
            name: bootstrapReps
            label: "Bootstrap Repetitions"
            format: number
          - type: CheckBox
            name: performCrossValidation
            label: "Cross-Validation"
          - type: TextBox
            name: cvFolds
            label: "CV Folds"
            format: number
          - type: CheckBox
            name: useOptimismCorrection
            label: "Apply Optimism Correction"

  # ===================================================================
  # CLINICAL SIGNIFICANCE THRESHOLDS (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üéØ Clinical Significance Thresholds"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: TextBox
            name: clinicalSignificanceThreshold
            label: "C-index Clinical Significance Threshold"
            format: number
          - type: TextBox
            name: nriClinicalThreshold
            label: "NRI Clinical Threshold"
            format: number
          - type: TextBox
            name: confidenceLevel
            label: "Confidence Level"
            format: number

  # ===================================================================
  # SPECIALIZED ANALYSES (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üß¨ Specialized Analyses"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Will Rogers Phenomenon"
          - type: CheckBox
            name: showWillRogersAnalysis
            label: "Will Rogers Phenomenon Analysis"
          - type: CheckBox
            name: advancedMigrationAnalysis
            label: "Advanced Migration Analysis"
          - type: CheckBox
            name: calculateSME
            label: "Stage Migration Effect (SME)"
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Advanced Survival Methods"
          - type: CheckBox
            name: calculateRMST
            label: "Restricted Mean Survival Time (RMST)"
          - type: CheckBox
            name: performCompetingRisks
            label: "Competing Risks Analysis"
          - type: CheckBox
            name: performCureModelAnalysis
            label: "Cure Models Analysis"
          - type: CheckBox
            name: performMultiStateAnalysis
            label: "Multi-State Survival Models"

  # ===================================================================
  # COVARIATES & MULTIFACTORIAL (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üî¢ Multifactorial Analysis"
    collapsed: true
    children:
      - type: CheckBox
        name: enableMultifactorialAnalysis
        label: "Enable Multifactorial Analysis"
      - type: VariableSupplier
        persistentItems: false
        enable: (enableMultifactorialAnalysis)
        stretchFactor: 1
        children:
          - type: TargetLayoutBox
            label: "Continuous Covariates"
            children:
              - type: VariablesListBox
                name: continuousCovariates
                isTarget: true
          - type: TargetLayoutBox
            label: "Categorical Covariates"
            children:
              - type: VariablesListBox
                name: categoricalCovariates
                isTarget: true
      - type: LayoutBox
        margin: large
        enable: (enableMultifactorialAnalysis)
        children:
          - type: ComboBox
            name: multifactorialComparisonType
            label: "Comparison Type"
          - type: ComboBox
            name: baselineModel
            label: "Baseline Model"
          - type: CheckBox
            name: performInteractionTests
            label: "Test Stage-Covariate Interactions"
          - type: CheckBox
            name: stratifiedAnalysis
            label: "Stratified Analysis"

  # ===================================================================
  # VISUALIZATIONS (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üìä Visualizations & Plots"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Migration Visualizations"
          - type: CheckBox
            name: showMigrationHeatmap
            label: "Migration Heatmap"
          - type: CheckBox
            name: showSankeyDiagram
            label: "Stage Migration Flow Diagram"
          - type: CheckBox
            name: showWillRogersVisualization
            label: "Will Rogers Effect Visualization"
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Statistical Plots"
          - type: CheckBox
            name: showROCComparison
            label: "ROC Curve Comparison"
          - type: CheckBox
            name: showCalibrationPlots
            label: "Calibration Plots"
          - type: CheckBox
            name: showDecisionCurves
            label: "Decision Curves"
          - type: CheckBox
            name: showForestPlot
            label: "Hazard Ratio Forest Plot"
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Survival Curves"
          - type: CheckBox
            name: showSurvivalCurves
            label: "Show Survival Curves"
          - type: ComboBox
            name: survivalPlotType
            label: "Survival Plot Display"
            enable: (showSurvivalCurves)
          - type: CheckBox
            name: showConfidenceIntervals
            label: "Show Confidence Intervals"
            enable: (showSurvivalCurves)
          - type: CheckBox
            name: showRiskTables
            label: "Show Risk Tables"
            enable: (showSurvivalCurves)
          - type: TextBox
            name: plotTimeRange
            label: "Plot Time Range (months)"
            format: string
            enable: (showSurvivalCurves)

  # ===================================================================
  # OUTPUT & REPORTING (Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "üìù Output & Reporting Options"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Clinical Interpretation"
          - type: CheckBox
            name: showClinicalInterpretation
            label: "Clinical Interpretation Guide"
          - type: CheckBox
            name: showMethodologyNotes
            label: "Methodology Notes"
          - type: CheckBox
            name: includeEffectSizes
            label: "Include Effect Sizes"
          - type: CheckBox
            name: generateExecutiveSummary
            label: "Executive Summary"
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "User Interface"
          - type: CheckBox
            name: showExplanations
            label: "Show Explanations for Results"
          - type: CheckBox
            name: showAbbreviationGlossary
            label: "Show Abbreviation Glossary"
          - type: CheckBox
            name: enableAccessibilityFeatures
            label: "‚ôø Accessibility Features"
          - type: ComboBox
            name: preferredLanguage
            label: "üåê Output Language"
          - type: CheckBox
            name: enableProgressIndicators
            label: "‚è±Ô∏è Show Progress Indicators"
          - type: CheckBox
            name: optimizeForLargeDatasets
            label: "üöÄ Large Dataset Optimization"

  # ===================================================================
  # ADVANCED EXPERT OPTIONS (Deeply Collapsed)
  # ===================================================================
  - type: CollapseBox
    label: "‚öôÔ∏è Advanced Expert Options"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "‚ö†Ô∏è Expert-Level Features (Advanced Users Only)"
          - type: CheckBox
            name: performHomogeneityTests
            label: "Stage Homogeneity Tests"
          - type: CheckBox
            name: performTrendTests
            label: "Stage Trend Analysis"
          - type: CheckBox
            name: performLikelihoodTests
            label: "Likelihood Ratio Tests"
          - type: CheckBox
            name: performRandomForestAnalysis
            label: "Random Survival Forests"
          - type: CheckBox
            name: performSHAPAnalysis
            label: "SHAP Model Interpretability"
          - type: CheckBox
            name: performFrailtyModelsAnalysis
            label: "Frailty Models Analysis"
          - type: CheckBox
            name: performOptimalCutpoint
            label: "Optimal Cut-point Determination"