title: Interrater Reliability
name: agreement
jus: '3.0'
stage: 0
compilerMode: tame
children:

  # ========================================================================
  # DATA INPUT - Essential Variables
  # ========================================================================
  - type: VariableSupplier
    persistentItems: false
    stretchFactor: 1
    children:
      - type: TargetLayoutBox
        label: "ğŸ”¹ Rater Variables (Required)"
        children:
          - type: VariablesListBox
            name: vars
            isTarget: true
            itemDropBehaviour: emptyspace

  - type: VariableSupplier
    persistentItems: false
    stretchFactor: 1
    children:
      - type: TargetLayoutBox
        label: "ğŸ†” Case ID Variable (Optional)"
        children:
          - type: VariablesListBox
            name: caseID
            maxItemCount: 1
            isTarget: true

  # ========================================================================
  # CORE ANALYSIS - Main Statistical Settings
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ“Š Core Agreement Analysis"
    collapsed: false
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Statistical Method Selection"
          - type: ComboBox
            name: multiraterMethod
            label: "Primary Analysis Method"
            options:
              - title: "ğŸ”„ Automatic (recommended for most users)"
                name: auto
              - title: "ğŸ‘¥ Cohen's Kappa (exactly 2 raters)"
                name: cohen
              - title: "ğŸ‘¥ğŸ‘¥ Fleiss' Kappa (3 or more raters)"
                name: fleiss
              - title: "ğŸŒ Krippendorff's Alpha (universal method)"
                name: krippendorff

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Data Type & Weighting"
          - type: ComboBox
            name: wght
            label: "Weighting Scheme"
            options:
              - title: "âšª Unweighted (nominal/categorical data)"
                name: unweighted
              - title: "ğŸ“ Linear Weighted (ordinal data, equal steps)"
                name: equal
              - title: "ğŸ“ Quadratic Weighted (ordinal data, severe distant errors)"
                name: squared

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Statistical Options"
          - type: CheckBox
            name: fleissCI
            label: "ğŸ“ˆ Show Confidence Intervals (recommended)"
          - type: CheckBox
            name: exct
            label: "ğŸ”¬ Use Exact Method (more accurate, slower)"

  # ========================================================================
  # CLINICAL OUTPUT - Results & Interpretation
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ¥ Clinical Output & Interpretation"
    collapsed: false
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Clinical Reports"
          - type: CheckBox
            name: showClinicalSummary
            label: "ğŸ“‹ Clinical Summary (recommended)"
          - type: CheckBox
            name: sft
            label: "ğŸ“Š Individual Rater Frequency Tables"

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Educational Content"
          - type: CheckBox
            name: showAboutAnalysis
            label: "â„¹ï¸ About This Analysis"
          - type: CheckBox
            name: showAssumptions
            label: "âš ï¸ Assumptions & Caveats"
          - type: CheckBox
            name: showStatisticalGlossary
            label: "ğŸ“š Statistical Terms Glossary"
          - type: CheckBox
            name: showWeightedKappaGuide
            label: "ğŸ“ Weighted Kappa Guide"
            enable: (wght != 'unweighted')

  # ========================================================================
  # VISUALIZATION - Charts and Graphics
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ“ˆ Visualization"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Agreement Visualization"
          - type: CheckBox
            name: heatmap
            label: "ğŸ”¥ Agreement Heatmap"
          - type: CheckBox
            name: heatmapDetails
            label: "ğŸ” Show Statistical Details in Heatmap"
            enable: (heatmap)
          
          - type: ComboBox
            name: heatmapTheme
            label: "ğŸ¨ Color Theme"
            enable: (heatmap)
            options:
              - title: "ğŸŒˆ Viridis (colorblind-safe, recommended)"
                name: viridis
              - title: "ğŸ”¥ Plasma (colorblind-safe)"
                name: plasma
              - title: "ğŸŒŠ Cividis (colorblind-safe)"
                name: cividis
              - title: "ğŸ”µ Blue-White-Red"
                name: bwr
              - title: "ğŸŸ¢ Red-Yellow-Green (classic)"
                name: ryg

  # ========================================================================
  # ADVANCED STATISTICS - Extended Statistical Methods
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ”¬ Advanced Statistical Methods"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Alternative Agreement Coefficients"
          - type: CheckBox
            name: kripp
            label: "ğŸŒ Krippendorff's Alpha (handles missing data)"
          - type: ComboBox
            name: krippMethod
            label: "ğŸ“ Data Measurement Level"
            enable: (kripp)
            options:
              - title: "ğŸ·ï¸ Nominal (unordered categories)"
                name: nominal
              - title: "ğŸ“Š Ordinal (ranked categories)"
                name: ordinal
              - title: "ğŸ“ Interval (equal intervals)"
                name: interval
              - title: "ğŸ”¢ Ratio (true zero point)"
                name: ratio
          
          - type: CheckBox
            name: icc
            label: "ğŸ“ˆ Intraclass Correlation Coefficient (ICC)"
          - type: CheckBox
            name: gwetAC
            label: "âš–ï¸ Gwet's AC1/AC2 Coefficients (prevalence-robust)"
          - type: CheckBox
            name: pabak
            label: "ğŸ¯ PABAK (Prevalence-Adjusted Kappa)"

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Bootstrap Analysis"
          - type: CheckBox
            name: bootstrap
            label: "ğŸ”„ Bootstrap Confidence Intervals"
          - type: TextBox
            name: bootstrapSamples
            label: "Bootstrap Samples (100-5000)"
            enable: (bootstrap)
            format: number

  # ========================================================================
  # CONSENSUS ANALYSIS - Agreement Scoring
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ¤ Consensus Analysis"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: CheckBox
            name: consensus
            label: "âœ… Enable Consensus Scoring"
          
          - type: ComboBox
            name: consensus_method
            label: "ğŸ—³ï¸ Consensus Threshold"
            enable: (consensus)
            options:
              - title: "ğŸ‘¥ Simple Majority (>50% agreement)"
                name: majority
              - title: "ğŸ‘¥ğŸ‘¥ Supermajority (â‰¥67% agreement)"
                name: super_majority
              - title: "ğŸ¯ Unanimous Agreement (100%)"
                name: unanimous
          
          - type: ComboBox
            name: tie_breaking
            label: "âš–ï¸ Handle Ties By"
            enable: (consensus)
            options:
              - title: "âŒ Excluding tied cases from analysis"
                name: exclude
              - title: "ğŸ‘¨â€âš•ï¸ Flagging for expert arbitration"
                name: arbitration
              - title: "ğŸ“Š Using global most frequent category"
                name: global_mode
          
          - type: CheckBox
            name: show_consensus_table
            label: "ğŸ“‹ Show Detailed Case-by-Case Results"
            enable: (consensus)

  # ========================================================================
  # DETAILED ANALYSIS - Case and Rater Level Analysis
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ” Detailed Analysis Options"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Rater-Level Analysis"
          - type: CheckBox
            name: pairwiseAnalysis
            label: "ğŸ‘¥ Pairwise Rater Comparisons"
          - type: CheckBox
            name: raterBiasAnalysis
            label: "ğŸ“Š Rater Bias Detection"
          - type: CheckBox
            name: agreementTrendAnalysis
            label: "ğŸ“ˆ Agreement Trend Over Cases (training effect)"

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Case-Level Analysis"
          - type: CheckBox
            name: categoryAnalysis
            label: "ğŸ·ï¸ Category-Specific Agreement"
          - type: CheckBox
            name: outlierAnalysis
            label: "ğŸš¨ Identify Problematic Cases"
          - type: CheckBox
            name: caseDifficultyScoring
            label: "âš–ï¸ Case Difficulty Assessment"

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Clinical Context Analysis"
          - type: CheckBox
            name: pathologyContext
            label: "ğŸ¥ Diagnostic Accuracy Metrics"
          - type: CheckBox
            name: agreementStabilityAnalysis
            label: "ğŸ”¬ Agreement Stability Analysis"

  # ========================================================================
  # DIAGNOSTIC STYLE ANALYSIS - Usubutun Method
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ§¬ Diagnostic Style Analysis (Usubutun Method)"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: CheckBox
            name: diagnosticStyleAnalysis
            label: "ğŸ”¬ Enable Diagnostic Style Clustering"
          
          - type: ComboBox
            name: styleClusterMethod
            label: "ğŸŒ³ Clustering Algorithm"
            enable: (diagnosticStyleAnalysis)
            options:
              - title: "ğŸ”— Ward's Linkage (Usubutun standard, recommended)"
                name: ward
              - title: "ğŸ”— Complete Linkage"
                name: complete
              - title: "ğŸ”— Average Linkage"
                name: average
          
          - type: ComboBox
            name: styleDistanceMetric
            label: "ğŸ“ Distance Metric"
            enable: (diagnosticStyleAnalysis)
            options:
              - title: "ğŸ“Š Percentage Agreement (recommended)"
                name: agreement
              - title: "ğŸ“ˆ Correlation"
                name: correlation
              - title: "ğŸ“ Euclidean Distance"
                name: euclidean
          
          - type: TextBox
            name: styleGroups
            label: "ğŸ‘¥ Number of Style Groups (2-10)"
            enable: (diagnosticStyleAnalysis)
            format: number
          
          - type: CheckBox
            name: identifyDiscordantCases
            label: "ğŸ¯ Identify Cases Distinguishing Styles"
            enable: (diagnosticStyleAnalysis)

  # ========================================================================
  # RATER CHARACTERISTICS - Optional Background Information
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ‘¨â€âš•ï¸ Rater Background Information (Optional)"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: CheckBox
            name: raterCharacteristics
            label: "ğŸ“ Include Rater Background Variables"
      
      - type: VariableSupplier
        persistentItems: false
        stretchFactor: 1
        children:
          - type: TargetLayoutBox
            label: "ğŸ“ Experience Variable"
            children:
              - type: VariablesListBox
                name: experienceVar
                maxItemCount: 1
                isTarget: true
                enable: (raterCharacteristics)
          
          - type: TargetLayoutBox
            label: "ğŸ« Training Institution Variable"
            children:
              - type: VariablesListBox
                name: trainingVar
                maxItemCount: 1
                isTarget: true
                enable: (raterCharacteristics)
          
          - type: TargetLayoutBox
            label: "ğŸ¥ Current Institution Variable"
            children:
              - type: VariablesListBox
                name: institutionVar
                maxItemCount: 1
                isTarget: true
                enable: (raterCharacteristics)
          
          - type: TargetLayoutBox
            label: "ğŸ©º Medical Specialty Variable"
            children:
              - type: VariablesListBox
                name: specialtyVar
                maxItemCount: 1
                isTarget: true
                enable: (raterCharacteristics)

  # ========================================================================
  # STUDY DESIGN - Sample Size Planning
  # ========================================================================
  - type: CollapseBox
    label: "ğŸ“‹ Study Design & Sample Size Planning"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: CheckBox
            name: sampleSizePlanning
            label: "ğŸ“Š Perform Sample Size Planning"
          
          - type: TextBox
            name: targetKappa
            label: "ğŸ¯ Target Kappa Value (0.0-1.0)"
            format: number
            enable: (sampleSizePlanning)
          
          - type: TextBox
            name: targetPrecision
            label: "ğŸ“ Target Precision (CI Width, e.g., 0.1)"
            format: number
            enable: (sampleSizePlanning)

  # ========================================================================
  # SYSTEM & TECHNICAL OPTIONS
  # ========================================================================
  - type: CollapseBox
    label: "âš™ï¸ System & Technical Options"
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: "Performance & Debugging"
          - type: CheckBox
            name: showInlineComments
            label: "ğŸ’¬ Show Inline Statistical Comments"
          - type: CheckBox
            name: enhancedErrorGuidance
            label: "ğŸš¨ Enhanced Error Guidance"
          - type: CheckBox
            name: showProgressIndicators
            label: "â±ï¸ Show Progress for Long Operations"