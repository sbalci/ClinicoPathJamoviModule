---
name: enhancednonparametric
title: Enhanced Non-Parametric Tests
menuGroup: ClinicoPathD Descriptives
menuSubgroup: Advanced Statistical Tests
menuSubtitle: 'Enhanced Non-Parametric Tests with Effect Sizes and Post Hoc Analysis'
version: '0.0.1'
jas: '1.2'

description:
    main: >-
        Performs enhanced non-parametric statistical tests specifically designed for digital pathology
        and biomarker analysis. This module provides comprehensive non-parametric testing with proper
        effect size calculations, assumption checking, and post hoc analysis - addressing critical
        gaps identified in 30% of pathology studies that use these methods. Includes enhanced 
        Mann-Whitney U tests, Kruskal-Wallis tests with Dunn's post hoc testing, and proper 
        multiple comparison corrections commonly needed in biomarker expression analysis.
    R:
        dontrun: false
        usage: |
            # Example 1: Enhanced Mann-Whitney U test for biomarker expression
            library(ClinicoPath)
            data(histopathology)
            
            enhancednonparametric(
                data = histopathology,
                deps = "Age",
                group = "Group",
                test_type = "mann_whitney",
                effect_size = TRUE,
                assumption_checks = TRUE,
                show_descriptives = TRUE
            )
            
            # Example 2: Kruskal-Wallis with post hoc analysis for tumor grades
            enhancednonparametric(
                data = histopathology,
                deps = "Age",
                group = "Grade",
                test_type = "kruskal_wallis",
                posthoc = "dunn",
                posthoc_correction = "bonferroni",
                effect_size = TRUE,
                assumption_checks = TRUE
            )

options:

# Data ----
    - name: data
      type: Data
      description:
          R: >
            The dataset to be analyzed, provided as a data frame. Must contain the
            variables specified in the options below.

# Dependent Variables ----
    - name: deps
      title: Dependent Variables
      type: Variables
      suggested: [continuous]
      permitted: [numeric]
      description:
          R: >
            Continuous variables to be analyzed. These should be numeric variables
            representing biomarker expression levels, cell counts, morphometric measurements,
            or other quantitative pathology data.

# Grouping Variable ----
    - name: group
      title: Grouping Variable
      type: Variable
      suggested: [nominal, ordinal]
      permitted: [factor]
      description:
          R: >
            Categorical variable defining the groups to be compared. For Mann-Whitney U test,
            this should have exactly 2 levels. For Kruskal-Wallis test, can have 2 or more levels.
            Examples: tumor grade, treatment group, diagnostic category.

# Test Selection ----
    - name: test_type
      title: Non-Parametric Test
      type: List
      options:
        - title: Mann-Whitney U Test (2 groups)
          name: mann_whitney
        - title: Kruskal-Wallis Test (2+ groups)
          name: kruskal_wallis
        - title: Wilcoxon Signed-Rank Test (paired)
          name: wilcoxon_signed
        - title: Friedman Test (repeated measures)
          name: friedman
        - title: Cochran's Q Test (>2 paired groups)
          name: cochran_q
        - title: Page's Trend Test (ordered Friedman alternative)
          name: page_trend
      default: mann_whitney
      description:
          R: >
            Select the appropriate non-parametric test based on your study design:
            - Mann-Whitney U: Compare 2 independent groups
            - Kruskal-Wallis: Compare 3+ independent groups  
            - Wilcoxon Signed-Rank: Compare paired samples
            - Friedman: Compare repeated measures (3+ time points)
            - Cochran's Q: Compare proportions/binary outcomes across 3+ matched groups
            - Page's Trend: Test for ordered trends in repeated measures (alternative to Friedman)

# Effect Sizes ----
    - name: effect_size
      title: Calculate Effect Sizes
      type: Bool
      default: true
      description:
          R: >
            Calculate appropriate effect sizes for non-parametric tests:
            - Mann-Whitney: rank-biserial correlation (r)
            - Kruskal-Wallis: eta-squared based on H statistic (η²)
            - Wilcoxon: matched pairs rank-biserial correlation
            - Friedman: Kendall's W (coefficient of concordance)
            - Cochran's Q: Effect size W (Kendall's coefficient of concordance)
            - Page's Trend: Kendall's tau for trend and Kendall's W

    - name: confidence_intervals
      title: Effect Size Confidence Intervals
      type: Bool
      default: true
      description:
          R: >
            Calculate bootstrap confidence intervals for effect sizes.
            Provides 95% confidence intervals using bias-corrected and 
            accelerated (BCa) bootstrap method.

# Post Hoc Analysis ----
    - name: posthoc
      title: Post Hoc Testing
      type: List
      options:
        - title: None
          name: none
        - title: Dunn's Test
          name: dunn
        - title: Conover-Iman Test
          name: conover
        - title: Pairwise Wilcoxon
          name: pairwise_wilcox
      default: none
      description:
          R: >
            Post hoc tests for multiple group comparisons (Kruskal-Wallis):
            - Dunn's Test: Most conservative, controls family-wise error rate
            - Conover-Iman: More powerful, uses pooled variance estimate
            - Pairwise Wilcoxon: Individual Mann-Whitney tests between pairs

    - name: posthoc_correction
      title: Multiple Comparison Correction
      type: List
      options:
        - title: Bonferroni
          name: bonferroni
        - title: Holm-Bonferroni
          name: holm
        - title: False Discovery Rate (BH)
          name: fdr
        - title: False Discovery Rate (BY)
          name: by
        - title: None
          name: none
      default: bonferroni
      description:
          R: >
            Method for correcting p-values in multiple comparisons:
            - Bonferroni: Most conservative, controls FWER strictly
            - Holm-Bonferroni: Less conservative than Bonferroni
            - FDR (BH): Controls false discovery rate (Benjamini-Hochberg)
            - FDR (BY): More conservative FDR control (Benjamini-Yekutieli)

# Assumption Checking ----
    - name: assumption_checks
      title: Assumption Checking
      type: Bool
      default: true
      description:
          R: >
            Perform assumption checks for non-parametric tests:
            - Independence assessment (Durbin-Watson if applicable)
            - Distribution shape comparison between groups
            - Outlier detection and impact assessment
            - Sample size adequacy evaluation

    - name: normality_tests
      title: Test Normality (for comparison)
      type: Bool
      default: true
      description:
          R: >
            Test normality of data to justify use of non-parametric methods.
            Performs Shapiro-Wilk test (n<50) or Anderson-Darling test (n≥50)
            and provides recommendation for parametric vs non-parametric analysis.

# Descriptive Statistics ----
    - name: show_descriptives
      title: Descriptive Statistics
      type: Bool
      default: true
      description:
          R: >
            Display comprehensive descriptive statistics including:
            - Median, quartiles, and interquartile range
            - Mean and standard deviation (for comparison)
            - Sample sizes and missing data counts
            - Min/max values and outlier identification

    - name: descriptive_plots
      title: Descriptive Plots
      type: Bool
      default: true
      description:
          R: >
            Generate publication-quality descriptive plots:
            - Box plots with individual data points
            - Violin plots showing distribution shapes
            - Density plots for distribution comparison
            - QQ plots for normality assessment

# Advanced Options ----
    - name: exact_test
      title: Use Exact Tests (when possible)
      type: Bool
      default: false
      description:
          R: >
            Use exact distribution calculations instead of asymptotic approximations
            when computationally feasible. Recommended for small sample sizes (n<20)
            or when ties are present in the data.

    - name: continuity_correction
      title: Continuity Correction
      type: Bool
      default: true
      description:
          R: >
            Apply continuity correction for better approximation to normal distribution
            in Mann-Whitney U and Wilcoxon tests. Generally recommended unless
            sample sizes are very large.

    - name: tie_correction
      title: Tie Correction
      type: Bool
      default: true
      description:
          R: >
            Apply correction for tied observations in rank-based tests.
            Important for accurate p-values when data contains many tied values,
            common in categorical or discretized measurements.

# Confidence Level ----
    - name: confidence_level
      title: Confidence Level
      type: Number
      min: 0.5
      max: 0.999
      default: 0.95
      description:
          R: >
            Confidence level for confidence intervals (e.g., 0.95 for 95% CI).
            Applied to effect size confidence intervals and descriptive statistics.

# Output Options ----
    - name: show_explanations
      title: Show Method Explanations
      type: Bool
      default: false
      description:
          R: >
            Display detailed explanations of non-parametric methods, assumptions,
            and interpretation guidelines. Helpful for educational purposes and
            ensuring proper understanding of the statistical methods used.

    - name: show_interpretation
      title: Show Result Interpretation
      type: Bool
      default: false
      description:
          R: >
            Provide plain-language interpretation of statistical results,
            including effect size magnitude interpretation and clinical significance
            guidelines. Designed to help non-statisticians understand results.

    - name: show_recommendations
      title: Show Statistical Recommendations
      type: Bool
      default: false
      description:
          R: >
            Provide recommendations for follow-up analyses, sample size considerations,
            and potential improvements to study design. Includes guidance on when
            to consider parametric alternatives or additional testing.

...