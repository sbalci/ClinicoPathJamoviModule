title: Advanced IHC Clustering
name: ihcadvanced
jus: '3.0'
stage: 0
compilerMode: tame

children:
  - type: VariableSupplier
    persistentItems: false
    stretchFactor: 1
    children:
      - type: TargetLayoutBox
        label: IHC Markers (e.g., ER, PR, HER2, Ki67)
        children:
          - type: VariablesListBox
            name: markers
            isTarget: true
      - type: TargetLayoutBox
        label: Case ID (for tracking individual samples)
        children:
          - type: VariablesListBox
            name: id
            maxItemCount: 1
            isTarget: true

  - type: LayoutBox
    margin: large
    stretchFactor: 1
    children:
      - type: Label
        label: Clustering Optimization - How to find the best number of clusters
        children:
          - type: LayoutBox
            margin: large
            children:
              - type: ComboBox
                name: optimalKMethod
                label: "Method to determine optimal clusters (Recommended: Silhouette)"
              - type: TextBox
                name: kRange
                label: "Range of clusters to test (e.g., 2:8 or 2,3,4,5)"
                format: string
                enable: (!optimalKMethod:manual)
              - type: CheckBox
                name: iterativeClustering
                label: "Find most informative markers automatically"
              - type: CheckBox
                name: consensusClustering
                label: "Use bootstrap validation for stability (slower but more reliable)"

  - type: LayoutBox
    margin: large
    stretchFactor: 1
    children:
      - type: Label
        label: Analysis Options - Additional analyses to perform
        children:
          - type: LayoutBox
            margin: large
            children:
              - type: CheckBox
                name: pcaAnalysis
                label: "Principal Component Analysis (dimensionality reduction)"
              - type: CheckBox
                name: clusterValidation
                label: "Calculate cluster quality metrics (silhouette, Dunn index)"
              - type: CheckBox
                name: showAdvancedPlots
                label: "Generate detailed visualization plots"

  - type: LayoutBox
    margin: large
    stretchFactor: 1
    children:
      - type: Label
        label: Advanced Settings - Fine-tune analysis parameters
        children:
          - type: LayoutBox
            margin: large
            children:
              - type: TextBox
                name: nBootstrap
                label: "Bootstrap iterations (100-1000, more = slower but more reliable)"
                format: number
                enable: (consensusClustering)
              - type: CheckBox
                name: parallelProcessing
                label: "Use multiple CPU cores (faster for large datasets)"
              - type: TextBox
                name: randomSeed
                label: "Random seed (123 = reproducible results)"
                format: number