---
name: pathsampling
title: Pathology Sampling Adequacy Analysis
menuGroup: OncoPathT
menuSubgroup: ClinicoPath Descriptives
version: '1.0.0'
jas: '1.2'

options:
    - name: data
      type: Data

    - name: analysisContext
      title: Analysis Context
      type: List
      options:
        - name: lymphnode
          title: Lymph Node Dissection
        - name: omentum
          title: Omentum Sampling
        - name: tumor
          title: Tumor Sampling (VI/EMVI/PNI/Budding)
        - name: margin
          title: Margin Assessment
        - name: general
          title: General Sampling Adequacy
      default: general
      description: >
        Select the type of pathology sampling analysis:
        - Lymph Node: Adequacy of lymph node dissection
        - Omentum: Omentum sampling in ovarian/gastric cancer
        - Tumor: Tumor block sampling for VI, EMVI, PNI, or budding detection
        - Margin: Margin sampling adequacy
        - General: Custom sampling adequacy analysis

    - name: totalSamples
      title: Total Samples
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL
      description: >
        Total number of samples examined per case.
        Examples: total tumor blocks examined, total lymph nodes dissected, total omentum sections.

    - name: firstDetection
      title: First Detection
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL
      description: >
        Sample number where outcome was first detected (e.g., which block first showed VI).
        Leave as NA for negative cases. For positive cases, enter the sequential sample number (1, 2, 3, etc.).

    - name: positiveCount
      title: Positive Samples Count (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: positiveSamplesList
      title: Positive Samples List (Optional)
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
        - numeric
      default: NULL

    - name: sampleType
      title: Compare Sample Type/Subtype (Optional)
      type: Variable
      suggested:
        - nominal
        - ordinal
      permitted:
        - factor
      default: NULL

    - name: targetConfidence
      title: Target Confidence
      type: Number
      min: 0.5
      max: 0.99
      default: 0.95

    - name: maxSamples
      title: Maximum Samples
      type: Integer
      min: 1
      max: 50
      default: 10

    - name: bootstrapIterations
      title: Bootstrap Iterations
      type: Integer
      min: 100
      max: 100000
      default: 10000

    - name: showBinomialModel
      title: Show Binomial Model
      type: Bool
      default: false

    - name: showBootstrap
      title: Show Bootstrap Analysis
      type: Bool
      default: false

    - name: showDetectionCurve
      title: Show Diagnostic Yield Curve
      type: Bool
      default: false

    - name: showSensitivityCI
      title: Show Sensitivity CI
      type: Bool
      default: false

    - name: setSeed
      title: Set Random Seed
      type: Bool
      default: false

    - name: seedValue
      title: Seed Value
      type: Integer
      default: 42
      min: 1

    - name: positiveCassettes
      title: Positive Cassettes (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: maxPositiveSingle
      title: Max Foci per Cassette (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: showTumorBurden
      title: Show Tumor Burden Analysis
      type: Bool
      default: false

    - name: showStageMigration
      title: Show Stage Migration Analysis
      type: Bool
      default: false

    - name: showCorrelation
      title: Show Correlation Plot
      type: Bool
      default: false

    - name: showDistributionPattern
      title: Show Distribution Pattern Analysis
      type: Bool
      default: false

    - name: distributionThreshold
      title: Distribution Threshold
      type: Integer
      min: 1
      max: 20
      default: 5

    - name: modelType
      title: Model Type
      type: List
      options:
        - name: binomial
          title: Binomial (infinite population)
        - name: hypergeometric
          title: Hypergeometric (finite population)
        - name: betabinomial
          title: Beta-Binomial (finite population with overdispersion)
      default: binomial

    - name: totalPopulation
      title: Total Population (Finite Models)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: successStates
      title: Success States (Finite Models)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: targetDetections
      title: Target Detections
      type: Integer
      min: 1
      max: 20
      default: 1

    - name: showHypergeometric
      title: Show Hypergeometric Model
      type: Bool
      default: false

    - name: showBetaBinomial
      title: Show Beta-Binomial Model
      type: Bool
      default: false

    - name: totalLymphNodes
      title: Total Lymph Nodes
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: positiveLymphNodes
      title: Positive Lymph Nodes
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      default: NULL

    - name: showLNAnalysis
      title: Show LN Ratio & Staging
      type: Bool
      default: false

    - name: lnrThreshold1
      title: LNR Threshold 1
      type: Number
      min: 0.01
      max: 1.00
      default: 0.1

    - name: lnrThreshold2
      title: LNR Threshold 2
      type: Number
      min: 0.01
      max: 1.00
      default: 0.3

    - name: showEffectSizes
      title: Show Effect Sizes
      type: Bool
      default: false

    - name: showOmentumAnalysis
      title: Show Omentum Analysis
      type: Bool
      default: false

    - name: showClinicalSummary
      title: Show Clinical Summary
      type: Bool
      default: false

    - name: showGuidedInstructions
      title: Show Guided Instructions (Detailed Checklist)
      type: Bool
      default: false
      description: >
        Display detailed step-by-step checklist with examples and common use cases.
        Best for first-time users and training.

    - name: showConciseInstructions
      title: Show Concise Instructions (Brief Overview)
      type: Bool
      default: false
      description: >
        Display brief analysis overview with required variables and methods.
        Best for experienced users.

    - name: showEmpiricalCumulative
      title: Show Empirical Cumulative Detection
      type: Bool
      default: false

    - name: showSpatialClustering
      title: Show Spatial Clustering Analysis
      type: Bool
      default: false

    - name: showStratifiedAnalysis
      title: Show Stratified Analysis by Sample Type
      type: Bool
      default: false

    - name: showPopulationDetection
      title: Show Population-Level Detection Rates
      type: Bool
      default: false

    - name: showIncrementalYield
      title: Show Incremental Diagnostic Yield
      type: Bool
      default: false

    - name: showMultifocalAnalysis
      title: Show Multifocal Detection Analysis
      type: Bool
      default: false

    - name: showProbabilityExplanation
      title: Show Probability Explanation
      type: Bool
      default: false
      description: >
        Show detailed explanation distinguishing conditional vs population-level detection probabilities.

    - name: showKeyResults
      title: Show Key Results Summary
      type: Bool
      default: false
      description: >
        Display a concise summary of key findings at the top of results.

    - name: showRecommendText
      title: Show Clinical Recommendations
      type: Bool
      default: false
      description: >
        Display context-specific clinical recommendations based on analysis results.

    - name: showInterpretText
      title: Show Statistical Interpretation
      type: Bool
      default: false
      description: >
        Show statistical interpretation and guidance for result interpretation.

    - name: showReferencesText
      title: Show References & Methods
      type: Bool
      default: false
      description: >
        Display statistical methods documentation and literature references.

    - name: estimationMethod
      title: q Estimation Method
      type: List
      options:
        - name: auto
          title: Auto (use best available method)
        - name: geometric
          title: Geometric MLE (first detection only)
        - name: empirical
          title: Empirical Proportion (requires positive count)
      default: auto

    - name: showHeterogeneityTest
      title: Show Heterogeneity Test
      type: Bool
      default: false
      description: >
        Test if detection probability varies significantly across sample types.
        Only available when Sample Type variable is specified. Uses likelihood ratio test.

    - name: useGeometricCI
      title: Use Geometric CI When Needed
      type: Bool
      default: true
      description: >
        Use theoretical geometric model confidence intervals when bootstrap
        shows ceiling effect (100% bounds). Provides more realistic uncertainty estimates.

    - name: ciMethod
      title: Confidence Interval Method
      type: List
      options:
        - name: auto
          title: Auto (choose best method)
        - name: bootstrap
          title: Bootstrap only
        - name: geometric
          title: Geometric model only
        - name: both
          title: Both (for comparison)
      default: auto
      description: >
        Method for calculating confidence intervals. Auto selects geometric when bootstrap
        shows ceiling effect, otherwise uses bootstrap.

    - name: showModelFit
      title: Show Model Fit Assessment
      type: Bool
      default: false
      description: >
        Perform goodness-of-fit test comparing observed vs predicted detection distribution.
        Validates geometric/binomial model assumptions.

    - name: showObsPred
      title: Show Observed vs Predicted Table
      type: Bool
      default: false
      description: >
        Compare observed detection rates with model predictions at each sample number.
        Visual model validation tool.

    - name: showMarginalInterpretation
      title: Interpret Marginal Benefits
      type: Bool
      default: true
      description: >
        Add cost-benefit interpretation to marginal gain analysis. Auto-enabled when
        Show Binomial Model is checked.

    - name: showPowerAnalysis
      title: Show Power Analysis
      type: Bool
      default: false

    - name: targetPower
      title: Target Power
      type: Number
      min: 0.5
      max: 0.99
      default: 0.8

    - name: targetDetectionProb
      title: Target Detection Probability
      type: Number
      min: 0.5
      max: 0.99
      default: 0.95

    - name: autoSelectModel
      title: Auto-Select Best Model
      type: Bool
      default: false

    - name: appendVariables
      title: Append Calculated Variables to Data
      type: Bool
      default: false
      description: >
        Add new columns to dataset with calculated detection probabilities and classifications.
        Variables include cumulative probabilities, recommended sample counts, and detection categories.

    - name: appendPrefix
      title: Variable Name Prefix
      type: String
      default: "ps_"
      description: >
        Prefix for appended variable names (e.g., 'ps_' creates 'ps_cumulative_prob_5').
        Only used when Append Variables is enabled.

    - name: autoDetectHeterogeneity
      title: Auto-Detect Population Heterogeneity
      type: Bool
      default: true
      description: >
        Automatically analyze and report if sample types have significantly different
        detection probabilities. Requires Sample Type variable. Warns if CV > 30%.
