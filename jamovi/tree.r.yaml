---
name: tree
title: Medical Decision Tree Analysis
jrs: '1.1'

items:
    # Instructions and status
    - name: todo
      title: Instructions
      type: Html
      visible: false

    - name: text1
      title: Analysis Status
      type: Html
      visible: true
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation
        - hyperparameter_tuning
        - model_comparison
        
    - name: progress_feedback
      title: Analysis Progress
      type: Html
      visible: true
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation
        - hyperparameter_tuning
        - model_comparison

    # Main model results
    - name: model_summary
      title: Model Summary
      type: Html
      visible: (show_performance_metrics)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation


    # Performance tables and metrics
    - name: performance_table
      title: Performance Metrics
      type: Table
      visible: (show_performance_metrics)
      columns:
        - name: metric
          title: Metric
          type: text
        - name: value
          title: Value
          type: number
          format: dp:3
        - name: ci_lower
          title: CI Lower
          type: number
          format: dp:3
        - name: ci_upper
          title: CI Upper
          type: number
          format: dp:3
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    - name: clinicalMetricsTable
      title: Clinical Performance Metrics
      type: Table
      visible: (show_performance_metrics)
      columns:
        - name: metric
          title: Clinical Metric
          type: text
        - name: value
          title: Value
          type: number
          format: dp:3
        - name: interpretation
          title: Clinical Interpretation
          type: text
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: performance_table_explanation
      title: Interpreting Performance Metrics
      type: Html
      visible: (show_performance_metrics)

    # Confusion matrix
    - name: confusion_matrix
      title: Confusion Matrix
      type: Html
      visible: (show_confusion_matrix)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    - name: confusion_matrix_explanation
      title: Reading the Confusion Matrix
      type: Html
      visible: (show_confusion_matrix)
      
    - name: confusion_matrix_plot
      title: Confusion Matrix Heatmap
      type: Image
      width: 500
      height: 400
      renderFun: .plot_confusion_matrix
      visible: (show_confusion_matrix)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    # Visualizations - Tree plots
    - name: tree_plot
      title: Decision Tree Visualization
      type: Image
      width: 800
      height: 600
      renderFun: .plot_tree
      visible: (show_tree_plot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - max_depth
        - min_samples_split
        - min_samples_leaf

    - name: tree_plot_explanation
      title: How to Read the Decision Tree
      type: Html
      visible: (show_tree_plot)
      clearWith:
        - algorithm

    - name: partitionPlot
      title: Decision Boundary Visualization
      type: Image
      width: 600
      height: 500
      renderFun: .plot_partition
      visible: (showPartitionPlot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Feature importance
    - name: importance_plot
      title: Feature Importance
      type: Image
      width: 700
      height: 500
      renderFun: .plot_importance
      visible: (show_importance_plot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - importance_method

    - name: importance_plot_explanation
      title: Understanding Feature Importance
      type: Html
      visible: (show_importance_plot)
      clearWith:
        - algorithm
        - importance_method

    - name: featureImportanceTable
      title: Feature Importance Rankings
      type: Table
      visible: (show_importance_plot)
      columns:
        - name: feature
          title: Clinical Variable
          type: text
        - name: importance
          title: Importance Score
          type: number
          format: dp:3
        - name: rank
          title: Rank
          type: integer
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Performance visualizations
    - name: roc_plot
      title: ROC Curve Analysis
      type: Image
      width: 600
      height: 500
      renderFun: .plot_roc
      visible: (show_roc_curve)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    - name: roc_plot_explanation
      title: Understanding the ROC Curve
      type: Html
      visible: (show_roc_curve)

    - name: validation_curves
      title: Validation Performance
      type: Image
      width: 800
      height: 500
      renderFun: .plot_validation
      visible: (show_validation_curves)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation
        - cv_folds

    - name: calibration_plot
      title: Probability Calibration
      type: Image
      width: 600
      height: 500
      renderFun: .plot_calibration
      visible: (show_calibration_plot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    # Interpretability analysis
    - name: shap_plot
      title: SHAP Value Analysis
      type: Image
      width: 800
      height: 600
      renderFun: .plot_shap
      visible: (shap_analysis && interpretability)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: partial_dependence_plot
      title: Partial Dependence Plots
      type: Image
      width: 900
      height: 700
      renderFun: .plot_partial_dependence
      visible: (partial_dependence && interpretability)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: interaction_plot
      title: Feature Interactions
      type: Image
      width: 700
      height: 600
      renderFun: .plot_interactions
      visible: (interaction_analysis && interpretability)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Clinical interpretation and reporting
    - name: clinical_interpretation
      title: Clinical Interpretation Guide
      type: Html
      visible: (show_clinical_interpretation)
      clearWith:
        - clinical_context
        - algorithm
        - target

    - name: clinicalInterpretation
      title: Medical Decision Support
      type: Html
      visible: (show_clinical_interpretation)
      clearWith:
        - clinical_context
        - target
        - targetLevel

    - name: riskStratification
      title: Risk Stratification Analysis
      type: Html
      visible: (clinical_context:risk || clinical_context:prognosis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Advanced analysis results
    - name: feature_selection_results
      title: Feature Selection Results
      type: Html
      visible: (feature_selection)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: bootstrap_intervals
      title: Bootstrap Confidence Intervals
      type: Html
      visible: (bootstrap_confidence)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - n_bootstrap

    - name: crossValidationTable
      title: Cross-Validation Results
      type: Table
      visible: (validation:cv)
      columns:
        - name: fold
          title: Fold
          type: integer
        - name: accuracy
          title: Accuracy
          type: number
          format: dp:3
        - name: sensitivity
          title: Sensitivity
          type: number
          format: dp:3
        - name: specificity
          title: Specificity
          type: number
          format: dp:3
        - name: auc
          title: AUC
          type: number
          format: dp:3
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - cv_folds

    - name: bootstrapTable
      title: Bootstrap Validation Results
      type: Table
      visible: (validation:bootstrap)
      columns:
        - name: iteration
          title: Bootstrap Sample
          type: integer
        - name: accuracy
          title: Accuracy
          type: number
          format: dp:3
        - name: sensitivity
          title: Sensitivity
          type: number
          format: dp:3
        - name: specificity
          title: Specificity
          type: number
          format: dp:3
        - name: auc
          title: AUC
          type: number
          format: dp:3
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Model comparison
    - name: modelComparison
      title: Algorithm Comparison
      type: Table
      visible: (model_comparison)
      columns:
        - name: algorithm
          title: Algorithm
          type: text
        - name: accuracy
          title: Accuracy
          type: number
          format: dp:3
        - name: sensitivity
          title: Sensitivity
          type: number
          format: dp:3
        - name: specificity
          title: Specificity
          type: number
          format: dp:3
        - name: auc
          title: AUC
          type: number
          format: dp:3
        - name: rank
          title: Rank
          type: integer
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - modelComparisonMetric

    # Complexity parameter analysis
    - name: cp_table_analysis
      title: Complexity Parameter Analysis
      type: Html
      visible: (show_cp_table)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: cp_plot
      title: Complexity Parameter Plot
      type: Image
      width: 600
      height: 400
      renderFun: .plot_cp
      visible: (show_cp_plot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: rsq_plot
      title: R-squared Plot
      type: Image
      width: 600
      height: 400
      renderFun: .plot_rsq
      visible: (show_rsq_plot)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Detailed variable importance
    - name: detailed_importance_analysis
      title: Detailed Variable Importance
      type: Html
      visible: (show_variable_importance_detailed)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Enhanced rpart analysis
    - name: competing_splits_analysis
      title: Competing Splits Analysis
      type: Html
      visible: (competing_splits)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: surrogate_splits_analysis
      title: Surrogate Splits Analysis
      type: Html
      visible: (surrogate_splits)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Export information
    - name: model_export
      title: Model Export Information
      type: Html
      visible: (export_model)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: exportInfo
      title: Data Export Information
      type: Html
      visible: (exportPredictions)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Model stability and robustness results
    - name: stability_analysis
      title: Model Stability Analysis
      type: Html
      visible: (model_stability_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: stability_plot
      title: Model Stability Visualization
      type: Image
      width: 800
      height: 600
      renderFun: .plot_stability
      visible: (model_stability_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: learning_curves_plot
      title: Learning Curves
      type: Image
      width: 800
      height: 500
      renderFun: .plot_learning_curves
      visible: (learning_curves)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - cv_folds

    - name: outlier_analysis_results
      title: Outlier Analysis Results
      type: Html
      visible: (outlier_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: outlier_plot
      title: Influential Observations Plot
      type: Image
      width: 700
      height: 500
      renderFun: .plot_outliers
      visible: (outlier_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: prediction_intervals_table
      title: Prediction Confidence Intervals
      type: Table
      visible: (prediction_intervals)
      columns:
        - name: observation
          title: Case ID
          type: integer
        - name: prediction
          title: Prediction
          type: text
        - name: probability
          title: Probability
          type: number
          format: dp:3
        - name: ci_lower
          title: CI Lower
          type: number
          format: dp:3
        - name: ci_upper
          title: CI Upper
          type: number
          format: dp:3
        - name: interval_width
          title: Interval Width
          type: number
          format: dp:3
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Advanced pruning analysis
    - name: pruning_analysis
      title: Advanced Pruning Analysis
      type: Html
      visible: (advanced_pruning:rep || advanced_pruning:mep)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - advanced_pruning

    # Enhanced cross-validation results
    - name: enhanced_cv_results
      title: Enhanced Cross-Validation Analysis
      type: Html
      visible: (validation:stratified_cv || validation:repeated_cv)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation
        - cv_folds
        - cv_repeats

    - name: enhanced_cv_table
      title: Detailed Cross-Validation Results
      type: Table
      visible: (validation:stratified_cv || validation:repeated_cv)
      columns:
        - name: metric
          title: Performance Metric
          type: text
        - name: mean
          title: Mean
          type: number
          format: dp:3
        - name: sd
          title: Standard Deviation
          type: number
          format: dp:3
        - name: min
          title: Minimum
          type: number
          format: dp:3
        - name: max
          title: Maximum
          type: number
          format: dp:3
        - name: ci_lower
          title: 95% CI Lower
          type: number
          format: dp:3
        - name: ci_upper
          title: 95% CI Upper
          type: number
          format: dp:3
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm
        - validation

    # Advanced rpart analysis sections
    - name: cp_sequence_analysis_results
      title: CP Sequence Analysis
      type: Html
      visible: (cp_sequence_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: xerror_detailed_analysis_results
      title: Detailed Cross-validation Error Analysis
      type: Html
      visible: (xerror_detailed_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: impurity_analysis_results
      title: Splitting Impurity Analysis
      type: Html
      visible: (impurity_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: recursive_partitioning_trace_results
      title: Recursive Partitioning Trace
      type: Html
      visible: (recursive_partitioning_trace)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    - name: xerror_confidence_plot
      title: Cross-validation Error with Confidence Bands
      type: Image
      width: 700
      height: 500
      renderFun: .plot_xerror_confidence
      visible: (xerror_detailed_analysis)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

    # Enhanced confusion matrix results
    - name: enhanced_confusion_matrix
      title: Clinical Confusion Matrix Analysis
      type: Html
      visible: (show_confusion_matrix)
      clearWith:
        - vars
        - facs
        - target
        - targetLevel
        - algorithm

...