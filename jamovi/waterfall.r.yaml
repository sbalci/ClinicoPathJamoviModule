---
name:  waterfall
title: Treatment Response Analysis
jrs:   '1.1'

items:


    - name: guidedAnalysis
      title: Guided Analysis Steps
      type: Html
      visible: (enableGuidedMode)
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - enableGuidedMode


    - name: todo
      title: Treatment Response Analysis Guide
      type: Html
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - enableGuidedMode
      visible: (!enableGuidedMode)

    - name: todo2
      title: Validation Messages
      type: Html
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - enableGuidedMode
      visible: (!enableGuidedMode)

    - name: clinicalSummary
      title: Clinical Summary
      type: Html
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - colorScheme
         - groupVar

    - name: aboutAnalysis
      title: About This Analysis
      type: Html
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - enableGuidedMode
      visible: (!enableGuidedMode)

    - name: summaryTable
      title: Response Categories Based on RECIST v1.1 Criteria
      type: Table
      rows: 0
      columns:
        - name: category
          title: "Category"
          type: text
        - name: n
          title: "Number of Patients"
          type: integer
        - name: percent
          title: "Percentage"
          type: number
          format: percent
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType


    # - name: summaryTable_explanation
    #   title: summaryTable
    #   type: Html
    #   clearWith:
    #      - patientID
    #      - responseVar
    #      - timeVar
    #      - inputType



    - name: personTimeTable
      title: Person-Time Analysis
      type: Table
      rows: 0
      columns:
        - name: category
          title: "Response Category"
          type: text
        - name: patients
          title: "Patients"
          type: integer
        - name: patient_pct
          title: "% Patients"
          type: text
        - name: person_time
          title: "Person-Time"
          type: text
        - name: time_pct
          title: "% Time"
          type: text
        - name: median_time
          title: "Median Time to Response"
          type: text
        - name: median_duration
          title: "Median Duration"
          type: text


    - name: clinicalMetrics
      title: Clinical Response Metrics
      type: Table
      rows: 0
      columns:
        - name: metric
          title: "Metric"
          type: text
        - name: value
          title: "Value"
          type: text
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType

    - name: waterfallplot
      title: 'Waterfall Plot'
      type: Image
      width: 800
      height: 500
      renderFun: .waterfallplot
      requiresData: true
      visible: (showWaterfallPlot)
      clearWith:
        - patientID
        - responseVar
        - sortBy
        - showThresholds
        - labelOutliers
        - colorBy
        - colorScheme
        - showMedian
        - showCI
        - groupVar
        - inputType

    - name: copyReadyReport
      title: Copy-Ready Report Sentences
      type: Html
      visible: (generateCopyReadyReport)
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - generateCopyReadyReport

    - name: clinicalSignificance
      title: Clinical Significance Assessment
      type: Html
      visible: (showClinicalSignificance)
      clearWith:
         - patientID
         - responseVar
         - showClinicalSignificance

    - name: clinicalGlossary
      title: Clinical Terms & Definitions
      type: Html
      visible: (showClinicalSignificance)
      clearWith:
         - patientID
         - responseVar
         - showClinicalSignificance



    - name: enhancedClinicalMetrics
      title: Enhanced Clinical Response Metrics
      type: Table
      rows: 0
      columns:
        - name: metric
          title: "Metric"
          type: text
        - name: value
          title: "Value"
          type: text
        - name: ci_lower
          title: "95% CI Lower"
          type: number
        - name: ci_upper
          title: "95% CI Upper"
          type: number
        - name: interpretation
          title: "Clinical Interpretation"
          type: text
      visible: (showConfidenceIntervals)
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - showConfidenceIntervals

    - name: groupComparisonTable
      title: Group Comparison Analysis
      type: Table
      rows: 0
      columns:
        - name: group
          title: "Group"
          type: text
        - name: n_patients
          title: "N"
          type: integer
        - name: orr
          title: "ORR (%)"
          type: number
        - name: orr_ci
          title: "95% CI"
          type: text
        - name: dcr
          title: "DCR (%)"
          type: number
        - name: dcr_ci
          title: "95% CI"
          type: text
      visible: (groupVar)
      clearWith:
         - patientID
         - responseVar
         - groupVar
         - inputType

    - name: groupComparisonTest
      title: Group Comparison Statistical Test
      type: Table
      rows: 0
      columns:
        - name: comparison
          title: "Comparison"
          type: text
        - name: test_statistic
          title: "Test Statistic"
          type: text
        - name: p_value
          title: "p-value"
          type: number
        - name: interpretation
          title: "Clinical Interpretation"
          type: text
      visible: (groupVar)
      clearWith:
         - patientID
         - responseVar
         - groupVar
         - inputType


    - name: spiderplot
      title: 'Spider Plot - Response Over Time'
      type: Image
      width: 800
      height: 500
      renderFun: .spiderplot
      requiresData: true
      visible: (showSpiderPlot)
      # Note: Spider plot requires both showSpiderPlot=true AND a time variable for meaningful trajectories
      clearWith:
        - patientID
        - responseVar
        - timeVar
        - inputType
        - sortBy
        - groupVar
        - showThresholds
        - labelOutliers
        - colorBy
        - colorScheme
        - spiderColorBy
        - spiderColorScheme
        - timeUnitLabel
        - showMedian
        - showCI



    - name: naturalLanguageSummary
      title: Treatment Response Summary
      type: Html
      visible: (showExplanations)
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - groupVar
         - showExplanations

    - name: explanations
      title: Analysis Guide
      type: Html
      visible: (showExplanations)
      clearWith:
         - showExplanations

    - name: addResponseCategory
      title: Add Response Category to Data
      type: Output
      varTitle: RECIST
      varDescription: Calculated response category based on RECIST criteria.
      measureType: nominal
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType


    # - name: mydataview
    #   title: mydataview
    #   type: Preformatted


    # Notice outputs converted to HTML to avoid serialization errors
    - name: notices
      title: Important Information
      type: Html
      clearWith:
         - patientID
         - responseVar
         - timeVar
         - inputType
         - groupVar


refs:
    - recist
    - ClinicoPathJamoviModule


...
