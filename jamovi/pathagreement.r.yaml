---
name:  pathagreement
title: Pathology Interrater Reliability
jrs:   '1.1'

items:
    - name: todo
      title: Getting Started
      type: Html


    - name: overviewTable
      title: Agreement Analysis Summary
      type: Table
      rows: 1
      columns:
        - name: cases
          title: 'Cases'
          type: integer
        - name: raters
          title: 'Raters'
          type: integer
        - name: categories
          title: 'Categories'
          type: integer
        - name: overall_agreement
          title: 'Overall Agreement %'
          type: number
          format: zto
        - name: primary_method
          title: 'Primary Method'
          type: text

    - name: kappaTable
      title: 'Kappa Statistics'
      type: Table
      columns:
        - name: method
          title: 'Method'
          type: text
        - name: kappa
          title: 'Kappa'
          type: number
          format: zto
        - name: se
          title: 'Standard Error'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
        - name: z
          title: 'z-value'
          type: number
          format: zto
        - name: p
          title: 'p-value'
          type: number
          format: zto,pvalue
        - name: interpretation
          title: 'Interpretation'
          type: text

    - name: iccTable
      title: 'Intraclass Correlation Coefficients'
      type: Table
      visible: (icc)
      columns:
        - name: type
          title: 'ICC Type'
          type: text
        - name: icc_value
          title: 'ICC'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
        - name: f_value
          title: 'F-value'
          type: number
          format: zto
        - name: p
          title: 'p-value'
          type: number
          format: zto,pvalue
        - name: interpretation
          title: 'Interpretation'
          type: text

    - name: pairwiseTable
      title: 'Pairwise Rater Agreements'
      type: Table
      visible: (pairwiseAnalysis)
      columns:
        - name: rater_pair
          title: 'Rater Pair'
          type: text
        - name: agreement_percent
          title: 'Agreement %'
          type: number
          format: zto
        - name: kappa
          title: 'Kappa'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
        - name: p
          title: 'p-value'
          type: number
          format: zto,pvalue
        - name: interpretation
          title: 'Agreement Level'
          type: text

    - name: categoryTable
      title: 'Category-Specific Agreement'
      type: Table
      visible: (categoryAnalysis)
      columns:
        - name: category
          title: 'Category'
          type: text
        - name: frequency
          title: 'Frequency'
          type: integer
        - name: agreement_percent
          title: 'Agreement %'
          type: number
          format: zto
        - name: kappa
          title: 'Category Kappa'
          type: number
          format: zto
        - name: sensitivity
          title: 'Sensitivity'
          type: number
          format: zto
          visible: (pathologyContext)
        - name: specificity
          title: 'Specificity'
          type: number
          format: zto
          visible: (pathologyContext)

    - name: outlierTable
      title: 'Cases with Poor Agreement'
      type: Table
      visible: (outlierAnalysis)
      columns:
        - name: case_id
          title: 'Case ID'
          type: text
        - name: disagreement_count
          title: 'Disagreements'
          type: integer
        - name: agreement_score
          title: 'Agreement Score'
          type: number
          format: zto
        - name: rater_assignments
          title: 'Rater Assignments'
          type: text
        - name: consensus_diagnosis
          title: 'Consensus'
          type: text
          visible: (pathologyContext)

    - name: diagnosticAccuracyTable
      title: 'Diagnostic Accuracy by Rater'
      type: Table
      visible: (pathologyContext)
      columns:
        - name: rater
          title: 'Rater'
          type: text
        - name: accuracy
          title: 'Accuracy %'
          type: number
          format: zto
        - name: sensitivity
          title: 'Sensitivity %'
          type: number
          format: zto
        - name: specificity
          title: 'Specificity %'
          type: number
          format: zto
        - name: ppv
          title: 'PPV %'
          type: number
          format: zto
        - name: npv
          title: 'NPV %'
          type: number
          format: zto
        - name: kappa_vs_gold
          title: 'Kappa vs Gold Standard'
          type: number
          format: zto

    - name: diagnosticStyleTable
      title: 'Diagnostic Style Clustering Results'
      type: Table
      visible: (diagnosticStyleAnalysis)
      columns:
        - name: rater
          title: 'Rater'
          type: text
        - name: style_group
          title: 'Style Group'
          type: text
        - name: within_group_agreement
          title: 'Within-Group Agreement %'
          type: number
          format: zto
        - name: experience
          title: 'Experience'
          type: text
          visible: (raterCharacteristics)
        - name: training
          title: 'Training Institution'
          type: text
          visible: (raterCharacteristics)
        - name: institution
          title: 'Current Institution'
          type: text
          visible: (raterCharacteristics)
        - name: specialty
          title: 'Specialty'
          type: text
          visible: (raterCharacteristics)

    - name: styleSummaryTable
      title: 'Diagnostic Style Group Summary'
      type: Table
      visible: (diagnosticStyleAnalysis)
      columns:
        - name: style_group
          title: 'Style Group'
          type: text
        - name: n_members
          title: 'Members'
          type: integer
        - name: members
          title: 'Member Names'
          type: text
        - name: avg_within_agreement
          title: 'Avg Within-Group Agreement %'
          type: number
          format: zto
        - name: predominant_experience
          title: 'Predominant Experience'
          type: text
          visible: (raterCharacteristics)
        - name: predominant_training
          title: 'Predominant Training'
          type: text
          visible: (raterCharacteristics)
        - name: predominant_institution
          title: 'Predominant Institution'
          type: text
          visible: (raterCharacteristics)

    - name: discordantCasesTable
      title: 'Cases Distinguishing Diagnostic Styles'
      type: Table
      visible: (identifyDiscordantCases)
      columns:
        - name: case_id
          title: 'Case ID'
          type: text
        - name: discord_score
          title: 'Discord Score'
          type: number
          format: zto
        - name: style_group_diagnoses
          title: 'Style Group Diagnoses'
          type: text
        - name: case_interpretation
          title: 'Interpretation'
          type: text

    - name: krippTable
      title: "Krippendorff's Alpha Results"
      type: Table
      visible: (kripp)
      columns:
        - name: data_type
          title: 'Data Type'
          type: text
        - name: alpha
          title: 'Alpha'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
          visible: (bootstrap)
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
          visible: (bootstrap)
        - name: interpretation
          title: 'Interpretation'
          type: text

    - name: consensusTable
      title: 'Consensus Scoring Results'
      type: Table
      visible: (consensus && show_consensus_table)
      columns:
        - name: case_id
          title: 'Case ID'
          type: text
        - name: consensus_score
          title: 'Consensus Score'
          type: text
        - name: agreement_level
          title: 'Agreement Level'
          type: text
        - name: n_agreeing
          title: 'Raters Agreeing'
          type: integer
        - name: rater_scores
          title: 'Individual Scores'
          type: text

    - name: consensusSummary
      title: 'Consensus Summary Statistics'
      type: Table
      visible: (consensus)
      columns:
        - name: metric
          title: 'Metric'
          type: text
        - name: value
          title: 'Value'
          type: text
        - name: percentage
          title: 'Percentage'
          type: number
          format: zto

    # - name: interpretationTable
    #   title: 'Agreement Interpretation Guidelines'
    #   type: Table
    #   visible: (showInterpretation)
    #  columns:
    #    - name: kappa_range
    #      title: 'Kappa Range'
    #      type: text
    #    - name: agreement_level
    #      title: 'Agreement Level'
    #      type: text
    #    - name: clinical_interpretation
    #      title: 'Clinical Interpretation'
    #      type: text

    - name: heatmapPlot
      title: 'Agreement Heatmap'
      type: Image
      width: 800
      height: 600
      renderFun: .heatmapPlot
      visible: (heatmap)

    - name: pairwisePlot
      title: 'Pairwise Agreement Plot'
      type: Image
      width: 700
      height: 500
      renderFun: .pairwisePlot
      visible: (pairwiseAnalysis)

    - name: categoryPlot
      title: 'Category Agreement Plot'
      type: Image
      width: 700
      height: 500
      renderFun: .categoryPlot
      visible: (categoryAnalysis)

    - name: confusionMatrixPlot
      title: 'Confusion Matrix'
      type: Image
      width: 600
      height: 600
      renderFun: .confusionMatrixPlot
      visible: (pathologyContext)

    - name: diagnosticStyleDendrogram
      title: 'Diagnostic Style Dendrogram'
      type: Image
      width: 800
      height: 600
      renderFun: .diagnosticStyleDendrogram
      visible: (diagnosticStyleAnalysis)

    - name: diagnosticStyleHeatmap
      title: 'Diagnostic Style Heatmap'
      type: Image
      width: 800
      height: 600
      renderFun: .diagnosticStyleHeatmap
      visible: (diagnosticStyleAnalysis)
    - name: diagnosticStyleCombined
      title: 'Combined Dendrogram + Heatmap (Usubutun Style)'
      type: Image
      width: 1000
      height: 1000
      renderFun: .diagnosticStyleCombined
      visible: (diagnosticStyleAnalysis)

    - name: raterFrequencyTables
      title: 'Individual Rater Frequencies'
      type: Group
      visible: (sft)
      items:
        - name: frequencyTable
          title: 'Frequency Distribution'
          type: Table
          columns:
            - name: rater
              title: 'Rater'
              type: text
            - name: category
              title: 'Category'
              type: text
            - name: frequency
              title: 'Frequency'
              type: integer
            - name: percentage
              title: 'Percentage'
              type: number
              format: zto

    - name: crosstabTable
      title: 'Cross-tabulation Matrix'
      type: Table
      visible: (sft)
      clearWith: [vars]
      columns:
        - name: rater1_category
          title: 'Category'
          type: text
        - name: frequencies
          title: 'Frequencies by Rater 2'
          type: text



    - name: clinicalSummary
      title: Clinical Summary
      type: Html
      visible: (showClinicalSummary)

    - name: reportTemplate
      title: Copy-Ready Report
      type: Html
      visible: (showClinicalSummary)

    - name: aboutAnalysis
      title: About This Analysis
      type: Html
      visible: (showAboutAnalysis)

    - name: assumptions
      title: Assumptions & Caveats
      type: Html
      visible: (showAssumptions)

    - name: weightedKappaGuide
      title: Weighted Kappa Guide
      type: Html
      visible: (showWeightedKappaGuide && wght != 'unweighted')

    - name: statisticalGlossary
      title: Statistical Terms Glossary
      type: Html
      visible: (showStatisticalGlossary)











    # Enhanced Analysis Results
    - name: gwetACTable
      title: "Gwet's Agreement Coefficients"
      type: Table
      visible: (gwetAC)
      columns:
        - name: coefficient
          title: 'Coefficient'
          type: text
        - name: value
          title: 'Value'
          type: number
          format: zto
        - name: se
          title: 'Standard Error'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
        - name: interpretation
          title: 'Interpretation'
          type: text

    - name: pabakTable
      title: 'PABAK Analysis Results'
      type: Table
      visible: (pabak)
      columns:
        - name: measure
          title: 'Measure'
          type: text
        - name: value
          title: 'Value'
          type: number
          format: zto
        - name: standard_kappa
          title: 'Standard Kappa'
          type: number
          format: zto
        - name: adjusted_kappa
          title: 'PABAK'
          type: number
          format: zto
        - name: interpretation
          title: 'Interpretation'
          type: text

    - name: sampleSizeTable
      title: 'Sample Size Planning Results'
      type: Table
      visible: (sampleSizePlanning)
      columns:
        - name: parameter
          title: 'Parameter'
          type: text
        - name: value
          title: 'Value'
          type: text
        - name: recommendation
          title: 'Recommendation'
          type: text

    - name: raterBiasTable
      title: 'Rater Bias Analysis'
      type: Table
      visible: (raterBiasAnalysis)
      columns:
        - name: rater
          title: 'Rater'
          type: text
        - name: bias_score
          title: 'Bias Score'
          type: number
          format: zto
        - name: tendency
          title: 'Systematic Tendency'
          type: text
        - name: severity
          title: 'Bias Severity'
          type: text
        - name: recommendation
          title: 'Recommendation'
          type: text

    - name: agreementTrendTable
      title: 'Agreement Trend Analysis'
      type: Table
      visible: (agreementTrendAnalysis)
      columns:
        - name: sequence_group
          title: 'Sequence Group'
          type: text
        - name: agreement_percent
          title: 'Agreement %'
          type: number
          format: zto
        - name: kappa
          title: 'Kappa'
          type: number
          format: zto
        - name: trend_direction
          title: 'Trend'
          type: text
        - name: significance
          title: 'Significance'
          type: text

    - name: caseDifficultyTable
      title: 'Case Difficulty Analysis'
      type: Table
      visible: (caseDifficultyScoring)
      columns:
        - name: case_id
          title: 'Case ID'
          type: text
        - name: difficulty_score
          title: 'Difficulty Score'
          type: number
          format: zto
        - name: disagreement_pattern
          title: 'Disagreement Pattern'
          type: text
        - name: difficulty_level
          title: 'Difficulty Level'
          type: text
        - name: rater_variability
          title: 'Rater Variability'
          type: number
          format: zto

    - name: stabilityTable
      title: 'Agreement Stability Analysis'
      type: Table
      visible: (agreementStabilityAnalysis)
      columns:
        - name: statistic
          title: 'Statistic'
          type: text
        - name: original_value
          title: 'Original Value'
          type: number
          format: zto
        - name: bootstrap_mean
          title: 'Bootstrap Mean'
          type: number
          format: zto
        - name: bootstrap_se
          title: 'Bootstrap SE'
          type: number
          format: zto
        - name: stability_index
          title: 'Stability Index'
          type: number
          format: zto
        - name: interpretation
          title: 'Stability'
          type: text

    - name: trendPlot
      title: 'Agreement Trend Plot'
      type: Image
      width: 700
      height: 500
      renderFun: .trendPlot
      visible: (agreementTrendAnalysis)

    - name: biasPlot
      title: 'Rater Bias Visualization'
      type: Image
      width: 700
      height: 500
      renderFun: .biasPlot
      visible: (raterBiasAnalysis)

    - name: difficultyPlot
      title: 'Case Difficulty Distribution'
      type: Image
      width: 700
      height: 500
      renderFun: .difficultyPlot
      visible: (caseDifficultyScoring)

    - name: inlineComments
      title: Statistical Commentary
      type: Html
      visible: (showInlineComments)

    # ========================================================================
    # Clustering Analysis Results (Usubutun et al. 2012)
    # ========================================================================

    - name: styleGroupSummary
      title: 'Diagnostic Style Groups Summary'
      type: Table
      visible: (performClustering)
      columns:
        - name: style_group
          title: 'Style Group'
          type: text
        - name: n_raters
          title: 'Number of Raters'
          type: integer
        - name: rater_names
          title: 'Raters'
          type: text
        - name: within_agreement
          title: 'Within-Group Agreement %'
          type: number
          format: zto
        - name: between_agreement
          title: 'Between-Group Agreement %'
          type: number
          format: zto
        - name: silhouette_score
          title: 'Silhouette Score'
          type: number
          format: zto
        - name: interpretation
          title: 'Style Interpretation'
          type: text

    - name: styleGroupProfiles
      title: 'Diagnostic Patterns by Style Group'
      type: Table
      visible: (performClustering)
      columns:
        - name: style_group
          title: 'Style Group'
          type: text
        - name: category
          title: 'Diagnostic Category'
          type: text
        - name: frequency
          title: 'Frequency'
          type: integer
        - name: percentage
          title: 'Percentage'
          type: number
          format: zto
        - name: relative_frequency
          title: 'Relative to Other Groups'
          type: text

    - name: discordantCasesCluster
      title: 'High-Disagreement Cases Between Style Groups'
      type: Table
      visible: (performClustering && identifyDiscordant)
      columns:
        - name: case_id
          title: 'Case ID'
          type: text
        - name: disagreement_score
          title: 'Disagreement Score'
          type: number
          format: zto
        - name: entropy
          title: 'Entropy'
          type: number
          format: zto
        - name: style_group_patterns
          title: 'Style Group Diagnostic Patterns'
          type: text
        - name: difficulty_level
          title: 'Case Difficulty'
          type: text

    - name: characteristicAssociations
      title: 'Style Group Associations with Rater Characteristics'
      type: Table
      visible: (performClustering)
      columns:
        - name: characteristic
          title: 'Rater Characteristic'
          type: text
        - name: test_statistic
          title: 'Test Statistic'
          type: number
          format: zto
        - name: df
          title: 'df'
          type: integer
        - name: p_value
          title: 'p-value'
          type: number
          format: zto,pvalue
        - name: effect_size
          title: 'Effect Size'
          type: number
          format: zto
        - name: interpretation
          title: 'Association Interpretation'
          type: text

    - name: referenceComparison
      title: 'Style Group Agreement with Reference Standard'
      type: Table
      visible: (performClustering && !is.null(referenceStandard))
      columns:
        - name: style_group
          title: 'Style Group'
          type: text
        - name: kappa_vs_reference
          title: 'Kappa vs Reference'
          type: number
          format: zto
        - name: agreement_percent
          title: 'Agreement %'
          type: number
          format: zto
        - name: ci_lower
          title: 'CI Lower'
          type: number
          format: zto
        - name: ci_upper
          title: 'CI Upper'
          type: number
          format: zto
        - name: accuracy_level
          title: 'Accuracy Level'
          type: text

    - name: clusteringHeatmap
      title: 'Hierarchical Clustering Heatmap (Cases × Raters)'
      type: Image
      width: 1000
      height: 800
      renderFun: .clusteringHeatmap
      visible: (performClustering && showClusteringHeatmap)
      description: 'Heatmap showing diagnostic patterns with dual dendrograms (raters and cases)'

    - name: clusterDendrogram
      title: 'Rater Clustering Dendrogram'
      type: Image
      width: 800
      height: 600
      renderFun: .clusterDendrogram
      visible: (performClustering)
      description: 'Dendrogram showing hierarchical relationships between raters'

    - name: silhouettePlot
      title: 'Cluster Quality (Silhouette Plot)'
      type: Image
      width: 700
      height: 500
      renderFun: .silhouettePlot
      visible: (performClustering)
      description: 'Silhouette plot showing cluster separation and cohesion'

    - name: clusteringInterpretation
      title: 'Clustering Analysis Interpretation Guide'
      type: Html
      visible: (performClustering && showClusteringInterpretation)
      description: 'Explanatory guide for understanding diagnostic style groups and cluster results'

refs:
    - irr
    - psych
    - ICC
    - PathologyKappa
    # - usubutun2012
    - ClinicoPathJamoviModule


    - ggdendro
    - gridExtra
    - grid
    - stringr
    - reshape2
    - scales
    - cluster
    - viridisLite
    - grDevices
    - pheatmap
...
