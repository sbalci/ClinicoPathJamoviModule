---
name: survivalendpoints
title: Survival Endpoint Derivation
menuGroup: SurvivalT3
menuSubgroup: Data Preparation
menuSubtitle: Derive PFS, OS, TTP, DOR from Timeline Data
version: '0.0.32'
jas: '1.2'

description:
    main: >
        Derives common survival endpoints (PFS, OS, TTP, DOR) from clinical trial timeline data.
        Automatically calculates time-to-event and event status variables for use in survival analysis.
        Designed for seamless integration with swimmer/waterfall plot data.
    R:
        dontrun: false
        usage: |
            data <- data.frame(
                patient = c("P01", "P02", "P03"),
                start_date = as.Date(c("2023-01-01", "2023-02-01", "2023-03-01")),
                end_date = as.Date(c("2023-06-15", "2023-08-20", "2023-09-10")),
                last_followup = as.Date(c("2024-01-01", "2023-12-01", "2024-02-01")),
                death = c(0, 1, 0),
                progression = c(1, 1, 0)
            )

            survivalendpoints(
                data = data,
                patientId = "patient",
                startDate = "start_date",
                lastFollowup = "last_followup",
                deathEvent = "death",
                progressionEvent = "progression"
            )

completeWhenFilled: false

options:
  - name: data
    type: Data
    description:
      R: the data as a data frame

  # Core Variables
  - name: patientId
    title: Patient ID
    type: Variable
    required: true
    description:
      R: >
        Patient identifier variable

  - name: startDate
    title: Treatment Start Date/Time
    type: Variable
    required: true
    suggested:
      - continuous
    description:
      R: >
        Treatment start date or baseline time (Date or numeric)

  - name: lastFollowup
    title: Last Follow-up Date/Time
    type: Variable
    required: true
    suggested:
      - continuous
    description:
      R: >
        Last follow-up date or time

  # Event Variables
  - name: progressionDate
    title: Progression Date/Time
    type: Variable
    suggested:
      - continuous
    default:
    description:
      R: >
        Date/time of disease progression (required for accurate PFS/TTP/DOR)

  - name: deathDate
    title: Death Date/Time
    type: Variable
    suggested:
      - continuous
    default:
    description:
      R: >
        Date/time of death (required for accurate OS/PFS)

  - name: deathEvent
    title: Death Event (optional if death date provided)
    type: Variable
    suggested:
      - nominal
      - ordinal
    default:
    description:
      R: >
        Death event indicator (0=alive, 1=dead). Not needed if death date is provided.

  - name: progressionEvent
    title: Progression Event (optional if progression date provided)
    type: Variable
    suggested:
      - nominal
      - ordinal
    default:
    description:
      R: >
        Disease progression indicator (0=no progression, 1=progression). Not needed if progression date is provided.

  # Optional Dates
  - name: treatmentEnd
    title: Treatment End Date/Time
    type: Variable
    suggested:
      - continuous
    default:
    description:
      R: >
        Treatment end date (optional, for time on treatment calculation)

  - name: responseDate
    title: Response Date/Time
    type: Variable
    suggested:
      - continuous
    default:
    description:
      R: >
        Date of confirmed response (optional, for DOR calculation)

  # Time Unit
  - name: timeUnit
    title: Time Unit
    type: List
    options:
      - name: days
        title: Days
      - name: weeks
        title: Weeks
      - name: months
        title: Months
      - name: years
        title: Years
    default: months
    description:
      R: >
        Unit for time calculations (for numeric time variables)

  # Input Type
  - name: inputType
    title: Input Type
    type: List
    options:
      - name: dates
        title: Dates
      - name: numeric
        title: Numeric (time values)
    default: dates
    description:
      R: >
        Type of input data (dates or numeric time values)

  # Endpoint Options
  - name: calculatePFS
    title: Calculate PFS
    type: Bool
    default: false
    description:
      R: >
        Calculate progression-free survival (time to progression or death)

  - name: calculateOS
    title: Calculate OS
    type: Bool
    default: false
    description:
      R: >
        Calculate overall survival (time to death)

  - name: calculateTTP
    title: Calculate TTP
    type: Bool
    default: false
    description:
      R: >
        Calculate time to progression (censors death without progression)

  - name: calculateDOR
    title: Calculate DOR
    type: Bool
    default: false
    description:
      R: >
        Calculate duration of response (requires response date)

  - name: calculateTOT
    title: Calculate Time on Treatment
    type: Bool
    default: false
    description:
      R: >
        Calculate time on treatment (requires treatment end date)

  # Output Options
  - name: showDerivedData
    title: Show Derived Endpoints Table
    type: Bool
    default: false
    description:
      R: >
        Display table with all derived survival endpoints

  - name: showSummaryStats
    title: Show Summary Statistics
    type: Bool
    default: false
    description:
      R: >
        Display summary statistics for each endpoint

  - name: showEventRates
    title: Show Event Rates
    type: Bool
    default: false
    description:
      R: >
        Display event rates and censoring proportions

  - name: showKMPlot
    title: Show Simple KM Plot
    type: Bool
    default: false
    description:
      R: >
        Display simple Kaplan-Meier curves for derived endpoints

  - name: showMilestones
    title: Show Milestone Analysis
    type: Bool
    default: false
    description:
      R: >
        Calculate survival at specific time milestones

  - name: milestones
    title: Milestone Times
    type: String
    default: '6,12,24'
    description:
      R: >
        Comma-separated milestone times (in selected time unit)

  # Export Options
  - name: exportEndpoints
    title: Export Derived Endpoints
    type: Bool
    default: false
    description:
      R: >
        Export derived endpoints to CSV for use in survival modules

  - name: showUsageGuide
    title: Show Usage Guide
    type: Bool
    default: false
    description:
      R: >
        Display guide for using derived endpoints in survival analysis

...
