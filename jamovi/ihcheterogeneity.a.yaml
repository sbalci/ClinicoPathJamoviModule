---
name: ihcheterogeneity
title: IHC Heterogeneity Analysis
menuGroup: OncoPath
menuSubgroup: IHC Analysis
version: '0.0.33'
jas: '1.2'

options:
    - name: data
      type: Data
      description:
          R: the data as a data frame

    - name: wholesection
      title: "Overall / Whole Slide / HotSpot (Optional)"
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Optional reference measurement for comparison with regional measurements. Can be whole section average,
            hotspot area, or overall tumor measurement. Leave empty for inter-regional comparison studies.
            Example: Ki67 proliferation index (0-100%), ER H-score (0-300), PR percentage (0-100%).
      default: NULL
    - name: biopsy1
      title: Regional Measurement 1 (Required)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Continuous biomarker measurement from first tissue region or area.
            Should represent same biomarker as reference measurement for heterogeneity comparison.
            Example: Ki67 % from tumor periphery, ER H-score from invasive front.

    - name: biopsy2
      title: Regional Measurement 2 (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Second tissue region biomarker measurement for heterogeneity analysis
      default: NULL

    - name: biopsy3
      title: Regional Measurement 3 (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Third tissue region biomarker measurement
      default: NULL

    - name: biopsy4
      title: Regional Measurement 4 (Optional)
      type: Variable
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Fourth tissue region biomarker measurement
      default: NULL

    - name: biopsies
      title: Additional Regional Measurements
      type: Variables
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            additional simulated biopsy measurements
      default: NULL

    - name: spatial_id
      title: Spatial Region ID (Optional)
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
      description:
          R: >
            identifier for spatial regions or tissue areas (e.g., Central/Invasive, Preinvasive/Invasive)
      default: NULL

    - name: compareCompartments
      title: Compare Spatial Compartments
      type: Bool
      default: false
      description:
          R: >
            Perform statistical comparison of heterogeneity patterns between spatial compartments.
            Requires spatial_id variable. Compares ICC, CV, and bias across compartments.

    - name: compartmentTests
      title: Compartment Comparison Tests
      type: Bool
      default: false
      description:
          R: >
            Perform statistical tests to determine if heterogeneity differs significantly between compartments.
            Uses Levene's test for variance equality and Kruskal-Wallis for distributional differences.

    - name: analysis_type
      title: Analysis Focus
      type: List
      options:
        - name: reproducibility
          title: 'Reproducibility Assessment'
        - name: bias
          title: 'Sampling Bias Analysis'
        - name: variability
          title: 'Variance Component Analysis'
        - name: comprehensive
          title: 'Comprehensive Analysis'
      default: comprehensive
      description:
          R: >
            primary focus of biopsy simulation analysis

    - name: sampling_strategy
      title: Sampling Strategy
      type: List
      options:
        - name: random
          title: 'Random Sampling'
        - name: systematic
          title: 'Systematic Sampling'
        - name: stratified
          title: 'Stratified Sampling'
        - name: unknown
          title: 'Unknown/Mixed'
      default: unknown
      description:
          R: >
            biopsy sampling strategy used

    - name: cv_threshold
      title: CV Threshold for Acceptable Variability
      type: Number
      min: 5.0
      max: 50.0
      default: 20.0
      description:
          R: >
            Coefficient of variation threshold for acceptable sampling variability.
            Typical clinical values: 15-25% for immunohistochemistry (Ki67, ER, PR),
            10-20% for molecular assays, 20-30% for heterogeneous markers (HER2, PD-L1).
            Lower values indicate more stringent quality requirements.

    - name: correlation_threshold
      title: Minimum Acceptable Correlation
      type: Number
      min: 0.50
      max: 0.99
      default: 0.80
      description:
          R: >
            Minimum Spearman correlation between biopsy and whole section measurements.
            Clinical guidelines: ≥0.80 excellent agreement, ≥0.70 good agreement,
            ≥0.60 moderate agreement, <0.60 poor agreement.
            Higher values indicate better representativeness of biopsy samples.

    - name: show_variability_plots
      title: Show Variability Plots
      type: Bool
      default: false
      description:
          R: >
            display plots showing sampling variability

    - name: variance_components
      title: Variance Component Analysis
      type: Bool
      default: false
      description:
          R: >
            perform variance component decomposition

    - name: power_analysis
      title: Power Analysis
      type: Bool
      default: false
      description:
          R: >
            perform power analysis for sample size recommendations

    - name: generate_recommendations
      title: Generate Clinical Recommendations
      type: Bool
      default: false
      description:
          R: >
            provide recommendations for optimal heterogeneity assessment strategy

    - name: showSummary
      title: Show Plain-Language Summary
      type: Bool
      default: false
      description:
          R: >
            Display natural-language summary of heterogeneity analysis results

    - name: showGlossary
      title: Show Statistical Glossary
      type: Bool
      default: false
      description:
          R: >
            Display definitions of statistical terms (ICC, CV, correlation)

...
