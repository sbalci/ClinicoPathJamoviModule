---
name:  agreement
title: Interrater Reliability
jrs:   '1.1'

items:

    - name: welcome
      title: ""
      type: Html

    # - name:  todo
    #   title: To Do
    #   type:  Html
    #   clearWith:
    #       - vars

    # - name: result_cohen
    #   title: 'result_cohen'
    #   type: Preformatted
    #   clearWith:
    #       - vars
    #       - wght
    #       - exct


    # - name:  ka
    #   title: Cohen's Kappa for 2 Raters
    #   type: Table
    #   rows:  1
    #   columns:
    #     - name: weights
    #       type: text
    #     - name: kappa
    #       type: number
    #     - name: upper_CI
    #       type: number
    #     - name: lower_CI
    #       type: number
    #     - name: p
    #       type: number
    #       format: zto,pvalue


    # - name:  text1
    #   title: Agreement
    #   type:  Preformatted
    #   clearWith:
    #       - vars
    #       - wght
    #       - exct

    # - name:  text2
    #   title: Interrater Reliability
    #   type:  Preformatted
    #   clearWith:
    #       - vars
    #       - wght
    #       - exct

    - name:  irrtable
      title: 'Interrater Reliability'
      type: Table
      swapRowsColumns: true
      rows:  1
      columns:
        - name: method
          title: 'Method'
          type: text
        - name: subjects
          title: 'Subjects'
          type: integer
        - name: raters
          title: 'Raters'
          type: integer
        - name: peragree
          title: 'Agreement %'
          type: integer
        - name: kappa
          title: 'Kappa'
          type: number
        - name: z
          title: 'z'
          type: number
        - name: p
          title: 'p-value'
          type: number
          format: zto,pvalue
      clearWith:
          - vars
          - wght
          - exct


    - name:  contingencyTable
      title: 'Contingency Table (2 Raters)'
      type: Table
      visible: (sft)
      rows: 0
      columns: []
      clearWith:
          - vars
          - wght
          - exct

    - name:  ratingCombinationsTable
      title: 'Rating Combinations (3+ Raters)'
      type: Table
      visible: (sft)
      rows: 0
      columns: []
      clearWith:
          - vars
          - wght
          - exct

    - name: blandAltman
      title: 'Bland-Altman Plot'
      type: Image
      width: 500
      height: 400
      visible: (blandAltmanPlot)
      requiresData: true
      clearWith:
          - vars
          - baConfidenceLevel

    - name: blandAltmanStats
      title: 'Bland-Altman Statistics'
      type: Table
      visible: (blandAltmanPlot)
      rows: 1
      columns:
        - name: meanDiff
          title: 'Mean Difference'
          type: number
        - name: sdDiff
          title: 'SD of Difference'
          type: number
        - name: lowerLoA
          title: 'Lower LoA'
          type: number
        - name: upperLoA
          title: 'Upper LoA'
          type: number
        - name: propBiasP
          title: 'Proportional Bias (p)'
          type: number
          format: zto,pvalue
          visible: (proportionalBias)
      clearWith:
          - vars
          - baConfidenceLevel
          - proportionalBias





    # - name:  freqtable
    #   title: 'Frequency Table'
    #   type: Table
    #   columns:
    #     - name: values
    #       title: 'Values'
    #       type: text
    #   clearWith:
    #       - vars
    #       - wght
    #       - exct


    - name: krippTable
      title: "Krippendorff's Alpha Results"
      type: Table
      visible: (kripp)
      rows: 1
      columns:
        - name: method
          title: 'Method'
          type: text
        - name: subjects
          title: 'Cases'
          type: integer
        - name: raters
          title: 'Raters'
          type: integer
        - name: alpha
          title: 'Alpha'
          type: number
        - name: ci_lower
          title: 'CI Lower'
          type: number
          visible: (bootstrap)
        - name: ci_upper
          title: 'CI Upper'
          type: number
          visible: (bootstrap)
      clearWith:
          - vars
          - krippMethod
          - bootstrap

    - name: weightedKappaGuide
      title: "Weighted Kappa Interpretation Guide"
      type: Html
      visible: (showAbout && (wght:unweighted == FALSE))

    - name: summary
      title: "Summary"
      type: Html
      visible: (showSummary)

    - name: about
      title: "About This Analysis"
      type: Html
      visible: (showAbout)

    # Agreement Status Results
    - name: agreementStatusTable
      title: "Agreement Status Distribution"
      type: Table
      visible: (agreementStatus && showAgreementTable)
      rows: 0
      columns:
        - name: status
          title: 'Agreement Status'
          type: text
        - name: count
          title: 'N Cases'
          type: integer
        - name: percentage
          title: 'Percentage'
          type: number
          format: pc
        - name: interpretation
          title: 'Interpretation'
          type: text
      clearWith:
          - vars
          - agreementThreshold

    - name: agreementStatusDetail
      title: "Case-Level Agreement Details"
      type: Table
      visible: (agreementStatus)
      rows: 0
      columns:
        - name: case_id
          title: 'Case'
          type: integer
        - name: agreement_status
          title: 'Status'
          type: text
        - name: agreement_percent
          title: 'Agreement %'
          type: number
          format: pc
        - name: modal_category
          title: 'Most Common Rating'
          type: text
        - name: n_agreeing
          title: 'N Agreeing'
          type: integer
      clearWith:
          - vars
          - agreementThreshold

    - name: consensusTable
      title: "Consensus Variable Summary"
      type: Table
      visible: (consensusVar)
      rows: 0
      columns:
        - name: category
          title: 'Category'
          type: text
        - name: consensus_count
          title: 'N Cases (Consensus)'
          type: integer
        - name: percentage
          title: 'Percentage'
          type: number
          format: pc
        - name: avg_agreement
          title: 'Avg Agreement %'
          type: number
          format: pc
      clearWith:
          - vars
          - consensusRule
          - tieBreaker

    - name: computedVariablesInfo
      title: "Computed Variables Added to Dataset"
      type: Html
      visible: (consensusVar || addAgreementStatus)

    # Output Variables (Computed Columns Added to Dataset)
    - name: consensusVar
      title: Add Consensus Variable to Data
      type: Output
      varTitle: '`{consensusName}`'
      varDescription: 'Consensus (modal) rating across raters based on selected consensus rule'
      measureType: nominal
      clearWith:
          - vars
          - consensusRule
          - tieBreaker
          - consensusName

    - name: addAgreementStatus
      title: Add Agreement Status to Data
      type: Output
      varTitle: '`{agreementStatusName}`'
      varDescription: 'Agreement status categorization (All Agreed, Majority Agreed, No Agreement)'
      measureType: nominal
      clearWith:
          - vars
          - agreementThreshold
          - agreementStatusName

refs:
    - irr
    - PathologyKappa
    - ClinicoPathJamoviModule


...
