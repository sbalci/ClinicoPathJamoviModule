---
name: decisiongraph
title: Decision Tree Graph
menuGroup: meddecideT2
menuSubgroup: DecisionD
menuSubtitle: Cost-Effectiveness Decision Tree Visualization
version: '0.0.31'
jas: '1.2'

description:
    main: >
        Creates decision tree graphs for cost-effectiveness analysis with typical
        decision nodes, chance nodes, and terminal nodes. Supports visualization
        of treatment pathways, probabilities, costs, and outcomes.
    R:
        dontrun: true
        usage: |
            # example will be added

options:
    - name: data
      type: Data
      description:
          R: The data as a data frame containing decision tree parameters.

    # Tree Structure Options
    - name: treeType
      title: Tree Type
      type: List
      options:
        - name: simple
          title: Simple Decision Tree
        - name: markov
          title: Markov Model Tree
        - name: costeffectiveness
          title: Cost-Effectiveness Tree
      default: costeffectiveness
      description:
          ui: >
            Type of decision tree to create.
          R: >
            Type of decision tree to create.

    # Node Definition Options
    - name: decisions
      title: Decision Nodes
      type: Variables
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Variables representing decision nodes (treatment options).
          R: >
            Variables representing decision nodes (treatment options).

    # Markov Model Specific Options
    - name: healthStates
      title: Health States
      type: Variables
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Variables defining health states for Markov model (e.g., Healthy, Sick, Dead).
          R: >
            Variables defining health states for Markov model.

    - name: transitionProbs
      title: Transition Probabilities
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables containing transition probabilities between health states.
          R: >
            Variables containing transition probabilities between health states.

    - name: cycleLength
      title: Cycle Length
      type: Number
      default: 1
      min: 0.1
      max: 10
      description:
          ui: >
            Length of each Markov cycle in years (e.g., 1 = annual cycles).
          R: >
            Length of each Markov cycle in years.

    - name: probabilities
      title: Probability Variables
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables containing probability values for chance nodes.
          R: >
            Variables containing probability values for chance nodes.

    - name: costs
      title: Cost Variables
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables containing cost values for terminal nodes.
          R: >
            Variables containing cost values for terminal nodes.

    - name: utilities
      title: Utility Variables
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables containing utility/effectiveness values.
          R: >
            Variables containing utility/effectiveness values.

    - name: outcomes
      title: Outcome Variables
      type: Variables
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Variables representing clinical outcomes.
          R: >
            Variables representing clinical outcomes.

    # Visualization Options
    - name: layout
      title: Tree Layout
      type: List
      options:
        - name: horizontal
          title: Horizontal (Left to Right)
        - name: vertical
          title: Vertical (Top to Bottom)
        - name: radial
          title: Radial
      default: horizontal
      description:
          ui: >
            Layout orientation for the decision tree.
          R: >
            Layout orientation for the decision tree.

    - name: nodeShapes
      title: Show Node Shapes
      type: Bool
      default: true
      description:
          ui: >
            Use different shapes for different node types (squares for decisions, circles for chance nodes, triangles for outcomes).
          R: >
            Use different shapes for different node types.

    - name: showProbabilities
      title: Show Probabilities
      type: Bool
      default: true
      description:
          ui: >
            Display probability values on tree branches.
          R: >
            Display probability values on tree branches.

    - name: showCosts
      title: Show Costs
      type: Bool
      default: true
      description:
          ui: >
            Display cost values at terminal nodes.
          R: >
            Display cost values at terminal nodes.

    - name: showUtilities
      title: Show Utilities
      type: Bool
      default: true
      description:
          ui: >
            Display utility/effectiveness values.
          R: >
            Display utility/effectiveness values.

    # Analysis Options
    - name: calculateExpectedValues
      title: Calculate Expected Values
      type: Bool
      default: true
      description:
          ui: >
            Calculate and display expected costs and utilities.
          R: >
            Calculate and display expected costs and utilities.

    - name: calculateNMB
      title: Calculate Net Monetary Benefit
      type: Bool
      default: true
      description:
          ui: >
            Calculate net monetary benefit (NMB) for decision paths using threshold analysis.
          R: >
            Calculate net monetary benefit (NMB) for decision paths using threshold analysis.

    - name: willingnessToPay
      title: Willingness to Pay Threshold
      type: Number
      default: 50000
      min: 0
      max: 500000
      description:
          ui: >
            Willingness to pay threshold (cost per QALY) for NMB calculations.
          R: >
            Willingness to pay threshold (cost per QALY) for NMB calculations.

    - name: sensitivityAnalysis
      title: Sensitivity Analysis
      type: Bool
      default: false
      description:
          ui: >
            Perform one-way sensitivity analysis on key parameters.
          R: >
            Perform one-way sensitivity analysis on key parameters.

    - name: discountRate
      title: Discount Rate
      type: Number
      default: 0.03
      min: 0
      max: 0.20
      description:
          ui: >
            Annual discount rate for future costs and benefits (0-20%).
          R: >
            Annual discount rate for future costs and benefits.

    - name: timeHorizon
      title: Time Horizon (years)
      type: Number
      default: 10
      min: 1
      max: 100
      description:
          ui: >
            Time horizon for the analysis in years.
          R: >
            Time horizon for the analysis in years.

    # Display Options
    - name: nodeLabels
      title: Show Node Labels
      type: Bool
      default: true
      description:
          ui: >
            Display descriptive labels for nodes.
          R: >
            Display descriptive labels for nodes.

    - name: branchLabels
      title: Show Branch Labels
      type: Bool
      default: true
      description:
          ui: >
            Display labels on tree branches.
          R: >
            Display labels on tree branches.

    - name: colorScheme
      title: Color Scheme
      type: List
      options:
        - name: default
          title: Default
        - name: colorblind
          title: Colorblind Friendly
        - name: medical
          title: Medical Theme
        - name: economic
          title: Economic Theme
      default: medical
      description:
          ui: >
            Color scheme for the decision tree visualization.
          R: >
            Color scheme for the decision tree visualization.

    # Output Options
    - name: summaryTable
      title: Summary Table
      type: Bool
      default: true
      description:
          ui: >
            Show summary table with expected values and cost-effectiveness ratios.
          R: >
            Show summary table with expected values and cost-effectiveness ratios.

    - name: tornado
      title: Tornado Diagram
      type: Bool
      default: false
      description:
          ui: >
            Create tornado diagram for sensitivity analysis.
          R: >
            Create tornado diagram for sensitivity analysis.

    - name: decisionComparison
      title: Decision Comparison Table
      type: Bool
      default: true
      description:
          ui: >
            Show comparison table with NMB scores for all decision paths.
          R: >
            Show comparison table with NMB scores for all decision paths.

    - name: incrementalAnalysis
      title: Incremental Cost-Effectiveness Analysis
      type: Bool
      default: true
      description:
          ui: >
            Perform incremental cost-effectiveness ratio (ICER) calculations.
          R: >
            Perform incremental cost-effectiveness ratio (ICER) calculations.

    - name: dominanceAnalysis
      title: Dominance Analysis
      type: Bool
      default: true
      description:
          ui: >
            Identify dominated and extendedly dominated strategies in ICER analysis.
          R: >
            Identify dominated and extendedly dominated strategies in ICER analysis.

    - name: icer_confidence_intervals
      title: ICER Confidence Intervals
      type: Bool
      default: false
      description:
          ui: >
            Calculate confidence intervals for ICERs using bootstrap or PSA results.
          R: >
            Calculate confidence intervals for ICERs using bootstrap or PSA results.

    - name: probabilisticAnalysis
      title: Probabilistic Sensitivity Analysis
      type: Bool
      default: false
      description:
          ui: >
            Perform probabilistic sensitivity analysis using Monte Carlo simulation.
          R: >
            Perform probabilistic sensitivity analysis using Monte Carlo simulation.

    - name: psa_advanced_outputs
      title: Advanced PSA Outputs
      type: Bool
      default: false
      description:
          ui: >
            Generate advanced PSA outputs (CEAC, EVPI, net benefit distributions).
          R: >
            Generate advanced PSA outputs (CEAC, EVPI, net benefit distributions).

    - name: numSimulations
      title: Number of Simulations
      type: Integer
      default: 1000
      min: 100
      max: 10000
      description:
          ui: >
            Number of Monte Carlo simulations for probabilistic analysis.
          R: >
            Number of Monte Carlo simulations for probabilistic analysis.

    # Advanced Markov Modeling Options
    - name: markovAdvanced
      title: Advanced Markov Features
      type: Bool
      default: false
      description:
          ui: >
            Enable advanced Markov modeling features (tunnel states, time-varying transitions).
          R: >
            Enable advanced Markov modeling features.

    - name: tunnelStates
      title: Tunnel States
      type: Variables
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Define tunnel states for temporary health states (e.g., post-surgical recovery).
          R: >
            Define tunnel states for temporary health states.

    - name: timeVaryingTransitions
      title: Time-Varying Transition Probabilities
      type: Bool
      default: false
      description:
          ui: >
            Allow transition probabilities to change over time (age-dependent rates).
          R: >
            Allow transition probabilities to change over time.

    - name: ageSpecificTransitions
      title: Age-Specific Transition Variables
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables defining age-specific or time-dependent transition rates.
          R: >
            Variables defining age-specific transition rates.

    # Chance Node Options
    - name: chanceNodeMethod
      title: Chance Node Calculation Method
      type: List
      options:
        - name: simple
          title: Simple Probabilities
        - name: conditional
          title: Conditional Probabilities
        - name: bayesian
          title: Bayesian Update
      default: simple
      description:
          ui: >
            Method for calculating probabilities at chance nodes.
          R: >
            Method for calculating probabilities at chance nodes.

    - name: riskAdjustment
      title: Risk Adjustment
      type: Bool
      default: false
      description:
          ui: >
            Apply risk adjustment to probabilities based on patient characteristics.
          R: >
            Apply risk adjustment to probabilities based on patient characteristics.

    # Health Economics Modeling Enhancements
    - name: cycleCorrection
      title: Half-Cycle Correction
      type: Bool
      default: true
      description:
          ui: >
            Apply half-cycle correction for more accurate discounting in Markov models.
          R: >
            Apply half-cycle correction for more accurate discounting in Markov models.

    - name: cohortTrace
      title: Cohort Trace Analysis
      type: Bool
      default: false
      description:
          ui: >
            Generate cohort trace showing population distribution across health states over time.
          R: >
            Generate cohort trace showing population distribution across health states over time.

    - name: cohortSize
      title: Starting Cohort Size
      type: Integer
      default: 1000
      min: 100
      max: 1000000
      description:
          ui: >
            Size of hypothetical cohort for trace analysis and budget impact modeling.
          R: >
            Size of hypothetical cohort for trace analysis and budget impact modeling.

    - name: valueOfInformation
      title: Value of Information Analysis
      type: Bool
      default: false
      description:
          ui: >
            Perform Expected Value of Perfect Information (EVPI) and partial EVPI analysis.
          R: >
            Perform Expected Value of Perfect Information (EVPI) and partial EVPI analysis.

    - name: evpi_parameters
      title: EVPI Analysis Parameters
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Parameters for partial EVPI analysis (subset of key uncertain parameters).
          R: >
            Parameters for partial EVPI analysis.

    - name: budgetImpactAnalysis
      title: Budget Impact Analysis
      type: Bool
      default: false
      description:
          ui: >
            Perform budget impact analysis comparing total costs of alternative strategies.
          R: >
            Perform budget impact analysis comparing total costs of alternative strategies.

    - name: targetPopulationSize
      title: Target Population Size
      type: Integer
      default: 10000
      min: 1000
      max: 10000000
      description:
          ui: >
            Size of target population for budget impact calculations.
          R: >
            Size of target population for budget impact calculations.

    - name: marketPenetration
      title: Market Penetration Rate
      type: Number
      default: 0.5
      min: 0.0
      max: 1.0
      description:
          ui: >
            Expected market penetration rate for new intervention (0-100%).
          R: >
            Expected market penetration rate for new intervention.

    - name: ceacThresholds
      title: CEAC Threshold Range
      type: String
      default: "0,100000,5000"
      description:
          ui: >
            Cost-effectiveness acceptability curve thresholds (min,max,step) for PSA.
          R: >
            Cost-effectiveness acceptability curve thresholds (min,max,step).

    - name: psa_distributions
      title: PSA Parameter Distributions
      type: List
      options:
        - name: normal
          title: Normal Distribution
        - name: lognormal
          title: Log-Normal Distribution
        - name: beta
          title: Beta Distribution (probabilities)
        - name: gamma
          title: Gamma Distribution (costs)
        - name: dirichlet
          title: Dirichlet Distribution (multinomial probabilities)
      default: normal
      description:
          ui: >
            Default probability distribution for uncertain parameters in PSA.
          R: >
            Default probability distribution for uncertain parameters in PSA.

    - name: correlatedParameters
      title: Parameter Correlations
      type: Bool
      default: false
      description:
          ui: >
            Account for correlations between uncertain parameters in PSA.
          R: >
            Account for correlations between uncertain parameters in PSA.

    - name: correlationMatrix
      title: Correlation Matrix Variables
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric ]
      description:
          ui: >
            Variables defining correlation structure between uncertain parameters.
          R: >
            Variables defining correlation structure between uncertain parameters.

...
