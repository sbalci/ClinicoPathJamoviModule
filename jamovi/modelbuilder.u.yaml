title: Prediction Model Builder
name: modelbuilder
jus: '3.0'
stage: 0
compilerMode: tame

children:
  # =============================================================================
  # VARIABLE SELECTION - Always visible at top
  # =============================================================================
  - type: VariableSupplier
    persistentItems: false
    stretchFactor: 1
    children:
      - type: TargetLayoutBox
        label: üéØ Outcome Variable
        children:
          - type: VariablesListBox
            name: outcome
            maxItemCount: 1
            isTarget: true
          - type: LevelSelector
            name: outcomePositive
            label: Positive Outcome Level
            enable: (outcome)
      
      - type: TargetLayoutBox
        label: ü©∫ Basic Clinical Variables (Demographics & Primary Risk Factors)
        children:
          - type: VariablesListBox
            name: basicPredictors
            isTarget: true
            height: normal
            
      - type: TargetLayoutBox
        label: ü©∫+ Enhanced Clinical Variables (Additional Clinical Factors)
        children:
          - type: VariablesListBox
            name: enhancedPredictors
            isTarget: true
            height: normal
            
      - type: TargetLayoutBox
        label: üß¨ Biomarker Variables (Laboratory & Advanced Diagnostics)
        children:
          - type: VariablesListBox
            name: biomarkerPredictors
            isTarget: true
            height: normal
            
      - type: TargetLayoutBox
        label: üéõÔ∏è Custom Variables (User-Defined Combination)
        children:
          - type: VariablesListBox
            name: customPredictors
            isTarget: true
            height: normal

  # =============================================================================
  # DATA PREPARATION - Essential setup
  # =============================================================================
  - type: CollapseBox
    label: üìä Data Preparation
    margin: normal
    collapsed: false
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: Data Splitting
            children:
              - type: CheckBox
                name: splitData
                label: Split data for validation (training 70% / testing 30%)
              - type: TextBox
                name: randomSeed
                format: number
                label: Random seed (for reproducibility)
                enable: (splitData)
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: Missing Data Handling
            children:
              - type: ComboBox
                name: missingDataMethod
                label: Missing data strategy
              - type: TextBox
                name: imputationSets
                format: number
                label: Number of imputation sets
                enable: (missingDataMethod:multiple_imputation)

  # =============================================================================
  # MODEL SELECTION - Core functionality
  # =============================================================================
  - type: CollapseBox
    label: üèóÔ∏è Model Types to Build
    margin: normal
    collapsed: false
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: ü©∫ Basic Clinical Model
            children:
              - type: CheckBox
                name: buildBasicModel
                label: Build basic clinical model (uses Basic Clinical Variables above)
              - type: TextBox
                name: basicModelName
                format: string
                label: Model display name
                enable: (buildBasicModel)

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: ü©∫+ Enhanced Clinical Model
            children:
              - type: CheckBox
                name: buildEnhancedModel
                label: Build enhanced clinical model (uses Enhanced Clinical Variables above)
              - type: TextBox
                name: enhancedModelName
                format: string
                label: Model display name
                enable: (buildEnhancedModel)

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üß¨ Biomarker Model
            children:
              - type: CheckBox
                name: buildBiomarkerModel
                label: Build biomarker model (uses Biomarker Variables above)
              - type: TextBox
                name: biomarkerModelName
                format: string
                label: Model display name
                enable: (buildBiomarkerModel)

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üéõÔ∏è Custom Model
            children:
              - type: CheckBox
                name: buildCustomModel
                label: Build custom model (uses Custom Variables above)
              - type: TextBox
                name: customModelName
                format: string
                label: Model display name
                enable: (buildCustomModel)

  # =============================================================================
  # MODELING METHOD - Algorithm selection
  # =============================================================================
  - type: CollapseBox
    label: üî¨ Modeling Method
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìà Regression Type
            children:
              - type: CheckBox
                name: penalizedRegression
                label: Use penalized regression (for high-dimensional data)
              - type: ComboBox
                name: penaltyType
                label: Penalty method
                enable: (penalizedRegression)

  # =============================================================================
  # FEATURE ENGINEERING - Advanced preprocessing
  # =============================================================================
  - type: CollapseBox
    label: ‚öôÔ∏è Feature Engineering
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üîÑ Variable Transformations
            children:
              - type: CheckBox
                name: transformVariables
                label: Transform continuous variables
              - type: ComboBox
                name: transformMethod
                label: Transformation type
                enable: (transformVariables)
      
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üîó Variable Interactions
            children:
              - type: CheckBox
                name: includeInteractions
                label: Include interaction terms
              - type: TextBox
                name: interactionTerms
                format: string
                label: Specific interactions (e.g., age*sex, bmi*diabetes)
                enable: (includeInteractions)

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìä Variable Selection
            children:
              - type: CheckBox
                name: useStepwise
                label: Automatic variable selection
              - type: ComboBox
                name: stepwiseDirection
                label: Selection method
                enable: (useStepwise)
              - type: ComboBox
                name: selectionCriterion
                label: Selection criterion
                enable: (useStepwise)

  # =============================================================================
  # MODEL VALIDATION - Performance assessment
  # =============================================================================
  - type: CollapseBox
    label: ‚úÖ Model Validation
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üîÑ Cross-Validation
            children:
              - type: CheckBox
                name: crossValidation
                label: Perform k-fold cross-validation
              - type: TextBox
                name: cvFolds
                format: number
                label: Number of folds
                enable: (crossValidation)

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üîÅ Bootstrap Validation
            children:
              - type: CheckBox
                name: bootstrapValidation
                label: Perform bootstrap validation
              - type: TextBox
                name: bootstrapReps
                format: number
                label: Bootstrap replications
                enable: (bootstrapValidation)

  # =============================================================================
  # MODEL COMPARISON - Advanced metrics
  # =============================================================================
  - type: CollapseBox
    label: ‚öñÔ∏è Model Comparison
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìä Improvement Metrics
            children:
              - type: CheckBox
                name: calculateNRI
                label: Net Reclassification Index (NRI)
              - type: TextBox
                name: nriThresholds
                format: string
                label: Risk thresholds (e.g., 0.10, 0.20)
                enable: (calculateNRI)
              - type: CheckBox
                name: calculateIDI
                label: Integrated Discrimination Index (IDI)

  # =============================================================================
  # OUTPUT OPTIONS - What to display/export
  # =============================================================================
  - type: CollapseBox
    label: üìã Output Options
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìä Tables & Performance
            children:
              - type: CheckBox
                name: showModelSummary
                label: Show model coefficients and statistics
              - type: CheckBox
                name: showPerformanceMetrics
                label: Show performance metrics (AUC, calibration, etc.)
              - type: CheckBox
                name: compareModels
                label: Model comparison table

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìà Plots & Visualizations
            children:
              - type: CheckBox
                name: showROCCurves
                label: ROC curves for discrimination
              - type: CheckBox
                name: showCalibrationPlots
                label: Calibration plots for reliability

      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üíæ Data Export & Integration
            children:
              - type: CheckBox
                name: createPredictions
                label: Add predictions to dataset (for further analysis)
              - type: CheckBox
                name: exportForDCA
                label: Prepare for Decision Curve Analysis

  # =============================================================================
  # CLINICAL RISK SCORE - Practical application
  # =============================================================================
  - type: CollapseBox
    label: üè• Clinical Risk Score
    margin: normal
    collapsed: true
    children:
      - type: LayoutBox
        margin: large
        children:
          - type: Label
            label: üìã Risk Score Generation
            children:
              - type: CheckBox
                name: generateRiskScore
                label: Generate clinical risk score for bedside use
              - type: ComboBox
                name: riskScorePoints
                label: Point system complexity
                enable: (generateRiskScore)