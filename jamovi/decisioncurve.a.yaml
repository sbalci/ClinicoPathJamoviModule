---
name: decisioncurve
title: Decision Curve Analysis
menuGroup: meddecideT
menuSubgroup: Decision Curve Analysis
menuSubtitle: Clinical Utility, Net Benefit, Threshold Analysis
version: '0.0.32'
jas: '1.2'

description:
    main: >
        Decision Curve Analysis for evaluating the clinical utility of prediction models
        and diagnostic tests. Calculates net benefit across threshold probabilities to
        determine if using a model provides more benefit than default strategies.
    R:
        dontrun: true
        usage: |
            # example will be added

options:
    - name: data
      type: Data
      description:
          R: The data as a data frame.

    - name: outcome
      title: Outcome Variable
      type: Variable
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          R: >
            Binary outcome variable (0/1 or FALSE/TRUE). This represents the
            condition or event you want to predict.

    - name: outcomePositive
      title: Positive Outcome Level
      type: Level
      variable: (outcome)
      description:
          R: >
            Which level of the outcome variable represents the positive case
            (presence of condition/event).

    - name: models
      title: Prediction Variables/Models
      type: Variables
      suggested: [ continuous ]
      permitted: [ numeric, factor ]
      description:
          R: >
            Variables representing predicted probabilities or risk scores from
            different models. Can include multiple models for comparison.

    - name: modelNames
      title: Model Names
      type: String
      default: ""
      description:
          R: >
            Optional comma-separated list of names for the models. If not provided,
            variable names will be used.

    - name: thresholdRange
      title: Threshold Range
      type: List
      options:
        - name: auto
          title: Automatic (0.01 to 0.99)
        - name: clinical
          title: Clinical range (0.05 to 0.50)
        - name: custom
          title: Custom range
      default: clinical
      description:
          R: >
            Range of threshold probabilities to evaluate.

    - name: thresholdMin
      title: Minimum Threshold
      type: Number
      default: 0.05
      min: 0.001
      max: 0.999
      description:
          R: >
            Minimum threshold probability when using custom range.

    - name: thresholdMax
      title: Maximum Threshold
      type: Number
      default: 0.50
      min: 0.001
      max: 0.999
      description:
          R: >
            Maximum threshold probability when using custom range.

    - name: thresholdStep
      title: Threshold Step Size
      type: Number
      default: 0.01
      min: 0.001
      max: 0.1
      description:
          R: >
            Step size between threshold probabilities.

    - name: showTable
      title: Show Results Table
      type: Bool
      default: true
      description:
          R: >
            Display table with net benefit values at selected thresholds.

    - name: selectedThresholds
      title: Selected Thresholds for Table
      type: String
      default: "0.05, 0.10, 0.15, 0.20, 0.25, 0.30"
      description:
          R: >
            Comma-separated list of threshold probabilities to display in table.

    - name: showPlot
      title: Show Decision Curve Plot
      type: Bool
      default: true
      description:
          R: >
            Display the decision curve plot.

    - name: plotStyle
      title: Plot Style
      type: List
      options:
        - name: standard
          title: Standard (with reference lines)
        - name: clean
          title: Clean (minimal annotations)
        - name: detailed
          title: Detailed (with annotations)
      default: standard
      description:
          R: >
            Style of the decision curve plot.

    - name: showReferenceLinesLabels
      title: Show Reference Line Labels
      type: Bool
      default: true
      description:
          R: >
            Show labels for "Treat All" and "Treat None" reference lines.

    - name: highlightRange
      title: Highlight Clinical Range
      type: Bool
      default: false
      description:
          R: >
            Highlight a clinically relevant threshold range on the plot.

    - name: highlightMin
      title: Highlight Range Minimum
      type: Number
      default: 0.10
      min: 0.001
      max: 0.999
      description:
          R: >
            Minimum threshold for highlighted range.

    - name: highlightMax
      title: Highlight Range Maximum
      type: Number
      default: 0.30
      min: 0.001
      max: 0.999
      description:
          R: >
            Maximum threshold for highlighted range.

    - name: calculateClinicalImpact
      title: Calculate Clinical Impact
      type: Bool
      default: false
      description:
          R: >
            Calculate clinical impact metrics (number needed to screen, etc.).

    - name: populationSize
      title: Population Size for Clinical Impact
      type: Number
      default: 1000
      min: 100
      max: 1000000
      description:
          R: >
            Population size for calculating clinical impact metrics.

    - name: showInterventionAvoided
      title: Show Interventions Avoided
      type: Bool
      default: false
      description:
          R: >
            Show how many unnecessary interventions are avoided compared to treat-all.

    - name: confidenceIntervals
      title: Bootstrap Confidence Intervals
      type: Bool
      default: false
      description:
          R: >
            Calculate bootstrap confidence intervals for net benefit curves.

    - name: bootReps
      title: Bootstrap Replications
      type: Number
      default: 1000
      min: 100
      max: 10000
      description:
          R: >
            Number of bootstrap replications for confidence intervals.

    - name: ciLevel
      title: Confidence Level
      type: Number
      default: 0.95
      min: 0.80
      max: 0.99
      description:
          R: >
            Confidence level for bootstrap confidence intervals.

    - name: showOptimalThreshold
      title: Show Optimal Thresholds
      type: Bool
      default: true
      description:
          R: >
            Identify and display optimal threshold probabilities for each model.

    - name: compareModels
      title: Model Comparison Statistics
      type: Bool
      default: false
      description:
          R: >
            Calculate statistical tests for comparing model performance.

    - name: weightedAUC
      title: Calculate Weighted AUC
      type: Bool
      default: false
      description:
          R: >
            Calculate weighted area under the decision curve.

    - name: clinicalDecisionRule
      title: Clinical Decision Rule Integration
      type: Bool
      default: false
      description:
          R: >
            Add clinical decision rule analysis and comparison with models.

    - name: decisionRuleThreshold
      title: Decision Rule Threshold
      type: Number
      default: 0.15
      min: 0.001
      max: 0.999
      description:
          R: >
            Threshold probability for clinical decision rule (e.g., "screen if risk > 15%").

    - name: decisionRuleLabel
      title: Decision Rule Label
      type: String
      default: "Clinical Rule"
      description:
          R: >
            Label for the clinical decision rule in plots and tables.

    # Enhanced Decision Curve Analysis Options
    - name: showClinicalImpactPlot
      title: Clinical Impact Plot
      type: Bool
      default: false
      description:
          R: >
            Display clinical impact plot showing number of true positives and false positives
            per population unit across threshold probabilities.

    - name: showNetBenefitCI
      title: Show Net Benefit Confidence Intervals
      type: Bool
      default: false
      description:
          R: >
            Display confidence intervals around net benefit curves in the decision curve plot.

    - name: costBenefitAnalysis
      title: Cost-Benefit Analysis
      type: Bool
      default: false
      description:
          R: >
            Perform cost-benefit analysis incorporating costs of testing, treatment, and outcomes.

    - name: testCost
      title: Cost of Test/Screening
      type: Number
      default: 100
      min: 0
      max: 1000000
      description:
          R: >
            Cost per test or screening procedure (in currency units).

    - name: treatmentCost
      title: Cost of Treatment
      type: Number
      default: 1000
      min: 0
      max: 1000000
      description:
          R: >
            Cost of treatment or intervention (in currency units).

    - name: benefitCorrectTreatment
      title: Benefit of Correct Treatment
      type: Number
      default: 10000
      min: 0
      max: 10000000
      description:
          R: >
            Monetary benefit or QALY-equivalent value of correctly treating a true positive.

    - name: harmFalseTreatment
      title: Harm of False Treatment
      type: Number
      default: 500
      min: 0
      max: 1000000
      description:
          R: >
            Cost or harm of treating a false positive (unnecessary treatment).

    - name: showStandardizedNetBenefit
      title: Standardized Net Benefit
      type: Bool
      default: false
      description:
          R: >
            Calculate and display standardized net benefit (net benefit per 100 patients).

    - name: multiModelComparison
      title: Enhanced Multi-Model Comparison
      type: Bool
      default: true
      description:
          R: >
            Perform comprehensive pairwise comparisons between all models with statistical tests.

    - name: comparisonMethod
      title: Comparison Statistical Test
      type: List
      options:
        - name: bootstrap
          title: Bootstrap Test
        - name: permutation
          title: Permutation Test
        - name: integral
          title: Integral Difference Test
      default: bootstrap
      description:
          R: >
            Statistical method for comparing decision curves between models.

    - name: showDecisionConsequences
      title: Decision Consequences Table
      type: Bool
      default: true
      description:
          R: >
            Show detailed table of decision consequences (TP, FP, TN, FN) at selected thresholds.

    - name: resourceUtilization
      title: Resource Utilization Analysis
      type: Bool
      default: false
      description:
          R: >
            Calculate resource utilization metrics (tests performed, treatments administered).

    - name: showRelativeUtility
      title: Relative Utility Curve
      type: Bool
      default: false
      description:
          R: >
            Display relative utility curve comparing each model to default strategies.

...
