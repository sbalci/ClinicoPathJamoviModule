---
name: decisioncombine
title: Combine Medical Decision Tests
menuGroup: meddecideT2
menuSubgroup: Decision
menuSubtitle: Combine tests and evaluate performance
version: '0.0.31'
jas: '1.2'

description:
    main: |
        Advanced medical diagnostic test combination analysis for categorical tests 
        with comprehensive clinical interpretation. This function systematically 
        evaluates all possible test result combinations (2-test: 4 patterns, 
        3-test: 8 patterns) against a gold standard using state-of-the-art 
        statistical methods. Features include Wilson score confidence intervals 
        for enhanced accuracy, performance heatmaps, decision trees, and 
        publication-quality visualizations with clinical decision thresholds. 
        Provides actionable recommendations for screening vs. confirmatory testing 
        strategies with detailed clinical interpretation guidelines. Essential for 
        evidence-based diagnostic protocol development and categorical test 
        validation studies.
    R:
        dontrun: false
        usage: |
            # Basic two-test combination analysis
            result1 <- decisioncombine(
              data = histopathology,
              gold = "Golden Standart",
              goldPositive = "1",
              test1 = "New Test", 
              test1Positive = "1",
              test2 = "Rater 1",
              test2Positive = "1",
              showVisualization = TRUE,
              plotType = "all"  # Shows all visualization types
            )
            
            # Comprehensive three-test analysis with clinical recommendations
            result2 <- decisioncombine(
              data = histopathology,
              gold = "Golden Standart",
              goldPositive = "1",
              test1 = "New Test",
              test1Positive = "1", 
              test2 = "Rater 1",
              test2Positive = "1",
              test3 = "Rater 2",
              test3Positive = "1",
              showIndividual = TRUE,
              showVisualization = TRUE,
              plotType = "heatmap",  # Focus on performance heatmap
              addCombinationPattern = TRUE  # Export patterns for further analysis
            )
            
            # Access clinical recommendations from HTML output
            # result2$combinationsAnalysis contains clinical recommendations

options:
    - name: data
      type: Data
      description:
          R: The data as a data frame.

    - name: gold
      title: Golden Standard (Reference Test)
      type: Variable
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Select the most reliable diagnostic method available (e.g., biopsy, final pathology report, expert consensus). 
            This is the "truth" against which we compare other tests. Must be categorical with exactly 2 levels.
          R: >
            The gold standard reference variable representing true disease status.

    - name: goldPositive
      title: Disease Present Level
      type: Level
      variable: (gold)
      description:
          ui: >
            Select the level that indicates disease is PRESENT in your gold standard variable 
            (e.g., "1", "positive", "malignant"). This represents the condition you want to detect.
          R: >
            The level indicating presence of disease in the gold standard variable.

    # For the first test
    - name: test1
      title: Test 1 (Required)
      type: Variable
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Select the first diagnostic test to evaluate. This should be a test you want to validate 
            (e.g., imaging result, biomarker, clinical assessment). Must be categorical with 2+ levels.
          R: >
            The first diagnostic test variable being evaluated for performance.

    - name: test1Positive
      title: Test 1 Positive Level
      type: Level
      variable: (test1)
      description:
          ui: >
            Select the level that represents a POSITIVE result for Test 1 
            (e.g., "abnormal", "high", "positive"). This should indicate suspected disease presence.
          R: >
            The level representing a positive result for Test 1.

    # For the second test
    - name: test2
      title: Test 2 (Optional - Required for Combinations)
      type: Variable
      default: NULL
      suggested: [ nominal ]
      permitted: [ factor ]
      description:
          ui: >
            Select a second diagnostic test to combine with Test 1. This enables combination analysis 
            (e.g., combine imaging + biomarker, or two different biomarkers). Leave empty for single test analysis.
          R: >
            The second diagnostic test variable for combination analysis.

    - name: test2Positive
      title: Positive Level
      type: Level
      variable: (test2)

    # For the third test
    - name: test3
      title: Test 3
      type: Variable
      default: NULL
      suggested: [ nominal ]
      permitted: [ factor ]

    - name: test3Positive
      title: Positive Level
      type: Level
      variable: (test3)



    - name: od
      title: Original Data
      type: Bool
      default: false
      description:
          R: >
            Boolean selection whether to show frequency tables. Default is 'false'.



    - name: showIndividual
      title: 'Show Individual Test Results'
      type: Bool
      default: false

    - name: addCombinationPattern
      title: 'Add Combination Pattern to Data'
      type: Bool
      default: false
      description:
          R: >
            Export a new variable to the original data frame indicating the test combination pattern (e.g., +/+, +/-, -/+, -/-).

    # Visualization options
    - name: showVisualization
      title: Show Advanced Visualizations
      type: Bool
      default: false
      description:
          ui: >
            Generate publication-quality visualizations to help interpret results:
            • Performance Heatmap: Color-coded overview of all test combinations
            • Decision Tree: Clinical decision-making flowchart
            • Venn Diagram: Test agreement visualization
            • Forest Plot: Confidence intervals for all metrics
          R: >
            Display comprehensive visualizations for categorical test combination analysis.

    - name: plotType
      title: Visualization Type
      type: List
      options:
        - title: Performance Heatmap
          name: heatmap
        - title: Clinical Decision Tree
          name: tree
        - title: Test Agreement Venn Diagram
          name: venn
        - title: Forest Plot with Wilson CIs
          name: forest
        - title: All Visualizations
          name: all
      default: heatmap
      description:
          ui: >
            Select visualization type for categorical test analysis. Forest plots use Wilson score 
            confidence intervals for enhanced accuracy. 'All Visualizations' provides comprehensive 
            publication-ready output.
          R: >
            Visualization selection: heatmap (performance matrix), tree (clinical decision hierarchy), 
            venn (test agreement), forest (Wilson CIs), all (comprehensive output).

    - name: plotHeight
      title: Plot Height (pixels)
      type: Integer
      default: 600
      min: 400
      max: 1200
      description:
          R: >
            Height of the plot in pixels.

    - name: plotWidth
      title: Plot Width (pixels)
      type: Integer
      default: 800
      min: 600
      max: 1600
      description:
          R: >
            Width of the plot in pixels.

    - name: colorScheme
      title: Color Scheme
      type: List
      options:
        - title: Clinical (Red-Green)
          name: clinical
        - title: Viridis
          name: viridis
        - title: Blue-Yellow
          name: blueyellow
        - title: Grayscale
          name: grayscale
      default: clinical
      description:
          R: >
            Color scheme for visualizations. Clinical uses red for negative and green for positive.

...
