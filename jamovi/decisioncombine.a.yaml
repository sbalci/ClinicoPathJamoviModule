---
name: decisioncombine
title: Combine Medical Decision Tests
menuGroup: meddecideT2
menuSubgroup: Decision
menuSubtitle: Combine tests and evaluate performance
version: '0.0.31'
jas: '1.2'

description:
    main: |
        Advanced medical diagnostic test combination analysis with automated 
        optimal cut-point identification and comprehensive clinical interpretation. 
        This function systematically evaluates all possible test result combinations 
        (2-test: 4 patterns, 3-test: 8 patterns) against a gold standard using 
        state-of-the-art statistical methods. Features include Wilson score 
        confidence intervals for enhanced accuracy, ROC-based optimal cut-point 
        selection using Youden Index maximization, and publication-quality 
        visualizations with clinical decision thresholds. Provides actionable 
        recommendations for screening vs. confirmatory testing strategies with 
        detailed clinical interpretation guidelines. Essential for evidence-based 
        diagnostic protocol development and test validation studies.
    R:
        dontrun: false
        usage: |
            # Basic two-test combination analysis with optimal cut-point identification
            result1 <- decisioncombine(
              data = histopathology,
              gold = "Golden Standart",
              goldPositive = "1",
              test1 = "New Test", 
              test1Positive = "1",
              test2 = "Rater 1",
              test2Positive = "1",
              showVisualization = TRUE,
              plotType = "all"  # Shows all visualization types including ROC with optimal cut-point
            )
            
            # Comprehensive three-test analysis with clinical recommendations
            result2 <- decisioncombine(
              data = histopathology,
              gold = "Golden Standart",
              goldPositive = "1",
              test1 = "New Test",
              test1Positive = "1", 
              test2 = "Rater 1",
              test2Positive = "1",
              test3 = "Rater 2",
              test3Positive = "1",
              showIndividual = TRUE,
              showVisualization = TRUE,
              plotType = "roc",  # Focus on ROC analysis with optimal cut-point
              addCombinationPattern = TRUE  # Export patterns for further analysis
            )
            
            # Access optimal cut-point recommendations from HTML output
            # result2$combinationsAnalysis contains clinical recommendations

options:
    - name: data
      type: Data
      description:
          R: The data as a data frame.

    - name: gold
      title: Golden Standard
      type: Variable
      suggested: [ nominal ]
      permitted: [ factor ]

    - name: goldPositive
      title: Positive Level
      type: Level
      variable: (gold)

    # For the first test
    - name: test1
      title: Test 1
      type: Variable
      suggested: [ nominal ]
      permitted: [ factor ]

    - name: test1Positive
      title: Positive Level
      type: Level
      variable: (test1)

    # For the second test
    - name: test2
      title: Test 2
      type: Variable
      default: NULL
      suggested: [ nominal ]
      permitted: [ factor ]

    - name: test2Positive
      title: Positive Level
      type: Level
      variable: (test2)

    # For the third test
    - name: test3
      title: Test 3
      type: Variable
      default: NULL
      suggested: [ nominal ]
      permitted: [ factor ]

    - name: test3Positive
      title: Positive Level
      type: Level
      variable: (test3)



    - name: od
      title: Original Data
      type: Bool
      default: false
      description:
          R: >
            Boolean selection whether to show frequency tables. Default is 'false'.



    - name: showIndividual
      title: 'Show Individual Test Results'
      type: Bool
      default: false

    - name: addCombinationPattern
      title: 'Add Combination Pattern to Data'
      type: Bool
      default: false
      description:
          R: >
            Export a new variable to the original data frame indicating the test combination pattern (e.g., +/+, +/-, -/+, -/-).

    # Visualization options
    - name: showVisualization
      title: Show Advanced Visualizations
      type: Bool
      default: false
      description:
          ui: >
            Generate publication-quality visualizations including performance heatmaps, 
            ROC analysis with optimal cut-point identification, decision trees, Venn diagrams, 
            and forest plots with Wilson confidence intervals.
          R: >
            Display comprehensive visualizations for test combination analysis with automated optimal cut-point identification.

    - name: plotType
      title: Visualization Type
      type: List
      options:
        - title: Performance Heatmap
          name: heatmap
        - title: ROC Analysis with Optimal Cut-point
          name: roc
        - title: Clinical Decision Tree
          name: tree
        - title: Test Agreement Venn Diagram
          name: venn
        - title: Forest Plot with Wilson CIs
          name: forest
        - title: All Visualizations
          name: all
      default: heatmap
      description:
          ui: >
            Select visualization type. ROC analysis automatically identifies optimal cut-points 
            using Youden Index. Forest plots use Wilson score confidence intervals for enhanced 
            accuracy. 'All Visualizations' provides comprehensive publication-ready output.
          R: >
            Visualization selection: heatmap (performance matrix), roc (ROC space with optimal cut-point), 
            tree (clinical decision hierarchy), venn (test agreement), forest (Wilson CIs), all (comprehensive output).

    - name: plotHeight
      title: Plot Height (pixels)
      type: Integer
      default: 600
      min: 400
      max: 1200
      description:
          R: >
            Height of the plot in pixels.

    - name: plotWidth
      title: Plot Width (pixels)
      type: Integer
      default: 800
      min: 600
      max: 1600
      description:
          R: >
            Width of the plot in pixels.

    - name: colorScheme
      title: Color Scheme
      type: List
      options:
        - title: Clinical (Red-Green)
          name: clinical
        - title: Viridis
          name: viridis
        - title: Blue-Yellow
          name: blueyellow
        - title: Grayscale
          name: grayscale
      default: clinical
      description:
          R: >
            Color scheme for visualizations. Clinical uses red for negative and green for positive.

...
