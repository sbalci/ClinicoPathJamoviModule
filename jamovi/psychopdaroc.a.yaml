---
name: psychopdaROC
title: Advanced ROC Analysis
menuGroup: meddecide
menuSubgroup: ROC
menuSubtitle: Advanced ROC analysis with statistical comparisons and effect sizes
version: '0.0.33'
jas: '1.2'

description:
    main: >
        Receiver Operating Characteristic (ROC) curve analysis with optimal cutpoint determination.

options:
    # ==========================================
    # CLINICAL ANALYSIS MODE SELECTION
    # ==========================================
    
    - name: clinicalMode
      title: Analysis Level
      type: List
      options:
        - name: basic
          title: Basic ROC Analysis (Recommended for Clinical Use)
        - name: advanced
          title: Advanced Research Analysis
        - name: comprehensive
          title: Comprehensive Statistical Analysis
      default: basic
      description:
          R: >
            Select the complexity level of analysis:
            Basic - Essential ROC metrics for clinical decision making
            Advanced - Additional statistical comparisons and metrics
            Comprehensive - Full research-grade analysis with all options

    # ==========================================
    # DATA INPUT SECTION
    # ==========================================
    
    - name: data
      type: Data
      description:
          R: The data as a data frame.

    - name: dependentVars
      title: Test Variables
      type: Variables
      suggested:
        - continuous
      permitted:
        - numeric
      description:
          R: >
            Test variable(s) to be evaluated for classification performance.
            Multiple variables can be selected for comparison.

    - name: classVar
      title: Class Variable (Gold Standard)
      type: Variable
      suggested:
        - nominal
      permitted:
        - factor
      description:
          R: >
            Binary classification variable representing the true class (gold standard).
            Must have exactly two levels.

    - name: positiveClass
      title: Positive Class
      type: Level
      variable: (classVar)
      description:
          ui: >
            Select which level of the class variable represents the positive class (disease/condition present).
          R: >
            Specifies which level of the class variable should be treated as the positive class.

    - name: subGroup
      title: Subgroup Variable (Optional)
      type: Variable
      default: null
      suggested:
        - nominal
      permitted:
        - factor
      description:
          R: >
            Optional grouping variable for stratified analysis.
            ROC curves will be calculated separately for each group.

    # ==========================================
    # CLINICAL WORKFLOW PRESETS
    # ==========================================
    
    - name: clinicalPreset
      title: Clinical Use Case
      type: List
      options:
        - name: none
          title: Custom Analysis
        - name: screening
          title: Screening Test (Prioritize Sensitivity)
        - name: confirmation
          title: Confirmation Test (Prioritize Specificity)  
        - name: balanced
          title: Balanced Diagnostic Test
        - name: research
          title: Research Comparison
      default: none
      description:
          R: >
            Choose a preset configuration optimized for specific clinical scenarios:
            Screening - High sensitivity to avoid missing cases
            Confirmation - High specificity to avoid false positives
            Balanced - Equal weight to sensitivity and specificity
            Research - Comprehensive analysis for publication

    # ==========================================
    # CUTPOINT OPTIMIZATION SECTION
    # ==========================================
    
    - name: method
      title: Cutpoint Method
      type: List
      options:
        - name: maximize_metric
          title: Maximize metric
        - name: minimize_metric
          title: Minimize metric
        - name: maximize_loess_metric
          title: Maximize metric (LOESS smoothed)
        - name: minimize_loess_metric
          title: Minimize metric (LOESS smoothed)
        - name: maximize_boot_metric
          title: Maximize metric (bootstrapped)
        - name: minimize_boot_metric
          title: Minimize metric (bootstrapped)
        - name: oc_youden_kernel
          title: Youden Index (kernel smoothed)
        - name: oc_youden_normal
          title: Youden Index (parametric normal)
        - name: oc_manual
          title: Manual cutpoint
        - name: oc_cost_ratio
          title: Cost-benefit optimized
        - name: oc_equal_sens_spec
          title: Equal sensitivity and specificity
        - name: oc_closest_01
          title: Closest to perfect classifier
      default: maximize_metric
      description:
          R: >
            Method for determining the optimal cutpoint. Different methods optimize
            different aspects of classifier performance.

    - name: metric
      title: Optimization Metric
      type: List
      options:
        - name: youden
          title: Youden Index (Sens + Spec - 1)
        - name: sum_sens_spec
          title: Sum of sensitivity and specificity
        - name: accuracy
          title: Overall accuracy
        - name: sum_ppv_npv
          title: Sum of PPV and NPV
        - name: prod_sens_spec
          title: Product of sensitivity and specificity
        - name: prod_ppv_npv
          title: Product of PPV and NPV
        - name: cohens_kappa
          title: Cohen's Kappa
        - name: abs_d_sens_spec
          title: Minimize |Sens - Spec|
        - name: abs_d_ppv_npv
          title: Minimize |PPV - NPV|
        - name: F1_score
          title: F1 Score
        - name: odds_ratio
          title: Diagnostic odds ratio
        - name: risk_ratio
          title: Risk ratio
        - name: misclassification_cost
          title: Misclassification cost
        - name: total_utility
          title: Total utility
        - name: roc01
          title: Distance to (0,1) in ROC space
        - name: p_chisquared
          title: Chi-squared statistic
      default: youden
      description:
          R: >
            Metric to optimize when determining the cutpoint. 
            Only applies to maximize/minimize methods.

    - name: direction
      title: Classification Direction
      type: List
      options:
        - name: ">="
          title: ">= (higher values indicate positive class)"
        - name: "<="
          title: "<= (lower values indicate positive class)"
      default: ">="
      description:
          R: >
            Direction of classification relative to the cutpoint.
            Use '>=' when higher test values indicate the positive class.

    - name: specifyCutScore
      title: Manual Cutpoint Value
      type: String
      default: ""
      description:
          R: >
            Specific cutpoint value to use when method is set to 'Manual cutpoint'.

    - name: tol_metric
      title: Metric Tolerance
      type: Number
      default: 0.05
      min: 0.0
      max: 1.0
      description:
          R: >
            Tolerance for the metric value when multiple cutpoints yield similar performance.
            Cutpoints within this tolerance are considered equivalent.

    - name: break_ties
      title: Tie Breaking Method
      type: List
      options:
        - name: mean
          title: Mean of tied cutpoints
        - name: median
          title: Median of tied cutpoints
        - name: c
          title: All tied cutpoints
      default: mean
      description:
          R: >
            Method for handling ties when multiple cutpoints achieve the same metric value.

    # ==========================================
    # ANALYSIS OPTIONS
    # ==========================================
    
    - name: allObserved
      title: Show All Observed Cutpoints
      type: Bool
      default: false
      description:
          R: >
            Display performance metrics for all observed test values as potential cutpoints,
            not just the optimal cutpoint.

    - name: boot_runs
      title: Bootstrap Iterations
      type: Number
      default: 0
      min: 0
      max: 10000
      description:
          R: >
            Number of bootstrap iterations for methods using bootstrapping.
            Set to 0 to disable bootstrapping.

    - name: seed
      title: Random Seed
      type: Integer
      default: 123
      description:
          R: >
            Random seed for reproducibility of bootstrap and permutation tests.

    - name: usePriorPrev
      title: Use Prior Prevalence
      type: Bool
      default: false
      description:
          R: >
            Use a specified prior prevalence instead of the sample prevalence
            for calculating predictive values.

    - name: priorPrev
      title: Prior Prevalence Value
      type: Number
      default: 0.5
      min: 0.001
      max: 0.999
      description:
          R: >
            Population prevalence to use for predictive value calculations.
            Only used when 'Use Prior Prevalence' is checked.

    - name: costratioFP
      title: Cost Ratio (FP:FN)
      type: Number
      default: 1.0
      min: 0.01
      max: 100.0
      description:
          R: >
            Relative cost of false positives compared to false negatives.
            Values > 1 penalize false positives more heavily.

    # ==========================================
    # BASIC OUTPUT OPTIONS
    # ==========================================
    
    - name: sensSpecTable
      title: Show Confusion Matrices
      type: Bool
      default: false
      description:
          R: >
            Display detailed confusion matrices at optimal cutpoints.

    - name: showThresholdTable
      title: Show Threshold Table
      type: Bool
      default: false
      description:
          R: >
            Display detailed table with performance metrics at multiple thresholds.

    - name: maxThresholds
      title: Maximum Thresholds to Display
      type: Number
      default: 20
      min: 5
      max: 100
      description:
          R: >
            Maximum number of threshold values to show in the threshold table.

    - name: delongTest
      title: Compare Test Performance Statistically
      type: Bool
      default: false
      description:
          R: >
            Test whether the diagnostic performance differs significantly between multiple tests.
            Uses DeLong's method to compare Area Under the Curve (AUC) values.
            Requires at least two test variables.

    # ==========================================
    # VISUALIZATION OPTIONS
    # ==========================================
    
    - name: plotROC
      title: Show ROC Curves
      type: Bool
      default: true
      description:
          R: >
            Display ROC curves for visual assessment of classifier performance.

    - name: combinePlots
      title: Combine Multiple ROC Curves
      type: Bool
      default: true
      description:
          R: >
            When multiple test variables are selected, combine all ROC curves in a single plot.

    - name: cleanPlot
      title: Publication-Ready Plot
      type: Bool
      default: false
      description:
          R: >
            Create clean ROC curves without annotations, suitable for publications.

    - name: showOptimalPoint
      title: Mark Optimal Cutpoint
      type: Bool
      default: true
      description:
          R: >
            Display the optimal cutpoint on the ROC curve.

    - name: displaySE
      title: Show Standard Error Bands
      type: Bool
      default: false
      description:
          R: >
            Display standard error bands on ROC curves (when LOESS smoothing is applied).

    - name: smoothing
      title: Apply LOESS Smoothing
      type: Bool
      default: false
      description:
          R: >
            Apply LOESS smoothing to ROC curves for visualization.

    - name: showConfidenceBands
      title: Show Confidence Bands
      type: Bool
      default: false
      description:
          R: >
            Display confidence bands around the ROC curve.

    - name: legendPosition
      title: Legend Position
      type: List
      options:
        - name: "none"
          title: "No legend"
        - name: "right"
          title: "Right"
        - name: "bottom"
          title: "Bottom"
        - name: "topleft"
          title: "Top left"
        - name: "topright" 
          title: "Top right"
      default: "right"
      description:
          R: >
            Position of the legend in plots with multiple ROC curves.

    - name: directLabel
      title: Direct Curve Labels
      type: Bool
      default: false
      description:
          R: >
            Label curves directly on the plot instead of using a legend.

    - name: interactiveROC
      title: Create Interactive Plot
      type: Bool
      default: false
      description:
          R: >
            Create an interactive HTML ROC plot (requires plotROC package).

    # ==========================================
    # ADDITIONAL PLOTS
    # ==========================================
    
    - name: showCriterionPlot
      title: Sensitivity/Specificity vs Threshold
      type: Bool
      default: false
      description:
          R: >
            Plot showing how sensitivity and specificity change across different thresholds.

    - name: showPrevalencePlot
      title: Predictive Values vs Prevalence
      type: Bool
      default: false
      description:
          R: >
            Plot showing how PPV and NPV change with disease prevalence.

    - name: showDotPlot
      title: Test Value Distribution
      type: Bool
      default: false
      description:
          R: >
            Dot plot showing the distribution of test values by class.

    - name: precisionRecallCurve
      title: Precision-Recall Curve
      type: Bool
      default: false
      description:
          R: >
            Display precision-recall curves alongside ROC curves.

    # ==========================================
    # ADVANCED ANALYSES
    # ==========================================
    
    - name: partialAUC
      title: Calculate Partial AUC
      type: Bool
      default: false
      description:
          R: >
            Calculate AUC for a specific region of the ROC curve.

    - name: partialAUCfrom
      title: Partial AUC From (Specificity)
      type: Number
      default: 0.8
      min: 0.0
      max: 1.0
      description:
          R: >
            Lower bound of specificity range for partial AUC calculation.

    - name: partialAUCto
      title: Partial AUC To (Specificity)
      type: Number
      default: 1.0
      min: 0.0
      max: 1.0
      description:
          R: >
            Upper bound of specificity range for partial AUC calculation.

    - name: rocSmoothingMethod
      title: ROC Smoothing Method
      type: List
      options:
        - name: none
          title: None
        - name: binormal
          title: Binormal
        - name: density
          title: Density-based
        - name: fitdistr
          title: Distribution fitting
      default: none
      description:
          R: >
            Method for smoothing the ROC curve (requires pROC package).

    - name: bootstrapCI
      title: Bootstrap Confidence Intervals
      type: Bool
      default: false
      description:
          R: >
            Calculate bootstrap confidence intervals for AUC and optimal cutpoints.

    - name: bootstrapReps
      title: Bootstrap Replications
      type: Number
      default: 2000
      min: 100
      max: 10000
      description:
          R: >
            Number of bootstrap replications for confidence interval calculation.

    - name: quantileCIs 
      title: Show CIs at Quantiles
      type: Bool
      default: false
      description:
          R: >
            Display confidence intervals at specific quantiles of the test variable.

    - name: quantiles
      title: Quantile Positions
      type: String
      default: "0.1,0.25,0.5,0.75,0.9"
      description:
          R: >
            Comma-separated list of quantiles (0-1) at which to display confidence intervals.

    # ==========================================
    # MODEL COMPARISON
    # ==========================================
    
    - name: compareClassifiers
      title: Compare Classifier Performance
      type: Bool
      default: false
      description:
          R: >
            Perform comprehensive comparison of classifier performance metrics.

    - name: calculateIDI
      title: Calculate Discrimination Improvement
      type: Bool
      default: false
      description:
          R: >
            Calculate how much better one test is at discriminating between diseased and healthy patients.
            IDI (Integrated Discrimination Improvement) measures the average improvement in predicted probabilities.

    - name: calculateNRI
      title: Calculate Reclassification Improvement
      type: Bool
      default: false
      description:
          R: >
            Calculate how many patients are correctly reclassified when using a new test.
            NRI (Net Reclassification Index) measures the net improvement in patient classification.

    - name: refVar
      title: Reference Variable
      type: Level
      variable: (dependentVars)
      allowNone: true
      description:
          R: >
            Reference test variable for IDI and NRI calculations.
            Other variables will be compared against this reference.

    - name: nriThresholds
      title: NRI Risk Categories
      type: String
      default: ""
      description:
          R: >
            Comma-separated probability thresholds (0-1) defining risk categories for NRI.
            Leave empty for continuous NRI.

    - name: idiNriBootRuns
      title: IDI/NRI Bootstrap Iterations
      type: Number
      default: 1000
      min: 100
      max: 10000
      description:
          R: >
            Number of bootstrap iterations for IDI and NRI confidence intervals.

    # ==========================================
    # ADVANCED STATISTICAL ANALYSES
    # ==========================================

    - name: effectSizeAnalysis
      title: Effect Size Analysis
      type: Bool
      default: false
      description:
          R: >
            Calculate effect sizes for ROC curve differences using Cohen's conventions
            and standardized mean differences between AUC values.

    # TODO: effectSizeMethod - Currently only Cohen's d is implemented
    # Uncomment when alternative effect size methods are added
    # - name: effectSizeMethod
    #   title: Effect Size Method
    #   type: List
    #   options:
    #     - name: cohens_d
    #       title: Cohen's d for AUC differences
    #     - name: delta_auc
    #       title: Standardized AUC difference
    #     - name: overlap_coefficient
    #       title: ROC curve overlap coefficient
    #     - name: net_benefit_difference
    #       title: Net benefit effect size
    #   default: cohens_d
    #   description:
    #       R: >
    #         Method for calculating effect sizes between ROC curves.

    - name: powerAnalysis
      title: Statistical Power Analysis
      type: Bool
      default: false
      description:
          R: >
            Perform statistical power analysis for ROC curve comparisons including
            sample size estimation and power calculations for detecting AUC differences.

    - name: powerAnalysisType
      title: Power Analysis Type
      type: List
      options:
        - name: post_hoc
          title: Post-hoc power (observed data)
        - name: prospective
          title: Prospective power (planning)
        - name: sample_size
          title: Sample size estimation
      default: post_hoc
      description:
          R: >
            Type of power analysis to perform.

    - name: expectedAUCDifference
      title: Expected AUC Difference
      type: Number
      default: 0.1
      min: 0.01
      max: 0.5
      description:
          R: >
            Expected difference in AUC values for power calculations and sample size estimation.

    - name: targetPower
      title: Target Statistical Power
      type: Number
      default: 0.8
      min: 0.5
      max: 0.99
      description:
          R: >
            Target statistical power for sample size calculations (typically 0.8 or 0.9).

    - name: significanceLevel
      title: Significance Level (Alpha)
      type: Number
      default: 0.05
      min: 0.001
      max: 0.1
      description:
          R: >
            Type I error rate for power calculations (typically 0.05).

    - name: correlationROCs
      title: ROC Correlation
      type: Number
      default: 0.5
      min: -1.0
      max: 1.0
      description:
          R: >
            Expected correlation between paired ROC curves for power calculations.
            Use 0.5 for moderate correlation, 0.0 for independent samples.

    # TODO: advancedMetrics - H-measure, KS statistic, Gini coefficient not yet implemented
    # Uncomment when advanced metrics are added
    # - name: advancedMetrics
    #   title: Advanced Performance Metrics
    #   type: Bool
    #   default: false
    #   description:
    #       R: >
    #         Calculate additional advanced metrics including H-measure, Kolmogorov-Smirnov
    #         statistic, and Gini coefficient for comprehensive model evaluation.

    - name: bayesianAnalysis
      title: Bootstrap ROC Analysis with Prior Weighting
      type: Bool
      default: false
      description:
          R: >
            Perform bootstrap-based ROC analysis with optional prior weighting to
            estimate uncertainty in AUC. Uses bootstrap resampling to create an
            empirical distribution. NOTE: This is NOT full Bayesian MCMC inference;
            it uses bootstrap simulation with prior parameters as weights. Interpret
            "credible intervals" as bootstrap percentile confidence intervals.

    - name: priorAUC
      title: Prior AUC Belief
      type: Number
      default: 0.7
      min: 0.5
      max: 1.0
      description:
          R: >
            Prior belief about AUC value for Bayesian analysis (center of prior distribution).

    - name: priorPrecision
      title: Prior Precision
      type: Number
      default: 10
      min: 1
      max: 100
      description:
          R: >
            Precision of prior belief (higher values = more confident prior).

    # ==========================================
    # CLINICAL UTILITY ANALYSIS
    # ==========================================

    - name: clinicalUtilityAnalysis
      title: Clinical Utility Analysis
      type: Bool
      default: false
      description:
          R: >
            Perform clinical utility analysis including net benefit curves,
            decision curve analysis, and clinical impact assessment.

    - name: treatmentThreshold
      title: Treatment Threshold Range
      type: String
      default: "0.05,0.5,0.05"
      description:
          R: >
            Treatment threshold range for decision curve analysis (min,max,step).
            Example: "0.05,0.5,0.05" creates thresholds from 5% to 50% in 5% steps.

    - name: harmBenefitRatio
      title: Harm-to-Benefit Ratio
      type: Number
      default: 0.25
      min: 0.01
      max: 10.0
      description:
          R: >
            Ratio of harm from unnecessary treatment to benefit from necessary treatment.
            Lower values favor more aggressive treatment policies.

    - name: interventionCost
      title: Intervention Cost Analysis
      type: Bool
      default: false
      description:
          R: >
            Include cost-effectiveness considerations in clinical utility analysis.

    # ==========================================
    # FIXED SENSITIVITY/SPECIFICITY ANALYSIS
    # ==========================================

    - name: fixedSensSpecAnalysis
      title: Fixed Sensitivity/Specificity Analysis
      type: Bool
      default: false
      description:
          R: >
            Determine cutoffs based on fixed sensitivity or specificity values and
            display corresponding performance metrics.

    - name: fixedAnalysisType
      title: Fixed Analysis Type
      type: List
      options:
        - name: sensitivity
          title: Fixed Sensitivity
        - name: specificity
          title: Fixed Specificity
      default: sensitivity
      description:
          R: >
            Choose whether to fix sensitivity or specificity value for cutoff determination.

    - name: fixedSensitivityValue
      title: Target Sensitivity
      type: Number
      default: 0.90
      min: 0.01
      max: 0.99
      description:
          R: >
            Target sensitivity value (0-1) for determining the corresponding cutoff and specificity.

    - name: fixedSpecificityValue
      title: Target Specificity
      type: Number
      default: 0.90
      min: 0.01
      max: 0.99
      description:
          R: >
            Target specificity value (0-1) for determining the corresponding cutoff and sensitivity.

    - name: showFixedROC
      title: Show Fixed Point ROC Curve
      type: Bool
      default: true
      description:
          R: >
            Display separate ROC curve highlighting the fixed sensitivity/specificity point.

    - name: fixedInterpolation
      title: Interpolation Method
      type: List
      options:
        - name: linear
          title: Linear Interpolation
        - name: nearest
          title: Nearest Point
        - name: stepwise
          title: Stepwise (Conservative)
      default: linear
      description:
          R: >
            Method for interpolating between observed points to achieve target sensitivity/specificity.

    - name: showFixedExplanation
      title: Show Analysis Guide
      type: Bool
      default: true
      description:
          R: >
            Display explanatory guide for fixed sensitivity/specificity analysis including 
            clinical interpretation, interpolation methods, and usage recommendations.

    # ==========================================
    # META-ANALYSIS OPTIONS
    # ==========================================

    - name: metaAnalysis
      title: Meta-Analysis of ROC Curves
      type: Bool
      default: false
      description:
          R: >
            Perform meta-analysis of AUC values across multiple test variables.
            Requires at least 3 test variables to enable pooled effect estimation.

    - name: metaAnalysisMethod
      title: Meta-Analysis Method
      type: List
      options:
        - name: fixed
          title: Fixed Effects Model
        - name: random
          title: Random Effects Model (DerSimonian-Laird)
        - name: both
          title: Both Fixed and Random Effects
      default: both
      description:
          R: >
            Statistical method for combining AUC estimates across studies/variables.

    - name: heterogeneityTest
      title: Test for Heterogeneity
      type: Bool
      default: true
      description:
          R: >
            Perform Cochran's Q test and calculate IÂ² statistic to assess
            heterogeneity between AUC estimates.

    - name: forestPlot
      title: Forest Plot
      type: Bool
      default: false
      description:
          R: >
            Create forest plot visualization of individual and pooled AUC estimates
            with confidence intervals.

    - name: overrideMetaAnalysisWarning
      title: Override Independence Warning (Advanced Users Only)
      type: Bool
      default: false
      description:
          R: >
            ADVANCED OPTION: Bypass the independence assumption check for meta-analysis.
            WARNING - Only use if you fully understand the statistical implications.
            Meta-analysis on non-independent data produces invalid results and should
            NOT be used for formal inference. Use DeLong's test instead for within-study
            comparisons of multiple markers.

...
