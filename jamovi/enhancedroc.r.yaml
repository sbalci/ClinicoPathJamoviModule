---
name: enhancedROC
title: Clinical ROC Analysis Results
jrs: '1.1'

items:
    - title: Analysis Results
      name: results
      type: Group
      items:
          # Notice outputs converted to HTML to avoid serialization errors
          - name: notices
            title: Important Information
            type: Html
            clearWith:
               - outcome
               - predictor
               - detectImbalance
               - analysisType

          - name: instructions
            title: Instructions
            type: Html
            visible: true

          # Imbalance Metrics Table
          - name: imbalanceMetrics
            title: Class Imbalance Metrics
            type: Table
            visible: (detectImbalance)
            rows: 1
            columns:
                - name: n_positive
                  title: 'N Positive'
                  type: integer
                - name: n_negative
                  title: 'N Negative'
                  type: integer
                - name: ratio
                  title: 'Ratio (Pos:Neg)'
                  type: text
                - name: prevalence
                  title: 'Prevalence'
                  type: number
                  format: zto
                - name: prc_baseline
                  title: 'PRC Baseline'
                  type: number
                  format: zto
                - name: imbalance_severity
                  title: 'Imbalance Severity'
                  type: text
                - name: recommendation
                  title: 'Recommendation'
                  type: text

          # Precision-Recall Metrics Table
          - name: precisionRecallTable
            title: Precision-Recall Metrics
            type: Table
            description: Metrics for imbalanced data analysis
            visible: (detectImbalance)
            rows: 1
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: auc_pr
                  title: 'AUC-PR'
                  type: number
                  format: zto
                - name: f1_score
                  title: 'F1 Score (Max)'
                  type: number
                  format: zto
                - name: precision
                  title: 'Precision'
                  type: number
                  format: zto
                - name: recall
                  title: 'Recall'
                  type: number
                  format: zto
                - name: average_precision
                  title: 'Average Precision'
                  type: number
                  format: zto

          # Natural Language Summary
          - name: analysisSummary
            title: Analysis Summary
            type: Html
            visible: true
            description: Plain language summary of key findings

          # Clinical Report Sentences
          - name: clinicalReport
            title: Clinical Report Sentences
            type: Html
            visible: true
            description: Copy-ready clinical report sentences for publications and reports

          # AUC Summary Table
          - name: aucSummary
            title: Area Under the Curve (AUC) Summary
            type: Table
            description: AUC values with confidence intervals for each predictor
            visible: (aucTable)
            
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: auc
                  title: 'AUC'
                  type: number
                  format: zto
                - name: auc_lower
                  title: 'AUC Lower CI'
                  type: number
                  format: zto
                - name: auc_upper
                  title: 'AUC Upper CI'
                  type: number
                  format: zto
                - name: std_error
                  title: 'Standard Error'
                  type: number
                  format: zto
                - name: auc_interpretation
                  title: 'AUC Interpretation'
                  type: text
                - name: clinical_utility
                  title: 'Clinical Utility'
                  type: text

          # ROC Curve Comparisons
          - name: rocComparisons
            title: ROC Curve Comparisons
            type: Table
            description: Pairwise comparisons between ROC curves
            visible: (pairwiseComparisons && analysisType:comparative)
            
            columns:
                - name: predictor1
                  title: 'Predictor 1'
                  type: text
                - name: predictor2
                  title: 'Predictor 2'
                  type: text
                - name: auc_difference
                  title: 'AUC Difference'
                  type: number
                  format: zto
                - name: test_statistic
                  title: 'Test Statistic'
                  type: number
                  format: zto
                - name: p_value
                  title: 'p-value'
                  type: number
                  format: zto;pvalue
                - name: result
                  title: 'Result'
                  type: text
                - name: clinical_significance
                  title: 'Clinical Significance'
                  type: text

          # Enhanced Model Comparison Metrics
          - name: detailedComparison
            title: Detailed Model Comparison
            type: Table
            description: Comprehensive comparison of diagnostic metrics between models
            visible: (showMetricsDiff && analysisType:comparative)
            
            columns:
                - name: metric
                  title: 'Metric'
                  type: text
                - name: model1_value
                  title: 'Model 1 Value'
                  type: number
                  format: zto
                - name: model2_value
                  title: 'Model 2 Value'
                  type: number
                  format: zto
                - name: difference
                  title: 'Difference'
                  type: number
                  format: zto
                - name: percent_change
                  title: '% Change'
                  type: number
                  format: pc
                - name: p_value
                  title: 'p-value'
                  type: number
                  format: zto;pvalue
                - name: effect_size
                  title: 'Effect Size'
                  type: number
                  format: zto
                - name: interpretation
                  title: 'Clinical Interpretation'
                  type: text

          # Statistical Comparison Summary
          - name: statisticalSummary
            title: Statistical Comparison Summary
            type: Table
            description: Summary of statistical tests for model comparison
            visible: (statisticalComparison && analysisType:comparative)
            
            columns:
                - name: test_name
                  title: 'Statistical Test'
                  type: text
                - name: test_statistic
                  title: 'Test Statistic'
                  type: number
                  format: zto
                - name: p_value
                  title: 'p-value'
                  type: number
                  format: zto;pvalue
                - name: conclusion
                  title: 'Statistical Conclusion'
                  type: text
                - name: effect_magnitude
                  title: 'Effect Magnitude'
                  type: text

          # Optimal Cutoff Summary
          - name: optimalCutoffSummary
            title: Optimal Cutoff Analysis
            type: Table
            description: Youden Index optimization results for each predictor
            visible: (optimalCutoffs)
            
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: optimal_cutoff
                  title: 'Optimal Cutoff'
                  type: number
                  format: zto
                - name: youden_index
                  title: 'Youden Index'
                  type: number
                  format: zto
                - name: sensitivity
                  title: 'Sensitivity'
                  type: number
                  format: zto
                - name: sens_ci_lower
                  title: 'Sens CI Lower'
                  type: number
                  format: zto
                  visible: (bootstrapCutoffCI && useBootstrap)
                - name: sens_ci_upper
                  title: 'Sens CI Upper'
                  type: number
                  format: zto
                  visible: (bootstrapCutoffCI && useBootstrap)
                - name: specificity
                  title: 'Specificity'
                  type: number
                  format: zto
                - name: spec_ci_lower
                  title: 'Spec CI Lower'
                  type: number
                  format: zto
                  visible: (bootstrapCutoffCI && useBootstrap)
                - name: spec_ci_upper
                  title: 'Spec CI Upper'
                  type: number
                  format: zto
                  visible: (bootstrapCutoffCI && useBootstrap)
                - name: accuracy
                  title: 'Accuracy'
                  type: number
                  format: zto
                - name: clinical_recommendation
                  title: 'Clinical Recommendation'
                  type: text

          # Detailed Cutoff Analysis
          - name: cutoffAnalysis
            title: Detailed Cutoff Analysis
            type: Table
            description: Comprehensive analysis across multiple cutoff values
            visible: (cutoffTable)
            
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: cutoff
                  title: 'Cutoff'
                  type: number
                  format: zto
                - name: cutoff_type
                  title: 'Cutoff Type'
                  type: text
                - name: sensitivity
                  title: 'Sensitivity'
                  type: number
                  format: zto
                - name: specificity
                  title: 'Specificity'
                  type: number
                  format: zto
                - name: one_minus_specificity
                  title: '1-Specificity'
                  type: number
                  format: zto
                - name: youden_index
                  title: 'Youden Index'
                  type: number
                  format: zto
                - name: true_positive
                  title: 'True Positive'
                  type: integer
                - name: true_negative
                  title: 'True Negative'
                  type: integer
                - name: false_positive
                  title: 'False Positive'
                  type: integer
                - name: false_negative
                  title: 'False Negative'
                  type: integer

          # Diagnostic Performance Metrics
          - name: diagnosticPerformance
            title: Diagnostic Performance Metrics
            type: Table
            description: Comprehensive diagnostic performance measures at optimal cutoff
            visible: (diagnosticMetrics)
            
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: cutoff
                  title: 'Cutoff'
                  type: number
                  format: zto
                - name: sensitivity
                  title: 'Sensitivity'
                  type: number
                  format: zto
                - name: sensitivity_ci
                  title: 'Sensitivity 95% CI'
                  type: text
                - name: specificity
                  title: 'Specificity'
                  type: number
                  format: zto
                - name: specificity_ci
                  title: 'Specificity 95% CI'
                  type: text
                - name: accuracy
                  title: 'Accuracy'
                  type: number
                  format: zto
                - name: balanced_accuracy
                  title: 'Balanced Accuracy'
                  type: number
                  format: zto

          # Clinical Application Metrics
          - name: clinicalApplicationMetrics
            title: Clinical Application Metrics
            type: Table
            description: Clinical metrics including predictive values and likelihood ratios
            visible: (clinicalMetrics)
            
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: prevalence
                  title: 'Prevalence'
                  type: number
                  format: zto
                - name: ppv
                  title: 'PPV'
                  type: number
                  format: zto
                - name: npv
                  title: 'NPV'
                  type: number
                  format: zto
                - name: lr_positive
                  title: 'LR+'
                  type: number
                  format: zto
                - name: lr_negative
                  title: 'LR-'
                  type: number
                  format: zto
                - name: diagnostic_odds_ratio
                  title: 'Diagnostic OR'
                  type: number
                  format: zto
                - name: clinical_interpretation
                  title: 'Clinical Interpretation'
                  type: text

          # Partial AUC Analysis
          - name: partialAucAnalysis
            title: Partial AUC Analysis
            type: Table
            description: Partial AUC analysis for specific sensitivity/specificity ranges
            visible: (partialAuc)

            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: range_type
                  title: 'Range Type'
                  type: text
                - name: range_min
                  title: 'Range Min'
                  type: number
                  format: zto
                - name: range_max
                  title: 'Range Max'
                  type: number
                  format: zto
                - name: partial_auc
                  title: 'Partial AUC'
                  type: number
                  format: zto
                - name: normalized_pauc
                  title: 'Normalized pAUC'
                  type: number
                  format: zto
                - name: clinical_relevance
                  title: 'Clinical Relevance'
                  type: text

          # CROC Analysis
          - name: crocAnalysisTable
            title: CROC (Concentrated ROC) Analysis
            type: Table
            description: Concentrated ROC analysis with early retrieval focus
            visible: (crocAnalysis)

            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: croc_auc
                  title: 'CROC AUC'
                  type: number
                  format: zto
                - name: roc_auc
                  title: 'ROC AUC'
                  type: number
                  format: zto
                - name: alpha
                  title: 'Alpha'
                  type: number
                  format: zto
                - name: early_retrieval_gain
                  title: 'Early Retrieval Gain'
                  type: number
                  format: zto
                - name: interpretation
                  title: 'Interpretation'
                  type: text

          # ROC Convex Hull
          - name: convexHullTable
            title: ROC Convex Hull Analysis
            type: Table
            description: ROC convex hull showing optimal achievable performance
            visible: (convexHull)

            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: hull_auc
                  title: 'Convex Hull AUC'
                  type: number
                  format: zto
                - name: empirical_auc
                  title: 'Empirical AUC'
                  type: number
                  format: zto
                - name: performance_gap
                  title: 'Performance Gap'
                  type: number
                  format: zto
                - name: n_hull_points
                  title: 'Hull Points'
                  type: integer
                - name: interpretation
                  title: 'Interpretation'
                  type: text

          # Comprehensive Analysis Summary
          - name: comprehensiveAnalysisSummary
            title: Comprehensive ROC Analysis Summary
            type: Table
            description: Enhanced statistical summary for comprehensive output
            visible: (comprehensive_output)
            
            columns:
                - name: measure
                  title: 'Measure'
                  type: text
                - name: value
                  title: 'Value'
                  type: text
                - name: interpretation
                  title: 'Interpretation'
                  type: text
                - name: clinical_significance
                  title: 'Clinical Significance'
                  type: text

          # Clinical Interpretation
          - name: clinicalInterpretationGuide
            title: Clinical Application Guidance
            type: Html
            visible: (clinical_interpretation)

          # Statistical Methods
          - name: methodsExplanation
            title: Statistical Methods and References
            type: Html
            visible: (comprehensive_output)

          # ROC Curve Plot
          - name: rocCurvePlot
            title: ROC Curve Analysis
            type: Image
            description: ROC curves with optimal cutoff points
            visible: (rocCurve)
            renderFun: .plotROCCurve
            width: 600
            height: 600

          # Precision-Recall Curve Plot
          - name: prcPlot
            title: Precision-Recall Curve
            type: Image
            description: Precision-Recall curve for imbalanced data
            visible: (detectImbalance)
            renderFun: .plotPRC
            width: 600
            height: 600

          # Comparative ROC Plot
          - name: comparativeROCPlot
            title: Comparative ROC Analysis
            type: Image
            description: Multiple ROC curves for comparison
            visible: (rocCurve && analysisType:comparative)
            renderFun: .plotComparativeROC
            width: 600
            height: 600

          # Cutoff Analysis Plot
          - name: cutoffAnalysisPlot
            title: Cutoff Analysis Plot
            type: Image
            description: Sensitivity and specificity across cutoff values
            visible: (cutoffTable)
            renderFun: .plotCutoffAnalysis
            width: 600
            height: 600

          # Youden Index Plot
          - name: youdenIndexPlot
            title: Youden Index Optimization Plot
            type: Image
            description: Youden Index values across cutoff range
            visible: (youdenOptimization)
            renderFun: .plotYoudenIndex
            width: 600
            height: 600

          # Clinical Decision Plot
          - name: clinicalDecisionPlot
            title: Clinical Decision Analysis Plot
            type: Image
            description: Clinical decision curves and threshold analysis
            visible: (clinicalMetrics)
            renderFun: .plotClinicalDecision
            width: 600
            height: 600

          # CROC Curve Plot
          - name: crocCurvePlot
            title: CROC (Concentrated ROC) Curve
            type: Image
            description: Concentrated ROC curve with exponential magnifier transformation
            visible: (crocAnalysis)
            renderFun: .plotCROC
            width: 600
            height: 600

          # ROC Convex Hull Plot
          - name: convexHullPlot
            title: ROC Convex Hull Plot
            type: Image
            description: ROC curve with convex hull overlay
            visible: (convexHull)
            renderFun: .plotConvexHull
            width: 600
            height: 600

          # Calibration Analysis Results
          - name: calibrationSummary
            title: Calibration Performance Summary
            type: Table
            description: Overall calibration metrics including Brier score
            visible: (calibrationAnalysis)
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: brier_score
                  title: 'Brier Score'
                  type: number
                  format: zto
                - name: scaled_brier
                  title: 'Scaled Brier'
                  type: number
                  format: zto
                - name: calibration_slope
                  title: 'Calibration Slope'
                  type: number
                  format: zto
                  visible: (calibrationMetrics)
                - name: calibration_intercept
                  title: 'Calibration Intercept'
                  type: number
                  format: zto
                  visible: (calibrationMetrics)
                - name: calibration_in_large
                  title: 'Calibration-in-the-Large'
                  type: number
                  format: zto
                  visible: (calibrationMetrics)
                - name: interpretation
                  title: 'Interpretation'
                  type: text

          - name: hosmerLemeshowTable
            title: Hosmer-Lemeshow Goodness-of-Fit Test
            type: Table
            description: Hosmer-Lemeshow test for calibration
            visible: (calibrationAnalysis && hosmerLemeshow)
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: chi_square
                  title: 'Chi-Square'
                  type: number
                  format: zto
                - name: df
                  title: 'df'
                  type: integer
                - name: p_value
                  title: 'p-value'
                  type: number
                  format: zto;pvalue
                - name: n_groups
                  title: 'Groups'
                  type: integer
                - name: conclusion
                  title: 'Conclusion'
                  type: text

          - name: calibrationPlotImage
            title: Calibration Plot
            type: Image
            description: Calibration plot showing observed vs predicted probabilities
            visible: (calibrationAnalysis && calibrationPlot)
            renderFun: .plotCalibration
            width: 600
            height: 600

          # Multi-Class ROC Results
          - name: multiClassAUC
            title: Multi-Class ROC Summary
            type: Table
            description: AUC values for each class in multi-class analysis
            visible: (multiClassROC)
            columns:
                - name: class
                  title: 'Class'
                  type: text
                - name: strategy
                  title: 'Strategy'
                  type: text
                - name: auc
                  title: 'AUC'
                  type: number
                  format: zto
                - name: auc_lower
                  title: 'AUC Lower CI'
                  type: number
                  format: zto
                - name: auc_upper
                  title: 'AUC Upper CI'
                  type: number
                  format: zto
                - name: n_positive
                  title: 'N Positive'
                  type: integer
                - name: n_negative
                  title: 'N Negative'
                  type: integer

          - name: multiClassAverage
            title: Multi-Class Average AUC
            type: Table
            description: Averaged AUC across all classes
            visible: (multiClassROC)
            rows: 1
            columns:
                - name: averaging_method
                  title: 'Averaging Method'
                  type: text
                - name: macro_auc
                  title: 'Macro AUC'
                  type: number
                  format: zto
                - name: weighted_auc
                  title: 'Weighted AUC'
                  type: number
                  format: zto
                - name: micro_auc
                  title: 'Micro AUC'
                  type: number
                  format: zto
                - name: interpretation
                  title: 'Interpretation'
                  type: text

          - name: multiClassROCPlot
            title: Multi-Class ROC Curves
            type: Image
            description: ROC curves for all classes
            visible: (multiClassROC)
            renderFun: .plotMultiClassROC
            width: 600
            height: 600

          # Time-Dependent ROC Results (NOT IMPLEMENTED - COMMENTED OUT)
          # - name: timeDependentAUC
          #   title: Time-Dependent AUC
          #   type: Table
          #   description: AUC values at different time points
          #   visible: (timeDependentROC)
          #   columns:
          #       - name: predictor
          #         title: 'Predictor'
          #         type: text
          #       - name: time_point
          #         title: 'Time Point'
          #         type: number
          #         format: zto
          #       - name: auc
          #         title: 'AUC(t)'
          #         type: number
          #         format: zto
          #       - name: auc_lower
          #         title: 'AUC Lower CI'
          #         type: number
          #         format: zto
          #       - name: auc_upper
          #         title: 'AUC Upper CI'
          #         type: number
          #         format: zto
          #       - name: n_events
          #         title: 'N Events'
          #         type: integer
          #       - name: n_at_risk
          #         title: 'N At Risk'
          #         type: integer
          #
          # - name: timeDependentROCPlot
          #   title: Time-Dependent ROC Curves
          #   type: Image
          #   description: ROC curves at multiple time points
          #   visible: (timeDependentROC)
          #   renderFun: .plotTimeDependentROC
          #   width: 600
          #   height: 600
          #
          # - name: aucTimeCoursePlot
          #   title: AUC Time Course
          #   type: Image
          #   description: AUC evolution over time
          #   visible: (timeDependentROC)
          #   renderFun: .plotAUCTimeCourse
          #   width: 600
          #   height: 600

          # Clinical Impact Results
          - name: clinicalImpactTable
            title: Clinical Impact Metrics
            type: Table
            description: Number needed to test and clinical utility metrics
            visible: (clinicalImpact)
            columns:
                - name: predictor
                  title: 'Predictor'
                  type: text
                - name: threshold
                  title: 'Threshold'
                  type: number
                  format: zto
                - name: nnt
                  title: 'NNT'
                  type: number
                  format: zto
                - name: nnd
                  title: 'NND'
                  type: number
                  format: zto
                - name: tested_positive
                  title: 'Tested Positive (%)'
                  type: number
                  format: pc
                - name: true_positive_rate
                  title: 'True Positive Rate'
                  type: number
                  format: pc
                - name: false_positive_rate
                  title: 'False Positive Rate'
                  type: number
                  format: pc
                - name: net_benefit_per_100
                  title: 'Net Benefit per 100'
                  type: number
                  format: zto

          - name: decisionImpactSummary
            title: Decision Impact at Key Thresholds
            type: Table
            description: Clinical consequences at various decision thresholds
            visible: (clinicalImpact && decisionImpactTable)
            columns:
                - name: threshold
                  title: 'Risk Threshold'
                  type: number
                  format: pc
                - name: n_high_risk
                  title: 'N High Risk'
                  type: integer
                - name: n_high_risk_with_event
                  title: 'N True Positives'
                  type: integer
                - name: n_high_risk_without_event
                  title: 'N False Positives'
                  type: integer
                - name: ppv
                  title: 'PPV'
                  type: number
                  format: pc
                - name: npv
                  title: 'NPV'
                  type: number
                  format: pc

          - name: clinicalUtilityPlot
            title: Clinical Utility Curve
            type: Image
            description: Clinical utility showing test consequences across thresholds
            visible: (clinicalImpact && clinicalUtilityCurve)
            renderFun: .plotClinicalUtility
            width: 600
            height: 600

refs:
    - ClinicoPathJamoviModule
    - Swamidass2010
    - pROC

...
