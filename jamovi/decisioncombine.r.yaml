---
name: decisioncombine
title: Combine Medical Decision Tests
jrs: '1.1'

items:
    - name: goldStandardFreqTable
      title: Gold Standard Frequencies
      type: Table
      visible: (od)
      rows: 0
      columns:
        - name: level
          title: 'Level'
          type: text
        - name: frequency
          title: 'Frequency'
          type: number
        - name: percentage
          title: 'Percentage'
          type: number
          format: percent
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    - name: crossTabTable
      title: Cross-tabulation Tables
      type: Table
      visible: (od)
      rows: 0
      columns:
        - name: test_var
          title: 'Test Variable'
          type: text
        - name: test_level
          title: 'Test Level'
          type: text
        - name: gold_positive
          title: 'Gold Standard Positive'
          type: number
        - name: gold_negative
          title: 'Gold Standard Negative'
          type: number
        - name: total
          title: 'Total'
          type: number
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    # Individual test tables
    - name: indTable1
      title: 'Test 1 Results'
      type: Table
      visible: (showIndividual && !is.null(test1))
      rows: 0
      columns:
        - name: newtest
          title: ''
          type: text
        - name: GP
          title: 'Gold Positive'
          type: number
        - name: GN
          title: 'Gold Negative'
          type: number
        - name: Total
          title: 'Total'
          type: number
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    - name: indTable2
      title: 'Test 2 Results'
      type: Table
      visible: (showIndividual && !is.null(test2))
      rows: 0
      columns:
        - name: newtest
          title: ''
          type: text
        - name: GP
          title: 'Gold Positive'
          type: number
        - name: GN
          title: 'Gold Negative'
          type: number
        - name: Total
          title: 'Total'
          type: number
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    - name: indTable3
      title: 'Test 3 Results'
      type: Table
      visible: (showIndividual && !is.null(test3))
      rows: 0
      columns:
        - name: newtest
          title: ''
          type: text
        - name: GP
          title: 'Gold Positive'
          type: number
        - name: GN
          title: 'Gold Negative'
          type: number
        - name: Total
          title: 'Total'
          type: number
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    - name: combinationsAnalysis
      title: 'Test Combination Patterns Analysis'
      type: Html
      visible: true
      description: 'Comprehensive analysis of all possible test combinations'
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    # Combination statistics tables
    - name: combStatsTable
      title: 'Combination Diagnostic Statistics'
      type: Table
      visible: true
      rows: 0
      columns:
        - name: combination
          title: 'Pattern'
          type: text
        - name: sens
          title: 'Sensitivity'
          type: number
          format: pc
        - name: spec  
          title: 'Specificity'
          type: number
          format: pc
        - name: ppv
          title: 'PPV'
          type: number
          format: pc
        - name: npv
          title: 'NPV'
          type: number
          format: pc
        - name: acc
          title: 'Accuracy'
          type: number
          format: pc
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive
      description: 'Primary diagnostic performance metrics for each test combination pattern. Wilson score confidence intervals used for enhanced accuracy with small samples.'

    - name: combStatsTableCI
      title: 'Combination Diagnostic Statistics with 95% Confidence Intervals'
      type: Table
      visible: true
      rows: 0  
      columns:
        - name: combination
          title: 'Pattern'
          type: text
        - name: statistic
          title: 'Statistic'
          type: text
        - name: estimate
          title: 'Estimate'
          type: number
          format: pc
        - name: lower
          title: 'Lower'
          superTitle: '95% Wilson CI'
          type: number
          format: pc
        - name: upper
          title: 'Upper'
          superTitle: '95% Wilson CI'
          type: number
          format: pc
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive
      description: 'Detailed confidence intervals using Wilson score method, which provides more accurate bounds for diagnostic proportions than normal approximation, especially for small samples or extreme values.'

    - name: addCombinationPattern
      title: 'Test Combination Patterns'
      type: Output
      varTitle: TestCombination
      varDescription: 'Test combination pattern exported to dataset (e.g., +/+ = both positive, +/- = test1 pos/test2 neg, -/+ = test1 neg/test2 pos, -/- = both negative). Enables further analysis of pattern-specific outcomes.'
      measureType: nominal
      clearWith:
        - test1
        - test2
        - test3
        - test1Positive
        - test2Positive
        - test3Positive

    # Visualization outputs
    - name: performanceHeatmap
      title: 'Diagnostic Performance Heatmap'
      type: Image
      width: 800
      height: 600
      visible: (showVisualization && (plotType == 'heatmap' || plotType == 'all'))
      renderFun: .plotPerformanceHeatmap
      clearWith:
        - test1
        - test2
        - test3
        - colorScheme
        - plotWidth
        - plotHeight
      description: 'Publication-quality heatmap showing comprehensive diagnostic performance metrics across all test combination patterns with clinical color coding.'


    - name: decisionTree
      title: 'Decision Tree Visualization'
      type: Image
      width: 800
      height: 600
      visible: (showVisualization && (plotType == 'tree' || plotType == 'all'))
      renderFun: .plotDecisionTree
      clearWith:
        - test1
        - test2
        - test3
        - plotWidth
        - plotHeight

    - name: vennDiagram
      title: 'Test Agreement Venn Diagram'
      type: Image
      width: 800
      height: 600
      visible: (showVisualization && (plotType == 'venn' || plotType == 'all'))
      renderFun: .plotVennDiagram
      clearWith:
        - test1
        - test2
        - test3
        - plotWidth
        - plotHeight

    - name: forestPlot
      title: 'Forest Plot with Wilson Confidence Intervals'
      type: Image
      width: 800
      height: 600
      visible: (showVisualization && (plotType == 'forest' || plotType == 'all'))
      renderFun: .plotForest
      clearWith:
        - test1
        - test2
        - test3
        - plotWidth
        - plotHeight
      description: 'Comprehensive forest plot displaying all diagnostic metrics with Wilson score confidence intervals, providing more accurate uncertainty estimates than normal approximation methods.'


refs:
    - DiagnosticTests
    - ClinicoPathJamoviModule

...
