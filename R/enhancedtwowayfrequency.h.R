
# This file is automatically generated, you probably don't want to edit this

enhancedtwowayfrequencyOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtwowayfrequencyOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            rowVar = NULL,
            colVar = NULL,
            cellPercent = TRUE,
            rowPercent = FALSE,
            colPercent = FALSE,
            showCounts = TRUE,
            showTotals = TRUE,
            chiSquareTest = TRUE,
            fisherTest = FALSE,
            continuityCorrection = TRUE,
            associationMeasures = TRUE,
            residualAnalysis = FALSE,
            expectedFrequencies = FALSE,
            minimumExpected = 5,
            robustErrorHandling = TRUE,
            showDiagnostics = FALSE,
            detailedOutput = FALSE,
            clinicalInterpretation = TRUE,
            showRecommendations = FALSE,
            bluesky_integration = TRUE,
            comprehensive_output = FALSE,
            heatmapPlot = FALSE,
            mosaicPlot = FALSE,
            percentageDisplay = "percentage", ...) {

            super$initialize(
                package="ClinicoPath",
                name="enhancedtwowayfrequency",
                requiresData=TRUE,
                ...)

            private$..rowVar <- jmvcore::OptionVariable$new(
                "rowVar",
                rowVar,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..colVar <- jmvcore::OptionVariable$new(
                "colVar",
                colVar,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..cellPercent <- jmvcore::OptionBool$new(
                "cellPercent",
                cellPercent,
                default=TRUE)
            private$..rowPercent <- jmvcore::OptionBool$new(
                "rowPercent",
                rowPercent,
                default=FALSE)
            private$..colPercent <- jmvcore::OptionBool$new(
                "colPercent",
                colPercent,
                default=FALSE)
            private$..showCounts <- jmvcore::OptionBool$new(
                "showCounts",
                showCounts,
                default=TRUE)
            private$..showTotals <- jmvcore::OptionBool$new(
                "showTotals",
                showTotals,
                default=TRUE)
            private$..chiSquareTest <- jmvcore::OptionBool$new(
                "chiSquareTest",
                chiSquareTest,
                default=TRUE)
            private$..fisherTest <- jmvcore::OptionBool$new(
                "fisherTest",
                fisherTest,
                default=FALSE)
            private$..continuityCorrection <- jmvcore::OptionBool$new(
                "continuityCorrection",
                continuityCorrection,
                default=TRUE)
            private$..associationMeasures <- jmvcore::OptionBool$new(
                "associationMeasures",
                associationMeasures,
                default=TRUE)
            private$..residualAnalysis <- jmvcore::OptionBool$new(
                "residualAnalysis",
                residualAnalysis,
                default=FALSE)
            private$..expectedFrequencies <- jmvcore::OptionBool$new(
                "expectedFrequencies",
                expectedFrequencies,
                default=FALSE)
            private$..minimumExpected <- jmvcore::OptionNumber$new(
                "minimumExpected",
                minimumExpected,
                min=1,
                max=10,
                default=5)
            private$..robustErrorHandling <- jmvcore::OptionBool$new(
                "robustErrorHandling",
                robustErrorHandling,
                default=TRUE)
            private$..showDiagnostics <- jmvcore::OptionBool$new(
                "showDiagnostics",
                showDiagnostics,
                default=FALSE)
            private$..detailedOutput <- jmvcore::OptionBool$new(
                "detailedOutput",
                detailedOutput,
                default=FALSE)
            private$..clinicalInterpretation <- jmvcore::OptionBool$new(
                "clinicalInterpretation",
                clinicalInterpretation,
                default=TRUE)
            private$..showRecommendations <- jmvcore::OptionBool$new(
                "showRecommendations",
                showRecommendations,
                default=FALSE)
            private$..bluesky_integration <- jmvcore::OptionBool$new(
                "bluesky_integration",
                bluesky_integration,
                default=TRUE)
            private$..comprehensive_output <- jmvcore::OptionBool$new(
                "comprehensive_output",
                comprehensive_output,
                default=FALSE)
            private$..heatmapPlot <- jmvcore::OptionBool$new(
                "heatmapPlot",
                heatmapPlot,
                default=FALSE)
            private$..mosaicPlot <- jmvcore::OptionBool$new(
                "mosaicPlot",
                mosaicPlot,
                default=FALSE)
            private$..percentageDisplay <- jmvcore::OptionList$new(
                "percentageDisplay",
                percentageDisplay,
                options=list(
                    "decimal",
                    "percentage"),
                default="percentage")

            self$.addOption(private$..rowVar)
            self$.addOption(private$..colVar)
            self$.addOption(private$..cellPercent)
            self$.addOption(private$..rowPercent)
            self$.addOption(private$..colPercent)
            self$.addOption(private$..showCounts)
            self$.addOption(private$..showTotals)
            self$.addOption(private$..chiSquareTest)
            self$.addOption(private$..fisherTest)
            self$.addOption(private$..continuityCorrection)
            self$.addOption(private$..associationMeasures)
            self$.addOption(private$..residualAnalysis)
            self$.addOption(private$..expectedFrequencies)
            self$.addOption(private$..minimumExpected)
            self$.addOption(private$..robustErrorHandling)
            self$.addOption(private$..showDiagnostics)
            self$.addOption(private$..detailedOutput)
            self$.addOption(private$..clinicalInterpretation)
            self$.addOption(private$..showRecommendations)
            self$.addOption(private$..bluesky_integration)
            self$.addOption(private$..comprehensive_output)
            self$.addOption(private$..heatmapPlot)
            self$.addOption(private$..mosaicPlot)
            self$.addOption(private$..percentageDisplay)
        }),
    active = list(
        rowVar = function() private$..rowVar$value,
        colVar = function() private$..colVar$value,
        cellPercent = function() private$..cellPercent$value,
        rowPercent = function() private$..rowPercent$value,
        colPercent = function() private$..colPercent$value,
        showCounts = function() private$..showCounts$value,
        showTotals = function() private$..showTotals$value,
        chiSquareTest = function() private$..chiSquareTest$value,
        fisherTest = function() private$..fisherTest$value,
        continuityCorrection = function() private$..continuityCorrection$value,
        associationMeasures = function() private$..associationMeasures$value,
        residualAnalysis = function() private$..residualAnalysis$value,
        expectedFrequencies = function() private$..expectedFrequencies$value,
        minimumExpected = function() private$..minimumExpected$value,
        robustErrorHandling = function() private$..robustErrorHandling$value,
        showDiagnostics = function() private$..showDiagnostics$value,
        detailedOutput = function() private$..detailedOutput$value,
        clinicalInterpretation = function() private$..clinicalInterpretation$value,
        showRecommendations = function() private$..showRecommendations$value,
        bluesky_integration = function() private$..bluesky_integration$value,
        comprehensive_output = function() private$..comprehensive_output$value,
        heatmapPlot = function() private$..heatmapPlot$value,
        mosaicPlot = function() private$..mosaicPlot$value,
        percentageDisplay = function() private$..percentageDisplay$value),
    private = list(
        ..rowVar = NA,
        ..colVar = NA,
        ..cellPercent = NA,
        ..rowPercent = NA,
        ..colPercent = NA,
        ..showCounts = NA,
        ..showTotals = NA,
        ..chiSquareTest = NA,
        ..fisherTest = NA,
        ..continuityCorrection = NA,
        ..associationMeasures = NA,
        ..residualAnalysis = NA,
        ..expectedFrequencies = NA,
        ..minimumExpected = NA,
        ..robustErrorHandling = NA,
        ..showDiagnostics = NA,
        ..detailedOutput = NA,
        ..clinicalInterpretation = NA,
        ..showRecommendations = NA,
        ..bluesky_integration = NA,
        ..comprehensive_output = NA,
        ..heatmapPlot = NA,
        ..mosaicPlot = NA,
        ..percentageDisplay = NA)
)

enhancedtwowayfrequencyResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtwowayfrequencyResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        observedFrequencies = function() private$.items[["observedFrequencies"]],
        crossTabMatrix = function() private$.items[["crossTabMatrix"]],
        cellPercentMatrix = function() private$.items[["cellPercentMatrix"]],
        rowPercentMatrix = function() private$.items[["rowPercentMatrix"]],
        colPercentMatrix = function() private$.items[["colPercentMatrix"]],
        testResults = function() private$.items[["testResults"]],
        associationMeasuresTable = function() private$.items[["associationMeasuresTable"]],
        assumptionCheck = function() private$.items[["assumptionCheck"]],
        diagnostics = function() private$.items[["diagnostics"]],
        comprehensiveAnalysisSummary = function() private$.items[["comprehensiveAnalysisSummary"]],
        recommendations = function() private$.items[["recommendations"]],
        clinicalInterpretationGuide = function() private$.items[["clinicalInterpretationGuide"]],
        methodsExplanation = function() private$.items[["methodsExplanation"]],
        heatmapPlot = function() private$.items[["heatmapPlot"]],
        mosaicPlot = function() private$.items[["mosaicPlot"]],
        residualPlot = function() private$.items[["residualPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Two-Way Frequency Analysis Results")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="observedFrequencies",
                title="Observed Frequencies",
                visible="(rowVar && colVar && showCounts)",
                columns=list(
                    list(
                        `name`="rowVar_level", 
                        `title`="Row Variable", 
                        `type`="text"),
                    list(
                        `name`="colVar_level", 
                        `title`="Column Variable", 
                        `type`="text"),
                    list(
                        `name`="count", 
                        `title`="Count", 
                        `type`="integer"),
                    list(
                        `name`="cell_percent", 
                        `title`="Cell %", 
                        `type`="number", 
                        `format`="pc", 
                        `visible`="(cellPercent)"),
                    list(
                        `name`="row_percent", 
                        `title`="Row %", 
                        `type`="number", 
                        `format`="pc", 
                        `visible`="(rowPercent)"),
                    list(
                        `name`="col_percent", 
                        `title`="Col %", 
                        `type`="number", 
                        `format`="pc", 
                        `visible`="(colPercent)"),
                    list(
                        `name`="expected", 
                        `title`="Expected", 
                        `type`="number", 
                        `format`="zto", 
                        `visible`="(expectedFrequencies)"),
                    list(
                        `name`="std_residual", 
                        `title`="Std. Residual", 
                        `type`="number", 
                        `format`="zto", 
                        `visible`="(residualAnalysis)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="crossTabMatrix",
                title="Cross-Tabulation Matrix",
                visible="(rowVar && colVar)",
                columns=list(
                    list(
                        `name`="row_category", 
                        `title`="", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="cellPercentMatrix",
                title="Cell Percentage Matrix",
                visible="(rowVar && colVar && cellPercent)",
                columns=list(
                    list(
                        `name`="row_category", 
                        `title`="", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="rowPercentMatrix",
                title="Row Percentage Matrix",
                visible="(rowVar && colVar && rowPercent)",
                columns=list(
                    list(
                        `name`="row_category", 
                        `title`="", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="colPercentMatrix",
                title="Column Percentage Matrix",
                visible="(rowVar && colVar && colPercent)",
                columns=list(
                    list(
                        `name`="row_category", 
                        `title`="", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="testResults",
                title="Tests of Independence",
                visible="(rowVar && colVar && (chiSquareTest || fisherTest))",
                columns=list(
                    list(
                        `name`="test_name", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"),
                    list(
                        `name`="effect_size", 
                        `title`="Effect Size", 
                        `type`="text", 
                        `visible`="(associationMeasures)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="associationMeasuresTable",
                title="Measures of Association",
                visible="(rowVar && colVar && associationMeasures)",
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="confidence_interval", 
                        `title`="95% CI", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="assumptionCheck",
                title="Assumption Validation",
                visible="(rowVar && colVar && (showDiagnostics || expectedFrequencies))",
                columns=list(
                    list(
                        `name`="assumption", 
                        `title`="Assumption", 
                        `type`="text"),
                    list(
                        `name`="status", 
                        `title`="Status", 
                        `type`="text"),
                    list(
                        `name`="details", 
                        `title`="Details", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="diagnostics",
                title="Diagnostic Information",
                visible="(showDiagnostics)",
                columns=list(
                    list(
                        `name`="diagnostic_item", 
                        `title`="Diagnostic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"),
                    list(
                        `name`="quality_flag", 
                        `title`="Quality Flag", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="comprehensiveAnalysisSummary",
                title="Comprehensive Two-Way Analysis Summary",
                visible="(bluesky_integration && comprehensive_output)",
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="recommendations",
                title="Statistical Recommendations",
                visible="(showRecommendations)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretationGuide",
                title="Clinical Application Guidance",
                visible="(clinicalInterpretation)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodsExplanation",
                title="Statistical Methods and References",
                visible="(detailedOutput)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="heatmapPlot",
                title="Frequency Heatmap",
                visible="(heatmapPlot)",
                width=500,
                height=400,
                renderFun=".plotHeatmap"))
            self$add(jmvcore::Image$new(
                options=options,
                name="mosaicPlot",
                title="Mosaic Plot",
                visible="(mosaicPlot)",
                width=600,
                height=400,
                renderFun=".plotMosaic"))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualPlot",
                title="Standardized Residuals Plot",
                visible="(residualAnalysis && detailedOutput)",
                width=500,
                height=400,
                renderFun=".plotResiduals"))}))

enhancedtwowayfrequencyBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtwowayfrequencyBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "enhancedtwowayfrequency",
                version = c(0,0,31),
                options = options,
                results = enhancedtwowayfrequencyResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Two-Way Frequency Analysis with BlueSky Integration
#'
#' Enhanced two-way frequency analysis toolkit with BlueSky integration for
#' comprehensive cross-tabulation analysis. Includes cell, row, and column 
#' percentages, statistical tests for association, robust error handling,
#' and clinical interpretation guidance. Perfect for exploring relationships 
#' between categorical variables in clinicopathological research.
#' 
#' @param data .
#' @param rowVar .
#' @param colVar .
#' @param cellPercent Display percentages of total sample (BlueSky
#'   BSkyTwoWayFrequency feature)
#' @param rowPercent Display row-wise percentages (sum to 100\% across rows)
#' @param colPercent Display column-wise percentages (sum to 100\% across
#'   columns)
#' @param showCounts Display raw frequency counts in cross-tabulation
#' @param showTotals Include row and column totals in tables
#' @param chiSquareTest Perform Pearson's chi-square test for association
#' @param fisherTest Perform Fisher's exact test (recommended for small
#'   samples)
#' @param continuityCorrection Apply continuity correction for 2x2 tables
#' @param associationMeasures Calculate Cramér's V, Phi coefficient, and other
#'   association measures
#' @param residualAnalysis Calculate and display standardized residuals for
#'   detecting patterns
#' @param expectedFrequencies Display expected frequencies under independence
#'   assumption
#' @param minimumExpected Threshold for warning about low expected frequencies
#' @param robustErrorHandling Use BlueSky-style error handling with graceful
#'   degradation
#' @param showDiagnostics Display diagnostic information about computations
#'   and assumptions
#' @param detailedOutput Include comprehensive statistical details and
#'   interpretations
#' @param clinicalInterpretation Provide clinical context and interpretation
#'   guidance
#' @param showRecommendations Provide recommendations based on analysis
#'   results
#' @param bluesky_integration Use BlueSky R statistical environment features
#' @param comprehensive_output Include comprehensive statistical details and
#'   diagnostics
#' @param heatmapPlot Create heatmap visualization of frequency table
#' @param mosaicPlot Create mosaic plot showing proportional relationships
#' @param percentageDisplay Format for displaying percentage values
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$observedFrequencies} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crossTabMatrix} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$cellPercentMatrix} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$rowPercentMatrix} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$colPercentMatrix} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$testResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$associationMeasuresTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$assumptionCheck} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$diagnostics} \tab \tab \tab \tab \tab Computational diagnostics and data quality assessment \cr
#'   \code{results$comprehensiveAnalysisSummary} \tab \tab \tab \tab \tab Enhanced statistical summary with BlueSky integration \cr
#'   \code{results$recommendations} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinicalInterpretationGuide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodsExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$heatmapPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$mosaicPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$observedFrequencies$asDF}
#'
#' \code{as.data.frame(results$observedFrequencies)}
#'
#' @export
enhancedtwowayfrequency <- function(
    data,
    rowVar,
    colVar,
    cellPercent = TRUE,
    rowPercent = FALSE,
    colPercent = FALSE,
    showCounts = TRUE,
    showTotals = TRUE,
    chiSquareTest = TRUE,
    fisherTest = FALSE,
    continuityCorrection = TRUE,
    associationMeasures = TRUE,
    residualAnalysis = FALSE,
    expectedFrequencies = FALSE,
    minimumExpected = 5,
    robustErrorHandling = TRUE,
    showDiagnostics = FALSE,
    detailedOutput = FALSE,
    clinicalInterpretation = TRUE,
    showRecommendations = FALSE,
    bluesky_integration = TRUE,
    comprehensive_output = FALSE,
    heatmapPlot = FALSE,
    mosaicPlot = FALSE,
    percentageDisplay = "percentage") {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("enhancedtwowayfrequency requires jmvcore to be installed (restart may be required)")

    if ( ! missing(rowVar)) rowVar <- jmvcore::resolveQuo(jmvcore::enquo(rowVar))
    if ( ! missing(colVar)) colVar <- jmvcore::resolveQuo(jmvcore::enquo(colVar))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(rowVar), rowVar, NULL),
            `if`( ! missing(colVar), colVar, NULL))


    options <- enhancedtwowayfrequencyOptions$new(
        rowVar = rowVar,
        colVar = colVar,
        cellPercent = cellPercent,
        rowPercent = rowPercent,
        colPercent = colPercent,
        showCounts = showCounts,
        showTotals = showTotals,
        chiSquareTest = chiSquareTest,
        fisherTest = fisherTest,
        continuityCorrection = continuityCorrection,
        associationMeasures = associationMeasures,
        residualAnalysis = residualAnalysis,
        expectedFrequencies = expectedFrequencies,
        minimumExpected = minimumExpected,
        robustErrorHandling = robustErrorHandling,
        showDiagnostics = showDiagnostics,
        detailedOutput = detailedOutput,
        clinicalInterpretation = clinicalInterpretation,
        showRecommendations = showRecommendations,
        bluesky_integration = bluesky_integration,
        comprehensive_output = comprehensive_output,
        heatmapPlot = heatmapPlot,
        mosaicPlot = mosaicPlot,
        percentageDisplay = percentageDisplay)

    analysis <- enhancedtwowayfrequencyClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

