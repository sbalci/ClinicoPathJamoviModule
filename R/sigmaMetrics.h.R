
# This file is automatically generated, you probably don't want to edit this

sigmametricsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sigmametricsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            bias = NULL,
            cv = NULL,
            tea = NULL,
            analyte = NULL,
            laboratory = NULL,
            method = NULL,
            sigma_calculation = "standard",
            quality_goals = "clia",
            custom_tea = 10,
            confidence_level = 0.95,
            benchmark_comparison = TRUE,
            process_capability = TRUE,
            quality_goal_index = TRUE,
            method_validation = TRUE,
            improvement_recommendations = TRUE,
            regulatory_compliance = TRUE,
            cost_of_quality = FALSE,
            defect_rates = TRUE,
            control_planning = FALSE,
            sigma_plots = TRUE,
            normalized_plots = TRUE,
            quality_scorecard = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="sigmametrics",
                requiresData=TRUE,
                ...)

            private$..bias <- jmvcore::OptionVariable$new(
                "bias",
                bias,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..cv <- jmvcore::OptionVariable$new(
                "cv",
                cv,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..tea <- jmvcore::OptionVariable$new(
                "tea",
                tea,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..analyte <- jmvcore::OptionVariable$new(
                "analyte",
                analyte,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..laboratory <- jmvcore::OptionVariable$new(
                "laboratory",
                laboratory,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..method <- jmvcore::OptionVariable$new(
                "method",
                method,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..sigma_calculation <- jmvcore::OptionList$new(
                "sigma_calculation",
                sigma_calculation,
                options=list(
                    "standard",
                    "westgard",
                    "clinical_goals",
                    "biological_variation"),
                default="standard")
            private$..quality_goals <- jmvcore::OptionList$new(
                "quality_goals",
                quality_goals,
                options=list(
                    "clia",
                    "rcpaqap",
                    "biological_variation",
                    "custom",
                    "proficiency_testing"),
                default="clia")
            private$..custom_tea <- jmvcore::OptionNumber$new(
                "custom_tea",
                custom_tea,
                min=0.1,
                max=50,
                default=10)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.9,
                max=0.99,
                default=0.95)
            private$..benchmark_comparison <- jmvcore::OptionBool$new(
                "benchmark_comparison",
                benchmark_comparison,
                default=TRUE)
            private$..process_capability <- jmvcore::OptionBool$new(
                "process_capability",
                process_capability,
                default=TRUE)
            private$..quality_goal_index <- jmvcore::OptionBool$new(
                "quality_goal_index",
                quality_goal_index,
                default=TRUE)
            private$..method_validation <- jmvcore::OptionBool$new(
                "method_validation",
                method_validation,
                default=TRUE)
            private$..improvement_recommendations <- jmvcore::OptionBool$new(
                "improvement_recommendations",
                improvement_recommendations,
                default=TRUE)
            private$..regulatory_compliance <- jmvcore::OptionBool$new(
                "regulatory_compliance",
                regulatory_compliance,
                default=TRUE)
            private$..cost_of_quality <- jmvcore::OptionBool$new(
                "cost_of_quality",
                cost_of_quality,
                default=FALSE)
            private$..defect_rates <- jmvcore::OptionBool$new(
                "defect_rates",
                defect_rates,
                default=TRUE)
            private$..control_planning <- jmvcore::OptionBool$new(
                "control_planning",
                control_planning,
                default=FALSE)
            private$..sigma_plots <- jmvcore::OptionBool$new(
                "sigma_plots",
                sigma_plots,
                default=TRUE)
            private$..normalized_plots <- jmvcore::OptionBool$new(
                "normalized_plots",
                normalized_plots,
                default=TRUE)
            private$..quality_scorecard <- jmvcore::OptionBool$new(
                "quality_scorecard",
                quality_scorecard,
                default=TRUE)

            self$.addOption(private$..bias)
            self$.addOption(private$..cv)
            self$.addOption(private$..tea)
            self$.addOption(private$..analyte)
            self$.addOption(private$..laboratory)
            self$.addOption(private$..method)
            self$.addOption(private$..sigma_calculation)
            self$.addOption(private$..quality_goals)
            self$.addOption(private$..custom_tea)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..benchmark_comparison)
            self$.addOption(private$..process_capability)
            self$.addOption(private$..quality_goal_index)
            self$.addOption(private$..method_validation)
            self$.addOption(private$..improvement_recommendations)
            self$.addOption(private$..regulatory_compliance)
            self$.addOption(private$..cost_of_quality)
            self$.addOption(private$..defect_rates)
            self$.addOption(private$..control_planning)
            self$.addOption(private$..sigma_plots)
            self$.addOption(private$..normalized_plots)
            self$.addOption(private$..quality_scorecard)
        }),
    active = list(
        bias = function() private$..bias$value,
        cv = function() private$..cv$value,
        tea = function() private$..tea$value,
        analyte = function() private$..analyte$value,
        laboratory = function() private$..laboratory$value,
        method = function() private$..method$value,
        sigma_calculation = function() private$..sigma_calculation$value,
        quality_goals = function() private$..quality_goals$value,
        custom_tea = function() private$..custom_tea$value,
        confidence_level = function() private$..confidence_level$value,
        benchmark_comparison = function() private$..benchmark_comparison$value,
        process_capability = function() private$..process_capability$value,
        quality_goal_index = function() private$..quality_goal_index$value,
        method_validation = function() private$..method_validation$value,
        improvement_recommendations = function() private$..improvement_recommendations$value,
        regulatory_compliance = function() private$..regulatory_compliance$value,
        cost_of_quality = function() private$..cost_of_quality$value,
        defect_rates = function() private$..defect_rates$value,
        control_planning = function() private$..control_planning$value,
        sigma_plots = function() private$..sigma_plots$value,
        normalized_plots = function() private$..normalized_plots$value,
        quality_scorecard = function() private$..quality_scorecard$value),
    private = list(
        ..bias = NA,
        ..cv = NA,
        ..tea = NA,
        ..analyte = NA,
        ..laboratory = NA,
        ..method = NA,
        ..sigma_calculation = NA,
        ..quality_goals = NA,
        ..custom_tea = NA,
        ..confidence_level = NA,
        ..benchmark_comparison = NA,
        ..process_capability = NA,
        ..quality_goal_index = NA,
        ..method_validation = NA,
        ..improvement_recommendations = NA,
        ..regulatory_compliance = NA,
        ..cost_of_quality = NA,
        ..defect_rates = NA,
        ..control_planning = NA,
        ..sigma_plots = NA,
        ..normalized_plots = NA,
        ..quality_scorecard = NA)
)

sigmametricsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sigmametricsResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        dataInfo = function() private$.items[["dataInfo"]],
        sigmaResults = function() private$.items[["sigmaResults"]],
        processCapability = function() private$.items[["processCapability"]],
        qualityGoalIndex = function() private$.items[["qualityGoalIndex"]],
        benchmarkComparison = function() private$.items[["benchmarkComparison"]],
        methodValidation = function() private$.items[["methodValidation"]],
        regulatoryCompliance = function() private$.items[["regulatoryCompliance"]],
        improvementRecommendations = function() private$.items[["improvementRecommendations"]],
        defectRateAnalysis = function() private$.items[["defectRateAnalysis"]],
        costOfQuality = function() private$.items[["costOfQuality"]],
        controlPlanning = function() private$.items[["controlPlanning"]],
        sigmaPlot = function() private$.items[["sigmaPlot"]],
        normalizedChart = function() private$.items[["normalizedChart"]],
        qualityScorecard = function() private$.items[["qualityScorecard"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Six Sigma Metrics for Laboratory Performance")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="dataInfo",
                title="Data Summary",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "bias",
                    "cv",
                    "tea"),
                columns=list(
                    list(
                        `name`="characteristic", 
                        `title`="Characteristic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sigmaResults",
                title="Sigma Metrics Results",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "bias",
                    "cv",
                    "tea",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="analyte", 
                        `title`="Analyte/Test", 
                        `type`="text"),
                    list(
                        `name`="sigma_value", 
                        `title`="Sigma Value", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="sigma_level", 
                        `title`="Sigma Level", 
                        `type`="text"),
                    list(
                        `name`="quality_rating", 
                        `title`="Quality Rating", 
                        `type`="text"),
                    list(
                        `name`="defect_rate_ppm", 
                        `title`="Defect Rate (ppm)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="yield_percentage", 
                        `title`="Process Yield (%)", 
                        `type`="number", 
                        `format`="zto:2"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="processCapability",
                title="Process Capability Analysis",
                visible="(process_capability)",
                rows=1,
                clearWith=list(
                    "process_capability",
                    "bias",
                    "cv"),
                columns=list(
                    list(
                        `name`="analyte", 
                        `title`="Analyte/Test", 
                        `type`="text"),
                    list(
                        `name`="cp", 
                        `title`="Cp", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="cpk", 
                        `title`="Cpk", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="cpp", 
                        `title`="Cpp", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="capability_status", 
                        `title`="Capability Status", 
                        `type`="text"),
                    list(
                        `name`="process_shift", 
                        `title`="Process Shift", 
                        `type`="number", 
                        `format`="zto:3"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="qualityGoalIndex",
                title="Quality Goal Index (QGI) Analysis",
                visible="(quality_goal_index)",
                rows=1,
                clearWith=list(
                    "quality_goal_index",
                    "bias",
                    "cv",
                    "tea"),
                columns=list(
                    list(
                        `name`="analyte", 
                        `title`="Analyte/Test", 
                        `type`="text"),
                    list(
                        `name`="bias_qgi", 
                        `title`="Bias QGI", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="precision_qgi", 
                        `title`="Precision QGI", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="total_qgi", 
                        `title`="Total QGI", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="qgi_interpretation", 
                        `title`="QGI Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="benchmarkComparison",
                title="Benchmark Comparison",
                visible="(benchmark_comparison)",
                rows=1,
                clearWith=list(
                    "benchmark_comparison",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="sigma_level", 
                        `title`="Sigma Level", 
                        `type`="text"),
                    list(
                        `name`="defect_rate", 
                        `title`="Defect Rate (ppm)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="process_yield", 
                        `title`="Process Yield (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="performance_class", 
                        `title`="Performance Class", 
                        `type`="text"),
                    list(
                        `name`="your_performance", 
                        `title`="Your Performance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="methodValidation",
                title="Method Validation Assessment",
                visible="(method_validation)",
                rows=1,
                clearWith=list(
                    "method_validation",
                    "bias",
                    "cv"),
                columns=list(
                    list(
                        `name`="validation_criterion", 
                        `title`="Validation Criterion", 
                        `type`="text"),
                    list(
                        `name`="observed_value", 
                        `title`="Observed Value", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="acceptance_limit", 
                        `title`="Acceptance Limit", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="status", 
                        `title`="Status", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="regulatoryCompliance",
                title="Regulatory Compliance Assessment",
                visible="(regulatory_compliance)",
                rows=1,
                clearWith=list(
                    "regulatory_compliance",
                    "quality_goals"),
                columns=list(
                    list(
                        `name`="regulatory_body", 
                        `title`="Regulatory Body", 
                        `type`="text"),
                    list(
                        `name`="requirement", 
                        `title`="Requirement", 
                        `type`="text"),
                    list(
                        `name`="your_result", 
                        `title`="Your Result", 
                        `type`="text"),
                    list(
                        `name`="compliance_status", 
                        `title`="Compliance Status", 
                        `type`="text"),
                    list(
                        `name`="action_needed", 
                        `title`="Action Needed", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="improvementRecommendations",
                title="Quality Improvement Recommendations",
                visible="(improvement_recommendations)",
                rows=1,
                clearWith=list(
                    "improvement_recommendations",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="issue_area", 
                        `title`="Issue Area", 
                        `type`="text"),
                    list(
                        `name`="current_performance", 
                        `title`="Current Performance", 
                        `type`="text"),
                    list(
                        `name`="target_performance", 
                        `title`="Target Performance", 
                        `type`="text"),
                    list(
                        `name`="recommended_action", 
                        `title`="Recommended Action", 
                        `type`="text"),
                    list(
                        `name`="expected_improvement", 
                        `title`="Expected Improvement", 
                        `type`="text"),
                    list(
                        `name`="priority", 
                        `title`="Priority", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="defectRateAnalysis",
                title="Defect Rate Analysis",
                visible="(defect_rates)",
                rows=1,
                clearWith=list(
                    "defect_rates",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="error_type", 
                        `title`="Error Type", 
                        `type`="text"),
                    list(
                        `name`="current_rate_ppm", 
                        `title`="Current Rate (ppm)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="target_rate_ppm", 
                        `title`="Target Rate (ppm)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="monthly_volume", 
                        `title`="Expected Monthly Errors", 
                        `type`="integer"),
                    list(
                        `name`="annual_errors", 
                        `title`="Expected Annual Errors", 
                        `type`="integer"),
                    list(
                        `name`="clinical_impact", 
                        `title`="Clinical Impact", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="costOfQuality",
                title="Cost of Quality Analysis",
                visible="(cost_of_quality)",
                rows=1,
                clearWith=list(
                    "cost_of_quality",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="cost_category", 
                        `title`="Cost Category", 
                        `type`="text"),
                    list(
                        `name`="current_sigma_cost", 
                        `title`="Current Sigma Cost ($)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="six_sigma_cost", 
                        `title`="6 Sigma Cost ($)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="cost_savings", 
                        `title`="Potential Savings ($)", 
                        `type`="number", 
                        `format`="zto:0"),
                    list(
                        `name`="roi_months", 
                        `title`="ROI Timeframe (months)", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="controlPlanning",
                title="Statistical Control Planning",
                visible="(control_planning)",
                rows=1,
                clearWith=list(
                    "control_planning",
                    "sigma_calculation"),
                columns=list(
                    list(
                        `name`="control_strategy", 
                        `title`="Control Strategy", 
                        `type`="text"),
                    list(
                        `name`="recommended_rules", 
                        `title`="Recommended QC Rules", 
                        `type`="text"),
                    list(
                        `name`="control_frequency", 
                        `title`="Control Frequency", 
                        `type`="text"),
                    list(
                        `name`="control_levels", 
                        `title`="Control Levels", 
                        `type`="text"),
                    list(
                        `name`="acceptance_criteria", 
                        `title`="Acceptance Criteria", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="sigmaPlot",
                title="Sigma Metrics Visualization",
                visible="(sigma_plots)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotSigma",
                clearWith=list(
                    "sigma_plots",
                    "bias",
                    "cv",
                    "tea")))
            self$add(jmvcore::Image$new(
                options=options,
                name="normalizedChart",
                title="Normalized Operating Specifications Chart",
                visible="(normalized_plots)",
                requiresData=TRUE,
                width=700,
                height=600,
                renderFun=".plotNormalizedOPSpecs",
                clearWith=list(
                    "normalized_plots",
                    "bias",
                    "cv")))
            self$add(jmvcore::Image$new(
                options=options,
                name="qualityScorecard",
                title="Quality Performance Scorecard",
                visible="(quality_scorecard)",
                requiresData=TRUE,
                width=900,
                height=700,
                renderFun=".plotQualityScorecard",
                clearWith=list(
                    "quality_scorecard",
                    "bias",
                    "cv",
                    "tea")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Clinical Context",
                visible=TRUE))}))

sigmametricsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sigmametricsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "sigmametrics",
                version = c(1,0,0),
                options = options,
                results = sigmametricsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Six Sigma Metrics for Laboratory Performance
#'
#' Six Sigma methodology for laboratory performance evaluation and quality 
#' assessment. Calculates sigma metrics, process capability indices, and 
#' quality goal index (QGI) for analytical methods. Supports ISO 15189 
#' compliance and quality improvement initiatives. Essential for laboratory 
#' method validation and performance monitoring.
#' 
#'
#' @examples
#' data \%>\%
#' sigmametrics(
#'     bias = "method_bias",
#'     cv = "coefficient_variation",
#'     tea = "total_allowable_error",
#'     analyte = "test_name"
#' )
#'
#' @param data the data as a data frame
#' @param bias Method bias as percentage from target value
#' @param cv Coefficient of variation (precision) as percentage
#' @param tea Total allowable error specification as percentage
#' @param analyte Analyte or test name for identification
#' @param laboratory Laboratory or site identifier for comparative analysis
#' @param method Analytical method identifier
#' @param sigma_calculation Method for calculating sigma metrics
#' @param quality_goals Source for quality goal specifications
#' @param custom_tea Custom total allowable error specification
#' @param confidence_level Confidence level for uncertainty calculations
#' @param benchmark_comparison Compare against benchmark sigma levels
#' @param process_capability Calculate Cp, Cpk, and other capability indices
#' @param quality_goal_index Calculate quality goal index metrics
#' @param method_validation Evaluate method performance for validation
#' @param improvement_recommendations Provide specific improvement
#'   recommendations
#' @param regulatory_compliance Assess compliance with regulatory standards
#' @param cost_of_quality Estimate cost implications of quality levels
#' @param defect_rates Calculate expected defect rates per million
#' @param control_planning Generate QC planning recommendations
#' @param sigma_plots Create sigma metric and capability plots
#' @param normalized_plots Generate normalized operating specifications chart
#' @param quality_scorecard Create comprehensive quality scorecard
#'   visualization
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$dataInfo} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sigmaResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$processCapability} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$qualityGoalIndex} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$benchmarkComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$methodValidation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$regulatoryCompliance} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$improvementRecommendations} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$defectRateAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$costOfQuality} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$controlPlanning} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sigmaPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$normalizedChart} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$qualityScorecard} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$dataInfo$asDF}
#'
#' \code{as.data.frame(results$dataInfo)}
#'
#' @export
sigmametrics <- function(
    data,
    bias,
    cv,
    tea,
    analyte,
    laboratory,
    method,
    sigma_calculation = "standard",
    quality_goals = "clia",
    custom_tea = 10,
    confidence_level = 0.95,
    benchmark_comparison = TRUE,
    process_capability = TRUE,
    quality_goal_index = TRUE,
    method_validation = TRUE,
    improvement_recommendations = TRUE,
    regulatory_compliance = TRUE,
    cost_of_quality = FALSE,
    defect_rates = TRUE,
    control_planning = FALSE,
    sigma_plots = TRUE,
    normalized_plots = TRUE,
    quality_scorecard = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("sigmametrics requires jmvcore to be installed (restart may be required)")

    if ( ! missing(bias)) bias <- jmvcore::resolveQuo(jmvcore::enquo(bias))
    if ( ! missing(cv)) cv <- jmvcore::resolveQuo(jmvcore::enquo(cv))
    if ( ! missing(tea)) tea <- jmvcore::resolveQuo(jmvcore::enquo(tea))
    if ( ! missing(analyte)) analyte <- jmvcore::resolveQuo(jmvcore::enquo(analyte))
    if ( ! missing(laboratory)) laboratory <- jmvcore::resolveQuo(jmvcore::enquo(laboratory))
    if ( ! missing(method)) method <- jmvcore::resolveQuo(jmvcore::enquo(method))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(bias), bias, NULL),
            `if`( ! missing(cv), cv, NULL),
            `if`( ! missing(tea), tea, NULL),
            `if`( ! missing(analyte), analyte, NULL),
            `if`( ! missing(laboratory), laboratory, NULL),
            `if`( ! missing(method), method, NULL))

    for (v in analyte) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in laboratory) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in method) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- sigmametricsOptions$new(
        bias = bias,
        cv = cv,
        tea = tea,
        analyte = analyte,
        laboratory = laboratory,
        method = method,
        sigma_calculation = sigma_calculation,
        quality_goals = quality_goals,
        custom_tea = custom_tea,
        confidence_level = confidence_level,
        benchmark_comparison = benchmark_comparison,
        process_capability = process_capability,
        quality_goal_index = quality_goal_index,
        method_validation = method_validation,
        improvement_recommendations = improvement_recommendations,
        regulatory_compliance = regulatory_compliance,
        cost_of_quality = cost_of_quality,
        defect_rates = defect_rates,
        control_planning = control_planning,
        sigma_plots = sigma_plots,
        normalized_plots = normalized_plots,
        quality_scorecard = quality_scorecard)

    analysis <- sigmametricsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

