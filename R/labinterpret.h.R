
# This file is automatically generated, you probably don't want to edit this

labinterpretOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "labinterpretOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            labValues = NULL,
            patientDemo = NULL,
            testDates = NULL,
            clinicalHistory = NULL,
            medicationVars = NULL,
            reference_ranges = TRUE,
            critical_values = TRUE,
            trend_analysis = TRUE,
            delta_checks = TRUE,
            reference_source = "demographic_adjusted",
            interpretation_level = "comprehensive",
            confidence_interval = 0.95,
            delta_threshold = 50,
            trend_window = 90,
            age_adjustment = TRUE,
            gender_adjustment = TRUE,
            ethnicity_adjustment = FALSE,
            medication_interaction = TRUE,
            clinical_correlation = TRUE,
            quality_assessment = TRUE,
            interpretation_plots = TRUE,
            trend_plots = TRUE,
            reference_visualization = TRUE,
            delta_plots = FALSE,
            correlation_matrix = FALSE,
            clinical_guidelines = TRUE,
            interpretation_report = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="labinterpret",
                requiresData=TRUE,
                ...)

            private$..labValues <- jmvcore::OptionVariables$new(
                "labValues",
                labValues,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..patientDemo <- jmvcore::OptionVariables$new(
                "patientDemo",
                patientDemo,
                suggested=list(
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..testDates <- jmvcore::OptionVariables$new(
                "testDates",
                testDates,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..clinicalHistory <- jmvcore::OptionVariables$new(
                "clinicalHistory",
                clinicalHistory,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..medicationVars <- jmvcore::OptionVariables$new(
                "medicationVars",
                medicationVars,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..reference_ranges <- jmvcore::OptionBool$new(
                "reference_ranges",
                reference_ranges,
                default=TRUE)
            private$..critical_values <- jmvcore::OptionBool$new(
                "critical_values",
                critical_values,
                default=TRUE)
            private$..trend_analysis <- jmvcore::OptionBool$new(
                "trend_analysis",
                trend_analysis,
                default=TRUE)
            private$..delta_checks <- jmvcore::OptionBool$new(
                "delta_checks",
                delta_checks,
                default=TRUE)
            private$..reference_source <- jmvcore::OptionList$new(
                "reference_source",
                reference_source,
                options=list(
                    "institutional",
                    "literature_based",
                    "demographic_adjusted",
                    "custom_ranges"),
                default="demographic_adjusted")
            private$..interpretation_level <- jmvcore::OptionList$new(
                "interpretation_level",
                interpretation_level,
                options=list(
                    "basic",
                    "comprehensive",
                    "expert_level",
                    "clinical_context"),
                default="comprehensive")
            private$..confidence_interval <- jmvcore::OptionNumber$new(
                "confidence_interval",
                confidence_interval,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..delta_threshold <- jmvcore::OptionNumber$new(
                "delta_threshold",
                delta_threshold,
                min=10,
                max=200,
                default=50)
            private$..trend_window <- jmvcore::OptionInteger$new(
                "trend_window",
                trend_window,
                min=7,
                max=365,
                default=90)
            private$..age_adjustment <- jmvcore::OptionBool$new(
                "age_adjustment",
                age_adjustment,
                default=TRUE)
            private$..gender_adjustment <- jmvcore::OptionBool$new(
                "gender_adjustment",
                gender_adjustment,
                default=TRUE)
            private$..ethnicity_adjustment <- jmvcore::OptionBool$new(
                "ethnicity_adjustment",
                ethnicity_adjustment,
                default=FALSE)
            private$..medication_interaction <- jmvcore::OptionBool$new(
                "medication_interaction",
                medication_interaction,
                default=TRUE)
            private$..clinical_correlation <- jmvcore::OptionBool$new(
                "clinical_correlation",
                clinical_correlation,
                default=TRUE)
            private$..quality_assessment <- jmvcore::OptionBool$new(
                "quality_assessment",
                quality_assessment,
                default=TRUE)
            private$..interpretation_plots <- jmvcore::OptionBool$new(
                "interpretation_plots",
                interpretation_plots,
                default=TRUE)
            private$..trend_plots <- jmvcore::OptionBool$new(
                "trend_plots",
                trend_plots,
                default=TRUE)
            private$..reference_visualization <- jmvcore::OptionBool$new(
                "reference_visualization",
                reference_visualization,
                default=TRUE)
            private$..delta_plots <- jmvcore::OptionBool$new(
                "delta_plots",
                delta_plots,
                default=FALSE)
            private$..correlation_matrix <- jmvcore::OptionBool$new(
                "correlation_matrix",
                correlation_matrix,
                default=FALSE)
            private$..clinical_guidelines <- jmvcore::OptionBool$new(
                "clinical_guidelines",
                clinical_guidelines,
                default=TRUE)
            private$..interpretation_report <- jmvcore::OptionBool$new(
                "interpretation_report",
                interpretation_report,
                default=TRUE)

            self$.addOption(private$..labValues)
            self$.addOption(private$..patientDemo)
            self$.addOption(private$..testDates)
            self$.addOption(private$..clinicalHistory)
            self$.addOption(private$..medicationVars)
            self$.addOption(private$..reference_ranges)
            self$.addOption(private$..critical_values)
            self$.addOption(private$..trend_analysis)
            self$.addOption(private$..delta_checks)
            self$.addOption(private$..reference_source)
            self$.addOption(private$..interpretation_level)
            self$.addOption(private$..confidence_interval)
            self$.addOption(private$..delta_threshold)
            self$.addOption(private$..trend_window)
            self$.addOption(private$..age_adjustment)
            self$.addOption(private$..gender_adjustment)
            self$.addOption(private$..ethnicity_adjustment)
            self$.addOption(private$..medication_interaction)
            self$.addOption(private$..clinical_correlation)
            self$.addOption(private$..quality_assessment)
            self$.addOption(private$..interpretation_plots)
            self$.addOption(private$..trend_plots)
            self$.addOption(private$..reference_visualization)
            self$.addOption(private$..delta_plots)
            self$.addOption(private$..correlation_matrix)
            self$.addOption(private$..clinical_guidelines)
            self$.addOption(private$..interpretation_report)
        }),
    active = list(
        labValues = function() private$..labValues$value,
        patientDemo = function() private$..patientDemo$value,
        testDates = function() private$..testDates$value,
        clinicalHistory = function() private$..clinicalHistory$value,
        medicationVars = function() private$..medicationVars$value,
        reference_ranges = function() private$..reference_ranges$value,
        critical_values = function() private$..critical_values$value,
        trend_analysis = function() private$..trend_analysis$value,
        delta_checks = function() private$..delta_checks$value,
        reference_source = function() private$..reference_source$value,
        interpretation_level = function() private$..interpretation_level$value,
        confidence_interval = function() private$..confidence_interval$value,
        delta_threshold = function() private$..delta_threshold$value,
        trend_window = function() private$..trend_window$value,
        age_adjustment = function() private$..age_adjustment$value,
        gender_adjustment = function() private$..gender_adjustment$value,
        ethnicity_adjustment = function() private$..ethnicity_adjustment$value,
        medication_interaction = function() private$..medication_interaction$value,
        clinical_correlation = function() private$..clinical_correlation$value,
        quality_assessment = function() private$..quality_assessment$value,
        interpretation_plots = function() private$..interpretation_plots$value,
        trend_plots = function() private$..trend_plots$value,
        reference_visualization = function() private$..reference_visualization$value,
        delta_plots = function() private$..delta_plots$value,
        correlation_matrix = function() private$..correlation_matrix$value,
        clinical_guidelines = function() private$..clinical_guidelines$value,
        interpretation_report = function() private$..interpretation_report$value),
    private = list(
        ..labValues = NA,
        ..patientDemo = NA,
        ..testDates = NA,
        ..clinicalHistory = NA,
        ..medicationVars = NA,
        ..reference_ranges = NA,
        ..critical_values = NA,
        ..trend_analysis = NA,
        ..delta_checks = NA,
        ..reference_source = NA,
        ..interpretation_level = NA,
        ..confidence_interval = NA,
        ..delta_threshold = NA,
        ..trend_window = NA,
        ..age_adjustment = NA,
        ..gender_adjustment = NA,
        ..ethnicity_adjustment = NA,
        ..medication_interaction = NA,
        ..clinical_correlation = NA,
        ..quality_assessment = NA,
        ..interpretation_plots = NA,
        ..trend_plots = NA,
        ..reference_visualization = NA,
        ..delta_plots = NA,
        ..correlation_matrix = NA,
        ..clinical_guidelines = NA,
        ..interpretation_report = NA)
)

labinterpretResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "labinterpretResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        interpretationTable = function() private$.items[["interpretationTable"]],
        criticalValuesTable = function() private$.items[["criticalValuesTable"]],
        trendAnalysisTable = function() private$.items[["trendAnalysisTable"]],
        deltaChecksTable = function() private$.items[["deltaChecksTable"]],
        medicationEffectsTable = function() private$.items[["medicationEffectsTable"]],
        correlationAnalysisTable = function() private$.items[["correlationAnalysisTable"]],
        qualityMetricsTable = function() private$.items[["qualityMetricsTable"]],
        interpretationSummary = function() private$.items[["interpretationSummary"]],
        clinicalRecommendations = function() private$.items[["clinicalRecommendations"]],
        interpretationPlot = function() private$.items[["interpretationPlot"]],
        trendPlot = function() private$.items[["trendPlot"]],
        referencePlot = function() private$.items[["referencePlot"]],
        deltaPlot = function() private$.items[["deltaPlot"]],
        correlationPlot = function() private$.items[["correlationPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Laboratory Result Interpretation")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Summary",
                refs=list(
                    "labValues")))
            self$add(jmvcore::Table$new(
                options=options,
                name="interpretationTable",
                title="Laboratory Value Interpretation",
                rows="(labValues)",
                clearWith=list(
                    "labValues",
                    "patientDemo",
                    "reference_source",
                    "interpretation_level"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Laboratory Test", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Observed Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="units", 
                        `title`="Units", 
                        `type`="text"),
                    list(
                        `name`="reference_range", 
                        `title`="Reference Range", 
                        `type`="text"),
                    list(
                        `name`="status", 
                        `title`="Status", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"),
                    list(
                        `name`="confidence", 
                        `title`="Confidence", 
                        `type`="number", 
                        `format`="pc"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="criticalValuesTable",
                title="Critical Values Alert",
                visible="(critical_values)",
                clearWith=list(
                    "labValues",
                    "critical_values"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Critical Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="severity", 
                        `title`="Severity Level", 
                        `type`="text"),
                    list(
                        `name`="action_required", 
                        `title`="Required Action", 
                        `type`="text"),
                    list(
                        `name`="time_sensitivity", 
                        `title`="Time Sensitivity", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="trendAnalysisTable",
                title="Temporal Trend Analysis",
                visible="(trend_analysis)",
                clearWith=list(
                    "labValues",
                    "testDates",
                    "trend_analysis",
                    "trend_window"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Laboratory Test", 
                        `type`="text"),
                    list(
                        `name`="trend_direction", 
                        `title`="Trend Direction", 
                        `type`="text"),
                    list(
                        `name`="slope", 
                        `title`="Change Rate", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="r_squared", 
                        `title`="R\u00B2", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="deltaChecksTable",
                title="Delta Check Analysis",
                visible="(delta_checks)",
                clearWith=list(
                    "labValues",
                    "testDates",
                    "delta_checks",
                    "delta_threshold"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="previous_value", 
                        `title`="Previous Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="current_value", 
                        `title`="Current Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="percent_change", 
                        `title`="% Change", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="delta_flag", 
                        `title`="Delta Flag", 
                        `type`="text"),
                    list(
                        `name`="clinical_relevance", 
                        `title`="Clinical Relevance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="medicationEffectsTable",
                title="Medication Effects Analysis",
                visible="(medication_interaction)",
                clearWith=list(
                    "labValues",
                    "medicationVars",
                    "medication_interaction"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Laboratory Test", 
                        `type`="text"),
                    list(
                        `name`="medication", 
                        `title`="Medication", 
                        `type`="text"),
                    list(
                        `name`="effect_type", 
                        `title`="Effect Type", 
                        `type`="text"),
                    list(
                        `name`="magnitude", 
                        `title`="Effect Magnitude", 
                        `type`="text"),
                    list(
                        `name`="clinical_impact", 
                        `title`="Clinical Impact", 
                        `type`="text"),
                    list(
                        `name`="monitoring_recommendation", 
                        `title`="Monitoring Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="correlationAnalysisTable",
                title="Laboratory Value Correlations",
                visible="(clinical_correlation)",
                clearWith=list(
                    "labValues",
                    "clinical_correlation"),
                columns=list(
                    list(
                        `name`="test_pair", 
                        `title`="Test Combination", 
                        `type`="text"),
                    list(
                        `name`="correlation", 
                        `title`="Correlation (r)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="clinical_relevance", 
                        `title`="Clinical Relevance", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="qualityMetricsTable",
                title="Quality Assessment Indicators",
                visible="(quality_assessment)",
                clearWith=list(
                    "labValues",
                    "quality_assessment"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="cv_percent", 
                        `title`="CV %", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="analytical_sensitivity", 
                        `title`="Analytical Sensitivity", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="reference_interval_quality", 
                        `title`="Reference Interval Quality", 
                        `type`="text"),
                    list(
                        `name`="measurement_uncertainty", 
                        `title`="Measurement Uncertainty", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretationSummary",
                title="Clinical Interpretation Summary",
                visible="(interpretation_report)",
                clearWith=list(
                    "labValues",
                    "patientDemo",
                    "interpretation_report",
                    "clinical_guidelines")))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalRecommendations",
                title="Clinical Recommendations",
                visible="(clinical_guidelines)",
                clearWith=list(
                    "labValues",
                    "clinical_guidelines",
                    "interpretation_level")))
            self$add(jmvcore::Image$new(
                options=options,
                name="interpretationPlot",
                title="Laboratory Value Interpretation",
                width=600,
                height=400,
                renderFun=".interpretationPlot",
                visible="(interpretation_plots)",
                requiresData=TRUE,
                clearWith=list(
                    "labValues",
                    "patientDemo",
                    "reference_ranges",
                    "interpretation_plots")))
            self$add(jmvcore::Image$new(
                options=options,
                name="trendPlot",
                title="Temporal Trend Analysis",
                width=800,
                height=500,
                renderFun=".trendPlot",
                visible="(trend_plots)",
                requiresData=TRUE,
                clearWith=list(
                    "labValues",
                    "testDates",
                    "trend_plots",
                    "trend_analysis")))
            self$add(jmvcore::Image$new(
                options=options,
                name="referencePlot",
                title="Reference Range Visualization",
                width=700,
                height=450,
                renderFun=".referencePlot",
                visible="(reference_visualization)",
                requiresData=TRUE,
                clearWith=list(
                    "labValues",
                    "patientDemo",
                    "reference_visualization",
                    "reference_source")))
            self$add(jmvcore::Image$new(
                options=options,
                name="deltaPlot",
                title="Delta Check Visualization",
                width=650,
                height=400,
                renderFun=".deltaPlot",
                visible="(delta_plots)",
                requiresData=TRUE,
                clearWith=list(
                    "labValues",
                    "testDates",
                    "delta_plots",
                    "delta_checks")))
            self$add(jmvcore::Image$new(
                options=options,
                name="correlationPlot",
                title="Laboratory Correlation Matrix",
                width=600,
                height=600,
                renderFun=".correlationPlot",
                visible="(correlation_matrix)",
                requiresData=TRUE,
                clearWith=list(
                    "labValues",
                    "correlation_matrix",
                    "clinical_correlation")))}))

labinterpretBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "labinterpretBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "labinterpret",
                version = c(1,0,0),
                options = options,
                results = labinterpretResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = TRUE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Laboratory Result Interpretation
#'
#' Laboratory Result Interpretation provides comprehensive analysis and 
#' clinical 
#' interpretation of laboratory test results with reference ranges, 
#' demographic 
#' adjustments, trend analysis, and critical value monitoring for 
#' evidence-based 
#' diagnostic decision-making and clinical assessment optimization.
#' 
#'
#' @examples
#' data('clinicaldata', package='ClinicoPath')
#'
#' # Basic laboratory interpretation
#' labinterpret(clinicaldata,
#'             labValues = c('Hemoglobin', 'Glucose', 'Creatinine'),
#'             patientDemo = c('Age', 'Gender'),
#'             reference_ranges = TRUE,
#'             trend_analysis = TRUE)
#'
#' @param data .
#' @param labValues Laboratory test results and biomarker values for
#'   interpretation
#' @param patientDemo Patient demographic variables (age, gender, ethnicity)
#'   for reference range adjustment
#' @param testDates Date/time variables for temporal trend analysis (optional)
#' @param clinicalHistory Clinical history and comorbidity variables affecting
#'   reference ranges (optional)
#' @param medicationVars Current medications that may affect laboratory values
#'   (optional)
#' @param reference_ranges Apply demographic-adjusted reference ranges and
#'   normal value analysis
#' @param critical_values Monitor and flag critical laboratory values
#'   requiring immediate attention
#' @param trend_analysis Analyze laboratory value trends over time with
#'   statistical significance testing
#' @param delta_checks Perform delta checks for significant changes between
#'   consecutive results
#' @param reference_source Source of reference ranges for laboratory value
#'   interpretation
#' @param interpretation_level Level of detail for laboratory result
#'   interpretation and clinical correlation
#' @param confidence_interval Confidence level for reference range
#'   calculations and interpretations
#' @param delta_threshold Percentage change threshold for delta check
#'   significance testing
#' @param trend_window Time window for temporal trend analysis and pattern
#'   detection
#' @param age_adjustment Apply age-specific reference ranges for laboratory
#'   value interpretation
#' @param gender_adjustment Apply gender-specific reference ranges for
#'   laboratory value interpretation
#' @param ethnicity_adjustment Apply ethnicity-specific reference ranges when
#'   available
#' @param medication_interaction Analyze potential medication effects on
#'   laboratory values
#' @param clinical_correlation Correlate laboratory results with clinical
#'   presentation and history
#' @param quality_assessment Include quality indicators and analytical
#'   performance metrics
#' @param interpretation_plots Create visualization plots for laboratory
#'   result interpretation
#' @param trend_plots Create time-series plots showing laboratory value trends
#' @param reference_visualization Visualize reference ranges and patient
#'   results comparison
#' @param delta_plots Create plots showing significant changes between
#'   consecutive results
#' @param correlation_matrix Create correlation matrix of laboratory values
#'   for pattern analysis
#' @param clinical_guidelines Integrate clinical laboratory guidelines and
#'   best practice recommendations
#' @param interpretation_report Generate comprehensive clinical interpretation
#'   report with recommendations
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretationTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$criticalValuesTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$trendAnalysisTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$deltaChecksTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$medicationEffectsTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$correlationAnalysisTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$qualityMetricsTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interpretationSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinicalRecommendations} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretationPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$trendPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$referencePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$deltaPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$correlationPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$interpretationTable$asDF}
#'
#' \code{as.data.frame(results$interpretationTable)}
#'
#' @export
labinterpret <- function(
    data,
    labValues,
    patientDemo,
    testDates,
    clinicalHistory,
    medicationVars,
    reference_ranges = TRUE,
    critical_values = TRUE,
    trend_analysis = TRUE,
    delta_checks = TRUE,
    reference_source = "demographic_adjusted",
    interpretation_level = "comprehensive",
    confidence_interval = 0.95,
    delta_threshold = 50,
    trend_window = 90,
    age_adjustment = TRUE,
    gender_adjustment = TRUE,
    ethnicity_adjustment = FALSE,
    medication_interaction = TRUE,
    clinical_correlation = TRUE,
    quality_assessment = TRUE,
    interpretation_plots = TRUE,
    trend_plots = TRUE,
    reference_visualization = TRUE,
    delta_plots = FALSE,
    correlation_matrix = FALSE,
    clinical_guidelines = TRUE,
    interpretation_report = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("labinterpret requires jmvcore to be installed (restart may be required)")

    if ( ! missing(labValues)) labValues <- jmvcore::resolveQuo(jmvcore::enquo(labValues))
    if ( ! missing(patientDemo)) patientDemo <- jmvcore::resolveQuo(jmvcore::enquo(patientDemo))
    if ( ! missing(testDates)) testDates <- jmvcore::resolveQuo(jmvcore::enquo(testDates))
    if ( ! missing(clinicalHistory)) clinicalHistory <- jmvcore::resolveQuo(jmvcore::enquo(clinicalHistory))
    if ( ! missing(medicationVars)) medicationVars <- jmvcore::resolveQuo(jmvcore::enquo(medicationVars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(labValues), labValues, NULL),
            `if`( ! missing(patientDemo), patientDemo, NULL),
            `if`( ! missing(testDates), testDates, NULL),
            `if`( ! missing(clinicalHistory), clinicalHistory, NULL),
            `if`( ! missing(medicationVars), medicationVars, NULL))

    for (v in clinicalHistory) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in medicationVars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- labinterpretOptions$new(
        labValues = labValues,
        patientDemo = patientDemo,
        testDates = testDates,
        clinicalHistory = clinicalHistory,
        medicationVars = medicationVars,
        reference_ranges = reference_ranges,
        critical_values = critical_values,
        trend_analysis = trend_analysis,
        delta_checks = delta_checks,
        reference_source = reference_source,
        interpretation_level = interpretation_level,
        confidence_interval = confidence_interval,
        delta_threshold = delta_threshold,
        trend_window = trend_window,
        age_adjustment = age_adjustment,
        gender_adjustment = gender_adjustment,
        ethnicity_adjustment = ethnicity_adjustment,
        medication_interaction = medication_interaction,
        clinical_correlation = clinical_correlation,
        quality_assessment = quality_assessment,
        interpretation_plots = interpretation_plots,
        trend_plots = trend_plots,
        reference_visualization = reference_visualization,
        delta_plots = delta_plots,
        correlation_matrix = correlation_matrix,
        clinical_guidelines = clinical_guidelines,
        interpretation_report = interpretation_report)

    analysis <- labinterpretClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

