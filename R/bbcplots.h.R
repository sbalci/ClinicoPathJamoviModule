
# This file is automatically generated, you probably don't want to edit this

bbcplotsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bbcplotsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            y_var = NULL,
            x_var = NULL,
            group_var = NULL,
            facet_var = NULL,
            chart_type = "column",
            bbc_colors = "bbc_blue",
            custom_colors = "#1380A1, #FAAB18, #007f7f, #333333",
            title_text = "",
            subtitle_text = "",
            source_text = "Source: Data analysis",
            x_axis_title = "",
            y_axis_title = "",
            show_values = FALSE,
            value_position = "above",
            horizontal_gridlines = TRUE,
            vertical_gridlines = FALSE,
            legend_position = "top",
            chart_width = 640,
            chart_height = 450,
            left_align_title = TRUE,
            font_family = "Helvetica",
            add_branding = FALSE,
            export_finalized = FALSE,
            statistical_annotations = FALSE,
            stat_method = "auto",
            confidence_level = 0.95,
            show_sample_sizes = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="bbcplots",
                requiresData=TRUE,
                ...)

            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..group_var <- jmvcore::OptionVariable$new(
                "group_var",
                group_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..chart_type <- jmvcore::OptionList$new(
                "chart_type",
                chart_type,
                options=list(
                    "column",
                    "bar",
                    "line",
                    "point",
                    "area",
                    "stacked_column",
                    "grouped_column",
                    "horizontal_bar"),
                default="column")
            private$..bbc_colors <- jmvcore::OptionList$new(
                "bbc_colors",
                bbc_colors,
                options=list(
                    "bbc_blue",
                    "bbc_orange",
                    "bbc_teal",
                    "bbc_gray",
                    "custom",
                    "multi_color"),
                default="bbc_blue")
            private$..custom_colors <- jmvcore::OptionString$new(
                "custom_colors",
                custom_colors,
                default="#1380A1, #FAAB18, #007f7f, #333333")
            private$..title_text <- jmvcore::OptionString$new(
                "title_text",
                title_text,
                default="")
            private$..subtitle_text <- jmvcore::OptionString$new(
                "subtitle_text",
                subtitle_text,
                default="")
            private$..source_text <- jmvcore::OptionString$new(
                "source_text",
                source_text,
                default="Source: Data analysis")
            private$..x_axis_title <- jmvcore::OptionString$new(
                "x_axis_title",
                x_axis_title,
                default="")
            private$..y_axis_title <- jmvcore::OptionString$new(
                "y_axis_title",
                y_axis_title,
                default="")
            private$..show_values <- jmvcore::OptionBool$new(
                "show_values",
                show_values,
                default=FALSE)
            private$..value_position <- jmvcore::OptionList$new(
                "value_position",
                value_position,
                options=list(
                    "above",
                    "center",
                    "below"),
                default="above")
            private$..horizontal_gridlines <- jmvcore::OptionBool$new(
                "horizontal_gridlines",
                horizontal_gridlines,
                default=TRUE)
            private$..vertical_gridlines <- jmvcore::OptionBool$new(
                "vertical_gridlines",
                vertical_gridlines,
                default=FALSE)
            private$..legend_position <- jmvcore::OptionList$new(
                "legend_position",
                legend_position,
                options=list(
                    "top",
                    "bottom",
                    "right",
                    "left",
                    "none"),
                default="top")
            private$..chart_width <- jmvcore::OptionNumber$new(
                "chart_width",
                chart_width,
                min=400,
                max=1200,
                default=640)
            private$..chart_height <- jmvcore::OptionNumber$new(
                "chart_height",
                chart_height,
                min=300,
                max=800,
                default=450)
            private$..left_align_title <- jmvcore::OptionBool$new(
                "left_align_title",
                left_align_title,
                default=TRUE)
            private$..font_family <- jmvcore::OptionList$new(
                "font_family",
                font_family,
                options=list(
                    "Helvetica",
                    "Arial",
                    "Calibri",
                    "sans"),
                default="Helvetica")
            private$..add_branding <- jmvcore::OptionBool$new(
                "add_branding",
                add_branding,
                default=FALSE)
            private$..export_finalized <- jmvcore::OptionBool$new(
                "export_finalized",
                export_finalized,
                default=FALSE)
            private$..statistical_annotations <- jmvcore::OptionBool$new(
                "statistical_annotations",
                statistical_annotations,
                default=FALSE)
            private$..stat_method <- jmvcore::OptionList$new(
                "stat_method",
                stat_method,
                options=list(
                    "auto",
                    "anova",
                    "ttest",
                    "chisq",
                    "kruskal",
                    "none"),
                default="auto")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..show_sample_sizes <- jmvcore::OptionBool$new(
                "show_sample_sizes",
                show_sample_sizes,
                default=FALSE)

            self$.addOption(private$..y_var)
            self$.addOption(private$..x_var)
            self$.addOption(private$..group_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..chart_type)
            self$.addOption(private$..bbc_colors)
            self$.addOption(private$..custom_colors)
            self$.addOption(private$..title_text)
            self$.addOption(private$..subtitle_text)
            self$.addOption(private$..source_text)
            self$.addOption(private$..x_axis_title)
            self$.addOption(private$..y_axis_title)
            self$.addOption(private$..show_values)
            self$.addOption(private$..value_position)
            self$.addOption(private$..horizontal_gridlines)
            self$.addOption(private$..vertical_gridlines)
            self$.addOption(private$..legend_position)
            self$.addOption(private$..chart_width)
            self$.addOption(private$..chart_height)
            self$.addOption(private$..left_align_title)
            self$.addOption(private$..font_family)
            self$.addOption(private$..add_branding)
            self$.addOption(private$..export_finalized)
            self$.addOption(private$..statistical_annotations)
            self$.addOption(private$..stat_method)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..show_sample_sizes)
        }),
    active = list(
        y_var = function() private$..y_var$value,
        x_var = function() private$..x_var$value,
        group_var = function() private$..group_var$value,
        facet_var = function() private$..facet_var$value,
        chart_type = function() private$..chart_type$value,
        bbc_colors = function() private$..bbc_colors$value,
        custom_colors = function() private$..custom_colors$value,
        title_text = function() private$..title_text$value,
        subtitle_text = function() private$..subtitle_text$value,
        source_text = function() private$..source_text$value,
        x_axis_title = function() private$..x_axis_title$value,
        y_axis_title = function() private$..y_axis_title$value,
        show_values = function() private$..show_values$value,
        value_position = function() private$..value_position$value,
        horizontal_gridlines = function() private$..horizontal_gridlines$value,
        vertical_gridlines = function() private$..vertical_gridlines$value,
        legend_position = function() private$..legend_position$value,
        chart_width = function() private$..chart_width$value,
        chart_height = function() private$..chart_height$value,
        left_align_title = function() private$..left_align_title$value,
        font_family = function() private$..font_family$value,
        add_branding = function() private$..add_branding$value,
        export_finalized = function() private$..export_finalized$value,
        statistical_annotations = function() private$..statistical_annotations$value,
        stat_method = function() private$..stat_method$value,
        confidence_level = function() private$..confidence_level$value,
        show_sample_sizes = function() private$..show_sample_sizes$value),
    private = list(
        ..y_var = NA,
        ..x_var = NA,
        ..group_var = NA,
        ..facet_var = NA,
        ..chart_type = NA,
        ..bbc_colors = NA,
        ..custom_colors = NA,
        ..title_text = NA,
        ..subtitle_text = NA,
        ..source_text = NA,
        ..x_axis_title = NA,
        ..y_axis_title = NA,
        ..show_values = NA,
        ..value_position = NA,
        ..horizontal_gridlines = NA,
        ..vertical_gridlines = NA,
        ..legend_position = NA,
        ..chart_width = NA,
        ..chart_height = NA,
        ..left_align_title = NA,
        ..font_family = NA,
        ..add_branding = NA,
        ..export_finalized = NA,
        ..statistical_annotations = NA,
        ..stat_method = NA,
        ..confidence_level = NA,
        ..show_sample_sizes = NA)
)

bbcplotsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bbcplotsResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        main_plot = function() private$.items[["main_plot"]],
        finalized_plot = function() private$.items[["finalized_plot"]],
        statistical_results = function() private$.items[["statistical_results"]],
        chart_summary = function() private$.items[["chart_summary"]],
        color_guide = function() private$.items[["color_guide"]],
        design_notes = function() private$.items[["design_notes"]],
        export_code = function() private$.items[["export_code"]],
        accessibility_info = function() private$.items[["accessibility_info"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="BBC-Style Data Visualization Results",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "bbplot",
                    "ggplot2",
                    "ggpubr"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Image$new(
                options=options,
                name="main_plot",
                title="BBC-Style Visualization",
                width=640,
                height=450,
                renderFun=".plot_main",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "group_var",
                    "chart_type",
                    "bbc_colors",
                    "custom_colors",
                    "title_text",
                    "subtitle_text",
                    "horizontal_gridlines",
                    "vertical_gridlines",
                    "legend_position",
                    "font_family")))
            self$add(jmvcore::Image$new(
                options=options,
                name="finalized_plot",
                title="Publication-Ready Chart",
                width=640,
                height=500,
                renderFun=".plot_finalized",
                visible="(export_finalized)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "group_var",
                    "chart_type",
                    "bbc_colors",
                    "source_text",
                    "add_branding",
                    "chart_width",
                    "chart_height")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistical_results",
                title="Statistical Analysis",
                visible="(statistical_annotations)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "group_var",
                    "stat_method",
                    "confidence_level")))
            self$add(jmvcore::Html$new(
                options=options,
                name="chart_summary",
                title="Chart Summary Statistics",
                visible="(show_sample_sizes)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "group_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="color_guide",
                title="BBC Color Guidelines",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="design_notes",
                title="BBC Design Principles",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="export_code",
                title="Reproducible R Code",
                visible="(export_finalized)",
                clearWith=list(
                    "chart_type",
                    "bbc_colors",
                    "title_text",
                    "subtitle_text",
                    "source_text")))
            self$add(jmvcore::Html$new(
                options=options,
                name="accessibility_info",
                title="Accessibility & Standards",
                visible=TRUE))}))

bbcplotsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bbcplotsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "bbcplots",
                version = c(0,0,3),
                options = options,
                results = bbcplotsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' BBC-Style Data Visualization
#'
#' Creates professional BBC News-style data visualizations using the bbplot 
#' package design principles.
#' 
#' This module implements the BBC Visual and Data Journalism team's design 
#' standards for creating
#' publication-ready graphics with clean typography, consistent color schemes, 
#' and professional
#' branding elements. Perfect for creating news-quality visualizations for 
#' reports, presentations,
#' and publications.
#' 
#' Features BBC's signature minimalist aesthetic with Helvetica typography, 
#' strategic use of
#' gridlines, and standardized chart dimensions optimized for digital 
#' publication.
#' 
#'
#' @examples
#' # Basic BBC-style visualization
#' library(bbplot)
#' library(ggplot2)
#'
#' # Create plot with BBC styling
#' plot <- ggplot(data, aes(x = category, y = value)) +
#'   geom_col(fill = "#1380A1") +
#'   bbc_style()
#'
#' # Finalize with BBC branding
#' finalise_plot(plot, "Source: Data source", "output.png")
#'
#' @param data The data as a data frame.
#' @param y_var The dependent variable for the main axis.
#' @param x_var The independent variable for categories or groups.
#' @param group_var Optional variable for creating grouped or series
#'   comparisons.
#' @param facet_var Optional variable for creating faceted subplots.
#' @param chart_type The type of chart to create using BBC styling.
#' @param bbc_colors BBC-approved color scheme for data visualization.
#' @param custom_colors Custom color palette as comma-separated hex codes.
#' @param title_text Main title for the chart in BBC style (28pt Helvetica
#'   bold).
#' @param subtitle_text Subtitle for additional context (22pt Helvetica).
#' @param source_text Data source attribution for the chart footer.
#' @param x_axis_title Custom title for the X-axis (leave blank for variable
#'   name).
#' @param y_axis_title Custom title for the Y-axis (leave blank for variable
#'   name).
#' @param show_values Whether to display data values on the chart.
#' @param value_position Position of data value labels on chart elements.
#' @param horizontal_gridlines Whether to show horizontal gridlines (BBC
#'   standard).
#' @param vertical_gridlines Whether to show vertical gridlines (not BBC
#'   standard).
#' @param legend_position Position of the chart legend following BBC
#'   guidelines.
#' @param chart_width Width of the exported chart in pixels (BBC standard:
#'   640).
#' @param chart_height Height of the exported chart in pixels (BBC standard:
#'   450).
#' @param left_align_title Whether to left-align the title (BBC standard).
#' @param font_family Font family for text elements (Helvetica is BBC
#'   standard).
#' @param add_branding Whether to add BBC-style branding elements to the
#'   chart.
#' @param export_finalized Whether to export a finalized version with BBC
#'   formatting.
#' @param statistical_annotations Whether to include statistical test results
#'   on the chart.
#' @param stat_method Statistical test to perform and display on the chart.
#' @param confidence_level Confidence level for statistical intervals and
#'   tests.
#' @param show_sample_sizes Whether to display sample sizes for each group.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$main_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$finalized_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistical_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$chart_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$color_guide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$design_notes} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$export_code} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$accessibility_info} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
bbcplots <- function(
    data,
    y_var,
    x_var,
    group_var,
    facet_var,
    chart_type = "column",
    bbc_colors = "bbc_blue",
    custom_colors = "#1380A1, #FAAB18, #007f7f, #333333",
    title_text = "",
    subtitle_text = "",
    source_text = "Source: Data analysis",
    x_axis_title = "",
    y_axis_title = "",
    show_values = FALSE,
    value_position = "above",
    horizontal_gridlines = TRUE,
    vertical_gridlines = FALSE,
    legend_position = "top",
    chart_width = 640,
    chart_height = 450,
    left_align_title = TRUE,
    font_family = "Helvetica",
    add_branding = FALSE,
    export_finalized = FALSE,
    statistical_annotations = FALSE,
    stat_method = "auto",
    confidence_level = 0.95,
    show_sample_sizes = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("bbcplots requires jmvcore to be installed (restart may be required)")

    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(group_var)) group_var <- jmvcore::resolveQuo(jmvcore::enquo(group_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(group_var), group_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))

    for (v in group_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- bbcplotsOptions$new(
        y_var = y_var,
        x_var = x_var,
        group_var = group_var,
        facet_var = facet_var,
        chart_type = chart_type,
        bbc_colors = bbc_colors,
        custom_colors = custom_colors,
        title_text = title_text,
        subtitle_text = subtitle_text,
        source_text = source_text,
        x_axis_title = x_axis_title,
        y_axis_title = y_axis_title,
        show_values = show_values,
        value_position = value_position,
        horizontal_gridlines = horizontal_gridlines,
        vertical_gridlines = vertical_gridlines,
        legend_position = legend_position,
        chart_width = chart_width,
        chart_height = chart_height,
        left_align_title = left_align_title,
        font_family = font_family,
        add_branding = add_branding,
        export_finalized = export_finalized,
        statistical_annotations = statistical_annotations,
        stat_method = stat_method,
        confidence_level = confidence_level,
        show_sample_sizes = show_sample_sizes)

    analysis <- bbcplotsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

