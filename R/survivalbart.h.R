
# This file is automatically generated, you probably don't want to edit this

survivalbartOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalbartOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time = NULL,
            event = NULL,
            predictors = NULL,
            strata = NULL,
            model_type = "aft",
            prior_distribution = "normal",
            n_trees = 200,
            alpha = 0.95,
            beta = 2,
            k = 2,
            q = 0.9,
            nu = 3,
            n_burn = 1000,
            n_post = 2000,
            n_thin = 1,
            n_chains = 1,
            variable_selection = TRUE,
            sparse_prior = FALSE,
            selection_alpha = 1,
            predict_times = "1, 2, 5",
            survival_quantiles = "0.25, 0.5, 0.75",
            credible_level = 0.95,
            cross_validation = FALSE,
            cv_folds = 5,
            convergence_diagnostics = TRUE,
            posterior_prediction = FALSE,
            show_model_summary = TRUE,
            show_variable_importance = TRUE,
            show_survival_summary = TRUE,
            show_convergence = TRUE,
            plot_survival_curves = TRUE,
            plot_variable_importance = TRUE,
            plot_trace = FALSE,
            plot_posterior_predictive = FALSE,
            plot_partial_dependence = FALSE,
            plot_interactions = FALSE,
            probit_link = FALSE,
            cure_fraction_prior = "uniform",
            adaptive_scaling = TRUE,
            parallel_chains = FALSE,
            memory_optimization = TRUE,
            random_seed = 123, ...) {

            super$initialize(
                package="ClinicoPath",
                name="survivalbart",
                requiresData=TRUE,
                ...)

            private$..time <- jmvcore::OptionVariable$new(
                "time",
                time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event <- jmvcore::OptionVariable$new(
                "event",
                event,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..predictors <- jmvcore::OptionVariables$new(
                "predictors",
                predictors,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..strata <- jmvcore::OptionVariable$new(
                "strata",
                strata,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "aft",
                    "ph",
                    "cure"),
                default="aft")
            private$..prior_distribution <- jmvcore::OptionList$new(
                "prior_distribution",
                prior_distribution,
                options=list(
                    "normal",
                    "logistic",
                    "t",
                    "extreme_value"),
                default="normal")
            private$..n_trees <- jmvcore::OptionInteger$new(
                "n_trees",
                n_trees,
                default=200,
                min=50,
                max=1000)
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..beta <- jmvcore::OptionNumber$new(
                "beta",
                beta,
                default=2,
                min=0.5,
                max=5)
            private$..k <- jmvcore::OptionNumber$new(
                "k",
                k,
                default=2,
                min=0.5,
                max=10)
            private$..q <- jmvcore::OptionNumber$new(
                "q",
                q,
                default=0.9,
                min=0.75,
                max=0.99)
            private$..nu <- jmvcore::OptionNumber$new(
                "nu",
                nu,
                default=3,
                min=1,
                max=10)
            private$..n_burn <- jmvcore::OptionInteger$new(
                "n_burn",
                n_burn,
                default=1000,
                min=500,
                max=10000)
            private$..n_post <- jmvcore::OptionInteger$new(
                "n_post",
                n_post,
                default=2000,
                min=1000,
                max=20000)
            private$..n_thin <- jmvcore::OptionInteger$new(
                "n_thin",
                n_thin,
                default=1,
                min=1,
                max=20)
            private$..n_chains <- jmvcore::OptionInteger$new(
                "n_chains",
                n_chains,
                default=1,
                min=1,
                max=4)
            private$..variable_selection <- jmvcore::OptionBool$new(
                "variable_selection",
                variable_selection,
                default=TRUE)
            private$..sparse_prior <- jmvcore::OptionBool$new(
                "sparse_prior",
                sparse_prior,
                default=FALSE)
            private$..selection_alpha <- jmvcore::OptionNumber$new(
                "selection_alpha",
                selection_alpha,
                default=1,
                min=0.1,
                max=10)
            private$..predict_times <- jmvcore::OptionString$new(
                "predict_times",
                predict_times,
                default="1, 2, 5")
            private$..survival_quantiles <- jmvcore::OptionString$new(
                "survival_quantiles",
                survival_quantiles,
                default="0.25, 0.5, 0.75")
            private$..credible_level <- jmvcore::OptionNumber$new(
                "credible_level",
                credible_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..cross_validation <- jmvcore::OptionBool$new(
                "cross_validation",
                cross_validation,
                default=FALSE)
            private$..cv_folds <- jmvcore::OptionInteger$new(
                "cv_folds",
                cv_folds,
                default=5,
                min=3,
                max=10)
            private$..convergence_diagnostics <- jmvcore::OptionBool$new(
                "convergence_diagnostics",
                convergence_diagnostics,
                default=TRUE)
            private$..posterior_prediction <- jmvcore::OptionBool$new(
                "posterior_prediction",
                posterior_prediction,
                default=FALSE)
            private$..show_model_summary <- jmvcore::OptionBool$new(
                "show_model_summary",
                show_model_summary,
                default=TRUE)
            private$..show_variable_importance <- jmvcore::OptionBool$new(
                "show_variable_importance",
                show_variable_importance,
                default=TRUE)
            private$..show_survival_summary <- jmvcore::OptionBool$new(
                "show_survival_summary",
                show_survival_summary,
                default=TRUE)
            private$..show_convergence <- jmvcore::OptionBool$new(
                "show_convergence",
                show_convergence,
                default=TRUE)
            private$..plot_survival_curves <- jmvcore::OptionBool$new(
                "plot_survival_curves",
                plot_survival_curves,
                default=TRUE)
            private$..plot_variable_importance <- jmvcore::OptionBool$new(
                "plot_variable_importance",
                plot_variable_importance,
                default=TRUE)
            private$..plot_trace <- jmvcore::OptionBool$new(
                "plot_trace",
                plot_trace,
                default=FALSE)
            private$..plot_posterior_predictive <- jmvcore::OptionBool$new(
                "plot_posterior_predictive",
                plot_posterior_predictive,
                default=FALSE)
            private$..plot_partial_dependence <- jmvcore::OptionBool$new(
                "plot_partial_dependence",
                plot_partial_dependence,
                default=FALSE)
            private$..plot_interactions <- jmvcore::OptionBool$new(
                "plot_interactions",
                plot_interactions,
                default=FALSE)
            private$..probit_link <- jmvcore::OptionBool$new(
                "probit_link",
                probit_link,
                default=FALSE)
            private$..cure_fraction_prior <- jmvcore::OptionList$new(
                "cure_fraction_prior",
                cure_fraction_prior,
                options=list(
                    "uniform",
                    "jeffreys",
                    "symmetric"),
                default="uniform")
            private$..adaptive_scaling <- jmvcore::OptionBool$new(
                "adaptive_scaling",
                adaptive_scaling,
                default=TRUE)
            private$..parallel_chains <- jmvcore::OptionBool$new(
                "parallel_chains",
                parallel_chains,
                default=FALSE)
            private$..memory_optimization <- jmvcore::OptionBool$new(
                "memory_optimization",
                memory_optimization,
                default=TRUE)
            private$..random_seed <- jmvcore::OptionInteger$new(
                "random_seed",
                random_seed,
                default=123,
                min=1,
                max=999999)

            self$.addOption(private$..time)
            self$.addOption(private$..event)
            self$.addOption(private$..predictors)
            self$.addOption(private$..strata)
            self$.addOption(private$..model_type)
            self$.addOption(private$..prior_distribution)
            self$.addOption(private$..n_trees)
            self$.addOption(private$..alpha)
            self$.addOption(private$..beta)
            self$.addOption(private$..k)
            self$.addOption(private$..q)
            self$.addOption(private$..nu)
            self$.addOption(private$..n_burn)
            self$.addOption(private$..n_post)
            self$.addOption(private$..n_thin)
            self$.addOption(private$..n_chains)
            self$.addOption(private$..variable_selection)
            self$.addOption(private$..sparse_prior)
            self$.addOption(private$..selection_alpha)
            self$.addOption(private$..predict_times)
            self$.addOption(private$..survival_quantiles)
            self$.addOption(private$..credible_level)
            self$.addOption(private$..cross_validation)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..convergence_diagnostics)
            self$.addOption(private$..posterior_prediction)
            self$.addOption(private$..show_model_summary)
            self$.addOption(private$..show_variable_importance)
            self$.addOption(private$..show_survival_summary)
            self$.addOption(private$..show_convergence)
            self$.addOption(private$..plot_survival_curves)
            self$.addOption(private$..plot_variable_importance)
            self$.addOption(private$..plot_trace)
            self$.addOption(private$..plot_posterior_predictive)
            self$.addOption(private$..plot_partial_dependence)
            self$.addOption(private$..plot_interactions)
            self$.addOption(private$..probit_link)
            self$.addOption(private$..cure_fraction_prior)
            self$.addOption(private$..adaptive_scaling)
            self$.addOption(private$..parallel_chains)
            self$.addOption(private$..memory_optimization)
            self$.addOption(private$..random_seed)
        }),
    active = list(
        time = function() private$..time$value,
        event = function() private$..event$value,
        predictors = function() private$..predictors$value,
        strata = function() private$..strata$value,
        model_type = function() private$..model_type$value,
        prior_distribution = function() private$..prior_distribution$value,
        n_trees = function() private$..n_trees$value,
        alpha = function() private$..alpha$value,
        beta = function() private$..beta$value,
        k = function() private$..k$value,
        q = function() private$..q$value,
        nu = function() private$..nu$value,
        n_burn = function() private$..n_burn$value,
        n_post = function() private$..n_post$value,
        n_thin = function() private$..n_thin$value,
        n_chains = function() private$..n_chains$value,
        variable_selection = function() private$..variable_selection$value,
        sparse_prior = function() private$..sparse_prior$value,
        selection_alpha = function() private$..selection_alpha$value,
        predict_times = function() private$..predict_times$value,
        survival_quantiles = function() private$..survival_quantiles$value,
        credible_level = function() private$..credible_level$value,
        cross_validation = function() private$..cross_validation$value,
        cv_folds = function() private$..cv_folds$value,
        convergence_diagnostics = function() private$..convergence_diagnostics$value,
        posterior_prediction = function() private$..posterior_prediction$value,
        show_model_summary = function() private$..show_model_summary$value,
        show_variable_importance = function() private$..show_variable_importance$value,
        show_survival_summary = function() private$..show_survival_summary$value,
        show_convergence = function() private$..show_convergence$value,
        plot_survival_curves = function() private$..plot_survival_curves$value,
        plot_variable_importance = function() private$..plot_variable_importance$value,
        plot_trace = function() private$..plot_trace$value,
        plot_posterior_predictive = function() private$..plot_posterior_predictive$value,
        plot_partial_dependence = function() private$..plot_partial_dependence$value,
        plot_interactions = function() private$..plot_interactions$value,
        probit_link = function() private$..probit_link$value,
        cure_fraction_prior = function() private$..cure_fraction_prior$value,
        adaptive_scaling = function() private$..adaptive_scaling$value,
        parallel_chains = function() private$..parallel_chains$value,
        memory_optimization = function() private$..memory_optimization$value,
        random_seed = function() private$..random_seed$value),
    private = list(
        ..time = NA,
        ..event = NA,
        ..predictors = NA,
        ..strata = NA,
        ..model_type = NA,
        ..prior_distribution = NA,
        ..n_trees = NA,
        ..alpha = NA,
        ..beta = NA,
        ..k = NA,
        ..q = NA,
        ..nu = NA,
        ..n_burn = NA,
        ..n_post = NA,
        ..n_thin = NA,
        ..n_chains = NA,
        ..variable_selection = NA,
        ..sparse_prior = NA,
        ..selection_alpha = NA,
        ..predict_times = NA,
        ..survival_quantiles = NA,
        ..credible_level = NA,
        ..cross_validation = NA,
        ..cv_folds = NA,
        ..convergence_diagnostics = NA,
        ..posterior_prediction = NA,
        ..show_model_summary = NA,
        ..show_variable_importance = NA,
        ..show_survival_summary = NA,
        ..show_convergence = NA,
        ..plot_survival_curves = NA,
        ..plot_variable_importance = NA,
        ..plot_trace = NA,
        ..plot_posterior_predictive = NA,
        ..plot_partial_dependence = NA,
        ..plot_interactions = NA,
        ..probit_link = NA,
        ..cure_fraction_prior = NA,
        ..adaptive_scaling = NA,
        ..parallel_chains = NA,
        ..memory_optimization = NA,
        ..random_seed = NA)
)

survivalbartResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalbartResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        todo = function() private$.items[["todo"]],
        modelSummary = function() private$.items[["modelSummary"]],
        variableImportance = function() private$.items[["variableImportance"]],
        survivalSummary = function() private$.items[["survivalSummary"]],
        convergenceDiagnostics = function() private$.items[["convergenceDiagnostics"]],
        crossValidationResults = function() private$.items[["crossValidationResults"]],
        posteriorPredictive = function() private$.items[["posteriorPredictive"]],
        interactionEffects = function() private$.items[["interactionEffects"]],
        survivalCurvesPlot = function() private$.items[["survivalCurvesPlot"]],
        variableImportancePlot = function() private$.items[["variableImportancePlot"]],
        tracePlot = function() private$.items[["tracePlot"]],
        posteriorPredictivePlot = function() private$.items[["posteriorPredictivePlot"]],
        partialDependencePlot = function() private$.items[["partialDependencePlot"]],
        interactionsPlot = function() private$.items[["interactionsPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Analysis Results",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Todo",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelSummary",
                title="BART Model Summary",
                visible="(show_model_summary)",
                clearWith=list(
                    "time",
                    "event",
                    "predictors",
                    "model_type",
                    "n_trees",
                    "n_burn",
                    "n_post"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Posterior Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Posterior SD", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="effective_sample_size", 
                        `title`="ESS", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="variableImportance",
                title="Variable Importance",
                visible="(show_variable_importance)",
                clearWith=list(
                    "predictors",
                    "variable_selection",
                    "n_post"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="inclusion_probability", 
                        `title`="Inclusion Probability", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="split_frequency", 
                        `title`="Split Frequency", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="relative_importance", 
                        `title`="Relative Importance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="marginal_effect", 
                        `title`="Marginal Effect", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="importance_rank", 
                        `title`="Rank", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="survivalSummary",
                title="Survival Function Summary",
                visible="(show_survival_summary)",
                clearWith=list(
                    "time",
                    "event",
                    "predict_times",
                    "survival_quantiles"),
                columns=list(
                    list(
                        `name`="summary_type", 
                        `title`="Summary Type", 
                        `type`="text"),
                    list(
                        `name`="time_point", 
                        `title`="Time Point", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="posterior_sd", 
                        `title`="SD", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="convergenceDiagnostics",
                title="MCMC Convergence Diagnostics",
                visible="(show_convergence)",
                clearWith=list(
                    "n_chains",
                    "n_burn",
                    "n_post",
                    "convergence_diagnostics"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="rhat", 
                        `title`="R\u0302", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="effective_sample_size", 
                        `title`="ESS", 
                        `type`="integer"),
                    list(
                        `name`="mcmc_se", 
                        `title`="MCMC SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="autocorr_lag1", 
                        `title`="Autocorr (lag 1)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="convergence_status", 
                        `title`="Status", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="crossValidationResults",
                title="Cross-Validation Results",
                visible="(cross_validation)",
                clearWith=list(
                    "cv_folds",
                    "cross_validation"),
                columns=list(
                    list(
                        `name`="fold", 
                        `title`="Fold", 
                        `type`="integer"),
                    list(
                        `name`="log_likelihood", 
                        `title`="Log-Likelihood", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="c_index", 
                        `title`="C-Index", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="brier_score", 
                        `title`="Brier Score", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="prediction_error", 
                        `title`="Prediction Error", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="posteriorPredictive",
                title="Posterior Predictive Checks",
                visible="(posterior_prediction)",
                clearWith=list(
                    "posterior_prediction",
                    "model_type"),
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="text"),
                    list(
                        `name`="observed_value", 
                        `title`="Observed", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Posterior Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Posterior SD", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="Bayesian p-value", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="interactionEffects",
                title="Detected Interactions",
                visible="(n_trees >= 100)",
                clearWith=list(
                    "predictors",
                    "alpha",
                    "beta"),
                columns=list(
                    list(
                        `name`="variable1", 
                        `title`="Variable 1", 
                        `type`="text"),
                    list(
                        `name`="variable2", 
                        `title`="Variable 2", 
                        `type`="text"),
                    list(
                        `name`="interaction_strength", 
                        `title`="Interaction Strength", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="frequency", 
                        `title`="Frequency", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="marginal_contribution", 
                        `title`="Marginal Contribution", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="survivalCurvesPlot",
                title="Survival Curves with Credible Bands",
                width=600,
                height=500,
                visible="(plot_survival_curves)",
                requiresData=TRUE,
                clearWith=list(
                    "time",
                    "event",
                    "credible_level")))
            self$add(jmvcore::Image$new(
                options=options,
                name="variableImportancePlot",
                title="Variable Importance",
                width=500,
                height=400,
                visible="(plot_variable_importance)",
                requiresData=TRUE,
                clearWith=list(
                    "variable_selection",
                    "predictors")))
            self$add(jmvcore::Image$new(
                options=options,
                name="tracePlot",
                title="MCMC Trace Plots",
                width=600,
                height=500,
                visible="(plot_trace)",
                requiresData=TRUE,
                clearWith=list(
                    "n_chains",
                    "n_burn",
                    "n_post")))
            self$add(jmvcore::Image$new(
                options=options,
                name="posteriorPredictivePlot",
                title="Posterior Predictive Checks",
                width=500,
                height=400,
                visible="(plot_posterior_predictive)",
                requiresData=TRUE,
                clearWith=list(
                    "posterior_prediction")))
            self$add(jmvcore::Image$new(
                options=options,
                name="partialDependencePlot",
                title="Partial Dependence Effects",
                width=600,
                height=500,
                visible="(plot_partial_dependence)",
                requiresData=TRUE,
                clearWith=list(
                    "predictors",
                    "variable_selection")))
            self$add(jmvcore::Image$new(
                options=options,
                name="interactionsPlot",
                title="Variable Interactions",
                width=500,
                height=400,
                visible="(plot_interactions)",
                requiresData=TRUE,
                clearWith=list(
                    "predictors",
                    "alpha",
                    "beta")))}))

survivalbartBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalbartBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "survivalbart",
                version = c(0,0,31),
                options = options,
                results = survivalbartResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Bayesian Additive Regression Trees (BART) for Survival
#'
#' Bayesian Additive Regression Trees (BART) for survival analysis providing 
#' flexible nonparametric modeling with automatic variable selection and 
#' interaction detection. BART combines an ensemble of weak learners (trees) 
#' with Bayesian priors to create a powerful predictive model that naturally 
#' handles nonlinear relationships, interactions, and variable selection 
#' without requiring preprocessing. The method provides full posterior 
#' distributions for predictions, built-in uncertainty quantification, and 
#' robust performance across diverse survival scenarios. Particularly 
#' effective for complex survival data with unknown functional forms, 
#' high-dimensional predictors, mixed variable types, and scenarios requiring 
#' individualized survival predictions with credible intervals. Implementation 
#' supports both accelerated failure time and proportional hazards 
#' formulations with comprehensive posterior inference and model diagnostics.
#' 
#'
#' @examples
#' result <- survivalbart(
#'     data = mydata,
#'     time = "time_to_event",
#'     event = "event_indicator",
#'     predictors = c("age", "stage", "biomarker1", "biomarker2"),
#'     model_type = "aft",
#'     n_trees = 200,
#'     n_burn = 1000,
#'     n_post = 2000
#' )
#'
#' @param data The data as a data frame.
#' @param time Time to event variable (numeric). For right-censored data, this
#'   is the  time from study entry to event or censoring.
#' @param event Event indicator variable. For survival analysis: 0 = censored,
#'   1 = event. Binary coding required for current BART implementation.
#' @param predictors Variables to include in the BART survival model. Can
#'   include numeric, ordinal, and nominal variables. BART automatically handles
#'   variable types and interactions without preprocessing.
#' @param strata Optional stratification variable for stratified survival
#'   analysis. Creates separate BART models for each stratum.
#' @param model_type Type of survival model. AFT models log-survival times
#'   directly, PH models log-hazard ratios, cure models handle long-term
#'   survivors with mixture of cured and susceptible populations.
#' @param prior_distribution Prior distribution for error terms in AFT model.
#'   Normal corresponds to log-normal survival times, extreme value to Weibull
#'   survival, logistic to log-logistic survival.
#' @param n_trees Number of trees in the BART ensemble. More trees provide
#'   greater flexibility but increase computation time. 100-300 is typical
#'   range.
#' @param alpha Controls tree depth through splitting probability. Higher
#'   values favor shallower trees, lower values allow deeper trees and more
#'   complex interactions.
#' @param beta Controls tree depth through splitting probability formula.
#'   Higher values discourage deep splits, promoting simpler trees.
#' @param k Scale parameter for terminal node prior. Controls magnitude of
#'   individual tree contributions to overall ensemble.
#' @param q Quantile for error variance prior specification. Higher values
#'   assume less noise in the survival process.
#' @param nu Degrees of freedom for inverse chi-square prior on error
#'   variance. Lower values allow more uncertainty in variance estimation.
#' @param n_burn Number of burn-in MCMC iterations to discard. Should be
#'   sufficient for convergence to stationary distribution.
#' @param n_post Number of posterior MCMC iterations to keep for inference.
#'   More iterations provide more precise posterior estimates.
#' @param n_thin Keep every nth posterior sample to reduce autocorrelation.
#'   Higher values reduce effective sample size but may improve mixing.
#' @param n_chains Number of independent MCMC chains. Multiple chains enable
#'   convergence diagnostics and robust posterior inference.
#' @param variable_selection Include variable selection probabilities in BART
#'   model. Automatically identifies relevant predictors and reduces overfitting
#'   with irrelevant variables.
#' @param sparse_prior Use sparse Dirichlet prior for variable selection
#'   probabilities. Promotes sparser models with fewer active variables.
#' @param selection_alpha Concentration parameter for Dirichlet prior on
#'   variable selection probabilities. Higher values favor uniform selection.
#' @param predict_times Comma-separated list of time points for survival
#'   probability predictions. Empty string uses data-driven quantiles.
#' @param survival_quantiles Comma-separated list of quantiles for survival
#'   time predictions. Provides percentile-based survival time estimates.
#' @param credible_level Level for posterior credible intervals on all
#'   estimates. 0.95 provides 95\% credible intervals.
#' @param cross_validation Perform k-fold cross-validation to assess
#'   out-of-sample performance and model generalization.
#' @param cv_folds Number of folds for cross-validation. More folds provide
#'   better performance estimates but increase computation.
#' @param convergence_diagnostics Compute MCMC convergence diagnostics
#'   including effective sample sizes, autocorrelation, and potential scale
#'   reduction.
#' @param posterior_prediction Perform posterior predictive checks to assess
#'   model adequacy by comparing observed data to posterior predictive
#'   distributions.
#' @param show_model_summary Display comprehensive model summary including
#'   BART parameters, convergence diagnostics, and posterior summaries.
#' @param show_variable_importance Display variable importance measures based
#'   on selection frequencies and splitting criteria across all trees.
#' @param show_survival_summary Display survival function summaries including
#'   median survival times and survival probabilities at key time points.
#' @param show_convergence Display MCMC convergence diagnostics and chain
#'   mixing assessment for model validation.
#' @param plot_survival_curves Plot individual and population-level survival
#'   curves with posterior credible bands showing uncertainty.
#' @param plot_variable_importance Create variable importance plot showing
#'   inclusion probabilities and splitting frequencies across the ensemble.
#' @param plot_trace Generate trace plots for key model parameters to assess
#'   MCMC convergence and mixing.
#' @param plot_posterior_predictive Create posterior predictive check plots
#'   comparing observed survival patterns to model predictions.
#' @param plot_partial_dependence Generate partial dependence plots showing
#'   marginal effects of individual variables on survival hazard.
#' @param plot_interactions Visualize detected interactions between variables
#'   with strength and confidence measures.
#' @param probit_link Use probit link for binary outcomes in cure models.
#'   Alternative to logit link for mixture component modeling.
#' @param cure_fraction_prior Prior distribution for cure fraction in cure
#'   models. Uniform is non-informative, Jeffreys is scale-invariant.
#' @param adaptive_scaling Use adaptive scaling of MCMC proposals to optimize
#'   acceptance rates and improve sampling efficiency.
#' @param parallel_chains Run MCMC chains in parallel for faster computation
#'   when multiple chains are specified.
#' @param memory_optimization Use memory-efficient storage for large ensembles
#'   and datasets to reduce memory footprint.
#' @param random_seed Random seed for reproducible MCMC sampling and tree
#'   ensemble generation.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$variableImportance} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survivalSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$convergenceDiagnostics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crossValidationResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$posteriorPredictive} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interactionEffects} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survivalCurvesPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$variableImportancePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$tracePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$posteriorPredictivePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$partialDependencePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$interactionsPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelSummary$asDF}
#'
#' \code{as.data.frame(results$modelSummary)}
#'
#' @export
survivalbart <- function(
    data,
    time,
    event,
    predictors,
    strata,
    model_type = "aft",
    prior_distribution = "normal",
    n_trees = 200,
    alpha = 0.95,
    beta = 2,
    k = 2,
    q = 0.9,
    nu = 3,
    n_burn = 1000,
    n_post = 2000,
    n_thin = 1,
    n_chains = 1,
    variable_selection = TRUE,
    sparse_prior = FALSE,
    selection_alpha = 1,
    predict_times = "1, 2, 5",
    survival_quantiles = "0.25, 0.5, 0.75",
    credible_level = 0.95,
    cross_validation = FALSE,
    cv_folds = 5,
    convergence_diagnostics = TRUE,
    posterior_prediction = FALSE,
    show_model_summary = TRUE,
    show_variable_importance = TRUE,
    show_survival_summary = TRUE,
    show_convergence = TRUE,
    plot_survival_curves = TRUE,
    plot_variable_importance = TRUE,
    plot_trace = FALSE,
    plot_posterior_predictive = FALSE,
    plot_partial_dependence = FALSE,
    plot_interactions = FALSE,
    probit_link = FALSE,
    cure_fraction_prior = "uniform",
    adaptive_scaling = TRUE,
    parallel_chains = FALSE,
    memory_optimization = TRUE,
    random_seed = 123) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("survivalbart requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time)) time <- jmvcore::resolveQuo(jmvcore::enquo(time))
    if ( ! missing(event)) event <- jmvcore::resolveQuo(jmvcore::enquo(event))
    if ( ! missing(predictors)) predictors <- jmvcore::resolveQuo(jmvcore::enquo(predictors))
    if ( ! missing(strata)) strata <- jmvcore::resolveQuo(jmvcore::enquo(strata))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time), time, NULL),
            `if`( ! missing(event), event, NULL),
            `if`( ! missing(predictors), predictors, NULL),
            `if`( ! missing(strata), strata, NULL))

    for (v in strata) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- survivalbartOptions$new(
        time = time,
        event = event,
        predictors = predictors,
        strata = strata,
        model_type = model_type,
        prior_distribution = prior_distribution,
        n_trees = n_trees,
        alpha = alpha,
        beta = beta,
        k = k,
        q = q,
        nu = nu,
        n_burn = n_burn,
        n_post = n_post,
        n_thin = n_thin,
        n_chains = n_chains,
        variable_selection = variable_selection,
        sparse_prior = sparse_prior,
        selection_alpha = selection_alpha,
        predict_times = predict_times,
        survival_quantiles = survival_quantiles,
        credible_level = credible_level,
        cross_validation = cross_validation,
        cv_folds = cv_folds,
        convergence_diagnostics = convergence_diagnostics,
        posterior_prediction = posterior_prediction,
        show_model_summary = show_model_summary,
        show_variable_importance = show_variable_importance,
        show_survival_summary = show_survival_summary,
        show_convergence = show_convergence,
        plot_survival_curves = plot_survival_curves,
        plot_variable_importance = plot_variable_importance,
        plot_trace = plot_trace,
        plot_posterior_predictive = plot_posterior_predictive,
        plot_partial_dependence = plot_partial_dependence,
        plot_interactions = plot_interactions,
        probit_link = probit_link,
        cure_fraction_prior = cure_fraction_prior,
        adaptive_scaling = adaptive_scaling,
        parallel_chains = parallel_chains,
        memory_optimization = memory_optimization,
        random_seed = random_seed)

    analysis <- survivalbartClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

