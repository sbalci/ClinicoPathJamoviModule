
# This file is automatically generated, you probably don't want to edit this

datetimeconverterOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "datetimeconverterOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            datetime_var = NULL,
            datetime_format = "auto",
            timezone = "system",
            preview_rows = 20,
            extract_year = FALSE,
            extract_month = FALSE,
            extract_monthname = FALSE,
            extract_day = FALSE,
            extract_hour = FALSE,
            extract_minute = FALSE,
            extract_second = FALSE,
            extract_dayname = FALSE,
            extract_weeknum = FALSE,
            extract_quarter = FALSE,
            extract_dayofyear = FALSE,
            show_quality_metrics = FALSE,
            show_summary = FALSE,
            show_explanations = FALSE,
            show_glossary = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="datetimeconverter",
                requiresData=TRUE,
                ...)

            private$..datetime_var <- jmvcore::OptionVariable$new(
                "datetime_var",
                datetime_var,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..datetime_format <- jmvcore::OptionList$new(
                "datetime_format",
                datetime_format,
                options=list(
                    "auto",
                    "ymdhms",
                    "ymd",
                    "dmy",
                    "mdy",
                    "dmyhms",
                    "mdyhms",
                    "dmyhm",
                    "mdyhm",
                    "ymdhm",
                    "ydm",
                    "myd",
                    "dym"),
                default="auto")
            private$..timezone <- jmvcore::OptionList$new(
                "timezone",
                timezone,
                options=list(
                    "system",
                    "utc"),
                default="system")
            private$..preview_rows <- jmvcore::OptionNumber$new(
                "preview_rows",
                preview_rows,
                min=10,
                max=100,
                default=20)
            private$..extract_year <- jmvcore::OptionBool$new(
                "extract_year",
                extract_year,
                default=FALSE)
            private$..extract_month <- jmvcore::OptionBool$new(
                "extract_month",
                extract_month,
                default=FALSE)
            private$..extract_monthname <- jmvcore::OptionBool$new(
                "extract_monthname",
                extract_monthname,
                default=FALSE)
            private$..extract_day <- jmvcore::OptionBool$new(
                "extract_day",
                extract_day,
                default=FALSE)
            private$..extract_hour <- jmvcore::OptionBool$new(
                "extract_hour",
                extract_hour,
                default=FALSE)
            private$..extract_minute <- jmvcore::OptionBool$new(
                "extract_minute",
                extract_minute,
                default=FALSE)
            private$..extract_second <- jmvcore::OptionBool$new(
                "extract_second",
                extract_second,
                default=FALSE)
            private$..extract_dayname <- jmvcore::OptionBool$new(
                "extract_dayname",
                extract_dayname,
                default=FALSE)
            private$..extract_weeknum <- jmvcore::OptionBool$new(
                "extract_weeknum",
                extract_weeknum,
                default=FALSE)
            private$..extract_quarter <- jmvcore::OptionBool$new(
                "extract_quarter",
                extract_quarter,
                default=FALSE)
            private$..extract_dayofyear <- jmvcore::OptionBool$new(
                "extract_dayofyear",
                extract_dayofyear,
                default=FALSE)
            private$..show_quality_metrics <- jmvcore::OptionBool$new(
                "show_quality_metrics",
                show_quality_metrics,
                default=FALSE)
            private$..show_summary <- jmvcore::OptionBool$new(
                "show_summary",
                show_summary,
                default=FALSE)
            private$..show_explanations <- jmvcore::OptionBool$new(
                "show_explanations",
                show_explanations,
                default=FALSE)
            private$..show_glossary <- jmvcore::OptionBool$new(
                "show_glossary",
                show_glossary,
                default=FALSE)
            private$..corrected_datetime_char <- jmvcore::OptionOutput$new(
                "corrected_datetime_char")
            private$..corrected_datetime_numeric <- jmvcore::OptionOutput$new(
                "corrected_datetime_numeric")
            private$..year_out <- jmvcore::OptionOutput$new(
                "year_out")
            private$..month_out <- jmvcore::OptionOutput$new(
                "month_out")
            private$..monthname_out <- jmvcore::OptionOutput$new(
                "monthname_out")
            private$..day_out <- jmvcore::OptionOutput$new(
                "day_out")
            private$..hour_out <- jmvcore::OptionOutput$new(
                "hour_out")
            private$..minute_out <- jmvcore::OptionOutput$new(
                "minute_out")
            private$..second_out <- jmvcore::OptionOutput$new(
                "second_out")
            private$..dayname_out <- jmvcore::OptionOutput$new(
                "dayname_out")
            private$..weeknum_out <- jmvcore::OptionOutput$new(
                "weeknum_out")
            private$..quarter_out <- jmvcore::OptionOutput$new(
                "quarter_out")
            private$..dayofyear_out <- jmvcore::OptionOutput$new(
                "dayofyear_out")

            self$.addOption(private$..datetime_var)
            self$.addOption(private$..datetime_format)
            self$.addOption(private$..timezone)
            self$.addOption(private$..preview_rows)
            self$.addOption(private$..extract_year)
            self$.addOption(private$..extract_month)
            self$.addOption(private$..extract_monthname)
            self$.addOption(private$..extract_day)
            self$.addOption(private$..extract_hour)
            self$.addOption(private$..extract_minute)
            self$.addOption(private$..extract_second)
            self$.addOption(private$..extract_dayname)
            self$.addOption(private$..extract_weeknum)
            self$.addOption(private$..extract_quarter)
            self$.addOption(private$..extract_dayofyear)
            self$.addOption(private$..show_quality_metrics)
            self$.addOption(private$..show_summary)
            self$.addOption(private$..show_explanations)
            self$.addOption(private$..show_glossary)
            self$.addOption(private$..corrected_datetime_char)
            self$.addOption(private$..corrected_datetime_numeric)
            self$.addOption(private$..year_out)
            self$.addOption(private$..month_out)
            self$.addOption(private$..monthname_out)
            self$.addOption(private$..day_out)
            self$.addOption(private$..hour_out)
            self$.addOption(private$..minute_out)
            self$.addOption(private$..second_out)
            self$.addOption(private$..dayname_out)
            self$.addOption(private$..weeknum_out)
            self$.addOption(private$..quarter_out)
            self$.addOption(private$..dayofyear_out)
        }),
    active = list(
        datetime_var = function() private$..datetime_var$value,
        datetime_format = function() private$..datetime_format$value,
        timezone = function() private$..timezone$value,
        preview_rows = function() private$..preview_rows$value,
        extract_year = function() private$..extract_year$value,
        extract_month = function() private$..extract_month$value,
        extract_monthname = function() private$..extract_monthname$value,
        extract_day = function() private$..extract_day$value,
        extract_hour = function() private$..extract_hour$value,
        extract_minute = function() private$..extract_minute$value,
        extract_second = function() private$..extract_second$value,
        extract_dayname = function() private$..extract_dayname$value,
        extract_weeknum = function() private$..extract_weeknum$value,
        extract_quarter = function() private$..extract_quarter$value,
        extract_dayofyear = function() private$..extract_dayofyear$value,
        show_quality_metrics = function() private$..show_quality_metrics$value,
        show_summary = function() private$..show_summary$value,
        show_explanations = function() private$..show_explanations$value,
        show_glossary = function() private$..show_glossary$value,
        corrected_datetime_char = function() private$..corrected_datetime_char$value,
        corrected_datetime_numeric = function() private$..corrected_datetime_numeric$value,
        year_out = function() private$..year_out$value,
        month_out = function() private$..month_out$value,
        monthname_out = function() private$..monthname_out$value,
        day_out = function() private$..day_out$value,
        hour_out = function() private$..hour_out$value,
        minute_out = function() private$..minute_out$value,
        second_out = function() private$..second_out$value,
        dayname_out = function() private$..dayname_out$value,
        weeknum_out = function() private$..weeknum_out$value,
        quarter_out = function() private$..quarter_out$value,
        dayofyear_out = function() private$..dayofyear_out$value),
    private = list(
        ..datetime_var = NA,
        ..datetime_format = NA,
        ..timezone = NA,
        ..preview_rows = NA,
        ..extract_year = NA,
        ..extract_month = NA,
        ..extract_monthname = NA,
        ..extract_day = NA,
        ..extract_hour = NA,
        ..extract_minute = NA,
        ..extract_second = NA,
        ..extract_dayname = NA,
        ..extract_weeknum = NA,
        ..extract_quarter = NA,
        ..extract_dayofyear = NA,
        ..show_quality_metrics = NA,
        ..show_summary = NA,
        ..show_explanations = NA,
        ..show_glossary = NA,
        ..corrected_datetime_char = NA,
        ..corrected_datetime_numeric = NA,
        ..year_out = NA,
        ..month_out = NA,
        ..monthname_out = NA,
        ..day_out = NA,
        ..hour_out = NA,
        ..minute_out = NA,
        ..second_out = NA,
        ..dayname_out = NA,
        ..weeknum_out = NA,
        ..quarter_out = NA,
        ..dayofyear_out = NA)
)

datetimeconverterResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "datetimeconverterResults",
    inherit = jmvcore::Group,
    active = list(
        welcome = function() private$.items[["welcome"]],
        formatInfo = function() private$.items[["formatInfo"]],
        qualityMetrics = function() private$.items[["qualityMetrics"]],
        previewTable = function() private$.items[["previewTable"]],
        componentPreview = function() private$.items[["componentPreview"]],
        qualityAssessment = function() private$.items[["qualityAssessment"]],
        nlSummary = function() private$.items[["nlSummary"]],
        aboutPanel = function() private$.items[["aboutPanel"]],
        caveatsPanel = function() private$.items[["caveatsPanel"]],
        glossaryPanel = function() private$.items[["glossaryPanel"]],
        corrected_datetime_char = function() private$.items[["corrected_datetime_char"]],
        corrected_datetime_numeric = function() private$.items[["corrected_datetime_numeric"]],
        year_out = function() private$.items[["year_out"]],
        month_out = function() private$.items[["month_out"]],
        monthname_out = function() private$.items[["monthname_out"]],
        day_out = function() private$.items[["day_out"]],
        hour_out = function() private$.items[["hour_out"]],
        minute_out = function() private$.items[["minute_out"]],
        second_out = function() private$.items[["second_out"]],
        dayname_out = function() private$.items[["dayname_out"]],
        weeknum_out = function() private$.items[["weeknum_out"]],
        quarter_out = function() private$.items[["quarter_out"]],
        dayofyear_out = function() private$.items[["dayofyear_out"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="DateTime Converter",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "lubridate",
                    "glue"))
            self$add(jmvcore::Html$new(
                options=options,
                name="welcome",
                title="Getting Started"))
            self$add(jmvcore::Html$new(
                options=options,
                name="formatInfo",
                title="Format Detection"))
            self$add(jmvcore::Html$new(
                options=options,
                name="qualityMetrics",
                title="Quality Assessment"))
            self$add(jmvcore::Html$new(
                options=options,
                name="previewTable",
                title="Conversion Preview"))
            self$add(jmvcore::Html$new(
                options=options,
                name="componentPreview",
                title="Extracted Components Preview"))
            self$add(jmvcore::Html$new(
                options=options,
                name="qualityAssessment",
                title="Data Quality Assessment",
                visible="(show_quality_metrics)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="nlSummary",
                title="Summary (Copy-Ready)",
                visible="(show_summary)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="aboutPanel",
                title="About This Analysis",
                visible="(show_explanations)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="caveatsPanel",
                title="Caveats & Assumptions",
                visible="(show_explanations)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="glossaryPanel",
                title="Key Terms & Concepts",
                visible="(show_glossary)"))
            self$add(jmvcore::Output$new(
                options=options,
                name="corrected_datetime_char",
                title="Corrected DateTime (Text)",
                varTitle="Corrected DateTime (Text)",
                varDescription="DateTime variable converted to standardized format (as character string)",
                measureType="nominal",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="corrected_datetime_numeric",
                title="Corrected DateTime (Numeric)",
                varTitle="`Corrected DateTime Numeric - from ${ datetime_var }`",
                varDescription="`DateTime variable ${ datetime_var } as Unix epoch seconds for calculations`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="year_out",
                title="Year",
                varTitle="`Year - from ${ datetime_var }`",
                varDescription="`Extracted year component from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="month_out",
                title="Month",
                varTitle="`Month - from ${ datetime_var }`",
                varDescription="`Extracted month component (1-12) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format",
                    "month_out")))
            self$add(jmvcore::Output$new(
                options=options,
                name="monthname_out",
                title="Month Name",
                varTitle="`Month Name - from ${ datetime_var }`",
                varDescription="`Extracted month name from ${ datetime_var }`",
                measureType="nominal",
                clearWith=list(
                    "datetime_var",
                    "datetime_format",
                    "monthname_out")))
            self$add(jmvcore::Output$new(
                options=options,
                name="day_out",
                title="Day",
                varTitle="`Day - from ${ datetime_var }`",
                varDescription="`Extracted day of month (1-31) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="hour_out",
                title="Hour",
                varTitle="`Hour - from ${ datetime_var }`",
                varDescription="`Extracted hour component (0-23) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="minute_out",
                title="Minute",
                varTitle="`Minute - from ${ datetime_var }`",
                varDescription="`Extracted minute component (0-59) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="second_out",
                title="Second",
                varTitle="`Second - from ${ datetime_var }`",
                varDescription="`Extracted second component (0-59) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="dayname_out",
                title="Day Name",
                varTitle="`Day Name - from ${ datetime_var }`",
                varDescription="`Extracted day of week name from ${ datetime_var }`",
                measureType="nominal",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="weeknum_out",
                title="Week Number",
                varTitle="`Week Number - from ${ datetime_var }`",
                varDescription="`Extracted week number of year (1-53) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="quarter_out",
                title="Quarter",
                varTitle="`Quarter - from ${ datetime_var }`",
                varDescription="`Extracted quarter (1-4) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))
            self$add(jmvcore::Output$new(
                options=options,
                name="dayofyear_out",
                title="Day of Year",
                varTitle="`Day of Year - from ${ datetime_var }`",
                varDescription="`Extracted day of year (1-366) from ${ datetime_var }`",
                measureType="continuous",
                clearWith=list(
                    "datetime_var",
                    "datetime_format")))}))

datetimeconverterBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "datetimeconverterBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "datetimeconverter",
                version = c(0,0,31),
                options = options,
                results = datetimeconverterResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'none')
        }))

#' DateTime Converter
#'
#' Convert datetime variables to standardized format and extract datetime 
#' components (year, month, day, hour, minute, day name, week number, quarter, 
#' etc.). Features automatic format detection, quality assessment, and preview 
#' of converted data. Perfect for preparing datetime data for analysis and 
#' creating time-based variables.
#'
#' @examples
#' # Basic datetime conversion: '0.0.31'
#' datetimeconverter(
#'   data = study_data,
#'   datetime_var = "event_date",
#'   datetime_format = "auto"
#' )
#'
#' # Extract components:
#' datetimeconverter(
#'   data = study_data,
#'   datetime_var = "timestamp",
#'   datetime_format = "ymd_hms",
#'   extract_year = TRUE,
#'   extract_month = TRUE,
#'   extract_dayname = TRUE
#' )
#'
#' @param data The data as a data frame containing datetime variable to
#'   convert.
#' @param datetime_var Variable containing datetime information in various
#'   formats. Can handle character strings, numeric values, or factors with
#'   datetime representations.
#' @param datetime_format DateTime format specification. 'Auto-detect'
#'   attempts to identify the format automatically. Manual selection ensures
#'   accurate parsing for specific datetime formats.
#' @param timezone Timezone for datetime parsing. 'System Default' uses your
#'   computer's timezone. 'UTC' interprets datetimes as Coordinated Universal
#'   Time. Note: Excel serial and Unix epoch conversions always use UTC
#'   regardless of this setting.
#' @param preview_rows Number of rows to display in preview tables. Shows
#'   original values, corrected datetimes, and extracted components for quality
#'   checking.
#' @param extract_year Extract and display year component in preview table.
#' @param extract_month Extract and display month component in preview table.
#' @param extract_monthname Extract and display month name in preview table.
#' @param extract_day Extract and display day component in preview table.
#' @param extract_hour Extract and display hour component in preview table.
#' @param extract_minute Extract and display minute component in preview
#'   table.
#' @param extract_second Extract and display second component in preview
#'   table.
#' @param extract_dayname Extract and display day name in preview table.
#' @param extract_weeknum Extract and display week number in preview table.
#' @param extract_quarter Extract and display quarter in preview table.
#' @param extract_dayofyear Extract and display day of year in preview table.
#' @param show_quality_metrics Display comprehensive quality metrics including
#'   parsing success rate, invalid dates, and data quality warnings.
#' @param show_summary Generate a plain-language summary suitable for copying
#'   into reports or clinical documentation.
#' @param show_explanations Display educational content explaining what this
#'   function does, when to use it, and how to interpret results.
#' @param show_glossary Display definitions of datetime-related terms (Excel
#'   serial dates, Unix epoch, timezones, etc.) to aid interpretation.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$welcome} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$formatInfo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$qualityMetrics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$previewTable} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$componentPreview} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$qualityAssessment} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$nlSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$aboutPanel} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$caveatsPanel} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$glossaryPanel} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$corrected_datetime_char} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$corrected_datetime_numeric} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$year_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$month_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$monthname_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$day_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$hour_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$minute_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$second_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$dayname_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$weeknum_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$quarter_out} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$dayofyear_out} \tab \tab \tab \tab \tab an output \cr
#' }
#'
#' @export
datetimeconverter <- function(
    data,
    datetime_var,
    datetime_format = "auto",
    timezone = "system",
    preview_rows = 20,
    extract_year = FALSE,
    extract_month = FALSE,
    extract_monthname = FALSE,
    extract_day = FALSE,
    extract_hour = FALSE,
    extract_minute = FALSE,
    extract_second = FALSE,
    extract_dayname = FALSE,
    extract_weeknum = FALSE,
    extract_quarter = FALSE,
    extract_dayofyear = FALSE,
    show_quality_metrics = FALSE,
    show_summary = FALSE,
    show_explanations = FALSE,
    show_glossary = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("datetimeconverter requires jmvcore to be installed (restart may be required)")

    if ( ! missing(datetime_var)) datetime_var <- jmvcore::resolveQuo(jmvcore::enquo(datetime_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(datetime_var), datetime_var, NULL))


    options <- datetimeconverterOptions$new(
        datetime_var = datetime_var,
        datetime_format = datetime_format,
        timezone = timezone,
        preview_rows = preview_rows,
        extract_year = extract_year,
        extract_month = extract_month,
        extract_monthname = extract_monthname,
        extract_day = extract_day,
        extract_hour = extract_hour,
        extract_minute = extract_minute,
        extract_second = extract_second,
        extract_dayname = extract_dayname,
        extract_weeknum = extract_weeknum,
        extract_quarter = extract_quarter,
        extract_dayofyear = extract_dayofyear,
        show_quality_metrics = show_quality_metrics,
        show_summary = show_summary,
        show_explanations = show_explanations,
        show_glossary = show_glossary)

    analysis <- datetimeconverterClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

