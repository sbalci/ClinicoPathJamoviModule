
# This file is automatically generated, you probably don't want to edit this

advancedimputationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedimputationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            imputation_vars = NULL,
            auxiliary_vars = NULL,
            cluster_var = NULL,
            id_var = NULL,
            n_imputations = 10,
            n_iterations = 10,
            convergence_check = TRUE,
            imputation_method = "pmm",
            categorical_method = "logreg",
            mnar_methods = FALSE,
            mnar_type = "delta_adjustment",
            delta_values = "0",
            sensitivity_analysis = TRUE,
            sensitivity_methods = "all",
            multilevel_imputation = FALSE,
            level1_vars = NULL,
            level2_vars = NULL,
            min_bucket_size = 5,
            exclude_vars = NULL,
            passive_imputation = NULL,
            ridge_penalty = 0.00001,
            remove_collinear = TRUE,
            collinearity_threshold = 0.95,
            diagnostic_plots = TRUE,
            imputation_quality = TRUE,
            cross_validation = FALSE,
            ampute_test = FALSE,
            save_imputations = FALSE,
            pool_results = TRUE,
            show_detailed_output = TRUE,
            regulatory_report = FALSE,
            random_seed = 123, ...) {

            super$initialize(
                package="ClinicoPath",
                name="advancedimputation",
                requiresData=TRUE,
                ...)

            private$..imputation_vars <- jmvcore::OptionVariables$new(
                "imputation_vars",
                imputation_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..auxiliary_vars <- jmvcore::OptionVariables$new(
                "auxiliary_vars",
                auxiliary_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..cluster_var <- jmvcore::OptionVariable$new(
                "cluster_var",
                cluster_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..id_var <- jmvcore::OptionVariable$new(
                "id_var",
                id_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "id"))
            private$..n_imputations <- jmvcore::OptionInteger$new(
                "n_imputations",
                n_imputations,
                min=3,
                max=100,
                default=10)
            private$..n_iterations <- jmvcore::OptionInteger$new(
                "n_iterations",
                n_iterations,
                min=1,
                max=100,
                default=10)
            private$..convergence_check <- jmvcore::OptionBool$new(
                "convergence_check",
                convergence_check,
                default=TRUE)
            private$..imputation_method <- jmvcore::OptionList$new(
                "imputation_method",
                imputation_method,
                options=list(
                    "pmm",
                    "norm",
                    "norm.boot",
                    "norm.nob",
                    "mean",
                    "2l.norm",
                    "2l.pmm",
                    "quadratic",
                    "rf"),
                default="pmm")
            private$..categorical_method <- jmvcore::OptionList$new(
                "categorical_method",
                categorical_method,
                options=list(
                    "logreg",
                    "polyreg",
                    "polr",
                    "lda",
                    "2l.bin",
                    "rf"),
                default="logreg")
            private$..mnar_methods <- jmvcore::OptionBool$new(
                "mnar_methods",
                mnar_methods,
                default=FALSE)
            private$..mnar_type <- jmvcore::OptionList$new(
                "mnar_type",
                mnar_type,
                options=list(
                    "delta_adjustment",
                    "pattern_mixture",
                    "selection_model",
                    "reference_based"),
                default="delta_adjustment")
            private$..delta_values <- jmvcore::OptionString$new(
                "delta_values",
                delta_values,
                default="0")
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=TRUE)
            private$..sensitivity_methods <- jmvcore::OptionList$new(
                "sensitivity_methods",
                sensitivity_methods,
                options=list(
                    "multiple_methods",
                    "parameter_variation",
                    "assumption_testing",
                    "all"),
                default="all")
            private$..multilevel_imputation <- jmvcore::OptionBool$new(
                "multilevel_imputation",
                multilevel_imputation,
                default=FALSE)
            private$..level1_vars <- jmvcore::OptionVariables$new(
                "level1_vars",
                level1_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..level2_vars <- jmvcore::OptionVariables$new(
                "level2_vars",
                level2_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..min_bucket_size <- jmvcore::OptionInteger$new(
                "min_bucket_size",
                min_bucket_size,
                min=1,
                max=20,
                default=5)
            private$..exclude_vars <- jmvcore::OptionVariables$new(
                "exclude_vars",
                exclude_vars)
            private$..passive_imputation <- jmvcore::OptionString$new(
                "passive_imputation",
                passive_imputation)
            private$..ridge_penalty <- jmvcore::OptionNumber$new(
                "ridge_penalty",
                ridge_penalty,
                min=0,
                max=1,
                default=0.00001)
            private$..remove_collinear <- jmvcore::OptionBool$new(
                "remove_collinear",
                remove_collinear,
                default=TRUE)
            private$..collinearity_threshold <- jmvcore::OptionNumber$new(
                "collinearity_threshold",
                collinearity_threshold,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..diagnostic_plots <- jmvcore::OptionBool$new(
                "diagnostic_plots",
                diagnostic_plots,
                default=TRUE)
            private$..imputation_quality <- jmvcore::OptionBool$new(
                "imputation_quality",
                imputation_quality,
                default=TRUE)
            private$..cross_validation <- jmvcore::OptionBool$new(
                "cross_validation",
                cross_validation,
                default=FALSE)
            private$..ampute_test <- jmvcore::OptionBool$new(
                "ampute_test",
                ampute_test,
                default=FALSE)
            private$..save_imputations <- jmvcore::OptionBool$new(
                "save_imputations",
                save_imputations,
                default=FALSE)
            private$..pool_results <- jmvcore::OptionBool$new(
                "pool_results",
                pool_results,
                default=TRUE)
            private$..show_detailed_output <- jmvcore::OptionBool$new(
                "show_detailed_output",
                show_detailed_output,
                default=TRUE)
            private$..regulatory_report <- jmvcore::OptionBool$new(
                "regulatory_report",
                regulatory_report,
                default=FALSE)
            private$..random_seed <- jmvcore::OptionInteger$new(
                "random_seed",
                random_seed,
                default=123)

            self$.addOption(private$..imputation_vars)
            self$.addOption(private$..auxiliary_vars)
            self$.addOption(private$..cluster_var)
            self$.addOption(private$..id_var)
            self$.addOption(private$..n_imputations)
            self$.addOption(private$..n_iterations)
            self$.addOption(private$..convergence_check)
            self$.addOption(private$..imputation_method)
            self$.addOption(private$..categorical_method)
            self$.addOption(private$..mnar_methods)
            self$.addOption(private$..mnar_type)
            self$.addOption(private$..delta_values)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..sensitivity_methods)
            self$.addOption(private$..multilevel_imputation)
            self$.addOption(private$..level1_vars)
            self$.addOption(private$..level2_vars)
            self$.addOption(private$..min_bucket_size)
            self$.addOption(private$..exclude_vars)
            self$.addOption(private$..passive_imputation)
            self$.addOption(private$..ridge_penalty)
            self$.addOption(private$..remove_collinear)
            self$.addOption(private$..collinearity_threshold)
            self$.addOption(private$..diagnostic_plots)
            self$.addOption(private$..imputation_quality)
            self$.addOption(private$..cross_validation)
            self$.addOption(private$..ampute_test)
            self$.addOption(private$..save_imputations)
            self$.addOption(private$..pool_results)
            self$.addOption(private$..show_detailed_output)
            self$.addOption(private$..regulatory_report)
            self$.addOption(private$..random_seed)
        }),
    active = list(
        imputation_vars = function() private$..imputation_vars$value,
        auxiliary_vars = function() private$..auxiliary_vars$value,
        cluster_var = function() private$..cluster_var$value,
        id_var = function() private$..id_var$value,
        n_imputations = function() private$..n_imputations$value,
        n_iterations = function() private$..n_iterations$value,
        convergence_check = function() private$..convergence_check$value,
        imputation_method = function() private$..imputation_method$value,
        categorical_method = function() private$..categorical_method$value,
        mnar_methods = function() private$..mnar_methods$value,
        mnar_type = function() private$..mnar_type$value,
        delta_values = function() private$..delta_values$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        sensitivity_methods = function() private$..sensitivity_methods$value,
        multilevel_imputation = function() private$..multilevel_imputation$value,
        level1_vars = function() private$..level1_vars$value,
        level2_vars = function() private$..level2_vars$value,
        min_bucket_size = function() private$..min_bucket_size$value,
        exclude_vars = function() private$..exclude_vars$value,
        passive_imputation = function() private$..passive_imputation$value,
        ridge_penalty = function() private$..ridge_penalty$value,
        remove_collinear = function() private$..remove_collinear$value,
        collinearity_threshold = function() private$..collinearity_threshold$value,
        diagnostic_plots = function() private$..diagnostic_plots$value,
        imputation_quality = function() private$..imputation_quality$value,
        cross_validation = function() private$..cross_validation$value,
        ampute_test = function() private$..ampute_test$value,
        save_imputations = function() private$..save_imputations$value,
        pool_results = function() private$..pool_results$value,
        show_detailed_output = function() private$..show_detailed_output$value,
        regulatory_report = function() private$..regulatory_report$value,
        random_seed = function() private$..random_seed$value),
    private = list(
        ..imputation_vars = NA,
        ..auxiliary_vars = NA,
        ..cluster_var = NA,
        ..id_var = NA,
        ..n_imputations = NA,
        ..n_iterations = NA,
        ..convergence_check = NA,
        ..imputation_method = NA,
        ..categorical_method = NA,
        ..mnar_methods = NA,
        ..mnar_type = NA,
        ..delta_values = NA,
        ..sensitivity_analysis = NA,
        ..sensitivity_methods = NA,
        ..multilevel_imputation = NA,
        ..level1_vars = NA,
        ..level2_vars = NA,
        ..min_bucket_size = NA,
        ..exclude_vars = NA,
        ..passive_imputation = NA,
        ..ridge_penalty = NA,
        ..remove_collinear = NA,
        ..collinearity_threshold = NA,
        ..diagnostic_plots = NA,
        ..imputation_quality = NA,
        ..cross_validation = NA,
        ..ampute_test = NA,
        ..save_imputations = NA,
        ..pool_results = NA,
        ..show_detailed_output = NA,
        ..regulatory_report = NA,
        ..random_seed = NA)
)

advancedimputationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedimputationResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        missing_summary = function() private$.items[["missing_summary"]],
        convergence_assessment = function() private$.items[["convergence_assessment"]],
        imputation_summary = function() private$.items[["imputation_summary"]],
        sensitivity_results = function() private$.items[["sensitivity_results"]],
        mnar_analysis = function() private$.items[["mnar_analysis"]],
        multilevel_results = function() private$.items[["multilevel_results"]],
        quality_assessment = function() private$.items[["quality_assessment"]],
        cross_validation_results = function() private$.items[["cross_validation_results"]],
        amputation_test_results = function() private$.items[["amputation_test_results"]],
        pooled_estimates = function() private$.items[["pooled_estimates"]],
        convergence_plot = function() private$.items[["convergence_plot"]],
        distribution_plot = function() private$.items[["distribution_plot"]],
        pattern_plot = function() private$.items[["pattern_plot"]],
        sensitivity_plot = function() private$.items[["sensitivity_plot"]],
        quality_plot = function() private$.items[["quality_plot"]],
        clinical_interpretation = function() private$.items[["clinical_interpretation"]],
        regulatory_report = function() private$.items[["regulatory_report"]],
        methods_documentation = function() private$.items[["methods_documentation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Multiple Imputation & Sensitivity Analysis",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Getting Started",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="missing_summary",
                title="Missing Data Summary",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="n_missing", 
                        `title`="N Missing", 
                        `type`="integer"),
                    list(
                        `name`="pct_missing", 
                        `title`="Missing %", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="pattern_id", 
                        `title`="Pattern ID", 
                        `type`="integer"),
                    list(
                        `name`="imputation_method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text")),
                clearWith=list(
                    "imputation_vars",
                    "auxiliary_vars")))
            self$add(jmvcore::Table$new(
                options=options,
                name="convergence_assessment",
                title="Convergence Assessment",
                visible="(convergence_check)",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="iteration", 
                        `title`="Iteration", 
                        `type`="integer"),
                    list(
                        `name`="between_variance", 
                        `title`="Between Variance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="within_variance", 
                        `title`="Within Variance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="total_variance", 
                        `title`="Total Variance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="rhat", 
                        `title`="R-hat", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="convergence_status", 
                        `title`="Status", 
                        `type`="text")),
                clearWith=list(
                    "n_imputations",
                    "n_iterations")))
            self$add(jmvcore::Table$new(
                options=options,
                name="imputation_summary",
                title="Imputation Results Summary",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="n_imputations", 
                        `title`="N Imputations", 
                        `type`="integer"),
                    list(
                        `name`="mean_observed", 
                        `title`="Mean (Observed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="mean_imputed", 
                        `title`="Mean (Imputed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sd_observed", 
                        `title`="SD (Observed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sd_imputed", 
                        `title`="SD (Imputed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="quality_score", 
                        `title`="Quality Score", 
                        `type`="number", 
                        `format`="zto")),
                clearWith=list(
                    "imputation_vars",
                    "imputation_method")))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivity_results",
                title="Sensitivity Analysis Results",
                visible="(sensitivity_analysis)",
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method/Assumption", 
                        `type`="text"),
                    list(
                        `name`="scenario", 
                        `title`="Scenario", 
                        `type`="text"),
                    list(
                        `name`="n_complete", 
                        `title`="N Complete", 
                        `type`="integer"),
                    list(
                        `name`="primary_estimate", 
                        `title`="Primary Estimate", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="standard_error", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_lower", 
                        `title`="CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_upper", 
                        `title`="CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sensitivity_flag", 
                        `title`="Sensitivity", 
                        `type`="text")),
                clearWith=list(
                    "sensitivity_methods",
                    "mnar_methods")))
            self$add(jmvcore::Table$new(
                options=options,
                name="mnar_analysis",
                title="MNAR Sensitivity Analysis",
                visible="(mnar_methods)",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="delta_value", 
                        `title`="Delta Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="mnar_method", 
                        `title`="MNAR Method", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="change_pct", 
                        `title`="Change (%)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "mnar_type",
                    "delta_values")))
            self$add(jmvcore::Table$new(
                options=options,
                name="multilevel_results",
                title="Multilevel Imputation Results",
                visible="(multilevel_imputation)",
                columns=list(
                    list(
                        `name`="level", 
                        `title`="Level", 
                        `type`="text"),
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="icc_observed", 
                        `title`="ICC (Observed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="icc_imputed", 
                        `title`="ICC (Imputed)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="level_variance", 
                        `title`="Level Variance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="quality_assessment", 
                        `title`="Quality", 
                        `type`="text")),
                clearWith=list(
                    "cluster_var",
                    "level1_vars",
                    "level2_vars")))
            self$add(jmvcore::Table$new(
                options=options,
                name="quality_assessment",
                title="Imputation Quality Assessment",
                visible="(imputation_quality)",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="distributional_match", 
                        `title`="Distribution Match", 
                        `type`="text"),
                    list(
                        `name`="correlation_preservation", 
                        `title`="Correlation Preservation", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="variance_ratio", 
                        `title`="Variance Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="outlier_detection", 
                        `title`="Outlier Count", 
                        `type`="integer"),
                    list(
                        `name`="plausibility_score", 
                        `title`="Plausibility Score", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="overall_quality", 
                        `title`="Overall Quality", 
                        `type`="text")),
                clearWith=list(
                    "imputation_vars")))
            self$add(jmvcore::Table$new(
                options=options,
                name="cross_validation_results",
                title="Cross-Validation Results",
                visible="(cross_validation)",
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="fold", 
                        `title`="Fold", 
                        `type`="integer"),
                    list(
                        `name`="rmse", 
                        `title`="RMSE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="mae", 
                        `title`="MAE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="correlation", 
                        `title`="Correlation", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="rank", 
                        `title`="Rank", 
                        `type`="integer")),
                clearWith=list(
                    "imputation_method",
                    "categorical_method")))
            self$add(jmvcore::Table$new(
                options=options,
                name="amputation_test_results",
                title="Amputation Test Results",
                visible="(ampute_test)",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="missingness_pct", 
                        `title`="Missingness %", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="recovery_rate", 
                        `title`="Recovery Rate", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="bias", 
                        `title`="Bias", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="coverage", 
                        `title`="Coverage", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="performance_grade", 
                        `title`="Grade", 
                        `type`="text")),
                clearWith=list(
                    "imputation_method")))
            self$add(jmvcore::Table$new(
                options=options,
                name="pooled_estimates",
                title="Pooled Analysis Results",
                visible="(pool_results)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_lower", 
                        `title`="CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_upper", 
                        `title`="CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="fmi", 
                        `title`="FMI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="lambda", 
                        `title`="Lambda", 
                        `type`="number", 
                        `format`="zto")),
                clearWith=list(
                    "n_imputations")))
            self$add(jmvcore::Image$new(
                options=options,
                name="convergence_plot",
                title="Convergence Diagnostic Plots",
                width=900,
                height=600,
                visible="(diagnostic_plots && convergence_check)",
                requiresData=TRUE,
                clearWith=list(
                    "n_iterations",
                    "imputation_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="distribution_plot",
                title="Observed vs Imputed Distributions",
                width=900,
                height=600,
                visible="(diagnostic_plots)",
                requiresData=TRUE,
                clearWith=list(
                    "imputation_vars",
                    "imputation_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="pattern_plot",
                title="Missing Data Pattern Plot",
                width=800,
                height=600,
                visible="(diagnostic_plots)",
                requiresData=TRUE,
                clearWith=list(
                    "imputation_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="sensitivity_plot",
                title="Sensitivity Analysis Plot",
                width=800,
                height=600,
                visible="(diagnostic_plots && sensitivity_analysis)",
                requiresData=TRUE,
                clearWith=list(
                    "sensitivity_methods",
                    "mnar_methods")))
            self$add(jmvcore::Image$new(
                options=options,
                name="quality_plot",
                title="Imputation Quality Plot",
                width=800,
                height=600,
                visible="(diagnostic_plots && imputation_quality)",
                requiresData=TRUE,
                clearWith=list(
                    "imputation_vars")))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinical_interpretation",
                title="Clinical Interpretation & Recommendations",
                visible="(show_detailed_output)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="regulatory_report",
                title="Regulatory Compliance Report",
                visible="(regulatory_report)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methods_documentation",
                title="Methods Documentation",
                visible="(show_detailed_output)"))}))

advancedimputationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedimputationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "advancedimputation",
                version = c(1,0,0),
                options = options,
                results = advancedimputationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Advanced Multiple Imputation & Sensitivity Analysis
#'
#' Advanced multiple imputation by chained equations (MICE) with comprehensive
#' sensitivity analysis for clinical research applications. Includes nested 
#' imputation
#' for multilevel data, missing not at random (MNAR) imputation methods, and
#' comprehensive sensitivity testing for missing data assumptions. Essential 
#' for
#' regulatory-compliant clinical research where missing data handling must be
#' thoroughly documented and validated.
#' 
#'
#' @examples
#' data('clinical_trial_data')
#'
#' advancedimputation(
#'     data = clinical_trial_data,
#'     imputation_vars = c("primary_endpoint", "biomarker", "age"),
#'     auxiliary_vars = c("baseline_score", "treatment_group"),
#'     sensitivity_analysis = TRUE,
#'     mnar_methods = TRUE
#' )
#'
#' @param data the data as a data frame
#' @param imputation_vars Variables with missing values to be imputed
#' @param auxiliary_vars Complete or mostly complete variables to assist
#'   imputation
#' @param cluster_var Clustering variable for nested/multilevel imputation
#'   (e.g., study site, patient ID)
#' @param id_var Subject identifier for tracking observations across
#'   imputations
#' @param n_imputations Number of imputed datasets to create (recommended 5-20
#'   for analysis, 100+ for final results)
#' @param n_iterations Number of MICE iterations per imputation (increase for
#'   convergence)
#' @param convergence_check Monitor and assess MICE convergence with
#'   diagnostic plots and statistics
#' @param imputation_method Primary method for continuous variables
#' @param categorical_method Method for categorical variables
#' @param mnar_methods Include Missing Not At Random imputation methods
#' @param mnar_type Type of MNAR imputation approach
#' @param delta_values Comma-separated delta values for MNAR sensitivity
#'   analysis (e.g., "0, -0.5, -1")
#' @param sensitivity_analysis Perform extensive sensitivity analysis for
#'   missing data assumptions
#' @param sensitivity_methods Type of sensitivity analysis to perform
#' @param multilevel_imputation Use multilevel imputation for nested/clustered
#'   data
#' @param level1_vars Individual-level variables for multilevel imputation
#' @param level2_vars Cluster-level variables for multilevel imputation
#' @param min_bucket_size Minimum number of donors for PMM (prevents poor
#'   matching)
#' @param exclude_vars Variables to exclude from imputation model (but keep in
#'   dataset)
#' @param passive_imputation R expressions for passive imputation (e.g., "bmi
#'   ~ I(weight/height^2)")
#' @param ridge_penalty Ridge penalty for numerical stability in regression
#'   imputation
#' @param remove_collinear Automatically remove highly collinear variables
#'   from imputation model
#' @param collinearity_threshold Correlation threshold for removing collinear
#'   variables
#' @param diagnostic_plots Generate convergence and diagnostic plots
#' @param imputation_quality Assess quality of imputations vs observed data
#' @param cross_validation Perform cross-validation of imputation methods
#' @param ampute_test Test imputation performance using artificial missingness
#' @param save_imputations Save completed imputed datasets for further
#'   analysis
#' @param pool_results Pool results across imputations using Rubin's rules
#' @param show_detailed_output Show detailed imputation summaries and
#'   diagnostics
#' @param regulatory_report Generate regulatory-compliant missing data
#'   analysis report
#' @param random_seed Set random seed for reproducible results
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab Instructions for advanced multiple imputation and sensitivity analysis \cr
#'   \code{results$missing_summary} \tab \tab \tab \tab \tab Overview of missing data patterns and completeness \cr
#'   \code{results$convergence_assessment} \tab \tab \tab \tab \tab MICE convergence diagnostics and statistics \cr
#'   \code{results$imputation_summary} \tab \tab \tab \tab \tab Summary of completed imputations across methods \cr
#'   \code{results$sensitivity_results} \tab \tab \tab \tab \tab Results across different imputation methods and assumptions \cr
#'   \code{results$mnar_analysis} \tab \tab \tab \tab \tab Missing Not At Random sensitivity analysis results \cr
#'   \code{results$multilevel_results} \tab \tab \tab \tab \tab Results for nested/multilevel imputation \cr
#'   \code{results$quality_assessment} \tab \tab \tab \tab \tab Comprehensive quality evaluation of imputations \cr
#'   \code{results$cross_validation_results} \tab \tab \tab \tab \tab Cross-validation performance of imputation methods \cr
#'   \code{results$amputation_test_results} \tab \tab \tab \tab \tab Performance assessment using artificial missingness \cr
#'   \code{results$pooled_estimates} \tab \tab \tab \tab \tab Results pooled across imputations using Rubin's rules \cr
#'   \code{results$convergence_plot} \tab \tab \tab \tab \tab MICE convergence trace plots and diagnostics \cr
#'   \code{results$distribution_plot} \tab \tab \tab \tab \tab Comparison of observed and imputed value distributions \cr
#'   \code{results$pattern_plot} \tab \tab \tab \tab \tab Visual representation of missing data patterns \cr
#'   \code{results$sensitivity_plot} \tab \tab \tab \tab \tab Visualization of sensitivity analysis results \cr
#'   \code{results$quality_plot} \tab \tab \tab \tab \tab Quality assessment visualization across variables \cr
#'   \code{results$clinical_interpretation} \tab \tab \tab \tab \tab Clinical context and imputation recommendations \cr
#'   \code{results$regulatory_report} \tab \tab \tab \tab \tab Comprehensive report for regulatory submissions \cr
#'   \code{results$methods_documentation} \tab \tab \tab \tab \tab Detailed documentation of imputation methods and assumptions \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$missing_summary$asDF}
#'
#' \code{as.data.frame(results$missing_summary)}
#'
#' @export
advancedimputation <- function(
    data,
    imputation_vars,
    auxiliary_vars,
    cluster_var,
    id_var,
    n_imputations = 10,
    n_iterations = 10,
    convergence_check = TRUE,
    imputation_method = "pmm",
    categorical_method = "logreg",
    mnar_methods = FALSE,
    mnar_type = "delta_adjustment",
    delta_values = "0",
    sensitivity_analysis = TRUE,
    sensitivity_methods = "all",
    multilevel_imputation = FALSE,
    level1_vars,
    level2_vars,
    min_bucket_size = 5,
    exclude_vars,
    passive_imputation,
    ridge_penalty = 0.00001,
    remove_collinear = TRUE,
    collinearity_threshold = 0.95,
    diagnostic_plots = TRUE,
    imputation_quality = TRUE,
    cross_validation = FALSE,
    ampute_test = FALSE,
    save_imputations = FALSE,
    pool_results = TRUE,
    show_detailed_output = TRUE,
    regulatory_report = FALSE,
    random_seed = 123) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("advancedimputation requires jmvcore to be installed (restart may be required)")

    if ( ! missing(imputation_vars)) imputation_vars <- jmvcore::resolveQuo(jmvcore::enquo(imputation_vars))
    if ( ! missing(auxiliary_vars)) auxiliary_vars <- jmvcore::resolveQuo(jmvcore::enquo(auxiliary_vars))
    if ( ! missing(cluster_var)) cluster_var <- jmvcore::resolveQuo(jmvcore::enquo(cluster_var))
    if ( ! missing(id_var)) id_var <- jmvcore::resolveQuo(jmvcore::enquo(id_var))
    if ( ! missing(level1_vars)) level1_vars <- jmvcore::resolveQuo(jmvcore::enquo(level1_vars))
    if ( ! missing(level2_vars)) level2_vars <- jmvcore::resolveQuo(jmvcore::enquo(level2_vars))
    if ( ! missing(exclude_vars)) exclude_vars <- jmvcore::resolveQuo(jmvcore::enquo(exclude_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(imputation_vars), imputation_vars, NULL),
            `if`( ! missing(auxiliary_vars), auxiliary_vars, NULL),
            `if`( ! missing(cluster_var), cluster_var, NULL),
            `if`( ! missing(id_var), id_var, NULL),
            `if`( ! missing(level1_vars), level1_vars, NULL),
            `if`( ! missing(level2_vars), level2_vars, NULL),
            `if`( ! missing(exclude_vars), exclude_vars, NULL))

    for (v in cluster_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- advancedimputationOptions$new(
        imputation_vars = imputation_vars,
        auxiliary_vars = auxiliary_vars,
        cluster_var = cluster_var,
        id_var = id_var,
        n_imputations = n_imputations,
        n_iterations = n_iterations,
        convergence_check = convergence_check,
        imputation_method = imputation_method,
        categorical_method = categorical_method,
        mnar_methods = mnar_methods,
        mnar_type = mnar_type,
        delta_values = delta_values,
        sensitivity_analysis = sensitivity_analysis,
        sensitivity_methods = sensitivity_methods,
        multilevel_imputation = multilevel_imputation,
        level1_vars = level1_vars,
        level2_vars = level2_vars,
        min_bucket_size = min_bucket_size,
        exclude_vars = exclude_vars,
        passive_imputation = passive_imputation,
        ridge_penalty = ridge_penalty,
        remove_collinear = remove_collinear,
        collinearity_threshold = collinearity_threshold,
        diagnostic_plots = diagnostic_plots,
        imputation_quality = imputation_quality,
        cross_validation = cross_validation,
        ampute_test = ampute_test,
        save_imputations = save_imputations,
        pool_results = pool_results,
        show_detailed_output = show_detailed_output,
        regulatory_report = regulatory_report,
        random_seed = random_seed)

    analysis <- advancedimputationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

