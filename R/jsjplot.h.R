
# This file is automatically generated, you probably don't want to edit this

jsjplotOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jsjplotOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            analysis_type = "coefficient_plot",
            dependent_var = NULL,
            independent_vars = NULL,
            grouping_var = NULL,
            interaction_vars = NULL,
            model_type = "lm",
            family = "gaussian",
            plot_type = "est",
            confidence_level = 0.95,
            standardized = FALSE,
            show_values = TRUE,
            show_p_values = TRUE,
            sort_estimates = FALSE,
            remove_intercept = TRUE,
            grid_breaks = 0.5,
            dot_size = 3,
            line_size = 0.8,
            colors = "default",
            theme_style = "sjplot",
            title = "",
            axis_labels = "",
            transform_axis = "none",
            show_data = FALSE,
            show_statistics = TRUE,
            show_summary = TRUE,
            html_output = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jsjplot",
                requiresData=TRUE,
                ...)

            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "regression_table",
                    "coefficient_plot",
                    "interaction_plot",
                    "marginal_effects",
                    "frequency_table",
                    "correlation_matrix",
                    "pca_plot"),
                default="coefficient_plot")
            private$..dependent_var <- jmvcore::OptionVariable$new(
                "dependent_var",
                dependent_var,
                default=NULL,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..independent_vars <- jmvcore::OptionVariables$new(
                "independent_vars",
                independent_vars,
                default=NULL,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..grouping_var <- jmvcore::OptionVariable$new(
                "grouping_var",
                grouping_var,
                default=NULL,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..interaction_vars <- jmvcore::OptionVariables$new(
                "interaction_vars",
                interaction_vars,
                default=NULL,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "lm",
                    "glm",
                    "lmer",
                    "logistic",
                    "poisson"),
                default="lm")
            private$..family <- jmvcore::OptionList$new(
                "family",
                family,
                options=list(
                    "gaussian",
                    "binomial",
                    "poisson",
                    "gamma"),
                default="gaussian")
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "est",
                    "pred",
                    "eff",
                    "int",
                    "diag"),
                default="est")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..standardized <- jmvcore::OptionBool$new(
                "standardized",
                standardized,
                default=FALSE)
            private$..show_values <- jmvcore::OptionBool$new(
                "show_values",
                show_values,
                default=TRUE)
            private$..show_p_values <- jmvcore::OptionBool$new(
                "show_p_values",
                show_p_values,
                default=TRUE)
            private$..sort_estimates <- jmvcore::OptionBool$new(
                "sort_estimates",
                sort_estimates,
                default=FALSE)
            private$..remove_intercept <- jmvcore::OptionBool$new(
                "remove_intercept",
                remove_intercept,
                default=TRUE)
            private$..grid_breaks <- jmvcore::OptionNumber$new(
                "grid_breaks",
                grid_breaks,
                default=0.5,
                min=0.1,
                max=2)
            private$..dot_size <- jmvcore::OptionNumber$new(
                "dot_size",
                dot_size,
                default=3,
                min=1,
                max=8)
            private$..line_size <- jmvcore::OptionNumber$new(
                "line_size",
                line_size,
                default=0.8,
                min=0.2,
                max=3)
            private$..colors <- jmvcore::OptionList$new(
                "colors",
                colors,
                options=list(
                    "default",
                    "colorblind",
                    "bw",
                    "viridis",
                    "metro"),
                default="default")
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "sjplot",
                    "minimal",
                    "classic",
                    "apa",
                    "bw"),
                default="sjplot")
            private$..title <- jmvcore::OptionString$new(
                "title",
                title,
                default="")
            private$..axis_labels <- jmvcore::OptionString$new(
                "axis_labels",
                axis_labels,
                default="")
            private$..transform_axis <- jmvcore::OptionList$new(
                "transform_axis",
                transform_axis,
                options=list(
                    "none",
                    "log",
                    "sqrt",
                    "inverse"),
                default="none")
            private$..show_data <- jmvcore::OptionBool$new(
                "show_data",
                show_data,
                default=FALSE)
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..show_summary <- jmvcore::OptionBool$new(
                "show_summary",
                show_summary,
                default=TRUE)
            private$..html_output <- jmvcore::OptionBool$new(
                "html_output",
                html_output,
                default=TRUE)

            self$.addOption(private$..analysis_type)
            self$.addOption(private$..dependent_var)
            self$.addOption(private$..independent_vars)
            self$.addOption(private$..grouping_var)
            self$.addOption(private$..interaction_vars)
            self$.addOption(private$..model_type)
            self$.addOption(private$..family)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..standardized)
            self$.addOption(private$..show_values)
            self$.addOption(private$..show_p_values)
            self$.addOption(private$..sort_estimates)
            self$.addOption(private$..remove_intercept)
            self$.addOption(private$..grid_breaks)
            self$.addOption(private$..dot_size)
            self$.addOption(private$..line_size)
            self$.addOption(private$..colors)
            self$.addOption(private$..theme_style)
            self$.addOption(private$..title)
            self$.addOption(private$..axis_labels)
            self$.addOption(private$..transform_axis)
            self$.addOption(private$..show_data)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..show_summary)
            self$.addOption(private$..html_output)
        }),
    active = list(
        analysis_type = function() private$..analysis_type$value,
        dependent_var = function() private$..dependent_var$value,
        independent_vars = function() private$..independent_vars$value,
        grouping_var = function() private$..grouping_var$value,
        interaction_vars = function() private$..interaction_vars$value,
        model_type = function() private$..model_type$value,
        family = function() private$..family$value,
        plot_type = function() private$..plot_type$value,
        confidence_level = function() private$..confidence_level$value,
        standardized = function() private$..standardized$value,
        show_values = function() private$..show_values$value,
        show_p_values = function() private$..show_p_values$value,
        sort_estimates = function() private$..sort_estimates$value,
        remove_intercept = function() private$..remove_intercept$value,
        grid_breaks = function() private$..grid_breaks$value,
        dot_size = function() private$..dot_size$value,
        line_size = function() private$..line_size$value,
        colors = function() private$..colors$value,
        theme_style = function() private$..theme_style$value,
        title = function() private$..title$value,
        axis_labels = function() private$..axis_labels$value,
        transform_axis = function() private$..transform_axis$value,
        show_data = function() private$..show_data$value,
        show_statistics = function() private$..show_statistics$value,
        show_summary = function() private$..show_summary$value,
        html_output = function() private$..html_output$value),
    private = list(
        ..analysis_type = NA,
        ..dependent_var = NA,
        ..independent_vars = NA,
        ..grouping_var = NA,
        ..interaction_vars = NA,
        ..model_type = NA,
        ..family = NA,
        ..plot_type = NA,
        ..confidence_level = NA,
        ..standardized = NA,
        ..show_values = NA,
        ..show_p_values = NA,
        ..sort_estimates = NA,
        ..remove_intercept = NA,
        ..grid_breaks = NA,
        ..dot_size = NA,
        ..line_size = NA,
        ..colors = NA,
        ..theme_style = NA,
        ..title = NA,
        ..axis_labels = NA,
        ..transform_axis = NA,
        ..show_data = NA,
        ..show_statistics = NA,
        ..show_summary = NA,
        ..html_output = NA)
)

jsjplotResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jsjplotResults",
    inherit = jmvcore::Group,
    active = list(
        plot = function() private$.items[["plot"]],
        model_table = function() private$.items[["model_table"]],
        statistics = function() private$.items[["statistics"]],
        summary = function() private$.items[["summary"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Social Science Statistical Visualization",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Statistical Visualization",
                width=800,
                height=600,
                renderFun=".plot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="model_table",
                title="Model Table",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistics",
                title="Model Statistics",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Analysis Summary",
                visible=TRUE))}))

jsjplotBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jsjplotBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jsjplot",
                version = c(0,0,3),
                options = options,
                results = jsjplotResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Social Science Statistical Visualization
#'
#' Social science statistical visualization using the sjPlot package for 
#' regression tables, model plots, and interaction visualizations.
#'
#' @examples
#' \donttest{
#' # Example usage:
#' library(sjPlot)
#' # Regression table
#' tab_model(lm_model)
#' # Coefficient plot
#' plot_model(lm_model)
#' # Interaction plot
#' plot_model(lm_model, type = "int")
#'}
#' @param data The data as a data frame.
#' @param analysis_type Type of statistical visualization to generate.
#' @param dependent_var Dependent/outcome variable for analysis.
#' @param independent_vars Independent/predictor variables for analysis.
#' @param grouping_var Variable for grouping or stratification.
#' @param interaction_vars Variables for interaction analysis.
#' @param model_type Type of statistical model to fit.
#' @param family Error distribution family for GLM.
#' @param plot_type Type of model plot to generate.
#' @param confidence_level Confidence level for intervals.
#' @param standardized Whether to show standardized coefficients.
#' @param show_values Whether to display coefficient values on plot.
#' @param show_p_values Whether to display p-values.
#' @param sort_estimates Whether to sort coefficients by effect size.
#' @param remove_intercept Whether to exclude intercept from plots.
#' @param grid_breaks Spacing for grid lines in plots.
#' @param dot_size Size of points in coefficient plots.
#' @param line_size Thickness of confidence interval lines.
#' @param colors Color scheme for plots.
#' @param theme_style Visual theme for plots.
#' @param title Custom title for the plot.
#' @param axis_labels Custom labels for axes (comma-separated).
#' @param transform_axis Transformation to apply to axis scale.
#' @param show_data Whether to overlay raw data points.
#' @param show_statistics Whether to display model fit statistics.
#' @param show_summary Whether to display detailed model summary.
#' @param html_output Whether to generate HTML formatted output.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$plot} \tab \tab \tab \tab \tab Statistical plots using sjPlot package \cr
#'   \code{results$model_table} \tab \tab \tab \tab \tab Regression table or statistical summary table \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab Model fit statistics and diagnostics \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab Comprehensive analysis summary and interpretation \cr
#' }
#'
#' @export
jsjplot <- function(
    data,
    analysis_type = "coefficient_plot",
    dependent_var = NULL,
    independent_vars = NULL,
    grouping_var = NULL,
    interaction_vars = NULL,
    model_type = "lm",
    family = "gaussian",
    plot_type = "est",
    confidence_level = 0.95,
    standardized = FALSE,
    show_values = TRUE,
    show_p_values = TRUE,
    sort_estimates = FALSE,
    remove_intercept = TRUE,
    grid_breaks = 0.5,
    dot_size = 3,
    line_size = 0.8,
    colors = "default",
    theme_style = "sjplot",
    title = "",
    axis_labels = "",
    transform_axis = "none",
    show_data = FALSE,
    show_statistics = TRUE,
    show_summary = TRUE,
    html_output = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jsjplot requires jmvcore to be installed (restart may be required)")

    if ( ! missing(dependent_var)) dependent_var <- jmvcore::resolveQuo(jmvcore::enquo(dependent_var))
    if ( ! missing(independent_vars)) independent_vars <- jmvcore::resolveQuo(jmvcore::enquo(independent_vars))
    if ( ! missing(grouping_var)) grouping_var <- jmvcore::resolveQuo(jmvcore::enquo(grouping_var))
    if ( ! missing(interaction_vars)) interaction_vars <- jmvcore::resolveQuo(jmvcore::enquo(interaction_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dependent_var), dependent_var, NULL),
            `if`( ! missing(independent_vars), independent_vars, NULL),
            `if`( ! missing(grouping_var), grouping_var, NULL),
            `if`( ! missing(interaction_vars), interaction_vars, NULL))

    for (v in grouping_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jsjplotOptions$new(
        analysis_type = analysis_type,
        dependent_var = dependent_var,
        independent_vars = independent_vars,
        grouping_var = grouping_var,
        interaction_vars = interaction_vars,
        model_type = model_type,
        family = family,
        plot_type = plot_type,
        confidence_level = confidence_level,
        standardized = standardized,
        show_values = show_values,
        show_p_values = show_p_values,
        sort_estimates = sort_estimates,
        remove_intercept = remove_intercept,
        grid_breaks = grid_breaks,
        dot_size = dot_size,
        line_size = line_size,
        colors = colors,
        theme_style = theme_style,
        title = title,
        axis_labels = axis_labels,
        transform_axis = transform_axis,
        show_data = show_data,
        show_statistics = show_statistics,
        show_summary = show_summary,
        html_output = html_output)

    analysis <- jsjplotClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

