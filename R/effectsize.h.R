
# This file is automatically generated, you probably don't want to edit this

effectsizeOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "effectsizeOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            dep = NULL,
            group = NULL,
            analysisType = "two_sample",
            measures_cohens_d = TRUE,
            measures_hedges_g = TRUE,
            measures_glass_delta = FALSE,
            testValue = 0,
            group1Value = NULL,
            group2Value = NULL,
            ciWidth = 95,
            interpretation = TRUE,
            descriptives = TRUE,
            testDetails = TRUE,
            assumptionChecks = FALSE,
            plotEffects = TRUE,
            plotType = "forest",
            plotWidth = 600,
            plotHeight = 400, ...) {

            super$initialize(
                package="ClinicoPath",
                name="effectsize",
                requiresData=TRUE,
                ...)

            private$..dep <- jmvcore::OptionVariable$new(
                "dep",
                dep,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..group <- jmvcore::OptionVariable$new(
                "group",
                group,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..analysisType <- jmvcore::OptionList$new(
                "analysisType",
                analysisType,
                options=list(
                    "one_sample",
                    "two_sample"),
                default="two_sample")
            private$..measures_cohens_d <- jmvcore::OptionBool$new(
                "measures_cohens_d",
                measures_cohens_d,
                default=TRUE)
            private$..measures_hedges_g <- jmvcore::OptionBool$new(
                "measures_hedges_g",
                measures_hedges_g,
                default=TRUE)
            private$..measures_glass_delta <- jmvcore::OptionBool$new(
                "measures_glass_delta",
                measures_glass_delta,
                default=FALSE)
            private$..testValue <- jmvcore::OptionNumber$new(
                "testValue",
                testValue,
                default=0)
            private$..group1Value <- jmvcore::OptionString$new(
                "group1Value",
                group1Value)
            private$..group2Value <- jmvcore::OptionString$new(
                "group2Value",
                group2Value)
            private$..ciWidth <- jmvcore::OptionNumber$new(
                "ciWidth",
                ciWidth,
                default=95,
                min=50,
                max=99.9)
            private$..interpretation <- jmvcore::OptionBool$new(
                "interpretation",
                interpretation,
                default=TRUE)
            private$..descriptives <- jmvcore::OptionBool$new(
                "descriptives",
                descriptives,
                default=TRUE)
            private$..testDetails <- jmvcore::OptionBool$new(
                "testDetails",
                testDetails,
                default=TRUE)
            private$..assumptionChecks <- jmvcore::OptionBool$new(
                "assumptionChecks",
                assumptionChecks,
                default=FALSE)
            private$..plotEffects <- jmvcore::OptionBool$new(
                "plotEffects",
                plotEffects,
                default=TRUE)
            private$..plotType <- jmvcore::OptionList$new(
                "plotType",
                plotType,
                options=list(
                    "forest",
                    "bar",
                    "dot"),
                default="forest")
            private$..plotWidth <- jmvcore::OptionInteger$new(
                "plotWidth",
                plotWidth,
                default=600,
                min=300,
                max=1200)
            private$..plotHeight <- jmvcore::OptionInteger$new(
                "plotHeight",
                plotHeight,
                default=400,
                min=200,
                max=800)

            self$.addOption(private$..dep)
            self$.addOption(private$..group)
            self$.addOption(private$..analysisType)
            self$.addOption(private$..measures_cohens_d)
            self$.addOption(private$..measures_hedges_g)
            self$.addOption(private$..measures_glass_delta)
            self$.addOption(private$..testValue)
            self$.addOption(private$..group1Value)
            self$.addOption(private$..group2Value)
            self$.addOption(private$..ciWidth)
            self$.addOption(private$..interpretation)
            self$.addOption(private$..descriptives)
            self$.addOption(private$..testDetails)
            self$.addOption(private$..assumptionChecks)
            self$.addOption(private$..plotEffects)
            self$.addOption(private$..plotType)
            self$.addOption(private$..plotWidth)
            self$.addOption(private$..plotHeight)
        }),
    active = list(
        dep = function() private$..dep$value,
        group = function() private$..group$value,
        analysisType = function() private$..analysisType$value,
        measures_cohens_d = function() private$..measures_cohens_d$value,
        measures_hedges_g = function() private$..measures_hedges_g$value,
        measures_glass_delta = function() private$..measures_glass_delta$value,
        testValue = function() private$..testValue$value,
        group1Value = function() private$..group1Value$value,
        group2Value = function() private$..group2Value$value,
        ciWidth = function() private$..ciWidth$value,
        interpretation = function() private$..interpretation$value,
        descriptives = function() private$..descriptives$value,
        testDetails = function() private$..testDetails$value,
        assumptionChecks = function() private$..assumptionChecks$value,
        plotEffects = function() private$..plotEffects$value,
        plotType = function() private$..plotType$value,
        plotWidth = function() private$..plotWidth$value,
        plotHeight = function() private$..plotHeight$value),
    private = list(
        ..dep = NA,
        ..group = NA,
        ..analysisType = NA,
        ..measures_cohens_d = NA,
        ..measures_hedges_g = NA,
        ..measures_glass_delta = NA,
        ..testValue = NA,
        ..group1Value = NA,
        ..group2Value = NA,
        ..ciWidth = NA,
        ..interpretation = NA,
        ..descriptives = NA,
        ..testDetails = NA,
        ..assumptionChecks = NA,
        ..plotEffects = NA,
        ..plotType = NA,
        ..plotWidth = NA,
        ..plotHeight = NA)
)

effectsizeResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "effectsizeResults",
    inherit = jmvcore::Group,
    active = list(
        results = function() private$.items[["results"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Effect Size Analysis Results")
            self$add(R6::R6Class(
                inherit = jmvcore::Group,
                active = list(
                    instructions = function() private$.items[["instructions"]],
                    effectSizes = function() private$.items[["effectSizes"]],
                    descriptives = function() private$.items[["descriptives"]],
                    testDetails = function() private$.items[["testDetails"]],
                    assumptions = function() private$.items[["assumptions"]],
                    effectPlot = function() private$.items[["effectPlot"]]),
                private = list(),
                public=list(
                    initialize=function(options) {
                        super$initialize(
                            options=options,
                            name="results",
                            title="Analysis Results")
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="instructions",
                            title="Instructions",
                            visible=TRUE))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="effectSizes",
                            title="Effect Size Statistics",
                            clearWith=list(
                                "dep",
                                "group",
                                "analysisType",
                                "measures",
                                "testValue",
                                "group1Value",
                                "group2Value",
                                "ciWidth"),
                            columns=list(
                                list(
                                    `name`="measure", 
                                    `title`="Effect Size", 
                                    `type`="text"),
                                list(
                                    `name`="estimate", 
                                    `title`="Estimate", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="lower", 
                                    `title`="Lower CI", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="upper", 
                                    `title`="Upper CI", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="descriptives",
                            title="Descriptive Statistics",
                            visible="(descriptives)",
                            clearWith=list(
                                "dep",
                                "group",
                                "analysisType"),
                            columns=list(
                                list(
                                    `name`="group", 
                                    `title`="Group", 
                                    `type`="text"),
                                list(
                                    `name`="n", 
                                    `title`="N", 
                                    `type`="integer"),
                                list(
                                    `name`="mean", 
                                    `title`="Mean", 
                                    `type`="number"),
                                list(
                                    `name`="sd", 
                                    `title`="SD", 
                                    `type`="number"),
                                list(
                                    `name`="se", 
                                    `title`="SE", 
                                    `type`="number"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="testDetails",
                            title="Statistical Test Details",
                            visible="(testDetails)",
                            clearWith=list(
                                "dep",
                                "group",
                                "analysisType",
                                "testValue",
                                "group1Value",
                                "group2Value"),
                            columns=list(
                                list(
                                    `name`="testValue", 
                                    `title`="Test Value", 
                                    `type`="number"),
                                list(
                                    `name`="meanDiff", 
                                    `title`="Mean Difference", 
                                    `type`="number"),
                                list(
                                    `name`="tStat", 
                                    `title`="t", 
                                    `type`="number"),
                                list(
                                    `name`="df", 
                                    `title`="df", 
                                    `type`="integer"),
                                list(
                                    `name`="pValue", 
                                    `title`="p", 
                                    `type`="number", 
                                    `format`="zto;pvalue"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="assumptions",
                            title="Assumption Checks",
                            visible="(assumptionChecks)",
                            clearWith=list(
                                "dep",
                                "group",
                                "analysisType"),
                            columns=list(
                                list(
                                    `name`="test", 
                                    `title`="Test", 
                                    `type`="text"),
                                list(
                                    `name`="statistic", 
                                    `title`="Statistic", 
                                    `type`="number"),
                                list(
                                    `name`="pValue", 
                                    `title`="p", 
                                    `type`="number", 
                                    `format`="zto;pvalue"),
                                list(
                                    `name`="result", 
                                    `title`="Result", 
                                    `type`="text"))))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="effectPlot",
                            title="Effect Size Visualization",
                            visible="(plotEffects)",
                            renderFun=".plotEffects",
                            clearWith=list(
                                "dep",
                                "group",
                                "analysisType",
                                "measures",
                                "testValue",
                                "group1Value",
                                "group2Value",
                                "ciWidth",
                                "plotType",
                                "plotWidth",
                                "plotHeight")))}))$new(options=options))}))

effectsizeBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "effectsizeBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "effectsize",
                version = c(0,0,1),
                options = options,
                results = effectsizeResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Effect Size Analysis
#'
#' Comprehensive effect size analysis including Cohen's d, Hedges' g, and 
#' Glass' delta.
#' Essential for clinical significance assessment, meta-analyses, and power 
#' analyses
#' in medical and pathological research.
#' 
#' @param data The data as a data frame.
#' @param dep The continuous outcome variable
#' @param group Variable to define groups for comparison (optional for
#'   one-sample analysis)
#' @param analysisType Type of effect size analysis
#' @param measures_cohens_d Calculate Cohen's d effect size
#' @param measures_hedges_g Calculate Hedges' g effect size (bias-corrected)
#' @param measures_glass_delta Calculate Glass' delta effect size
#' @param testValue Reference value for one-sample analysis
#' @param group1Value Specific value for first group (optional)
#' @param group2Value Specific value for second group (optional)
#' @param ciWidth Confidence level for effect size confidence intervals
#' @param interpretation Provide Cohen's (1988) interpretation guidelines
#' @param descriptives Show group descriptive statistics
#' @param testDetails Show t-test statistics and p-values
#' @param assumptionChecks Perform normality and homogeneity of variance tests
#' @param plotEffects Create visualization of effect sizes with confidence
#'   intervals
#' @param plotType Type of effect size visualization
#' @param plotWidth Width of effect size plot
#' @param plotHeight Height of effect size plot
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$effectSizes} \tab \tab \tab \tab \tab Effect size measures with confidence intervals \cr
#'   \code{results$results$descriptives} \tab \tab \tab \tab \tab Group descriptive statistics \cr
#'   \code{results$results$testDetails} \tab \tab \tab \tab \tab t-test statistics and significance \cr
#'   \code{results$results$assumptions} \tab \tab \tab \tab \tab Tests of normality and variance homogeneity \cr
#'   \code{results$results$effectPlot} \tab \tab \tab \tab \tab Plot showing effect sizes with confidence intervals \cr
#' }
#'
#' @export
effectsize <- function(
    data,
    dep,
    group,
    analysisType = "two_sample",
    measures_cohens_d = TRUE,
    measures_hedges_g = TRUE,
    measures_glass_delta = FALSE,
    testValue = 0,
    group1Value,
    group2Value,
    ciWidth = 95,
    interpretation = TRUE,
    descriptives = TRUE,
    testDetails = TRUE,
    assumptionChecks = FALSE,
    plotEffects = TRUE,
    plotType = "forest",
    plotWidth = 600,
    plotHeight = 400) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("effectsize requires jmvcore to be installed (restart may be required)")

    if ( ! missing(dep)) dep <- jmvcore::resolveQuo(jmvcore::enquo(dep))
    if ( ! missing(group)) group <- jmvcore::resolveQuo(jmvcore::enquo(group))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dep), dep, NULL),
            `if`( ! missing(group), group, NULL))


    options <- effectsizeOptions$new(
        dep = dep,
        group = group,
        analysisType = analysisType,
        measures_cohens_d = measures_cohens_d,
        measures_hedges_g = measures_hedges_g,
        measures_glass_delta = measures_glass_delta,
        testValue = testValue,
        group1Value = group1Value,
        group2Value = group2Value,
        ciWidth = ciWidth,
        interpretation = interpretation,
        descriptives = descriptives,
        testDetails = testDetails,
        assumptionChecks = assumptionChecks,
        plotEffects = plotEffects,
        plotType = plotType,
        plotWidth = plotWidth,
        plotHeight = plotHeight)

    analysis <- effectsizeClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

