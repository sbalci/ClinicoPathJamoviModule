
# This file is automatically generated, you probably don't want to edit this

spatialautocorrelationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "spatialautocorrelationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            measurement = NULL,
            x_coordinate = NULL,
            y_coordinate = NULL,
            region_id = NULL,
            time_point = NULL,
            autocorr_method = "morans_i",
            spatial_weights = "k_nearest",
            distance_threshold = 50,
            k_neighbors = 8,
            bandwidth = 25,
            significance_test = "permutation_test",
            permutations = 999,
            confidence_level = 0.95,
            local_analysis = TRUE,
            cluster_detection = TRUE,
            hotspot_analysis = TRUE,
            spatial_regimes = FALSE,
            temporal_analysis = FALSE,
            multivariate_analysis = FALSE,
            robustness_check = TRUE,
            edge_effects = TRUE,
            clinical_interpretation = TRUE,
            spatial_plots = TRUE,
            autocorr_plots = TRUE,
            lisa_plots = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="spatialautocorrelation",
                requiresData=TRUE,
                ...)

            private$..measurement <- jmvcore::OptionVariable$new(
                "measurement",
                measurement,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..x_coordinate <- jmvcore::OptionVariable$new(
                "x_coordinate",
                x_coordinate,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..y_coordinate <- jmvcore::OptionVariable$new(
                "y_coordinate",
                y_coordinate,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..region_id <- jmvcore::OptionVariable$new(
                "region_id",
                region_id,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..time_point <- jmvcore::OptionVariable$new(
                "time_point",
                time_point,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..autocorr_method <- jmvcore::OptionList$new(
                "autocorr_method",
                autocorr_method,
                options=list(
                    "morans_i",
                    "gearys_c",
                    "both_global",
                    "local_morans",
                    "local_gearys",
                    "comprehensive"),
                default="morans_i")
            private$..spatial_weights <- jmvcore::OptionList$new(
                "spatial_weights",
                spatial_weights,
                options=list(
                    "queen",
                    "rook",
                    "distance_band",
                    "k_nearest",
                    "inverse_distance",
                    "gaussian"),
                default="k_nearest")
            private$..distance_threshold <- jmvcore::OptionNumber$new(
                "distance_threshold",
                distance_threshold,
                min=1,
                max=1000,
                default=50)
            private$..k_neighbors <- jmvcore::OptionInteger$new(
                "k_neighbors",
                k_neighbors,
                min=1,
                max=50,
                default=8)
            private$..bandwidth <- jmvcore::OptionNumber$new(
                "bandwidth",
                bandwidth,
                min=1,
                max=500,
                default=25)
            private$..significance_test <- jmvcore::OptionList$new(
                "significance_test",
                significance_test,
                options=list(
                    "normal_approximation",
                    "permutation_test",
                    "bootstrap",
                    "both"),
                default="permutation_test")
            private$..permutations <- jmvcore::OptionInteger$new(
                "permutations",
                permutations,
                min=99,
                max=9999,
                default=999)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.9,
                max=0.99,
                default=0.95)
            private$..local_analysis <- jmvcore::OptionBool$new(
                "local_analysis",
                local_analysis,
                default=TRUE)
            private$..cluster_detection <- jmvcore::OptionBool$new(
                "cluster_detection",
                cluster_detection,
                default=TRUE)
            private$..hotspot_analysis <- jmvcore::OptionBool$new(
                "hotspot_analysis",
                hotspot_analysis,
                default=TRUE)
            private$..spatial_regimes <- jmvcore::OptionBool$new(
                "spatial_regimes",
                spatial_regimes,
                default=FALSE)
            private$..temporal_analysis <- jmvcore::OptionBool$new(
                "temporal_analysis",
                temporal_analysis,
                default=FALSE)
            private$..multivariate_analysis <- jmvcore::OptionBool$new(
                "multivariate_analysis",
                multivariate_analysis,
                default=FALSE)
            private$..robustness_check <- jmvcore::OptionBool$new(
                "robustness_check",
                robustness_check,
                default=TRUE)
            private$..edge_effects <- jmvcore::OptionBool$new(
                "edge_effects",
                edge_effects,
                default=TRUE)
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)
            private$..spatial_plots <- jmvcore::OptionBool$new(
                "spatial_plots",
                spatial_plots,
                default=TRUE)
            private$..autocorr_plots <- jmvcore::OptionBool$new(
                "autocorr_plots",
                autocorr_plots,
                default=TRUE)
            private$..lisa_plots <- jmvcore::OptionBool$new(
                "lisa_plots",
                lisa_plots,
                default=TRUE)

            self$.addOption(private$..measurement)
            self$.addOption(private$..x_coordinate)
            self$.addOption(private$..y_coordinate)
            self$.addOption(private$..region_id)
            self$.addOption(private$..time_point)
            self$.addOption(private$..autocorr_method)
            self$.addOption(private$..spatial_weights)
            self$.addOption(private$..distance_threshold)
            self$.addOption(private$..k_neighbors)
            self$.addOption(private$..bandwidth)
            self$.addOption(private$..significance_test)
            self$.addOption(private$..permutations)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..local_analysis)
            self$.addOption(private$..cluster_detection)
            self$.addOption(private$..hotspot_analysis)
            self$.addOption(private$..spatial_regimes)
            self$.addOption(private$..temporal_analysis)
            self$.addOption(private$..multivariate_analysis)
            self$.addOption(private$..robustness_check)
            self$.addOption(private$..edge_effects)
            self$.addOption(private$..clinical_interpretation)
            self$.addOption(private$..spatial_plots)
            self$.addOption(private$..autocorr_plots)
            self$.addOption(private$..lisa_plots)
        }),
    active = list(
        measurement = function() private$..measurement$value,
        x_coordinate = function() private$..x_coordinate$value,
        y_coordinate = function() private$..y_coordinate$value,
        region_id = function() private$..region_id$value,
        time_point = function() private$..time_point$value,
        autocorr_method = function() private$..autocorr_method$value,
        spatial_weights = function() private$..spatial_weights$value,
        distance_threshold = function() private$..distance_threshold$value,
        k_neighbors = function() private$..k_neighbors$value,
        bandwidth = function() private$..bandwidth$value,
        significance_test = function() private$..significance_test$value,
        permutations = function() private$..permutations$value,
        confidence_level = function() private$..confidence_level$value,
        local_analysis = function() private$..local_analysis$value,
        cluster_detection = function() private$..cluster_detection$value,
        hotspot_analysis = function() private$..hotspot_analysis$value,
        spatial_regimes = function() private$..spatial_regimes$value,
        temporal_analysis = function() private$..temporal_analysis$value,
        multivariate_analysis = function() private$..multivariate_analysis$value,
        robustness_check = function() private$..robustness_check$value,
        edge_effects = function() private$..edge_effects$value,
        clinical_interpretation = function() private$..clinical_interpretation$value,
        spatial_plots = function() private$..spatial_plots$value,
        autocorr_plots = function() private$..autocorr_plots$value,
        lisa_plots = function() private$..lisa_plots$value),
    private = list(
        ..measurement = NA,
        ..x_coordinate = NA,
        ..y_coordinate = NA,
        ..region_id = NA,
        ..time_point = NA,
        ..autocorr_method = NA,
        ..spatial_weights = NA,
        ..distance_threshold = NA,
        ..k_neighbors = NA,
        ..bandwidth = NA,
        ..significance_test = NA,
        ..permutations = NA,
        ..confidence_level = NA,
        ..local_analysis = NA,
        ..cluster_detection = NA,
        ..hotspot_analysis = NA,
        ..spatial_regimes = NA,
        ..temporal_analysis = NA,
        ..multivariate_analysis = NA,
        ..robustness_check = NA,
        ..edge_effects = NA,
        ..clinical_interpretation = NA,
        ..spatial_plots = NA,
        ..autocorr_plots = NA,
        ..lisa_plots = NA)
)

spatialautocorrelationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "spatialautocorrelationResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        dataInfo = function() private$.items[["dataInfo"]],
        globalAutocorrelation = function() private$.items[["globalAutocorrelation"]],
        localIndicators = function() private$.items[["localIndicators"]],
        spatialClusters = function() private$.items[["spatialClusters"]],
        hotspotAnalysis = function() private$.items[["hotspotAnalysis"]],
        spatialRegimes = function() private$.items[["spatialRegimes"]],
        robustnessAnalysis = function() private$.items[["robustnessAnalysis"]],
        temporalAnalysis = function() private$.items[["temporalAnalysis"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        spatialMap = function() private$.items[["spatialMap"]],
        autocorrPlot = function() private$.items[["autocorrPlot"]],
        lisaMap = function() private$.items[["lisaMap"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Spatial Autocorrelation Analysis (Moran's I, Geary's C)")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="dataInfo",
                title="Spatial Data Summary",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "measurement",
                    "x_coordinate",
                    "y_coordinate"),
                columns=list(
                    list(
                        `name`="characteristic", 
                        `title`="Characteristic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="globalAutocorrelation",
                title="Global Spatial Autocorrelation",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "measurement",
                    "autocorr_method",
                    "spatial_weights"),
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="observed", 
                        `title`="Observed", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="expected", 
                        `title`="Expected", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="variance", 
                        `title`="Variance", 
                        `type`="number", 
                        `format`="zto:8"),
                    list(
                        `name`="z_score", 
                        `title`="Z-score", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="localIndicators",
                title="Local Indicators of Spatial Association (LISA)",
                visible="(local_analysis)",
                rows=1,
                clearWith=list(
                    "local_analysis",
                    "measurement",
                    "spatial_weights"),
                columns=list(
                    list(
                        `name`="location_id", 
                        `title`="Location ID", 
                        `type`="integer"),
                    list(
                        `name`="local_moran", 
                        `title`="Local Moran", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="local_pvalue", 
                        `title`="Local p-value", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="cluster_type", 
                        `title`="Cluster Type", 
                        `type`="text"),
                    list(
                        `name`="significance", 
                        `title`="Significance", 
                        `type`="text"),
                    list(
                        `name`="quadrant", 
                        `title`="Quadrant", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="spatialClusters",
                title="Spatial Cluster Analysis",
                visible="(cluster_detection)",
                rows=1,
                clearWith=list(
                    "cluster_detection",
                    "measurement"),
                columns=list(
                    list(
                        `name`="cluster_id", 
                        `title`="Cluster ID", 
                        `type`="integer"),
                    list(
                        `name`="cluster_type", 
                        `title`="Cluster Type", 
                        `type`="text"),
                    list(
                        `name`="size", 
                        `title`="Cluster Size", 
                        `type`="integer"),
                    list(
                        `name`="mean_value", 
                        `title`="Mean Value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="local_moran", 
                        `title`="Local Moran", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="significance_level", 
                        `title`="Significance Level", 
                        `type`="text"),
                    list(
                        `name`="clinical_relevance", 
                        `title`="Clinical Relevance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hotspotAnalysis",
                title="Hot Spot Analysis Results",
                visible="(hotspot_analysis)",
                rows=1,
                clearWith=list(
                    "hotspot_analysis",
                    "measurement"),
                columns=list(
                    list(
                        `name`="hotspot_id", 
                        `title`="Hot Spot ID", 
                        `type`="integer"),
                    list(
                        `name`="hotspot_type", 
                        `title`="Type", 
                        `type`="text"),
                    list(
                        `name`="intensity", 
                        `title`="Intensity Score", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_level", 
                        `title`="Confidence Level", 
                        `type`="text"),
                    list(
                        `name`="area_coverage", 
                        `title`="Area Coverage (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="statistical_significance", 
                        `title`="Statistical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="spatialRegimes",
                title="Spatial Regimes Identification",
                visible="(spatial_regimes)",
                rows=1,
                clearWith=list(
                    "spatial_regimes",
                    "measurement"),
                columns=list(
                    list(
                        `name`="regime_id", 
                        `title`="Regime ID", 
                        `type`="integer"),
                    list(
                        `name`="regime_type", 
                        `title`="Regime Type", 
                        `type`="text"),
                    list(
                        `name`="mean_autocorr", 
                        `title`="Mean Autocorrelation", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="regime_size", 
                        `title`="Size (locations)", 
                        `type`="integer"),
                    list(
                        `name`="homogeneity_measure", 
                        `title`="Homogeneity Measure", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="boundary_strength", 
                        `title`="Boundary Strength", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="robustnessAnalysis",
                title="Robustness Analysis",
                visible="(robustness_check)",
                rows=1,
                clearWith=list(
                    "robustness_check",
                    "spatial_weights"),
                columns=list(
                    list(
                        `name`="weight_specification", 
                        `title`="Weight Specification", 
                        `type`="text"),
                    list(
                        `name`="morans_i", 
                        `title`="Moran's I", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="gearys_c", 
                        `title`="Geary's C", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="p_value_moran", 
                        `title`="p-value (Moran)", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="p_value_geary", 
                        `title`="p-value (Geary)", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="consistency_rating", 
                        `title`="Consistency Rating", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="temporalAnalysis",
                title="Temporal Spatial Analysis",
                visible="(temporal_analysis)",
                rows=1,
                clearWith=list(
                    "temporal_analysis",
                    "time_point"),
                columns=list(
                    list(
                        `name`="time_point", 
                        `title`="Time Point", 
                        `type`="text"),
                    list(
                        `name`="morans_i", 
                        `title`="Moran's I", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="change_from_baseline", 
                        `title`="Change from Baseline", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="trend_direction", 
                        `title`="Trend Direction", 
                        `type`="text"),
                    list(
                        `name`="temporal_significance", 
                        `title`="Temporal Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation Guide",
                visible="(clinical_interpretation)",
                rows=1,
                clearWith=list(
                    "clinical_interpretation",
                    "measurement"),
                columns=list(
                    list(
                        `name`="spatial_pattern", 
                        `title`="Spatial Pattern", 
                        `type`="text"),
                    list(
                        `name`="statistical_finding", 
                        `title`="Statistical Finding", 
                        `type`="text"),
                    list(
                        `name`="biological_interpretation", 
                        `title`="Biological Interpretation", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"),
                    list(
                        `name`="follow_up_recommendation", 
                        `title`="Follow-up Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="spatialMap",
                title="Spatial Pattern Map",
                visible="(spatial_plots)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotSpatialMap",
                clearWith=list(
                    "spatial_plots",
                    "measurement",
                    "x_coordinate",
                    "y_coordinate")))
            self$add(jmvcore::Image$new(
                options=options,
                name="autocorrPlot",
                title="Spatial Autocorrelation Functions",
                visible="(autocorr_plots)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotAutocorrFunction",
                clearWith=list(
                    "autocorr_plots",
                    "measurement",
                    "spatial_weights")))
            self$add(jmvcore::Image$new(
                options=options,
                name="lisaMap",
                title="LISA Cluster and Significance Map",
                visible="(lisa_plots && local_analysis)",
                requiresData=TRUE,
                width=900,
                height=600,
                renderFun=".plotLISAMap",
                clearWith=list(
                    "lisa_plots",
                    "local_analysis",
                    "measurement")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Clinical Context",
                visible=TRUE))}))

spatialautocorrelationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "spatialautocorrelationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "spatialautocorrelation",
                version = c(1,0,0),
                options = options,
                results = spatialautocorrelationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Spatial Autocorrelation Analysis (Moran's I, Geary's C)
#'
#' Comprehensive spatial autocorrelation analysis for tissue pattern analysis 
#' and digital pathology. Implements Moran's I, Geary's C, and local 
#' indicators of spatial association (LISA) for detecting spatial clustering 
#' and patterns in histopathological data. Essential for analyzing spatial 
#' dependencies in tissue architecture and cellular distributions.
#' 
#'
#' @examples
#' data \%>\%
#' spatialautocorrelation(
#'     measurement = "biomarker_intensity",
#'     x_coordinate = "cell_x",
#'     y_coordinate = "cell_y",
#'     autocorr_method = "morans_i"
#' )
#'
#' @param data the data as a data frame
#' @param measurement Continuous measurement for spatial autocorrelation
#'   analysis
#' @param x_coordinate X spatial coordinate for location data
#' @param y_coordinate Y spatial coordinate for location data
#' @param region_id Region or tissue identifier for stratified analysis
#' @param time_point Time point identifier for temporal spatial analysis
#' @param autocorr_method Spatial autocorrelation method to compute
#' @param spatial_weights Method for constructing spatial weights matrix
#' @param distance_threshold Distance threshold for spatial neighbor
#'   definition
#' @param k_neighbors Number of nearest neighbors for spatial weights
#' @param bandwidth Bandwidth for Gaussian kernel weights
#' @param significance_test Method for statistical significance testing
#' @param permutations Number of permutations for significance testing
#' @param confidence_level Confidence level for statistical inference
#' @param local_analysis Compute local indicators of spatial association
#' @param cluster_detection Detect and characterize spatial clusters
#' @param hotspot_analysis Identify spatial hot spots and cold spots
#' @param spatial_regimes Identify spatially distinct regimes or patterns
#' @param temporal_analysis Analyze changes in spatial autocorrelation over
#'   time
#' @param multivariate_analysis Analyze spatial relationships between multiple
#'   variables
#' @param robustness_check Test robustness to different spatial weight
#'   specifications
#' @param edge_effects Apply corrections for edge effects in spatial analysis
#' @param clinical_interpretation Provide clinical interpretation of spatial
#'   patterns
#' @param spatial_plots Generate spatial pattern visualization maps
#' @param autocorr_plots Create spatial autocorrelation function plots
#' @param lisa_plots Generate LISA cluster and significance maps
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$dataInfo} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$globalAutocorrelation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$localIndicators} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$spatialClusters} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hotspotAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$spatialRegimes} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$robustnessAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$temporalAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$spatialMap} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$autocorrPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$lisaMap} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$dataInfo$asDF}
#'
#' \code{as.data.frame(results$dataInfo)}
#'
#' @export
spatialautocorrelation <- function(
    data,
    measurement,
    x_coordinate,
    y_coordinate,
    region_id,
    time_point,
    autocorr_method = "morans_i",
    spatial_weights = "k_nearest",
    distance_threshold = 50,
    k_neighbors = 8,
    bandwidth = 25,
    significance_test = "permutation_test",
    permutations = 999,
    confidence_level = 0.95,
    local_analysis = TRUE,
    cluster_detection = TRUE,
    hotspot_analysis = TRUE,
    spatial_regimes = FALSE,
    temporal_analysis = FALSE,
    multivariate_analysis = FALSE,
    robustness_check = TRUE,
    edge_effects = TRUE,
    clinical_interpretation = TRUE,
    spatial_plots = TRUE,
    autocorr_plots = TRUE,
    lisa_plots = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("spatialautocorrelation requires jmvcore to be installed (restart may be required)")

    if ( ! missing(measurement)) measurement <- jmvcore::resolveQuo(jmvcore::enquo(measurement))
    if ( ! missing(x_coordinate)) x_coordinate <- jmvcore::resolveQuo(jmvcore::enquo(x_coordinate))
    if ( ! missing(y_coordinate)) y_coordinate <- jmvcore::resolveQuo(jmvcore::enquo(y_coordinate))
    if ( ! missing(region_id)) region_id <- jmvcore::resolveQuo(jmvcore::enquo(region_id))
    if ( ! missing(time_point)) time_point <- jmvcore::resolveQuo(jmvcore::enquo(time_point))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(measurement), measurement, NULL),
            `if`( ! missing(x_coordinate), x_coordinate, NULL),
            `if`( ! missing(y_coordinate), y_coordinate, NULL),
            `if`( ! missing(region_id), region_id, NULL),
            `if`( ! missing(time_point), time_point, NULL))


    options <- spatialautocorrelationOptions$new(
        measurement = measurement,
        x_coordinate = x_coordinate,
        y_coordinate = y_coordinate,
        region_id = region_id,
        time_point = time_point,
        autocorr_method = autocorr_method,
        spatial_weights = spatial_weights,
        distance_threshold = distance_threshold,
        k_neighbors = k_neighbors,
        bandwidth = bandwidth,
        significance_test = significance_test,
        permutations = permutations,
        confidence_level = confidence_level,
        local_analysis = local_analysis,
        cluster_detection = cluster_detection,
        hotspot_analysis = hotspot_analysis,
        spatial_regimes = spatial_regimes,
        temporal_analysis = temporal_analysis,
        multivariate_analysis = multivariate_analysis,
        robustness_check = robustness_check,
        edge_effects = edge_effects,
        clinical_interpretation = clinical_interpretation,
        spatial_plots = spatial_plots,
        autocorr_plots = autocorr_plots,
        lisa_plots = lisa_plots)

    analysis <- spatialautocorrelationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

