
# This file is automatically generated, you probably don't want to edit this

factoranalysisOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "factoranalysisOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            vars = NULL,
            method = "ml",
            nFactorsMethod = "kaiser",
            nFactors = 1,
            rotation = "varimax",
            scores = "none",
            saveScores = FALSE,
            scoresPrefix = "Factor",
            showUnrotated = FALSE,
            showRotated = TRUE,
            hideSmallLoadings = FALSE,
            loadingsCutoff = 0.3,
            screePlot = TRUE,
            loadingsPlot = FALSE,
            biplot = FALSE,
            priorCommunalities = "smc",
            maxIterations = 25,
            convergence = 0.001,
            adequacyTests = TRUE,
            bartlettTest = TRUE,
            kmoTest = TRUE,
            factorCorrelations = TRUE,
            communalities = TRUE,
            eigenvalues = TRUE,
            bluesky_integration = TRUE,
            comprehensive_output = FALSE,
            clinical_interpretation = TRUE,
            parallel_iterations = 100,
            parallel_percentile = 95,
            plotWidth = 600,
            plotHeight = 400, ...) {

            super$initialize(
                package="ClinicoPath",
                name="factoranalysis",
                requiresData=TRUE,
                ...)

            private$..vars <- jmvcore::OptionVariables$new(
                "vars",
                vars,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..method <- jmvcore::OptionList$new(
                "method",
                method,
                options=list(
                    "ml",
                    "paf",
                    "pc"),
                default="ml")
            private$..nFactorsMethod <- jmvcore::OptionList$new(
                "nFactorsMethod",
                nFactorsMethod,
                options=list(
                    "kaiser",
                    "manual",
                    "parallel",
                    "scree"),
                default="kaiser")
            private$..nFactors <- jmvcore::OptionInteger$new(
                "nFactors",
                nFactors,
                default=1,
                min=1,
                max=20)
            private$..rotation <- jmvcore::OptionList$new(
                "rotation",
                rotation,
                options=list(
                    "none",
                    "varimax",
                    "quartimax",
                    "oblimin",
                    "promax"),
                default="varimax")
            private$..scores <- jmvcore::OptionList$new(
                "scores",
                scores,
                options=list(
                    "none",
                    "regression",
                    "bartlett",
                    "anderson"),
                default="none")
            private$..saveScores <- jmvcore::OptionBool$new(
                "saveScores",
                saveScores,
                default=FALSE)
            private$..scoresPrefix <- jmvcore::OptionString$new(
                "scoresPrefix",
                scoresPrefix,
                default="Factor")
            private$..showUnrotated <- jmvcore::OptionBool$new(
                "showUnrotated",
                showUnrotated,
                default=FALSE)
            private$..showRotated <- jmvcore::OptionBool$new(
                "showRotated",
                showRotated,
                default=TRUE)
            private$..hideSmallLoadings <- jmvcore::OptionBool$new(
                "hideSmallLoadings",
                hideSmallLoadings,
                default=FALSE)
            private$..loadingsCutoff <- jmvcore::OptionNumber$new(
                "loadingsCutoff",
                loadingsCutoff,
                default=0.3,
                min=0,
                max=1)
            private$..screePlot <- jmvcore::OptionBool$new(
                "screePlot",
                screePlot,
                default=TRUE)
            private$..loadingsPlot <- jmvcore::OptionBool$new(
                "loadingsPlot",
                loadingsPlot,
                default=FALSE)
            private$..biplot <- jmvcore::OptionBool$new(
                "biplot",
                biplot,
                default=FALSE)
            private$..priorCommunalities <- jmvcore::OptionList$new(
                "priorCommunalities",
                priorCommunalities,
                options=list(
                    "smc",
                    "maxr",
                    "unity"),
                default="smc")
            private$..maxIterations <- jmvcore::OptionInteger$new(
                "maxIterations",
                maxIterations,
                default=25,
                min=10,
                max=1000)
            private$..convergence <- jmvcore::OptionNumber$new(
                "convergence",
                convergence,
                default=0.001,
                min=0.000001,
                max=0.1)
            private$..adequacyTests <- jmvcore::OptionBool$new(
                "adequacyTests",
                adequacyTests,
                default=TRUE)
            private$..bartlettTest <- jmvcore::OptionBool$new(
                "bartlettTest",
                bartlettTest,
                default=TRUE)
            private$..kmoTest <- jmvcore::OptionBool$new(
                "kmoTest",
                kmoTest,
                default=TRUE)
            private$..factorCorrelations <- jmvcore::OptionBool$new(
                "factorCorrelations",
                factorCorrelations,
                default=TRUE)
            private$..communalities <- jmvcore::OptionBool$new(
                "communalities",
                communalities,
                default=TRUE)
            private$..eigenvalues <- jmvcore::OptionBool$new(
                "eigenvalues",
                eigenvalues,
                default=TRUE)
            private$..bluesky_integration <- jmvcore::OptionBool$new(
                "bluesky_integration",
                bluesky_integration,
                default=TRUE)
            private$..comprehensive_output <- jmvcore::OptionBool$new(
                "comprehensive_output",
                comprehensive_output,
                default=FALSE)
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)
            private$..parallel_iterations <- jmvcore::OptionInteger$new(
                "parallel_iterations",
                parallel_iterations,
                default=100,
                min=50,
                max=1000)
            private$..parallel_percentile <- jmvcore::OptionNumber$new(
                "parallel_percentile",
                parallel_percentile,
                default=95,
                min=50,
                max=99)
            private$..plotWidth <- jmvcore::OptionInteger$new(
                "plotWidth",
                plotWidth,
                default=600,
                min=300,
                max=1200)
            private$..plotHeight <- jmvcore::OptionInteger$new(
                "plotHeight",
                plotHeight,
                default=400,
                min=200,
                max=800)

            self$.addOption(private$..vars)
            self$.addOption(private$..method)
            self$.addOption(private$..nFactorsMethod)
            self$.addOption(private$..nFactors)
            self$.addOption(private$..rotation)
            self$.addOption(private$..scores)
            self$.addOption(private$..saveScores)
            self$.addOption(private$..scoresPrefix)
            self$.addOption(private$..showUnrotated)
            self$.addOption(private$..showRotated)
            self$.addOption(private$..hideSmallLoadings)
            self$.addOption(private$..loadingsCutoff)
            self$.addOption(private$..screePlot)
            self$.addOption(private$..loadingsPlot)
            self$.addOption(private$..biplot)
            self$.addOption(private$..priorCommunalities)
            self$.addOption(private$..maxIterations)
            self$.addOption(private$..convergence)
            self$.addOption(private$..adequacyTests)
            self$.addOption(private$..bartlettTest)
            self$.addOption(private$..kmoTest)
            self$.addOption(private$..factorCorrelations)
            self$.addOption(private$..communalities)
            self$.addOption(private$..eigenvalues)
            self$.addOption(private$..bluesky_integration)
            self$.addOption(private$..comprehensive_output)
            self$.addOption(private$..clinical_interpretation)
            self$.addOption(private$..parallel_iterations)
            self$.addOption(private$..parallel_percentile)
            self$.addOption(private$..plotWidth)
            self$.addOption(private$..plotHeight)
        }),
    active = list(
        vars = function() private$..vars$value,
        method = function() private$..method$value,
        nFactorsMethod = function() private$..nFactorsMethod$value,
        nFactors = function() private$..nFactors$value,
        rotation = function() private$..rotation$value,
        scores = function() private$..scores$value,
        saveScores = function() private$..saveScores$value,
        scoresPrefix = function() private$..scoresPrefix$value,
        showUnrotated = function() private$..showUnrotated$value,
        showRotated = function() private$..showRotated$value,
        hideSmallLoadings = function() private$..hideSmallLoadings$value,
        loadingsCutoff = function() private$..loadingsCutoff$value,
        screePlot = function() private$..screePlot$value,
        loadingsPlot = function() private$..loadingsPlot$value,
        biplot = function() private$..biplot$value,
        priorCommunalities = function() private$..priorCommunalities$value,
        maxIterations = function() private$..maxIterations$value,
        convergence = function() private$..convergence$value,
        adequacyTests = function() private$..adequacyTests$value,
        bartlettTest = function() private$..bartlettTest$value,
        kmoTest = function() private$..kmoTest$value,
        factorCorrelations = function() private$..factorCorrelations$value,
        communalities = function() private$..communalities$value,
        eigenvalues = function() private$..eigenvalues$value,
        bluesky_integration = function() private$..bluesky_integration$value,
        comprehensive_output = function() private$..comprehensive_output$value,
        clinical_interpretation = function() private$..clinical_interpretation$value,
        parallel_iterations = function() private$..parallel_iterations$value,
        parallel_percentile = function() private$..parallel_percentile$value,
        plotWidth = function() private$..plotWidth$value,
        plotHeight = function() private$..plotHeight$value),
    private = list(
        ..vars = NA,
        ..method = NA,
        ..nFactorsMethod = NA,
        ..nFactors = NA,
        ..rotation = NA,
        ..scores = NA,
        ..saveScores = NA,
        ..scoresPrefix = NA,
        ..showUnrotated = NA,
        ..showRotated = NA,
        ..hideSmallLoadings = NA,
        ..loadingsCutoff = NA,
        ..screePlot = NA,
        ..loadingsPlot = NA,
        ..biplot = NA,
        ..priorCommunalities = NA,
        ..maxIterations = NA,
        ..convergence = NA,
        ..adequacyTests = NA,
        ..bartlettTest = NA,
        ..kmoTest = NA,
        ..factorCorrelations = NA,
        ..communalities = NA,
        ..eigenvalues = NA,
        ..bluesky_integration = NA,
        ..comprehensive_output = NA,
        ..clinical_interpretation = NA,
        ..parallel_iterations = NA,
        ..parallel_percentile = NA,
        ..plotWidth = NA,
        ..plotHeight = NA)
)

factoranalysisResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "factoranalysisResults",
    inherit = jmvcore::Group,
    active = list(
        results = function() private$.items[["results"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Comprehensive Factor Analysis Results",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(R6::R6Class(
                inherit = jmvcore::Group,
                active = list(
                    instructions = function() private$.items[["instructions"]],
                    adequacyTable = function() private$.items[["adequacyTable"]],
                    eigenvaluesTable = function() private$.items[["eigenvaluesTable"]],
                    parallelAnalysis = function() private$.items[["parallelAnalysis"]],
                    communalitiesTable = function() private$.items[["communalitiesTable"]],
                    unrotatedLoadings = function() private$.items[["unrotatedLoadings"]],
                    rotatedLoadings = function() private$.items[["rotatedLoadings"]],
                    factorLoadings = function() private$.items[["factorLoadings"]],
                    factorCorrelationsTable = function() private$.items[["factorCorrelationsTable"]],
                    factorScoresStats = function() private$.items[["factorScoresStats"]],
                    goodnessOfFit = function() private$.items[["goodnessOfFit"]],
                    comprehensiveResults = function() private$.items[["comprehensiveResults"]],
                    clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
                    methodDetails = function() private$.items[["methodDetails"]],
                    screePlotImage = function() private$.items[["screePlotImage"]],
                    loadingsPlotImage = function() private$.items[["loadingsPlotImage"]],
                    biplotImage = function() private$.items[["biplotImage"]],
                    parallelPlot = function() private$.items[["parallelPlot"]]),
                private = list(),
                public=list(
                    initialize=function(options) {
                        super$initialize(
                            options=options,
                            name="results",
                            title="Analysis Results")
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="instructions",
                            title="Instructions",
                            visible=TRUE))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="adequacyTable",
                            title="Sampling Adequacy Tests",
                            visible="(adequacyTests)",
                            columns=list(
                                list(
                                    `name`="test", 
                                    `title`="Test", 
                                    `type`="text"),
                                list(
                                    `name`="statistic", 
                                    `title`="Statistic", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="pValue", 
                                    `title`="p", 
                                    `type`="number", 
                                    `format`="zto;pvalue"),
                                list(
                                    `name`="result", 
                                    `title`="Result", 
                                    `type`="text"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="eigenvaluesTable",
                            title="Total Variance Explained",
                            visible="(eigenvalues)",
                            columns=list(
                                list(
                                    `name`="factor", 
                                    `title`="Factor", 
                                    `type`="integer"),
                                list(
                                    `name`="eigenvalue", 
                                    `title`="Eigenvalue", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="variance_percent", 
                                    `title`="% Variance", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="cumulative_percent", 
                                    `title`="% Cumulative", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="eigenvalue_rotated", 
                                    `title`="Rotated Eigenvalue", 
                                    `type`="number", 
                                    `format`="zto", 
                                    `visible`="(rotation:!none)"),
                                list(
                                    `name`="variance_percent_rotated", 
                                    `title`="Rotated % Variance", 
                                    `type`="number", 
                                    `format`="zto", 
                                    `visible`="(rotation:!none)"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="parallelAnalysis",
                            title="Parallel Analysis Results",
                            visible="(nFactorsMethod:parallel)",
                            columns=list(
                                list(
                                    `name`="factor", 
                                    `title`="Factor", 
                                    `type`="integer"),
                                list(
                                    `name`="actual_eigenvalue", 
                                    `title`="Actual Eigenvalue", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="random_eigenvalue", 
                                    `title`="Random Eigenvalue", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="retain_factor", 
                                    `title`="Retain?", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="communalitiesTable",
                            title="Communalities",
                            visible="(communalities)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="initial", 
                                    `title`="Initial", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="extracted", 
                                    `title`="Extracted", 
                                    `type`="number", 
                                    `format`="zto"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="unrotatedLoadings",
                            title="Unrotated Factor Loadings",
                            visible="(showUnrotated)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="rotatedLoadings",
                            title="Rotated Factor Loadings",
                            visible="(showRotated && rotation:!none)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="factorLoadings",
                            title="Factor Loadings",
                            visible="(showRotated && rotation:none)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="factorCorrelationsTable",
                            title="Factor Correlations",
                            visible="(factorCorrelations && (rotation:oblimin || rotation:promax))",
                            columns=list(
                                list(
                                    `name`="factor", 
                                    `title`="Factor", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="factorScoresStats",
                            title="Factor Scores Statistics",
                            visible="(scores:!none)",
                            columns=list(
                                list(
                                    `name`="factor", 
                                    `title`="Factor", 
                                    `type`="text"),
                                list(
                                    `name`="mean", 
                                    `title`="Mean", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="sd", 
                                    `title`="SD", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="min", 
                                    `title`="Minimum", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="max", 
                                    `title`="Maximum", 
                                    `type`="number", 
                                    `format`="zto"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="goodnessOfFit",
                            title="Goodness of Fit Test",
                            visible="(method:ml)",
                            columns=list(
                                list(
                                    `name`="statistic", 
                                    `title`="Chi-square", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="df", 
                                    `title`="df", 
                                    `type`="integer"),
                                list(
                                    `name`="pValue", 
                                    `title`="p", 
                                    `type`="number", 
                                    `format`="zto;pvalue"),
                                list(
                                    `name`="result", 
                                    `title`="Result", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="comprehensiveResults",
                            title="Comprehensive Factor Analysis Summary",
                            visible="(bluesky_integration && comprehensive_output)",
                            columns=list(
                                list(
                                    `name`="measure", 
                                    `title`="Measure", 
                                    `type`="text"),
                                list(
                                    `name`="value", 
                                    `title`="Value", 
                                    `type`="text"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"))))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="clinicalInterpretation",
                            title="Clinical Application Guidance",
                            visible="(clinical_interpretation)"))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="methodDetails",
                            title="Analysis Method Details",
                            visible="(comprehensive_output)"))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="screePlotImage",
                            title="Scree Plot",
                            visible="(screePlot)",
                            renderFun=".plotScree",
                            width=600,
                            height=400))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="loadingsPlotImage",
                            title="Factor Loadings Plot",
                            visible="(loadingsPlot)",
                            renderFun=".plotLoadings",
                            width=600,
                            height=400))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="biplotImage",
                            title="Factor Biplot",
                            visible="(biplot)",
                            renderFun=".plotBiplot",
                            width=600,
                            height=600))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="parallelPlot",
                            title="Parallel Analysis Plot",
                            visible="(nFactorsMethod:parallel)",
                            renderFun=".plotParallel",
                            width=600,
                            height=400))}))$new(options=options))}))

factoranalysisBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "factoranalysisBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "factoranalysis",
                version = c(0,0,31),
                options = options,
                results = factoranalysisResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Comprehensive Factor Analysis
#'
#' Comprehensive factor analysis toolkit with BlueSky R integration. Includes
#' maximum likelihood factor analysis, principal axis factoring, scree plots,
#' multiple rotation methods, and factor score extraction. Essential for
#' dimensionality reduction, scale development, and multivariate analysis
#' in clinical and pathological research.
#' 
#' @param data The data as a data frame.
#' @param vars Numeric variables for factor analysis
#' @param method Method for factor extraction
#' @param nFactorsMethod Method for determining number of factors
#' @param nFactors Number of factors to extract (when method = manual)
#' @param rotation Factor rotation method
#' @param scores Method for computing factor scores
#' @param saveScores Save factor scores to dataset
#' @param scoresPrefix Prefix for saved factor score variables
#' @param showUnrotated Display unrotated factor loadings
#' @param showRotated Display rotated factor loadings
#' @param hideSmallLoadings Hide loadings below cutoff
#' @param loadingsCutoff Cutoff for hiding small loadings
#' @param screePlot Display scree plot of eigenvalues
#' @param loadingsPlot Display factor loadings plot
#' @param biplot Display factor biplot (first 2 factors)
#' @param priorCommunalities Method for prior communality estimates
#' @param maxIterations Maximum iterations for factor extraction
#' @param convergence Convergence criterion for factor extraction
#' @param adequacyTests Perform sampling adequacy tests
#' @param bartlettTest Test if correlation matrix is identity matrix
#' @param kmoTest Measure of sampling adequacy
#' @param factorCorrelations Show correlations between factors (oblique
#'   rotation)
#' @param communalities Show initial and extracted communalities
#' @param eigenvalues Show eigenvalues and variance explained
#' @param bluesky_integration Use BlueSky R statistical environment features
#' @param comprehensive_output Include comprehensive statistical details
#' @param clinical_interpretation Provide clinical context for factor analysis
#'   results
#' @param parallel_iterations Number of iterations for parallel analysis
#' @param parallel_percentile Percentile for parallel analysis threshold
#' @param plotWidth Width of plots
#' @param plotHeight Height of plots
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$adequacyTable} \tab \tab \tab \tab \tab Tests for appropriateness of factor analysis \cr
#'   \code{results$results$eigenvaluesTable} \tab \tab \tab \tab \tab Eigenvalues and percentage of variance explained \cr
#'   \code{results$results$parallelAnalysis} \tab \tab \tab \tab \tab Comparison of eigenvalues with random data \cr
#'   \code{results$results$communalitiesTable} \tab \tab \tab \tab \tab Initial and extracted communalities \cr
#'   \code{results$results$unrotatedLoadings} \tab \tab \tab \tab \tab Factor loadings before rotation \cr
#'   \code{results$results$rotatedLoadings} \tab \tab \tab \tab \tab Factor loadings after rotation \cr
#'   \code{results$results$factorLoadings} \tab \tab \tab \tab \tab Factor loadings matrix \cr
#'   \code{results$results$factorCorrelationsTable} \tab \tab \tab \tab \tab Correlations between factors (oblique rotation only) \cr
#'   \code{results$results$factorScoresStats} \tab \tab \tab \tab \tab Descriptive statistics for factor scores \cr
#'   \code{results$results$goodnessOfFit} \tab \tab \tab \tab \tab Chi-square test of model fit \cr
#'   \code{results$results$comprehensiveResults} \tab \tab \tab \tab \tab Enhanced statistical output with BlueSky integration \cr
#'   \code{results$results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$methodDetails} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$screePlotImage} \tab \tab \tab \tab \tab Plot of eigenvalues \cr
#'   \code{results$results$loadingsPlotImage} \tab \tab \tab \tab \tab Visualization of factor loadings \cr
#'   \code{results$results$biplotImage} \tab \tab \tab \tab \tab Biplot of first two factors \cr
#'   \code{results$results$parallelPlot} \tab \tab \tab \tab \tab Comparison of actual vs random eigenvalues \cr
#' }
#'
#' @export
factoranalysis <- function(
    data,
    vars,
    method = "ml",
    nFactorsMethod = "kaiser",
    nFactors = 1,
    rotation = "varimax",
    scores = "none",
    saveScores = FALSE,
    scoresPrefix = "Factor",
    showUnrotated = FALSE,
    showRotated = TRUE,
    hideSmallLoadings = FALSE,
    loadingsCutoff = 0.3,
    screePlot = TRUE,
    loadingsPlot = FALSE,
    biplot = FALSE,
    priorCommunalities = "smc",
    maxIterations = 25,
    convergence = 0.001,
    adequacyTests = TRUE,
    bartlettTest = TRUE,
    kmoTest = TRUE,
    factorCorrelations = TRUE,
    communalities = TRUE,
    eigenvalues = TRUE,
    bluesky_integration = TRUE,
    comprehensive_output = FALSE,
    clinical_interpretation = TRUE,
    parallel_iterations = 100,
    parallel_percentile = 95,
    plotWidth = 600,
    plotHeight = 400) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("factoranalysis requires jmvcore to be installed (restart may be required)")

    if ( ! missing(vars)) vars <- jmvcore::resolveQuo(jmvcore::enquo(vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(vars), vars, NULL))


    options <- factoranalysisOptions$new(
        vars = vars,
        method = method,
        nFactorsMethod = nFactorsMethod,
        nFactors = nFactors,
        rotation = rotation,
        scores = scores,
        saveScores = saveScores,
        scoresPrefix = scoresPrefix,
        showUnrotated = showUnrotated,
        showRotated = showRotated,
        hideSmallLoadings = hideSmallLoadings,
        loadingsCutoff = loadingsCutoff,
        screePlot = screePlot,
        loadingsPlot = loadingsPlot,
        biplot = biplot,
        priorCommunalities = priorCommunalities,
        maxIterations = maxIterations,
        convergence = convergence,
        adequacyTests = adequacyTests,
        bartlettTest = bartlettTest,
        kmoTest = kmoTest,
        factorCorrelations = factorCorrelations,
        communalities = communalities,
        eigenvalues = eigenvalues,
        bluesky_integration = bluesky_integration,
        comprehensive_output = comprehensive_output,
        clinical_interpretation = clinical_interpretation,
        parallel_iterations = parallel_iterations,
        parallel_percentile = parallel_percentile,
        plotWidth = plotWidth,
        plotHeight = plotHeight)

    analysis <- factoranalysisClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

