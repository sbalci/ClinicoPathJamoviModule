
# This file is automatically generated, you probably don't want to edit this

sparsegrouplassoOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sparsegrouplassoOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_var = NULL,
            event_var = NULL,
            pred_vars = NULL,
            group_definition = "factor_based",
            custom_groups = "",
            pathway_info = NULL,
            correlation_threshold = 0.7,
            alpha_sgl = 0.95,
            lambda_sequence = "auto",
            custom_lambda = "",
            lambda_min_ratio = 0.001,
            n_lambda = 100,
            selection_criterion = "cv_deviance",
            cv_folds = 10,
            cv_repeats = 1,
            ebic_gamma = 1,
            weight_type = "none",
            weight_power = 1,
            standardize_vars = TRUE,
            center_vars = TRUE,
            orthogonalize_groups = FALSE,
            max_iterations = 1000,
            convergence_threshold = 0.000001,
            warm_start = TRUE,
            parallel_cv = FALSE,
            seed_value = 42,
            show_summary = TRUE,
            show_coefficients = TRUE,
            show_groups = TRUE,
            show_path = FALSE,
            show_performance = TRUE,
            show_validation = TRUE,
            plot_cv_error = TRUE,
            plot_coefficients = TRUE,
            plot_groups = TRUE,
            plot_sparsity = FALSE,
            plot_stability = FALSE,
            alpha_level = 0.05,
            confidence_intervals = FALSE,
            bootstrap_samples = 500,
            stability_selection = FALSE,
            stability_threshold = 0.8,
            stability_subsample = 0.8,
            showExplanations = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="sparsegrouplasso",
                requiresData=TRUE,
                ...)

            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_var <- jmvcore::OptionVariable$new(
                "event_var",
                event_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..pred_vars <- jmvcore::OptionVariables$new(
                "pred_vars",
                pred_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..group_definition <- jmvcore::OptionList$new(
                "group_definition",
                group_definition,
                options=list(
                    "factor_based",
                    "custom",
                    "pathway_based",
                    "variable_type",
                    "correlation_based"),
                default="factor_based")
            private$..custom_groups <- jmvcore::OptionString$new(
                "custom_groups",
                custom_groups,
                default="")
            private$..pathway_info <- jmvcore::OptionVariable$new(
                "pathway_info",
                pathway_info,
                permitted=list(
                    "factor"))
            private$..correlation_threshold <- jmvcore::OptionNumber$new(
                "correlation_threshold",
                correlation_threshold,
                min=0,
                max=1,
                default=0.7)
            private$..alpha_sgl <- jmvcore::OptionNumber$new(
                "alpha_sgl",
                alpha_sgl,
                min=0,
                max=1,
                default=0.95)
            private$..lambda_sequence <- jmvcore::OptionList$new(
                "lambda_sequence",
                lambda_sequence,
                options=list(
                    "auto",
                    "custom",
                    "adaptive"),
                default="auto")
            private$..custom_lambda <- jmvcore::OptionString$new(
                "custom_lambda",
                custom_lambda,
                default="")
            private$..lambda_min_ratio <- jmvcore::OptionNumber$new(
                "lambda_min_ratio",
                lambda_min_ratio,
                min=0.001,
                max=0.5,
                default=0.001)
            private$..n_lambda <- jmvcore::OptionInteger$new(
                "n_lambda",
                n_lambda,
                min=10,
                max=200,
                default=100)
            private$..selection_criterion <- jmvcore::OptionList$new(
                "selection_criterion",
                selection_criterion,
                options=list(
                    "cv_deviance",
                    "cv_c_index",
                    "aic",
                    "bic",
                    "ebic"),
                default="cv_deviance")
            private$..cv_folds <- jmvcore::OptionInteger$new(
                "cv_folds",
                cv_folds,
                min=3,
                max=20,
                default=10)
            private$..cv_repeats <- jmvcore::OptionInteger$new(
                "cv_repeats",
                cv_repeats,
                min=1,
                max=10,
                default=1)
            private$..ebic_gamma <- jmvcore::OptionNumber$new(
                "ebic_gamma",
                ebic_gamma,
                min=0,
                max=1,
                default=1)
            private$..weight_type <- jmvcore::OptionList$new(
                "weight_type",
                weight_type,
                options=list(
                    "none",
                    "ridge_based",
                    "univariate_based",
                    "lasso_based"),
                default="none")
            private$..weight_power <- jmvcore::OptionNumber$new(
                "weight_power",
                weight_power,
                min=0.5,
                max=5,
                default=1)
            private$..standardize_vars <- jmvcore::OptionBool$new(
                "standardize_vars",
                standardize_vars,
                default=TRUE)
            private$..center_vars <- jmvcore::OptionBool$new(
                "center_vars",
                center_vars,
                default=TRUE)
            private$..orthogonalize_groups <- jmvcore::OptionBool$new(
                "orthogonalize_groups",
                orthogonalize_groups,
                default=FALSE)
            private$..max_iterations <- jmvcore::OptionInteger$new(
                "max_iterations",
                max_iterations,
                min=100,
                max=10000,
                default=1000)
            private$..convergence_threshold <- jmvcore::OptionNumber$new(
                "convergence_threshold",
                convergence_threshold,
                min=1e-8,
                max=0.001,
                default=0.000001)
            private$..warm_start <- jmvcore::OptionBool$new(
                "warm_start",
                warm_start,
                default=TRUE)
            private$..parallel_cv <- jmvcore::OptionBool$new(
                "parallel_cv",
                parallel_cv,
                default=FALSE)
            private$..seed_value <- jmvcore::OptionInteger$new(
                "seed_value",
                seed_value,
                default=42)
            private$..show_summary <- jmvcore::OptionBool$new(
                "show_summary",
                show_summary,
                default=TRUE)
            private$..show_coefficients <- jmvcore::OptionBool$new(
                "show_coefficients",
                show_coefficients,
                default=TRUE)
            private$..show_groups <- jmvcore::OptionBool$new(
                "show_groups",
                show_groups,
                default=TRUE)
            private$..show_path <- jmvcore::OptionBool$new(
                "show_path",
                show_path,
                default=FALSE)
            private$..show_performance <- jmvcore::OptionBool$new(
                "show_performance",
                show_performance,
                default=TRUE)
            private$..show_validation <- jmvcore::OptionBool$new(
                "show_validation",
                show_validation,
                default=TRUE)
            private$..plot_cv_error <- jmvcore::OptionBool$new(
                "plot_cv_error",
                plot_cv_error,
                default=TRUE)
            private$..plot_coefficients <- jmvcore::OptionBool$new(
                "plot_coefficients",
                plot_coefficients,
                default=TRUE)
            private$..plot_groups <- jmvcore::OptionBool$new(
                "plot_groups",
                plot_groups,
                default=TRUE)
            private$..plot_sparsity <- jmvcore::OptionBool$new(
                "plot_sparsity",
                plot_sparsity,
                default=FALSE)
            private$..plot_stability <- jmvcore::OptionBool$new(
                "plot_stability",
                plot_stability,
                default=FALSE)
            private$..alpha_level <- jmvcore::OptionNumber$new(
                "alpha_level",
                alpha_level,
                min=0.01,
                max=0.1,
                default=0.05)
            private$..confidence_intervals <- jmvcore::OptionBool$new(
                "confidence_intervals",
                confidence_intervals,
                default=FALSE)
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                min=100,
                max=2000,
                default=500)
            private$..stability_selection <- jmvcore::OptionBool$new(
                "stability_selection",
                stability_selection,
                default=FALSE)
            private$..stability_threshold <- jmvcore::OptionNumber$new(
                "stability_threshold",
                stability_threshold,
                min=0.5,
                max=0.95,
                default=0.8)
            private$..stability_subsample <- jmvcore::OptionNumber$new(
                "stability_subsample",
                stability_subsample,
                min=0.5,
                max=0.9,
                default=0.8)
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=TRUE)

            self$.addOption(private$..time_var)
            self$.addOption(private$..event_var)
            self$.addOption(private$..pred_vars)
            self$.addOption(private$..group_definition)
            self$.addOption(private$..custom_groups)
            self$.addOption(private$..pathway_info)
            self$.addOption(private$..correlation_threshold)
            self$.addOption(private$..alpha_sgl)
            self$.addOption(private$..lambda_sequence)
            self$.addOption(private$..custom_lambda)
            self$.addOption(private$..lambda_min_ratio)
            self$.addOption(private$..n_lambda)
            self$.addOption(private$..selection_criterion)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..cv_repeats)
            self$.addOption(private$..ebic_gamma)
            self$.addOption(private$..weight_type)
            self$.addOption(private$..weight_power)
            self$.addOption(private$..standardize_vars)
            self$.addOption(private$..center_vars)
            self$.addOption(private$..orthogonalize_groups)
            self$.addOption(private$..max_iterations)
            self$.addOption(private$..convergence_threshold)
            self$.addOption(private$..warm_start)
            self$.addOption(private$..parallel_cv)
            self$.addOption(private$..seed_value)
            self$.addOption(private$..show_summary)
            self$.addOption(private$..show_coefficients)
            self$.addOption(private$..show_groups)
            self$.addOption(private$..show_path)
            self$.addOption(private$..show_performance)
            self$.addOption(private$..show_validation)
            self$.addOption(private$..plot_cv_error)
            self$.addOption(private$..plot_coefficients)
            self$.addOption(private$..plot_groups)
            self$.addOption(private$..plot_sparsity)
            self$.addOption(private$..plot_stability)
            self$.addOption(private$..alpha_level)
            self$.addOption(private$..confidence_intervals)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..stability_selection)
            self$.addOption(private$..stability_threshold)
            self$.addOption(private$..stability_subsample)
            self$.addOption(private$..showExplanations)
        }),
    active = list(
        time_var = function() private$..time_var$value,
        event_var = function() private$..event_var$value,
        pred_vars = function() private$..pred_vars$value,
        group_definition = function() private$..group_definition$value,
        custom_groups = function() private$..custom_groups$value,
        pathway_info = function() private$..pathway_info$value,
        correlation_threshold = function() private$..correlation_threshold$value,
        alpha_sgl = function() private$..alpha_sgl$value,
        lambda_sequence = function() private$..lambda_sequence$value,
        custom_lambda = function() private$..custom_lambda$value,
        lambda_min_ratio = function() private$..lambda_min_ratio$value,
        n_lambda = function() private$..n_lambda$value,
        selection_criterion = function() private$..selection_criterion$value,
        cv_folds = function() private$..cv_folds$value,
        cv_repeats = function() private$..cv_repeats$value,
        ebic_gamma = function() private$..ebic_gamma$value,
        weight_type = function() private$..weight_type$value,
        weight_power = function() private$..weight_power$value,
        standardize_vars = function() private$..standardize_vars$value,
        center_vars = function() private$..center_vars$value,
        orthogonalize_groups = function() private$..orthogonalize_groups$value,
        max_iterations = function() private$..max_iterations$value,
        convergence_threshold = function() private$..convergence_threshold$value,
        warm_start = function() private$..warm_start$value,
        parallel_cv = function() private$..parallel_cv$value,
        seed_value = function() private$..seed_value$value,
        show_summary = function() private$..show_summary$value,
        show_coefficients = function() private$..show_coefficients$value,
        show_groups = function() private$..show_groups$value,
        show_path = function() private$..show_path$value,
        show_performance = function() private$..show_performance$value,
        show_validation = function() private$..show_validation$value,
        plot_cv_error = function() private$..plot_cv_error$value,
        plot_coefficients = function() private$..plot_coefficients$value,
        plot_groups = function() private$..plot_groups$value,
        plot_sparsity = function() private$..plot_sparsity$value,
        plot_stability = function() private$..plot_stability$value,
        alpha_level = function() private$..alpha_level$value,
        confidence_intervals = function() private$..confidence_intervals$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        stability_selection = function() private$..stability_selection$value,
        stability_threshold = function() private$..stability_threshold$value,
        stability_subsample = function() private$..stability_subsample$value,
        showExplanations = function() private$..showExplanations$value),
    private = list(
        ..time_var = NA,
        ..event_var = NA,
        ..pred_vars = NA,
        ..group_definition = NA,
        ..custom_groups = NA,
        ..pathway_info = NA,
        ..correlation_threshold = NA,
        ..alpha_sgl = NA,
        ..lambda_sequence = NA,
        ..custom_lambda = NA,
        ..lambda_min_ratio = NA,
        ..n_lambda = NA,
        ..selection_criterion = NA,
        ..cv_folds = NA,
        ..cv_repeats = NA,
        ..ebic_gamma = NA,
        ..weight_type = NA,
        ..weight_power = NA,
        ..standardize_vars = NA,
        ..center_vars = NA,
        ..orthogonalize_groups = NA,
        ..max_iterations = NA,
        ..convergence_threshold = NA,
        ..warm_start = NA,
        ..parallel_cv = NA,
        ..seed_value = NA,
        ..show_summary = NA,
        ..show_coefficients = NA,
        ..show_groups = NA,
        ..show_path = NA,
        ..show_performance = NA,
        ..show_validation = NA,
        ..plot_cv_error = NA,
        ..plot_coefficients = NA,
        ..plot_groups = NA,
        ..plot_sparsity = NA,
        ..plot_stability = NA,
        ..alpha_level = NA,
        ..confidence_intervals = NA,
        ..bootstrap_samples = NA,
        ..stability_selection = NA,
        ..stability_threshold = NA,
        ..stability_subsample = NA,
        ..showExplanations = NA)
)

sparsegrouplassoResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sparsegrouplassoResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        todo = function() private$.items[["todo"]],
        summary = function() private$.items[["summary"]],
        coefficients = function() private$.items[["coefficients"]],
        groupStructure = function() private$.items[["groupStructure"]],
        solutionPath = function() private$.items[["solutionPath"]],
        performance = function() private$.items[["performance"]],
        validationResults = function() private$.items[["validationResults"]],
        adaptiveWeights = function() private$.items[["adaptiveWeights"]],
        stabilityResults = function() private$.items[["stabilityResults"]],
        comparisonTable = function() private$.items[["comparisonTable"]],
        cvErrorPlot = function() private$.items[["cvErrorPlot"]],
        coefficientPlot = function() private$.items[["coefficientPlot"]],
        groupSelectionPlot = function() private$.items[["groupSelectionPlot"]],
        sparsityPlot = function() private$.items[["sparsityPlot"]],
        stabilityPlot = function() private$.items[["stabilityPlot"]],
        explanations = function() private$.items[["explanations"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Analysis Results",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "survival"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Todo",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="summary",
                title="Sparse Group LASSO Summary",
                visible="(show_summary)",
                clearWith=list(
                    "time_var",
                    "event_var",
                    "pred_vars",
                    "alpha_sgl",
                    "selection_criterion"),
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="coefficients",
                title="Selected Coefficients",
                visible="(show_coefficients)",
                clearWith=list(
                    "pred_vars",
                    "alpha_sgl",
                    "lambda_sequence",
                    "selection_criterion"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="coefficient", 
                        `title`="Coefficient", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="hazard_ratio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="standardized_coef", 
                        `title`="Standardized Coef", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="importance", 
                        `title`="Importance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="selection_frequency", 
                        `title`="Selection Frequency", 
                        `type`="number", 
                        `format`="pc"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="groupStructure",
                title="Group Structure",
                visible="(show_groups)",
                clearWith=list(
                    "pred_vars",
                    "group_definition",
                    "custom_groups"),
                columns=list(
                    list(
                        `name`="group_id", 
                        `title`="Group ID", 
                        `type`="integer"),
                    list(
                        `name`="group_name", 
                        `title`="Group Name", 
                        `type`="text"),
                    list(
                        `name`="n_variables", 
                        `title`="Variables", 
                        `type`="integer"),
                    list(
                        `name`="group_selected", 
                        `title`="Selected", 
                        `type`="text"),
                    list(
                        `name`="group_penalty", 
                        `title`="Group Penalty", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sparsity_within", 
                        `title`="Within-Group Sparsity", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="variables_list", 
                        `title`="Variables in Group", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="solutionPath",
                title="Regularization Path",
                visible="(show_path)",
                clearWith=list(
                    "alpha_sgl",
                    "lambda_sequence"),
                columns=list(
                    list(
                        `name`="lambda_index", 
                        `title`="Lambda Index", 
                        `type`="integer"),
                    list(
                        `name`="lambda_value", 
                        `title`="Lambda", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="n_selected_vars", 
                        `title`="Selected Variables", 
                        `type`="integer"),
                    list(
                        `name`="n_selected_groups", 
                        `title`="Selected Groups", 
                        `type`="integer"),
                    list(
                        `name`="deviance", 
                        `title`="Deviance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="df", 
                        `title`="Degrees of Freedom", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sparsity_level", 
                        `title`="Sparsity Level", 
                        `type`="number", 
                        `format`="pc"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="performance",
                title="Performance Metrics",
                visible="(show_performance)",
                clearWith=list(
                    "selection_criterion",
                    "cv_folds"),
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="training", 
                        `title`="Training", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="cv_mean", 
                        `title`="CV Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="cv_se", 
                        `title`="CV SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="validationResults",
                title="Cross-Validation Results",
                visible="(show_validation)",
                clearWith=list(
                    "cv_folds",
                    "cv_repeats",
                    "selection_criterion"),
                columns=list(
                    list(
                        `name`="lambda_value", 
                        `title`="Lambda", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="cv_error", 
                        `title`="CV Error", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="cv_se", 
                        `title`="CV SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="n_selected", 
                        `title`="Variables Selected", 
                        `type`="integer"),
                    list(
                        `name`="model_rank", 
                        `title`="Model Rank", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="adaptiveWeights",
                title="Adaptive Weights",
                visible="(weight_type:none)",
                clearWith=list(
                    "weight_type",
                    "weight_power"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="individual_weight", 
                        `title`="Individual Weight", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="group_weight", 
                        `title`="Group Weight", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="combined_weight", 
                        `title`="Combined Weight", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="weight_rationale", 
                        `title`="Weight Rationale", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stabilityResults",
                title="Stability Selection Results",
                visible="(stability_selection)",
                clearWith=list(
                    "stability_selection",
                    "stability_threshold"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="selection_probability", 
                        `title`="Selection Probability", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="stable_selection", 
                        `title`="Stable Selection", 
                        `type`="text"),
                    list(
                        `name`="first_selected", 
                        `title`="First Selected (Lambda)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="last_selected", 
                        `title`="Last Selected (Lambda)", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="comparisonTable",
                title="Method Comparison",
                visible="(show_performance)",
                clearWith=list(
                    "alpha_sgl",
                    "selection_criterion"),
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="n_selected", 
                        `title`="Variables Selected", 
                        `type`="integer"),
                    list(
                        `name`="n_groups_selected", 
                        `title`="Groups Selected", 
                        `type`="integer"),
                    list(
                        `name`="cv_error", 
                        `title`="CV Error", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="c_index", 
                        `title`="C-Index", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="relative_performance", 
                        `title`="Relative Performance", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="cvErrorPlot",
                title="Cross-Validation Error",
                width=600,
                height=400,
                visible="(plot_cv_error)",
                requiresData=TRUE,
                clearWith=list(
                    "lambda_sequence",
                    "cv_folds",
                    "selection_criterion")))
            self$add(jmvcore::Image$new(
                options=options,
                name="coefficientPlot",
                title="Coefficient Path",
                width=700,
                height=500,
                visible="(plot_coefficients)",
                requiresData=TRUE,
                clearWith=list(
                    "alpha_sgl",
                    "lambda_sequence",
                    "pred_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="groupSelectionPlot",
                title="Group Selection Pattern",
                width=600,
                height=400,
                visible="(plot_groups)",
                requiresData=TRUE,
                clearWith=list(
                    "group_definition",
                    "alpha_sgl",
                    "lambda_sequence")))
            self$add(jmvcore::Image$new(
                options=options,
                name="sparsityPlot",
                title="Sparsity Pattern",
                width=600,
                height=400,
                visible="(plot_sparsity)",
                requiresData=TRUE,
                clearWith=list(
                    "alpha_sgl",
                    "lambda_sequence",
                    "selection_criterion")))
            self$add(jmvcore::Image$new(
                options=options,
                name="stabilityPlot",
                title="Stability Selection",
                width=600,
                height=400,
                visible="(plot_stability)",
                requiresData=TRUE,
                clearWith=list(
                    "stability_selection",
                    "stability_threshold",
                    "stability_subsample")))
            self$add(jmvcore::Html$new(
                options=options,
                name="explanations",
                title="Sparse Group LASSO Explanations",
                visible="(showExplanations)"))}))

sparsegrouplassoBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "sparsegrouplassoBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "sparsegrouplasso",
                version = c(1,0,0),
                options = options,
                results = sparsegrouplassoResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Sparse Group LASSO
#'
#' Sparse Group LASSO regularization for survival analysis
#'
#' @examples
#' data('histopathology', package='ClinicoPath')
#'
#' sparsegrouplasso(data = histopathology,
#'                time_var = 'OverallSurvival',
#'                event_var = 'Death',
#'                pred_vars = c('Age', 'Grade', 'LVI', 'PNI'),
#'                group_definition = 'factor_based',
#'                alpha_sgl = 0.95,
#'                lambda_sequence = 'auto')
#'
#' @param data the data as a data frame
#' @param time_var the time-to-event variable
#' @param event_var the event indicator variable (0/1 or FALSE/TRUE)
#' @param pred_vars the predictor variables for the model
#' @param group_definition method for defining variable groups
#' @param custom_groups custom group specification as comma-separated lists.
#'   Example: "1,2;3,4,5;6" for three groups
#' @param pathway_info variable containing pathway/cluster information for
#'   grouping
#' @param correlation_threshold correlation threshold for correlation-based
#'   grouping
#' @param alpha_sgl mixing parameter between group LASSO (0) and LASSO (1).
#'   Default 0.95 emphasizes sparsity within groups
#' @param lambda_sequence method for selecting regularization parameter
#'   sequence
#' @param custom_lambda custom lambda values as comma-separated numbers.
#'   Example: "0.001,0.01,0.1,1"
#' @param lambda_min_ratio ratio of smallest to largest lambda value
#' @param n_lambda number of lambda values in the sequence
#' @param selection_criterion criterion for selecting optimal lambda
#' @param cv_folds number of folds for cross-validation
#' @param cv_repeats number of repeated cross-validation runs
#' @param ebic_gamma gamma parameter for Extended BIC (0 = standard BIC)
#' @param weight_type type of adaptive weights for penalty terms
#' @param weight_power power parameter for adaptive weights
#' @param standardize_vars whether to standardize predictor variables
#' @param center_vars whether to center predictor variables
#' @param orthogonalize_groups whether to orthogonalize variables within
#'   groups
#' @param max_iterations maximum number of iterations for optimization
#' @param convergence_threshold convergence threshold for optimization
#' @param warm_start whether to use warm start for lambda sequence
#' @param parallel_cv whether to use parallel processing for CV
#' @param seed_value random seed for reproducible results
#' @param show_summary show model summary table
#' @param show_coefficients show coefficient estimates table
#' @param show_groups show group structure table
#' @param show_path show complete regularization path
#' @param show_performance show model performance metrics
#' @param show_validation show cross-validation results
#' @param plot_cv_error plot cross-validation error curve
#' @param plot_coefficients plot coefficient regularization path
#' @param plot_groups plot group selection pattern
#' @param plot_sparsity plot sparsity pattern across lambda values
#' @param plot_stability plot stability selection results
#' @param alpha_level significance level for confidence intervals
#' @param confidence_intervals whether to calculate bootstrap confidence
#'   intervals
#' @param bootstrap_samples number of bootstrap samples for confidence
#'   intervals
#' @param stability_selection whether to perform stability selection
#' @param stability_threshold threshold for stability selection
#' @param stability_subsample subsample ratio for stability selection
#' @param showExplanations show explanations for the analysis
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$coefficients} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$groupStructure} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$solutionPath} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$performance} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$validationResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$adaptiveWeights} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$stabilityResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$comparisonTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$cvErrorPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$coefficientPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$groupSelectionPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sparsityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$stabilityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$explanations} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$summary$asDF}
#'
#' \code{as.data.frame(results$summary)}
#'
#' @export
sparsegrouplasso <- function(
    data,
    time_var,
    event_var,
    pred_vars,
    group_definition = "factor_based",
    custom_groups = "",
    pathway_info,
    correlation_threshold = 0.7,
    alpha_sgl = 0.95,
    lambda_sequence = "auto",
    custom_lambda = "",
    lambda_min_ratio = 0.001,
    n_lambda = 100,
    selection_criterion = "cv_deviance",
    cv_folds = 10,
    cv_repeats = 1,
    ebic_gamma = 1,
    weight_type = "none",
    weight_power = 1,
    standardize_vars = TRUE,
    center_vars = TRUE,
    orthogonalize_groups = FALSE,
    max_iterations = 1000,
    convergence_threshold = 0.000001,
    warm_start = TRUE,
    parallel_cv = FALSE,
    seed_value = 42,
    show_summary = TRUE,
    show_coefficients = TRUE,
    show_groups = TRUE,
    show_path = FALSE,
    show_performance = TRUE,
    show_validation = TRUE,
    plot_cv_error = TRUE,
    plot_coefficients = TRUE,
    plot_groups = TRUE,
    plot_sparsity = FALSE,
    plot_stability = FALSE,
    alpha_level = 0.05,
    confidence_intervals = FALSE,
    bootstrap_samples = 500,
    stability_selection = FALSE,
    stability_threshold = 0.8,
    stability_subsample = 0.8,
    showExplanations = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("sparsegrouplasso requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(event_var)) event_var <- jmvcore::resolveQuo(jmvcore::enquo(event_var))
    if ( ! missing(pred_vars)) pred_vars <- jmvcore::resolveQuo(jmvcore::enquo(pred_vars))
    if ( ! missing(pathway_info)) pathway_info <- jmvcore::resolveQuo(jmvcore::enquo(pathway_info))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(event_var), event_var, NULL),
            `if`( ! missing(pred_vars), pred_vars, NULL),
            `if`( ! missing(pathway_info), pathway_info, NULL))

    for (v in pathway_info) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- sparsegrouplassoOptions$new(
        time_var = time_var,
        event_var = event_var,
        pred_vars = pred_vars,
        group_definition = group_definition,
        custom_groups = custom_groups,
        pathway_info = pathway_info,
        correlation_threshold = correlation_threshold,
        alpha_sgl = alpha_sgl,
        lambda_sequence = lambda_sequence,
        custom_lambda = custom_lambda,
        lambda_min_ratio = lambda_min_ratio,
        n_lambda = n_lambda,
        selection_criterion = selection_criterion,
        cv_folds = cv_folds,
        cv_repeats = cv_repeats,
        ebic_gamma = ebic_gamma,
        weight_type = weight_type,
        weight_power = weight_power,
        standardize_vars = standardize_vars,
        center_vars = center_vars,
        orthogonalize_groups = orthogonalize_groups,
        max_iterations = max_iterations,
        convergence_threshold = convergence_threshold,
        warm_start = warm_start,
        parallel_cv = parallel_cv,
        seed_value = seed_value,
        show_summary = show_summary,
        show_coefficients = show_coefficients,
        show_groups = show_groups,
        show_path = show_path,
        show_performance = show_performance,
        show_validation = show_validation,
        plot_cv_error = plot_cv_error,
        plot_coefficients = plot_coefficients,
        plot_groups = plot_groups,
        plot_sparsity = plot_sparsity,
        plot_stability = plot_stability,
        alpha_level = alpha_level,
        confidence_intervals = confidence_intervals,
        bootstrap_samples = bootstrap_samples,
        stability_selection = stability_selection,
        stability_threshold = stability_threshold,
        stability_subsample = stability_subsample,
        showExplanations = showExplanations)

    analysis <- sparsegrouplassoClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

