
# This file is automatically generated, you probably don't want to edit this

ggprismOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ggprismOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            group_var = NULL,
            facet_var = NULL,
            plot_type = "violin",
            prism_theme = "default",
            prism_palette = "floral",
            show_points = TRUE,
            point_size = 1.5,
            point_alpha = 0.6,
            show_statistics = TRUE,
            stats_method = "auto",
            pvalue_format = "exact",
            plot_title = "GraphPad Prism Style Plot",
            x_label = "",
            y_label = "",
            legend_position = "right",
            base_size = 12,
            show_summary = TRUE,
            error_bars = "se",
            prism_guides = "standard",
            annotation_ticks = FALSE,
            preview_mode = FALSE,
            prism_shape_palette = "default",
            jitter_width = 0.2,
            violin_width = 1,
            publication_ready = FALSE,
            export_dpi = 300,
            custom_comparisons = "", ...) {

            super$initialize(
                package="ClinicoPath",
                name="ggprism",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..group_var <- jmvcore::OptionVariable$new(
                "group_var",
                group_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "violin",
                    "boxplot",
                    "scatter",
                    "column",
                    "line"),
                default="violin")
            private$..prism_theme <- jmvcore::OptionList$new(
                "prism_theme",
                prism_theme,
                options=list(
                    "default",
                    "white",
                    "minimal",
                    "publication"),
                default="default")
            private$..prism_palette <- jmvcore::OptionList$new(
                "prism_palette",
                prism_palette,
                options=list(
                    "floral",
                    "candy_bright",
                    "office",
                    "pastels",
                    "colorblind_safe",
                    "blueprint",
                    "neon",
                    "flames",
                    "ocean",
                    "spring",
                    "starry",
                    "the_blues",
                    "viridis",
                    "pearl",
                    "quiet",
                    "stained_glass",
                    "warm_pastels",
                    "prism_dark",
                    "prism_light",
                    "evergreen",
                    "sunny_garden"),
                default="floral")
            private$..show_points <- jmvcore::OptionBool$new(
                "show_points",
                show_points,
                default=TRUE)
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                min=0.1,
                max=5,
                default=1.5)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                min=0,
                max=1,
                default=0.6)
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..stats_method <- jmvcore::OptionList$new(
                "stats_method",
                stats_method,
                options=list(
                    "auto",
                    "ttest",
                    "wilcoxon",
                    "anova",
                    "kruskal"),
                default="auto")
            private$..pvalue_format <- jmvcore::OptionList$new(
                "pvalue_format",
                pvalue_format,
                options=list(
                    "exact",
                    "scientific",
                    "stars",
                    "symbols"),
                default="exact")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="GraphPad Prism Style Plot")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..legend_position <- jmvcore::OptionList$new(
                "legend_position",
                legend_position,
                options=list(
                    "right",
                    "left",
                    "top",
                    "bottom",
                    "none"),
                default="right")
            private$..base_size <- jmvcore::OptionNumber$new(
                "base_size",
                base_size,
                min=8,
                max=24,
                default=12)
            private$..show_summary <- jmvcore::OptionBool$new(
                "show_summary",
                show_summary,
                default=TRUE)
            private$..error_bars <- jmvcore::OptionList$new(
                "error_bars",
                error_bars,
                options=list(
                    "none",
                    "se",
                    "sd",
                    "ci"),
                default="se")
            private$..prism_guides <- jmvcore::OptionList$new(
                "prism_guides",
                prism_guides,
                options=list(
                    "standard",
                    "minor",
                    "offset",
                    "offset_minor",
                    "bracket"),
                default="standard")
            private$..annotation_ticks <- jmvcore::OptionBool$new(
                "annotation_ticks",
                annotation_ticks,
                default=FALSE)
            private$..preview_mode <- jmvcore::OptionBool$new(
                "preview_mode",
                preview_mode,
                default=FALSE)
            private$..prism_shape_palette <- jmvcore::OptionList$new(
                "prism_shape_palette",
                prism_shape_palette,
                options=list(
                    "default",
                    "prism",
                    "filled",
                    "open"),
                default="default")
            private$..jitter_width <- jmvcore::OptionNumber$new(
                "jitter_width",
                jitter_width,
                min=0,
                max=1,
                default=0.2)
            private$..violin_width <- jmvcore::OptionNumber$new(
                "violin_width",
                violin_width,
                min=0.1,
                max=2,
                default=1)
            private$..publication_ready <- jmvcore::OptionBool$new(
                "publication_ready",
                publication_ready,
                default=FALSE)
            private$..export_dpi <- jmvcore::OptionNumber$new(
                "export_dpi",
                export_dpi,
                min=150,
                max=600,
                default=300)
            private$..custom_comparisons <- jmvcore::OptionString$new(
                "custom_comparisons",
                custom_comparisons,
                default="")

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..group_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..prism_theme)
            self$.addOption(private$..prism_palette)
            self$.addOption(private$..show_points)
            self$.addOption(private$..point_size)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..stats_method)
            self$.addOption(private$..pvalue_format)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..legend_position)
            self$.addOption(private$..base_size)
            self$.addOption(private$..show_summary)
            self$.addOption(private$..error_bars)
            self$.addOption(private$..prism_guides)
            self$.addOption(private$..annotation_ticks)
            self$.addOption(private$..preview_mode)
            self$.addOption(private$..prism_shape_palette)
            self$.addOption(private$..jitter_width)
            self$.addOption(private$..violin_width)
            self$.addOption(private$..publication_ready)
            self$.addOption(private$..export_dpi)
            self$.addOption(private$..custom_comparisons)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        group_var = function() private$..group_var$value,
        facet_var = function() private$..facet_var$value,
        plot_type = function() private$..plot_type$value,
        prism_theme = function() private$..prism_theme$value,
        prism_palette = function() private$..prism_palette$value,
        show_points = function() private$..show_points$value,
        point_size = function() private$..point_size$value,
        point_alpha = function() private$..point_alpha$value,
        show_statistics = function() private$..show_statistics$value,
        stats_method = function() private$..stats_method$value,
        pvalue_format = function() private$..pvalue_format$value,
        plot_title = function() private$..plot_title$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        legend_position = function() private$..legend_position$value,
        base_size = function() private$..base_size$value,
        show_summary = function() private$..show_summary$value,
        error_bars = function() private$..error_bars$value,
        prism_guides = function() private$..prism_guides$value,
        annotation_ticks = function() private$..annotation_ticks$value,
        preview_mode = function() private$..preview_mode$value,
        prism_shape_palette = function() private$..prism_shape_palette$value,
        jitter_width = function() private$..jitter_width$value,
        violin_width = function() private$..violin_width$value,
        publication_ready = function() private$..publication_ready$value,
        export_dpi = function() private$..export_dpi$value,
        custom_comparisons = function() private$..custom_comparisons$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..group_var = NA,
        ..facet_var = NA,
        ..plot_type = NA,
        ..prism_theme = NA,
        ..prism_palette = NA,
        ..show_points = NA,
        ..point_size = NA,
        ..point_alpha = NA,
        ..show_statistics = NA,
        ..stats_method = NA,
        ..pvalue_format = NA,
        ..plot_title = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..legend_position = NA,
        ..base_size = NA,
        ..show_summary = NA,
        ..error_bars = NA,
        ..prism_guides = NA,
        ..annotation_ticks = NA,
        ..preview_mode = NA,
        ..prism_shape_palette = NA,
        ..jitter_width = NA,
        ..violin_width = NA,
        ..publication_ready = NA,
        ..export_dpi = NA,
        ..custom_comparisons = NA)
)

ggprismResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ggprismResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        main_plot = function() private$.items[["main_plot"]],
        palette_preview = function() private$.items[["palette_preview"]],
        publication_plot = function() private$.items[["publication_plot"]],
        summary_statistics = function() private$.items[["summary_statistics"]],
        statistical_tests = function() private$.items[["statistical_tests"]],
        prism_guide = function() private$.items[["prism_guide"]],
        palette_information = function() private$.items[["palette_information"]],
        export_code = function() private$.items[["export_code"]],
        accessibility_notes = function() private$.items[["accessibility_notes"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="GraphPad Prism Style Plots",
                refs=list(
                    "ggprism",
                    "ggplot2",
                    "dplyr"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Image$new(
                options=options,
                name="main_plot",
                title="Prism Style Plot",
                width=800,
                height=600,
                renderFun=".plot_main",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "group_var",
                    "plot_type",
                    "prism_theme",
                    "prism_palette",
                    "prism_guides")))
            self$add(jmvcore::Image$new(
                options=options,
                name="palette_preview",
                title="Color Palette Preview",
                width=600,
                height=400,
                renderFun=".plot_palette_preview",
                visible="(preview_mode)",
                clearWith=list(
                    "prism_palette")))
            self$add(jmvcore::Image$new(
                options=options,
                name="publication_plot",
                title="Publication Ready Plot",
                width=1200,
                height=900,
                renderFun=".plot_publication",
                visible="(publication_ready)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "group_var",
                    "plot_type",
                    "prism_theme",
                    "prism_palette",
                    "export_dpi")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary_statistics",
                title="Summary Statistics",
                visible="(show_summary)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "group_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistical_tests",
                title="Statistical Test Results",
                visible="(show_statistics)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "group_var",
                    "stats_method")))
            self$add(jmvcore::Html$new(
                options=options,
                name="prism_guide",
                title="GraphPad Prism Style Guide",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="palette_information",
                title="Color Palette Information",
                visible=TRUE,
                clearWith=list(
                    "prism_palette")))
            self$add(jmvcore::Html$new(
                options=options,
                name="export_code",
                title="Reproducible R Code",
                visible="(publication_ready)",
                clearWith=list(
                    "plot_type",
                    "prism_theme",
                    "prism_palette")))
            self$add(jmvcore::Html$new(
                options=options,
                name="accessibility_notes",
                title="Accessibility & Best Practices",
                visible=TRUE))}))

ggprismBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ggprismBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "ggprism",
                version = c(0,0,3),
                options = options,
                results = ggprismResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' GraphPad Prism Style Plots
#'
#' Creates publication-ready plots with GraphPad Prism styling using ggprism 
#' package.
#' This module provides Prism-style themes, color palettes, and statistical 
#' annotations
#' to create professional scientific visualizations. Perfect for clinical 
#' research 
#' publications, biostatistics, and academic presentations. Supports various 
#' plot 
#' types including violin plots, box plots, scatter plots, and dose-response 
#' curves
#' with seamless ggplot2 integration and Prism-style aesthetics.
#' 
#'
#' @examples
#' \donttest{
#' # Example:
#' # 1. Load your data frame with continuous and categorical variables.
#' # 2. Select variables for X and Y axes.
#' # 3. Choose grouping variables for statistical comparisons.
#' # 4. Customize with Prism-style themes and color palettes.
#' # 5. Add statistical annotations and publication formatting.
#'}
#' @param data The data as a data frame.
#' @param x_var Variable for the X-axis. Can be continuous or categorical.
#' @param y_var Continuous variable for the Y-axis.
#' @param group_var Optional categorical variable for grouping and statistical
#'   comparisons.
#' @param facet_var Optional variable for creating separate panels in a grid
#'   layout.
#' @param plot_type Type of plot to create with Prism styling.
#' @param prism_theme GraphPad Prism theme variant to apply.
#' @param prism_palette Prism-style color palette for different groups. Choose
#'   from 20+ authentic GraphPad Prism palettes.
#' @param show_points If TRUE, overlays individual data points on the plot.
#' @param point_size Size of individual data points.
#' @param point_alpha Transparency level for data points (0 = transparent, 1 =
#'   opaque).
#' @param show_statistics If TRUE, performs statistical tests and adds p-value
#'   annotations.
#' @param stats_method Statistical test method for group comparisons.
#' @param pvalue_format Format for displaying p-values in statistical
#'   annotations.
#' @param plot_title Custom title for the plot.
#' @param x_label Custom label for X-axis. If empty, uses variable name.
#' @param y_label Custom label for Y-axis. If empty, uses variable name.
#' @param legend_position Position of the legend in the plot.
#' @param base_size Base font size for all text elements in the plot.
#' @param show_summary If TRUE, displays summary statistics table.
#' @param error_bars Type of error bars to display (for applicable plot
#'   types).
#' @param prism_guides Axis guide style following GraphPad Prism conventions.
#' @param annotation_ticks Add tick marks as annotations in Prism style.
#' @param preview_mode Enable palette preview mode to see all colors in the
#'   selected palette.
#' @param prism_shape_palette Shape palette for point plots following Prism
#'   conventions.
#' @param jitter_width Width of horizontal jittering for overlaid points.
#' @param violin_width Scale factor for violin plot widths.
#' @param publication_ready Optimize plot for publication with enhanced
#'   styling and formatting.
#' @param export_dpi DPI for high-resolution export (publication standard:
#'   300).
#' @param custom_comparisons Custom pairwise comparisons (e.g.,
#'   "Group1-Group2,Group1-Group3").
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$main_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$palette_preview} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$publication_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$summary_statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$statistical_tests} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$prism_guide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$palette_information} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$export_code} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$accessibility_notes} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
ggprism <- function(
    data,
    x_var,
    y_var,
    group_var,
    facet_var,
    plot_type = "violin",
    prism_theme = "default",
    prism_palette = "floral",
    show_points = TRUE,
    point_size = 1.5,
    point_alpha = 0.6,
    show_statistics = TRUE,
    stats_method = "auto",
    pvalue_format = "exact",
    plot_title = "GraphPad Prism Style Plot",
    x_label = "",
    y_label = "",
    legend_position = "right",
    base_size = 12,
    show_summary = TRUE,
    error_bars = "se",
    prism_guides = "standard",
    annotation_ticks = FALSE,
    preview_mode = FALSE,
    prism_shape_palette = "default",
    jitter_width = 0.2,
    violin_width = 1,
    publication_ready = FALSE,
    export_dpi = 300,
    custom_comparisons = "") {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("ggprism requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(group_var)) group_var <- jmvcore::resolveQuo(jmvcore::enquo(group_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(group_var), group_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))


    options <- ggprismOptions$new(
        x_var = x_var,
        y_var = y_var,
        group_var = group_var,
        facet_var = facet_var,
        plot_type = plot_type,
        prism_theme = prism_theme,
        prism_palette = prism_palette,
        show_points = show_points,
        point_size = point_size,
        point_alpha = point_alpha,
        show_statistics = show_statistics,
        stats_method = stats_method,
        pvalue_format = pvalue_format,
        plot_title = plot_title,
        x_label = x_label,
        y_label = y_label,
        legend_position = legend_position,
        base_size = base_size,
        show_summary = show_summary,
        error_bars = error_bars,
        prism_guides = prism_guides,
        annotation_ticks = annotation_ticks,
        preview_mode = preview_mode,
        prism_shape_palette = prism_shape_palette,
        jitter_width = jitter_width,
        violin_width = violin_width,
        publication_ready = publication_ready,
        export_dpi = export_dpi,
        custom_comparisons = custom_comparisons)

    analysis <- ggprismClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

