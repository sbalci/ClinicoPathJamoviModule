
# This file is automatically generated, you probably don't want to edit this

clinicalcalculatorsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalcalculatorsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            calculator_type = "risk_score",
            outcome_variable = NULL,
            predictor_variables = NULL,
            time_variable = NULL,
            event_variable = NULL,
            stratification_variable = NULL,
            model_type = "logistic_regression",
            validation_method = "bootstrap",
            risk_categories = 3,
            risk_thresholds = "",
            confidence_level = 0.95,
            bootstrap_samples = 1000,
            cv_folds = 10,
            include_nomogram = TRUE,
            include_calibration = TRUE,
            include_discrimination = TRUE,
            include_decision_curve = TRUE,
            include_net_benefit = TRUE,
            clinical_threshold_low = 0.1,
            clinical_threshold_high = 0.3,
            feature_selection = FALSE,
            feature_selection_method = "stepwise",
            regularization_alpha = 1,
            missing_data_method = "complete_case",
            outlier_detection = FALSE,
            outlier_method = "iqr",
            calculator_name = "Clinical Risk Calculator",
            calculator_description = "",
            target_population = "",
            units_specification = "",
            reference_ranges = "",
            include_uncertainty = TRUE,
            interactive_calculator = TRUE,
            export_format = "html",
            performance_metrics = "comprehensive",
            include_interpretation = TRUE,
            interpretation_text = "",
            risk_communication = "multiple_formats",
            validation_data_source = "",
            regulatory_compliance = "none",
            bias_assessment = TRUE,
            subgroup_analysis = FALSE,
            sensitivity_analysis = TRUE,
            implementation_guide = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="clinicalcalculators",
                requiresData=TRUE,
                ...)

            private$..calculator_type <- jmvcore::OptionList$new(
                "calculator_type",
                calculator_type,
                options=list(
                    "risk_score",
                    "nomogram",
                    "decision_tree",
                    "survival_prediction",
                    "diagnostic_probability",
                    "treatment_benefit",
                    "biomarker_threshold",
                    "clinical_index",
                    "prognostic_model",
                    "screening_risk"),
                default="risk_score")
            private$..outcome_variable <- jmvcore::OptionVariable$new(
                "outcome_variable",
                outcome_variable,
                suggested=list(
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..predictor_variables <- jmvcore::OptionVariables$new(
                "predictor_variables",
                predictor_variables,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..time_variable <- jmvcore::OptionVariable$new(
                "time_variable",
                time_variable,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_variable <- jmvcore::OptionVariable$new(
                "event_variable",
                event_variable,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..stratification_variable <- jmvcore::OptionVariable$new(
                "stratification_variable",
                stratification_variable,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "logistic_regression",
                    "cox_regression",
                    "linear_regression",
                    "random_forest",
                    "gradient_boosting",
                    "neural_network",
                    "ensemble_model",
                    "bayesian_model"),
                default="logistic_regression")
            private$..validation_method <- jmvcore::OptionList$new(
                "validation_method",
                validation_method,
                options=list(
                    "bootstrap",
                    "cross_validation",
                    "holdout",
                    "external_validation",
                    "temporal_validation"),
                default="bootstrap")
            private$..risk_categories <- jmvcore::OptionInteger$new(
                "risk_categories",
                risk_categories,
                min=2,
                max=10,
                default=3)
            private$..risk_thresholds <- jmvcore::OptionString$new(
                "risk_thresholds",
                risk_thresholds,
                default="")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                min=100,
                max=10000,
                default=1000)
            private$..cv_folds <- jmvcore::OptionInteger$new(
                "cv_folds",
                cv_folds,
                min=3,
                max=20,
                default=10)
            private$..include_nomogram <- jmvcore::OptionBool$new(
                "include_nomogram",
                include_nomogram,
                default=TRUE)
            private$..include_calibration <- jmvcore::OptionBool$new(
                "include_calibration",
                include_calibration,
                default=TRUE)
            private$..include_discrimination <- jmvcore::OptionBool$new(
                "include_discrimination",
                include_discrimination,
                default=TRUE)
            private$..include_decision_curve <- jmvcore::OptionBool$new(
                "include_decision_curve",
                include_decision_curve,
                default=TRUE)
            private$..include_net_benefit <- jmvcore::OptionBool$new(
                "include_net_benefit",
                include_net_benefit,
                default=TRUE)
            private$..clinical_threshold_low <- jmvcore::OptionNumber$new(
                "clinical_threshold_low",
                clinical_threshold_low,
                min=0,
                max=1,
                default=0.1)
            private$..clinical_threshold_high <- jmvcore::OptionNumber$new(
                "clinical_threshold_high",
                clinical_threshold_high,
                min=0,
                max=1,
                default=0.3)
            private$..feature_selection <- jmvcore::OptionBool$new(
                "feature_selection",
                feature_selection,
                default=FALSE)
            private$..feature_selection_method <- jmvcore::OptionList$new(
                "feature_selection_method",
                feature_selection_method,
                options=list(
                    "forward",
                    "backward",
                    "stepwise",
                    "lasso",
                    "elastic_net",
                    "boruta",
                    "rfe"),
                default="stepwise")
            private$..regularization_alpha <- jmvcore::OptionNumber$new(
                "regularization_alpha",
                regularization_alpha,
                min=0,
                max=1,
                default=1)
            private$..missing_data_method <- jmvcore::OptionList$new(
                "missing_data_method",
                missing_data_method,
                options=list(
                    "complete_case",
                    "mean_imputation",
                    "median_imputation",
                    "mode_imputation",
                    "mice",
                    "knn_imputation",
                    "random_forest_imputation"),
                default="complete_case")
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=FALSE)
            private$..outlier_method <- jmvcore::OptionList$new(
                "outlier_method",
                outlier_method,
                options=list(
                    "iqr",
                    "zscore",
                    "isolation_forest",
                    "local_outlier",
                    "mahalanobis"),
                default="iqr")
            private$..calculator_name <- jmvcore::OptionString$new(
                "calculator_name",
                calculator_name,
                default="Clinical Risk Calculator")
            private$..calculator_description <- jmvcore::OptionString$new(
                "calculator_description",
                calculator_description,
                default="")
            private$..target_population <- jmvcore::OptionString$new(
                "target_population",
                target_population,
                default="")
            private$..units_specification <- jmvcore::OptionString$new(
                "units_specification",
                units_specification,
                default="")
            private$..reference_ranges <- jmvcore::OptionString$new(
                "reference_ranges",
                reference_ranges,
                default="")
            private$..include_uncertainty <- jmvcore::OptionBool$new(
                "include_uncertainty",
                include_uncertainty,
                default=TRUE)
            private$..interactive_calculator <- jmvcore::OptionBool$new(
                "interactive_calculator",
                interactive_calculator,
                default=TRUE)
            private$..export_format <- jmvcore::OptionList$new(
                "export_format",
                export_format,
                options=list(
                    "html",
                    "pdf",
                    "shiny",
                    "r_package",
                    "json",
                    "excel"),
                default="html")
            private$..performance_metrics <- jmvcore::OptionList$new(
                "performance_metrics",
                performance_metrics,
                options=list(
                    "basic",
                    "comprehensive",
                    "clinical_focused",
                    "research_focused"),
                default="comprehensive")
            private$..include_interpretation <- jmvcore::OptionBool$new(
                "include_interpretation",
                include_interpretation,
                default=TRUE)
            private$..interpretation_text <- jmvcore::OptionString$new(
                "interpretation_text",
                interpretation_text,
                default="")
            private$..risk_communication <- jmvcore::OptionList$new(
                "risk_communication",
                risk_communication,
                options=list(
                    "percentage",
                    "natural_frequency",
                    "odds_ratio",
                    "icon_array",
                    "multiple_formats"),
                default="multiple_formats")
            private$..validation_data_source <- jmvcore::OptionString$new(
                "validation_data_source",
                validation_data_source,
                default="")
            private$..regulatory_compliance <- jmvcore::OptionList$new(
                "regulatory_compliance",
                regulatory_compliance,
                options=list(
                    "none",
                    "fda_guidance",
                    "ema_guidance",
                    "ce_marking",
                    "iso_standards",
                    "clinical_practice"),
                default="none")
            private$..bias_assessment <- jmvcore::OptionBool$new(
                "bias_assessment",
                bias_assessment,
                default=TRUE)
            private$..subgroup_analysis <- jmvcore::OptionBool$new(
                "subgroup_analysis",
                subgroup_analysis,
                default=FALSE)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=TRUE)
            private$..implementation_guide <- jmvcore::OptionBool$new(
                "implementation_guide",
                implementation_guide,
                default=TRUE)

            self$.addOption(private$..calculator_type)
            self$.addOption(private$..outcome_variable)
            self$.addOption(private$..predictor_variables)
            self$.addOption(private$..time_variable)
            self$.addOption(private$..event_variable)
            self$.addOption(private$..stratification_variable)
            self$.addOption(private$..model_type)
            self$.addOption(private$..validation_method)
            self$.addOption(private$..risk_categories)
            self$.addOption(private$..risk_thresholds)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..include_nomogram)
            self$.addOption(private$..include_calibration)
            self$.addOption(private$..include_discrimination)
            self$.addOption(private$..include_decision_curve)
            self$.addOption(private$..include_net_benefit)
            self$.addOption(private$..clinical_threshold_low)
            self$.addOption(private$..clinical_threshold_high)
            self$.addOption(private$..feature_selection)
            self$.addOption(private$..feature_selection_method)
            self$.addOption(private$..regularization_alpha)
            self$.addOption(private$..missing_data_method)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..outlier_method)
            self$.addOption(private$..calculator_name)
            self$.addOption(private$..calculator_description)
            self$.addOption(private$..target_population)
            self$.addOption(private$..units_specification)
            self$.addOption(private$..reference_ranges)
            self$.addOption(private$..include_uncertainty)
            self$.addOption(private$..interactive_calculator)
            self$.addOption(private$..export_format)
            self$.addOption(private$..performance_metrics)
            self$.addOption(private$..include_interpretation)
            self$.addOption(private$..interpretation_text)
            self$.addOption(private$..risk_communication)
            self$.addOption(private$..validation_data_source)
            self$.addOption(private$..regulatory_compliance)
            self$.addOption(private$..bias_assessment)
            self$.addOption(private$..subgroup_analysis)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..implementation_guide)
        }),
    active = list(
        calculator_type = function() private$..calculator_type$value,
        outcome_variable = function() private$..outcome_variable$value,
        predictor_variables = function() private$..predictor_variables$value,
        time_variable = function() private$..time_variable$value,
        event_variable = function() private$..event_variable$value,
        stratification_variable = function() private$..stratification_variable$value,
        model_type = function() private$..model_type$value,
        validation_method = function() private$..validation_method$value,
        risk_categories = function() private$..risk_categories$value,
        risk_thresholds = function() private$..risk_thresholds$value,
        confidence_level = function() private$..confidence_level$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        cv_folds = function() private$..cv_folds$value,
        include_nomogram = function() private$..include_nomogram$value,
        include_calibration = function() private$..include_calibration$value,
        include_discrimination = function() private$..include_discrimination$value,
        include_decision_curve = function() private$..include_decision_curve$value,
        include_net_benefit = function() private$..include_net_benefit$value,
        clinical_threshold_low = function() private$..clinical_threshold_low$value,
        clinical_threshold_high = function() private$..clinical_threshold_high$value,
        feature_selection = function() private$..feature_selection$value,
        feature_selection_method = function() private$..feature_selection_method$value,
        regularization_alpha = function() private$..regularization_alpha$value,
        missing_data_method = function() private$..missing_data_method$value,
        outlier_detection = function() private$..outlier_detection$value,
        outlier_method = function() private$..outlier_method$value,
        calculator_name = function() private$..calculator_name$value,
        calculator_description = function() private$..calculator_description$value,
        target_population = function() private$..target_population$value,
        units_specification = function() private$..units_specification$value,
        reference_ranges = function() private$..reference_ranges$value,
        include_uncertainty = function() private$..include_uncertainty$value,
        interactive_calculator = function() private$..interactive_calculator$value,
        export_format = function() private$..export_format$value,
        performance_metrics = function() private$..performance_metrics$value,
        include_interpretation = function() private$..include_interpretation$value,
        interpretation_text = function() private$..interpretation_text$value,
        risk_communication = function() private$..risk_communication$value,
        validation_data_source = function() private$..validation_data_source$value,
        regulatory_compliance = function() private$..regulatory_compliance$value,
        bias_assessment = function() private$..bias_assessment$value,
        subgroup_analysis = function() private$..subgroup_analysis$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        implementation_guide = function() private$..implementation_guide$value),
    private = list(
        ..calculator_type = NA,
        ..outcome_variable = NA,
        ..predictor_variables = NA,
        ..time_variable = NA,
        ..event_variable = NA,
        ..stratification_variable = NA,
        ..model_type = NA,
        ..validation_method = NA,
        ..risk_categories = NA,
        ..risk_thresholds = NA,
        ..confidence_level = NA,
        ..bootstrap_samples = NA,
        ..cv_folds = NA,
        ..include_nomogram = NA,
        ..include_calibration = NA,
        ..include_discrimination = NA,
        ..include_decision_curve = NA,
        ..include_net_benefit = NA,
        ..clinical_threshold_low = NA,
        ..clinical_threshold_high = NA,
        ..feature_selection = NA,
        ..feature_selection_method = NA,
        ..regularization_alpha = NA,
        ..missing_data_method = NA,
        ..outlier_detection = NA,
        ..outlier_method = NA,
        ..calculator_name = NA,
        ..calculator_description = NA,
        ..target_population = NA,
        ..units_specification = NA,
        ..reference_ranges = NA,
        ..include_uncertainty = NA,
        ..interactive_calculator = NA,
        ..export_format = NA,
        ..performance_metrics = NA,
        ..include_interpretation = NA,
        ..interpretation_text = NA,
        ..risk_communication = NA,
        ..validation_data_source = NA,
        ..regulatory_compliance = NA,
        ..bias_assessment = NA,
        ..subgroup_analysis = NA,
        ..sensitivity_analysis = NA,
        ..implementation_guide = NA)
)

clinicalcalculatorsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalcalculatorsResults",
    inherit = jmvcore::Group,
    active = list(),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Clinical Risk Calculators & Nomograms")}))

clinicalcalculatorsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalcalculatorsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "clinicalcalculators",
                version = c(1,0,0),
                options = options,
                results = clinicalcalculatorsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Clinical Risk Calculators & Nomograms
#'
#' 
#' @param data the data as a data frame
#' @param calculator_type the type of clinical calculator to generate
#' @param outcome_variable primary outcome variable for the calculator
#' @param predictor_variables predictor variables for the risk model
#' @param time_variable time variable for survival analysis (if applicable)
#' @param event_variable event/status variable for survival analysis (if
#'   applicable)
#' @param stratification_variable variable for subgroup stratification
#'   (optional)
#' @param model_type statistical model for the calculator
#' @param validation_method method for model validation
#' @param risk_categories number of risk categories for stratification
#' @param risk_thresholds custom risk thresholds (comma-separated percentages)
#' @param confidence_level confidence level for intervals
#' @param bootstrap_samples number of bootstrap samples for validation
#' @param cv_folds number of folds for cross-validation
#' @param include_nomogram whether to generate a nomogram visualization
#' @param include_calibration whether to include model calibration assessment
#' @param include_discrimination whether to include discrimination analysis
#' @param include_decision_curve whether to include decision curve analysis
#' @param include_net_benefit whether to include net benefit calculations
#' @param clinical_threshold_low lower threshold for clinical decision making
#' @param clinical_threshold_high upper threshold for clinical decision making
#' @param feature_selection whether to perform automatic feature selection
#' @param feature_selection_method method for automatic feature selection
#' @param regularization_alpha alpha parameter for elastic net (1=LASSO,
#'   0=Ridge)
#' @param missing_data_method method for handling missing data
#' @param outlier_detection whether to detect and handle outliers
#' @param outlier_method method for outlier detection
#' @param calculator_name name for the clinical calculator
#' @param calculator_description description of the calculator's purpose and
#'   application
#' @param target_population description of the target patient population
#' @param units_specification units for variables (e.g.,
#'   "age:years,weight:kg")
#' @param reference_ranges normal reference ranges for variables
#' @param include_uncertainty whether to include prediction uncertainty
#' @param interactive_calculator whether to generate an interactive web
#'   calculator
#' @param export_format format for exporting the calculator
#' @param performance_metrics level of performance metrics to include
#' @param include_interpretation whether to include clinical interpretation
#'   guidelines
#' @param interpretation_text custom text for result interpretation
#' @param risk_communication format for communicating risk to patients
#' @param validation_data_source source of external validation data (if
#'   applicable)
#' @param regulatory_compliance regulatory framework for compliance
#' @param bias_assessment whether to include bias and fairness assessment
#' @param subgroup_analysis whether to perform subgroup-specific analyses
#' @param sensitivity_analysis whether to include sensitivity analysis
#' @param implementation_guide whether to include clinical implementation
#'   guidelines
#' @return A results object containing:
#' \tabular{llllll}{
#' }
#'
#' @export
clinicalcalculators <- function(
    data,
    calculator_type = "risk_score",
    outcome_variable,
    predictor_variables,
    time_variable,
    event_variable,
    stratification_variable,
    model_type = "logistic_regression",
    validation_method = "bootstrap",
    risk_categories = 3,
    risk_thresholds = "",
    confidence_level = 0.95,
    bootstrap_samples = 1000,
    cv_folds = 10,
    include_nomogram = TRUE,
    include_calibration = TRUE,
    include_discrimination = TRUE,
    include_decision_curve = TRUE,
    include_net_benefit = TRUE,
    clinical_threshold_low = 0.1,
    clinical_threshold_high = 0.3,
    feature_selection = FALSE,
    feature_selection_method = "stepwise",
    regularization_alpha = 1,
    missing_data_method = "complete_case",
    outlier_detection = FALSE,
    outlier_method = "iqr",
    calculator_name = "Clinical Risk Calculator",
    calculator_description = "",
    target_population = "",
    units_specification = "",
    reference_ranges = "",
    include_uncertainty = TRUE,
    interactive_calculator = TRUE,
    export_format = "html",
    performance_metrics = "comprehensive",
    include_interpretation = TRUE,
    interpretation_text = "",
    risk_communication = "multiple_formats",
    validation_data_source = "",
    regulatory_compliance = "none",
    bias_assessment = TRUE,
    subgroup_analysis = FALSE,
    sensitivity_analysis = TRUE,
    implementation_guide = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("clinicalcalculators requires jmvcore to be installed (restart may be required)")

    if ( ! missing(outcome_variable)) outcome_variable <- jmvcore::resolveQuo(jmvcore::enquo(outcome_variable))
    if ( ! missing(predictor_variables)) predictor_variables <- jmvcore::resolveQuo(jmvcore::enquo(predictor_variables))
    if ( ! missing(time_variable)) time_variable <- jmvcore::resolveQuo(jmvcore::enquo(time_variable))
    if ( ! missing(event_variable)) event_variable <- jmvcore::resolveQuo(jmvcore::enquo(event_variable))
    if ( ! missing(stratification_variable)) stratification_variable <- jmvcore::resolveQuo(jmvcore::enquo(stratification_variable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(outcome_variable), outcome_variable, NULL),
            `if`( ! missing(predictor_variables), predictor_variables, NULL),
            `if`( ! missing(time_variable), time_variable, NULL),
            `if`( ! missing(event_variable), event_variable, NULL),
            `if`( ! missing(stratification_variable), stratification_variable, NULL))

    for (v in stratification_variable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- clinicalcalculatorsOptions$new(
        calculator_type = calculator_type,
        outcome_variable = outcome_variable,
        predictor_variables = predictor_variables,
        time_variable = time_variable,
        event_variable = event_variable,
        stratification_variable = stratification_variable,
        model_type = model_type,
        validation_method = validation_method,
        risk_categories = risk_categories,
        risk_thresholds = risk_thresholds,
        confidence_level = confidence_level,
        bootstrap_samples = bootstrap_samples,
        cv_folds = cv_folds,
        include_nomogram = include_nomogram,
        include_calibration = include_calibration,
        include_discrimination = include_discrimination,
        include_decision_curve = include_decision_curve,
        include_net_benefit = include_net_benefit,
        clinical_threshold_low = clinical_threshold_low,
        clinical_threshold_high = clinical_threshold_high,
        feature_selection = feature_selection,
        feature_selection_method = feature_selection_method,
        regularization_alpha = regularization_alpha,
        missing_data_method = missing_data_method,
        outlier_detection = outlier_detection,
        outlier_method = outlier_method,
        calculator_name = calculator_name,
        calculator_description = calculator_description,
        target_population = target_population,
        units_specification = units_specification,
        reference_ranges = reference_ranges,
        include_uncertainty = include_uncertainty,
        interactive_calculator = interactive_calculator,
        export_format = export_format,
        performance_metrics = performance_metrics,
        include_interpretation = include_interpretation,
        interpretation_text = interpretation_text,
        risk_communication = risk_communication,
        validation_data_source = validation_data_source,
        regulatory_compliance = regulatory_compliance,
        bias_assessment = bias_assessment,
        subgroup_analysis = subgroup_analysis,
        sensitivity_analysis = sensitivity_analysis,
        implementation_guide = implementation_guide)

    analysis <- clinicalcalculatorsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

