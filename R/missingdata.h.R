
# This file is automatically generated, you probably don't want to edit this

missingdataOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            analysis_vars = NULL,
            analysis_type = "pattern",
            n_imputations = 5,
            max_iterations = 5,
            imputation_method = "auto",
            seed_value = 123,
            convergence_check = TRUE,
            show_pattern_plot = TRUE,
            show_pattern_table = TRUE,
            show_correlation_plot = TRUE,
            show_flux_plot = TRUE,
            show_trace_plot = TRUE,
            show_density_plot = TRUE,
            show_stripplot = TRUE,
            show_scatterplot = FALSE,
            show_imputation_summary = TRUE,
            show_interpretation = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="missingdata",
                requiresData=TRUE,
                ...)

            private$..analysis_vars <- jmvcore::OptionVariables$new(
                "analysis_vars",
                analysis_vars)
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "pattern",
                    "imputation",
                    "complete"),
                default="pattern")
            private$..n_imputations <- jmvcore::OptionNumber$new(
                "n_imputations",
                n_imputations,
                min=1,
                max=50,
                default=5)
            private$..max_iterations <- jmvcore::OptionNumber$new(
                "max_iterations",
                max_iterations,
                min=1,
                max=100,
                default=5)
            private$..imputation_method <- jmvcore::OptionList$new(
                "imputation_method",
                imputation_method,
                options=list(
                    "pmm",
                    "norm",
                    "logreg",
                    "polyreg",
                    "auto"),
                default="auto")
            private$..seed_value <- jmvcore::OptionNumber$new(
                "seed_value",
                seed_value,
                default=123)
            private$..convergence_check <- jmvcore::OptionBool$new(
                "convergence_check",
                convergence_check,
                default=TRUE)
            private$..show_pattern_plot <- jmvcore::OptionBool$new(
                "show_pattern_plot",
                show_pattern_plot,
                default=TRUE)
            private$..show_pattern_table <- jmvcore::OptionBool$new(
                "show_pattern_table",
                show_pattern_table,
                default=TRUE)
            private$..show_correlation_plot <- jmvcore::OptionBool$new(
                "show_correlation_plot",
                show_correlation_plot,
                default=TRUE)
            private$..show_flux_plot <- jmvcore::OptionBool$new(
                "show_flux_plot",
                show_flux_plot,
                default=TRUE)
            private$..show_trace_plot <- jmvcore::OptionBool$new(
                "show_trace_plot",
                show_trace_plot,
                default=TRUE)
            private$..show_density_plot <- jmvcore::OptionBool$new(
                "show_density_plot",
                show_density_plot,
                default=TRUE)
            private$..show_stripplot <- jmvcore::OptionBool$new(
                "show_stripplot",
                show_stripplot,
                default=TRUE)
            private$..show_scatterplot <- jmvcore::OptionBool$new(
                "show_scatterplot",
                show_scatterplot,
                default=FALSE)
            private$..show_imputation_summary <- jmvcore::OptionBool$new(
                "show_imputation_summary",
                show_imputation_summary,
                default=TRUE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)

            self$.addOption(private$..analysis_vars)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..n_imputations)
            self$.addOption(private$..max_iterations)
            self$.addOption(private$..imputation_method)
            self$.addOption(private$..seed_value)
            self$.addOption(private$..convergence_check)
            self$.addOption(private$..show_pattern_plot)
            self$.addOption(private$..show_pattern_table)
            self$.addOption(private$..show_correlation_plot)
            self$.addOption(private$..show_flux_plot)
            self$.addOption(private$..show_trace_plot)
            self$.addOption(private$..show_density_plot)
            self$.addOption(private$..show_stripplot)
            self$.addOption(private$..show_scatterplot)
            self$.addOption(private$..show_imputation_summary)
            self$.addOption(private$..show_interpretation)
        }),
    active = list(
        analysis_vars = function() private$..analysis_vars$value,
        analysis_type = function() private$..analysis_type$value,
        n_imputations = function() private$..n_imputations$value,
        max_iterations = function() private$..max_iterations$value,
        imputation_method = function() private$..imputation_method$value,
        seed_value = function() private$..seed_value$value,
        convergence_check = function() private$..convergence_check$value,
        show_pattern_plot = function() private$..show_pattern_plot$value,
        show_pattern_table = function() private$..show_pattern_table$value,
        show_correlation_plot = function() private$..show_correlation_plot$value,
        show_flux_plot = function() private$..show_flux_plot$value,
        show_trace_plot = function() private$..show_trace_plot$value,
        show_density_plot = function() private$..show_density_plot$value,
        show_stripplot = function() private$..show_stripplot$value,
        show_scatterplot = function() private$..show_scatterplot$value,
        show_imputation_summary = function() private$..show_imputation_summary$value,
        show_interpretation = function() private$..show_interpretation$value),
    private = list(
        ..analysis_vars = NA,
        ..analysis_type = NA,
        ..n_imputations = NA,
        ..max_iterations = NA,
        ..imputation_method = NA,
        ..seed_value = NA,
        ..convergence_check = NA,
        ..show_pattern_plot = NA,
        ..show_pattern_table = NA,
        ..show_correlation_plot = NA,
        ..show_flux_plot = NA,
        ..show_trace_plot = NA,
        ..show_density_plot = NA,
        ..show_stripplot = NA,
        ..show_scatterplot = NA,
        ..show_imputation_summary = NA,
        ..show_interpretation = NA)
)

missingdataResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        pattern_plot = function() private$.items[["pattern_plot"]],
        pattern_table = function() private$.items[["pattern_table"]],
        correlation_plot = function() private$.items[["correlation_plot"]],
        flux_plot = function() private$.items[["flux_plot"]],
        trace_plot = function() private$.items[["trace_plot"]],
        density_plot = function() private$.items[["density_plot"]],
        stripplot = function() private$.items[["stripplot"]],
        scatterplot = function() private$.items[["scatterplot"]],
        imputation_summary = function() private$.items[["imputation_summary"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Missing Data Analysis and Imputation",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Image$new(
                options=options,
                name="pattern_plot",
                title="Missing Data Pattern",
                width=700,
                height=500,
                renderFun=".plot_pattern",
                visible="(show_pattern_plot)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="pattern_table",
                title="Missing Data Pattern Table",
                visible="(show_pattern_table)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="correlation_plot",
                title="Variable Correlations",
                width=600,
                height=500,
                renderFun=".plot_correlation",
                visible="(show_correlation_plot)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="flux_plot",
                title="Influx/Outflux Analysis",
                width=600,
                height=400,
                renderFun=".plot_flux",
                visible="(show_flux_plot)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="trace_plot",
                title="Convergence Diagnostics",
                width=800,
                height=600,
                renderFun=".plot_trace",
                visible="(show_trace_plot && analysis_type:imputation || analysis_type:complete)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type",
                    "n_imputations",
                    "max_iterations",
                    "imputation_method",
                    "seed_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="density_plot",
                title="Observed vs Imputed Distributions",
                width=800,
                height=600,
                renderFun=".plot_density",
                visible="(show_density_plot && analysis_type:imputation || analysis_type:complete)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type",
                    "n_imputations",
                    "max_iterations",
                    "imputation_method",
                    "seed_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="stripplot",
                title="Strip Plot Comparison",
                width=800,
                height=600,
                renderFun=".plot_strip",
                visible="(show_stripplot && analysis_type:imputation || analysis_type:complete)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type",
                    "n_imputations",
                    "max_iterations",
                    "imputation_method",
                    "seed_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="scatterplot",
                title="Scatter Plot Analysis",
                width=700,
                height=500,
                renderFun=".plot_scatter",
                visible="(show_scatterplot && analysis_type:imputation || analysis_type:complete)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type",
                    "n_imputations",
                    "max_iterations",
                    "imputation_method",
                    "seed_value")))
            self$add(jmvcore::Html$new(
                options=options,
                name="imputation_summary",
                title="Imputation Summary",
                visible="(show_imputation_summary && analysis_type:imputation || analysis_type:complete)",
                clearWith=list(
                    "analysis_vars",
                    "analysis_type",
                    "n_imputations",
                    "max_iterations",
                    "imputation_method",
                    "seed_value")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Usage Guide",
                visible="(show_interpretation)",
                clearWith=list(
                    "analysis_type")))}))

missingdataBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "missingdata",
                version = c(0,0,3),
                options = options,
                results = missingdataResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Missing Data Analysis and Imputation
#'
#' Comprehensive missing data analysis and multiple imputation using mice and 
#' ggmice packages.
#' Analyze missing data patterns, perform multiple imputation by chained 
#' equations (MICE),
#' and visualize imputation results. Includes diagnostic plots for convergence 
#' assessment,
#' comparison of observed vs imputed data, and quality evaluation. Perfect for 
#' clinical
#' research data preprocessing where missing data is common and proper 
#' handling is critical
#' for valid statistical inference.
#' 
#'
#' @examples
#' \donttest{
#' # Example:
#' # 1. Select variables for missing data analysis
#' # 2. Explore missing data patterns and correlations
#' # 3. Configure imputation methods and parameters
#' # 4. Run multiple imputation and evaluate convergence
#' # 5. Compare observed vs imputed data distributions
#'}
#' @param data The data as a data frame.
#' @param analysis_vars Variables to include in the missing data analysis and
#'   imputation. Can include numeric, factor, and ID variables.
#' @param analysis_type Type of missing data analysis to perform. Pattern
#'   analysis explores missing data structure, imputation performs MICE,
#'   complete does both.
#' @param n_imputations Number of imputed datasets to generate using MICE
#'   algorithm. Typically 5-20 imputations are sufficient for most applications.
#' @param max_iterations Maximum number of MICE iterations per imputation.
#'   Default is 5, increase if convergence issues occur.
#' @param imputation_method Default imputation method. Auto-select chooses
#'   appropriate methods based on variable types. PMM is robust for continuous
#'   variables.
#' @param seed_value Random seed for reproducible imputation results.
#' @param convergence_check Perform convergence diagnostics to ensure MICE
#'   algorithm stability.
#' @param show_pattern_plot Display visual representation of missing data
#'   patterns.
#' @param show_pattern_table Display tabular summary of missing data patterns.
#' @param show_correlation_plot Display correlation matrix between incomplete
#'   variables.
#' @param show_flux_plot Display influx and outflux of missing data patterns.
#' @param show_trace_plot Display convergence trace plots for imputation
#'   diagnostics.
#' @param show_density_plot Compare distributions of observed vs imputed data.
#' @param show_stripplot Display strip plots comparing observed and imputed
#'   values.
#' @param show_scatterplot Display scatter plots of observed vs imputed data
#'   relationships.
#' @param show_imputation_summary Display summary statistics and information
#'   about the imputation process.
#' @param show_interpretation Display guidance on missing data analysis and
#'   imputation best practices for clinical research.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$pattern_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$pattern_table} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$correlation_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$flux_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$trace_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$density_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$stripplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$scatterplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$imputation_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
missingdata <- function(
    data,
    analysis_vars,
    analysis_type = "pattern",
    n_imputations = 5,
    max_iterations = 5,
    imputation_method = "auto",
    seed_value = 123,
    convergence_check = TRUE,
    show_pattern_plot = TRUE,
    show_pattern_table = TRUE,
    show_correlation_plot = TRUE,
    show_flux_plot = TRUE,
    show_trace_plot = TRUE,
    show_density_plot = TRUE,
    show_stripplot = TRUE,
    show_scatterplot = FALSE,
    show_imputation_summary = TRUE,
    show_interpretation = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("missingdata requires jmvcore to be installed (restart may be required)")

    if ( ! missing(analysis_vars)) analysis_vars <- jmvcore::resolveQuo(jmvcore::enquo(analysis_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(analysis_vars), analysis_vars, NULL))


    options <- missingdataOptions$new(
        analysis_vars = analysis_vars,
        analysis_type = analysis_type,
        n_imputations = n_imputations,
        max_iterations = max_iterations,
        imputation_method = imputation_method,
        seed_value = seed_value,
        convergence_check = convergence_check,
        show_pattern_plot = show_pattern_plot,
        show_pattern_table = show_pattern_table,
        show_correlation_plot = show_correlation_plot,
        show_flux_plot = show_flux_plot,
        show_trace_plot = show_trace_plot,
        show_density_plot = show_density_plot,
        show_stripplot = show_stripplot,
        show_scatterplot = show_scatterplot,
        show_imputation_summary = show_imputation_summary,
        show_interpretation = show_interpretation)

    analysis <- missingdataClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

