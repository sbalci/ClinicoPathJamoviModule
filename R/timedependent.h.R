
# This file is automatically generated, you probably don't want to edit this

timedependentOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "timedependentOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            id = NULL,
            start_time = NULL,
            stop_time = NULL,
            event = NULL,
            time_dependent_vars = NULL,
            baseline_vars = NULL,
            perform_landmark = TRUE,
            landmark_times = "6,12,24",
            prediction_window = 12,
            time_dependent_roc = TRUE,
            roc_times = "1,2,3,5",
            roc_method = "incident_dynamic",
            optimal_cutpoint = TRUE,
            cutpoint_method = "youden",
            model_type = "extended_cox",
            time_transform = "none",
            test_proportional_hazards = TRUE,
            schoenfeld_transform = "km",
            internal_validation = TRUE,
            cv_folds = 5,
            bootstrap_validation = FALSE,
            n_bootstrap = 100,
            compare_models = FALSE,
            comparison_metric = "iauc",
            plot_time_varying_effects = TRUE,
            plot_roc_curves = TRUE,
            plot_auc_trajectory = TRUE,
            plot_cutpoint_stability = TRUE,
            plot_landmark_predictions = TRUE,
            plot_schoenfeld_residuals = TRUE,
            confidence_level = 0.95,
            decimals = 3,
            export_predictions = FALSE,
            export_roc_data = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="timedependent",
                requiresData=TRUE,
                ...)

            private$..id <- jmvcore::OptionVariable$new(
                "id",
                id,
                suggested=list(
                    "id"),
                permitted=list(
                    "id",
                    "factor",
                    "numeric"))
            private$..start_time <- jmvcore::OptionVariable$new(
                "start_time",
                start_time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..stop_time <- jmvcore::OptionVariable$new(
                "stop_time",
                stop_time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event <- jmvcore::OptionVariable$new(
                "event",
                event,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..time_dependent_vars <- jmvcore::OptionVariables$new(
                "time_dependent_vars",
                time_dependent_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..baseline_vars <- jmvcore::OptionVariables$new(
                "baseline_vars",
                baseline_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..perform_landmark <- jmvcore::OptionBool$new(
                "perform_landmark",
                perform_landmark,
                default=TRUE)
            private$..landmark_times <- jmvcore::OptionString$new(
                "landmark_times",
                landmark_times,
                default="6,12,24")
            private$..prediction_window <- jmvcore::OptionNumber$new(
                "prediction_window",
                prediction_window,
                default=12,
                min=1)
            private$..time_dependent_roc <- jmvcore::OptionBool$new(
                "time_dependent_roc",
                time_dependent_roc,
                default=TRUE)
            private$..roc_times <- jmvcore::OptionString$new(
                "roc_times",
                roc_times,
                default="1,2,3,5")
            private$..roc_method <- jmvcore::OptionList$new(
                "roc_method",
                roc_method,
                options=list(
                    "incident_dynamic",
                    "cumulative_dynamic",
                    "incident_static",
                    "cumulative_static"),
                default="incident_dynamic")
            private$..optimal_cutpoint <- jmvcore::OptionBool$new(
                "optimal_cutpoint",
                optimal_cutpoint,
                default=TRUE)
            private$..cutpoint_method <- jmvcore::OptionList$new(
                "cutpoint_method",
                cutpoint_method,
                options=list(
                    "youden",
                    "closest",
                    "liu",
                    "concordance"),
                default="youden")
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "cox",
                    "extended_cox",
                    "landmark_cox",
                    "joint"),
                default="extended_cox")
            private$..time_transform <- jmvcore::OptionList$new(
                "time_transform",
                time_transform,
                options=list(
                    "none",
                    "log",
                    "sqrt",
                    "poly"),
                default="none")
            private$..test_proportional_hazards <- jmvcore::OptionBool$new(
                "test_proportional_hazards",
                test_proportional_hazards,
                default=TRUE)
            private$..schoenfeld_transform <- jmvcore::OptionList$new(
                "schoenfeld_transform",
                schoenfeld_transform,
                options=list(
                    "identity",
                    "km",
                    "rank"),
                default="km")
            private$..internal_validation <- jmvcore::OptionBool$new(
                "internal_validation",
                internal_validation,
                default=TRUE)
            private$..cv_folds <- jmvcore::OptionInteger$new(
                "cv_folds",
                cv_folds,
                default=5,
                min=3,
                max=10)
            private$..bootstrap_validation <- jmvcore::OptionBool$new(
                "bootstrap_validation",
                bootstrap_validation,
                default=FALSE)
            private$..n_bootstrap <- jmvcore::OptionInteger$new(
                "n_bootstrap",
                n_bootstrap,
                default=100,
                min=50,
                max=1000)
            private$..compare_models <- jmvcore::OptionBool$new(
                "compare_models",
                compare_models,
                default=FALSE)
            private$..comparison_metric <- jmvcore::OptionList$new(
                "comparison_metric",
                comparison_metric,
                options=list(
                    "cindex",
                    "iauc",
                    "nri",
                    "idi"),
                default="iauc")
            private$..plot_time_varying_effects <- jmvcore::OptionBool$new(
                "plot_time_varying_effects",
                plot_time_varying_effects,
                default=TRUE)
            private$..plot_roc_curves <- jmvcore::OptionBool$new(
                "plot_roc_curves",
                plot_roc_curves,
                default=TRUE)
            private$..plot_auc_trajectory <- jmvcore::OptionBool$new(
                "plot_auc_trajectory",
                plot_auc_trajectory,
                default=TRUE)
            private$..plot_cutpoint_stability <- jmvcore::OptionBool$new(
                "plot_cutpoint_stability",
                plot_cutpoint_stability,
                default=TRUE)
            private$..plot_landmark_predictions <- jmvcore::OptionBool$new(
                "plot_landmark_predictions",
                plot_landmark_predictions,
                default=TRUE)
            private$..plot_schoenfeld_residuals <- jmvcore::OptionBool$new(
                "plot_schoenfeld_residuals",
                plot_schoenfeld_residuals,
                default=TRUE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..decimals <- jmvcore::OptionInteger$new(
                "decimals",
                decimals,
                default=3,
                min=1,
                max=5)
            private$..export_predictions <- jmvcore::OptionBool$new(
                "export_predictions",
                export_predictions,
                default=FALSE)
            private$..export_roc_data <- jmvcore::OptionBool$new(
                "export_roc_data",
                export_roc_data,
                default=FALSE)

            self$.addOption(private$..id)
            self$.addOption(private$..start_time)
            self$.addOption(private$..stop_time)
            self$.addOption(private$..event)
            self$.addOption(private$..time_dependent_vars)
            self$.addOption(private$..baseline_vars)
            self$.addOption(private$..perform_landmark)
            self$.addOption(private$..landmark_times)
            self$.addOption(private$..prediction_window)
            self$.addOption(private$..time_dependent_roc)
            self$.addOption(private$..roc_times)
            self$.addOption(private$..roc_method)
            self$.addOption(private$..optimal_cutpoint)
            self$.addOption(private$..cutpoint_method)
            self$.addOption(private$..model_type)
            self$.addOption(private$..time_transform)
            self$.addOption(private$..test_proportional_hazards)
            self$.addOption(private$..schoenfeld_transform)
            self$.addOption(private$..internal_validation)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..bootstrap_validation)
            self$.addOption(private$..n_bootstrap)
            self$.addOption(private$..compare_models)
            self$.addOption(private$..comparison_metric)
            self$.addOption(private$..plot_time_varying_effects)
            self$.addOption(private$..plot_roc_curves)
            self$.addOption(private$..plot_auc_trajectory)
            self$.addOption(private$..plot_cutpoint_stability)
            self$.addOption(private$..plot_landmark_predictions)
            self$.addOption(private$..plot_schoenfeld_residuals)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..decimals)
            self$.addOption(private$..export_predictions)
            self$.addOption(private$..export_roc_data)
        }),
    active = list(
        id = function() private$..id$value,
        start_time = function() private$..start_time$value,
        stop_time = function() private$..stop_time$value,
        event = function() private$..event$value,
        time_dependent_vars = function() private$..time_dependent_vars$value,
        baseline_vars = function() private$..baseline_vars$value,
        perform_landmark = function() private$..perform_landmark$value,
        landmark_times = function() private$..landmark_times$value,
        prediction_window = function() private$..prediction_window$value,
        time_dependent_roc = function() private$..time_dependent_roc$value,
        roc_times = function() private$..roc_times$value,
        roc_method = function() private$..roc_method$value,
        optimal_cutpoint = function() private$..optimal_cutpoint$value,
        cutpoint_method = function() private$..cutpoint_method$value,
        model_type = function() private$..model_type$value,
        time_transform = function() private$..time_transform$value,
        test_proportional_hazards = function() private$..test_proportional_hazards$value,
        schoenfeld_transform = function() private$..schoenfeld_transform$value,
        internal_validation = function() private$..internal_validation$value,
        cv_folds = function() private$..cv_folds$value,
        bootstrap_validation = function() private$..bootstrap_validation$value,
        n_bootstrap = function() private$..n_bootstrap$value,
        compare_models = function() private$..compare_models$value,
        comparison_metric = function() private$..comparison_metric$value,
        plot_time_varying_effects = function() private$..plot_time_varying_effects$value,
        plot_roc_curves = function() private$..plot_roc_curves$value,
        plot_auc_trajectory = function() private$..plot_auc_trajectory$value,
        plot_cutpoint_stability = function() private$..plot_cutpoint_stability$value,
        plot_landmark_predictions = function() private$..plot_landmark_predictions$value,
        plot_schoenfeld_residuals = function() private$..plot_schoenfeld_residuals$value,
        confidence_level = function() private$..confidence_level$value,
        decimals = function() private$..decimals$value,
        export_predictions = function() private$..export_predictions$value,
        export_roc_data = function() private$..export_roc_data$value),
    private = list(
        ..id = NA,
        ..start_time = NA,
        ..stop_time = NA,
        ..event = NA,
        ..time_dependent_vars = NA,
        ..baseline_vars = NA,
        ..perform_landmark = NA,
        ..landmark_times = NA,
        ..prediction_window = NA,
        ..time_dependent_roc = NA,
        ..roc_times = NA,
        ..roc_method = NA,
        ..optimal_cutpoint = NA,
        ..cutpoint_method = NA,
        ..model_type = NA,
        ..time_transform = NA,
        ..test_proportional_hazards = NA,
        ..schoenfeld_transform = NA,
        ..internal_validation = NA,
        ..cv_folds = NA,
        ..bootstrap_validation = NA,
        ..n_bootstrap = NA,
        ..compare_models = NA,
        ..comparison_metric = NA,
        ..plot_time_varying_effects = NA,
        ..plot_roc_curves = NA,
        ..plot_auc_trajectory = NA,
        ..plot_cutpoint_stability = NA,
        ..plot_landmark_predictions = NA,
        ..plot_schoenfeld_residuals = NA,
        ..confidence_level = NA,
        ..decimals = NA,
        ..export_predictions = NA,
        ..export_roc_data = NA)
)

timedependentResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "timedependentResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        model_summary = function() private$.items[["model_summary"]],
        cox_results = function() private$.items[["cox_results"]],
        time_varying_effects = function() private$.items[["time_varying_effects"]],
        landmark_results = function() private$.items[["landmark_results"]],
        roc_results = function() private$.items[["roc_results"]],
        model_comparison = function() private$.items[["model_comparison"]],
        validation_results = function() private$.items[["validation_results"]],
        time_varying_plot = function() private$.items[["time_varying_plot"]],
        roc_curves_plot = function() private$.items[["roc_curves_plot"]],
        auc_trajectory_plot = function() private$.items[["auc_trajectory_plot"]],
        cutpoint_stability_plot = function() private$.items[["cutpoint_stability_plot"]],
        landmark_predictions_plot = function() private$.items[["landmark_predictions_plot"]],
        schoenfeld_plot = function() private$.items[["schoenfeld_plot"]],
        interpretation = function() private$.items[["interpretation"]],
        recommendations = function() private$.items[["recommendations"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Time-Dependent Covariates & ROC Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Instructions",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "model_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="model_summary",
                title="Model Summary",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "model_type",
                    "time_transform")))
            self$add(jmvcore::Table$new(
                options=options,
                name="cox_results",
                title="Cox Regression Results",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "model_type"),
                columns=list(
                    list(
                        `name`="term", 
                        `title`="Term", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="statistic", 
                        `title`="Z", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="p", 
                        `title`="p", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="conf_low", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="conf_high", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="hr", 
                        `title`="HR", 
                        `type`="number", 
                        `format`="dp:3"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="time_varying_effects",
                title="Time-Varying Coefficients Test",
                visible="(test_proportional_hazards)",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "test_proportional_hazards",
                    "schoenfeld_transform"),
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="chisq", 
                        `title`="Chi-square", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="landmark_results",
                title="Landmark Analysis Results",
                visible="(perform_landmark)",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "perform_landmark",
                    "landmark_times"),
                columns=list(
                    list(
                        `name`="landmark_time", 
                        `title`="Landmark Time", 
                        `type`="number", 
                        `format`="dp:1"),
                    list(
                        `name`="n_at_risk", 
                        `title`="N at Risk", 
                        `type`="integer"),
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="hr", 
                        `title`="HR", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="conf_low", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="conf_high", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="roc_results",
                title="Time-Dependent ROC Results",
                visible="(time_dependent_roc)",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "time_dependent_roc",
                    "roc_times",
                    "roc_method"),
                columns=list(
                    list(
                        `name`="time_point", 
                        `title`="Time Point", 
                        `type`="number", 
                        `format`="dp:1"),
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="auc_lower", 
                        `title`="AUC Lower CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="auc_upper", 
                        `title`="AUC Upper CI", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="optimal_cutpoint", 
                        `title`="Optimal Cutpoint", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="dp:3"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="model_comparison",
                title="Model Comparison",
                visible="(compare_models)",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "compare_models",
                    "comparison_metric"),
                columns=list(
                    list(
                        `name`="model", 
                        `title`="Model", 
                        `type`="text"),
                    list(
                        `name`="metric_value", 
                        `title`="Metric Value", 
                        `type`="number", 
                        `format`="dp:4"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="dp:4"),
                    list(
                        `name`="improvement", 
                        `title`="Improvement", 
                        `type`="number", 
                        `format`="dp:4"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="validation_results",
                title="Validation Results",
                visible="(internal_validation)",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "internal_validation",
                    "cv_folds"),
                columns=list(
                    list(
                        `name`="time_point", 
                        `title`="Time Point", 
                        `type`="number", 
                        `format`="dp:1"),
                    list(
                        `name`="apparent_auc", 
                        `title`="Apparent AUC", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="optimism", 
                        `title`="Optimism", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="corrected_auc", 
                        `title`="Corrected AUC", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="cv_auc", 
                        `title`="CV AUC", 
                        `type`="number", 
                        `format`="dp:3"),
                    list(
                        `name`="cv_se", 
                        `title`="CV SE", 
                        `type`="number", 
                        `format`="dp:3"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="time_varying_plot",
                title="Time-Varying Effects",
                visible="(plot_time_varying_effects)",
                width=600,
                height=400,
                renderFun=".plot_time_varying",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "plot_time_varying_effects")))
            self$add(jmvcore::Image$new(
                options=options,
                name="roc_curves_plot",
                title="Time-Dependent ROC Curves",
                visible="(plot_roc_curves)",
                width=600,
                height=400,
                renderFun=".plot_roc_curves",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "time_dependent_roc",
                    "plot_roc_curves")))
            self$add(jmvcore::Image$new(
                options=options,
                name="auc_trajectory_plot",
                title="AUC Over Time",
                visible="(plot_auc_trajectory)",
                width=600,
                height=400,
                renderFun=".plot_auc_trajectory",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "time_dependent_roc",
                    "plot_auc_trajectory")))
            self$add(jmvcore::Image$new(
                options=options,
                name="cutpoint_stability_plot",
                title="Optimal Cutpoints Over Time",
                visible="(plot_cutpoint_stability)",
                width=600,
                height=400,
                renderFun=".plot_cutpoint_stability",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "optimal_cutpoint",
                    "plot_cutpoint_stability")))
            self$add(jmvcore::Image$new(
                options=options,
                name="landmark_predictions_plot",
                title="Landmark Predictions",
                visible="(plot_landmark_predictions)",
                width=600,
                height=400,
                renderFun=".plot_landmark_predictions",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "perform_landmark",
                    "plot_landmark_predictions")))
            self$add(jmvcore::Image$new(
                options=options,
                name="schoenfeld_plot",
                title="Schoenfeld Residuals",
                visible="(plot_schoenfeld_residuals)",
                width=600,
                height=400,
                renderFun=".plot_schoenfeld_residuals",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "test_proportional_hazards",
                    "plot_schoenfeld_residuals")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Clinical Interpretation",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "model_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="recommendations",
                title="Clinical Recommendations",
                clearWith=list(
                    "id",
                    "start_time",
                    "stop_time",
                    "event",
                    "time_dependent_vars",
                    "baseline_vars",
                    "model_type")))}))

timedependentBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "timedependentBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "timedependent",
                version = c(0,0,3),
                options = options,
                results = timedependentResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Time-Dependent Covariates & ROC Analysis
#'
#' Analysis of time-dependent covariates and time-varying ROC curves for 
#' survival data.
#' Handles covariates that change over time, landmark analysis, and dynamic 
#' prediction
#' accuracy assessment through time-dependent AUC and optimal cutpoint 
#' selection.
#' 
#'
#' @examples
#' \donttest{
#' # Example: Time-varying biomarker effects
#' timedependent(
#'     data = biomarker_data,
#'     id = patient_id,
#'     start_time = tstart,
#'     stop_time = tstop,
#'     event = status,
#'     time_dependent_vars = c("biomarker_level", "treatment_status"),
#'     baseline_vars = c("age", "sex"),
#'     landmark_times = c(6, 12, 24),
#'     roc_times = c(1, 2, 3, 5)
#' )
#'}
#' @param data The data as a data frame (can be in counting process format).
#' @param id Patient ID variable
#' @param start_time Beginning of time interval (tstart)
#' @param stop_time End of time interval (tstop)
#' @param event Event status variable
#' @param time_dependent_vars Time-varying predictors
#' @param baseline_vars Time-fixed predictors
#' @param perform_landmark Enable landmark analysis
#' @param landmark_times Landmark time points
#' @param prediction_window Prediction horizon from landmark
#' @param time_dependent_roc Enable TD-ROC analysis
#' @param roc_times ROC assessment times
#' @param roc_method TD-ROC approach
#' @param optimal_cutpoint Optimal threshold selection
#' @param cutpoint_method Cutpoint optimization approach
#' @param model_type Model specification
#' @param time_transform Time function transformation
#' @param test_proportional_hazards PH assumption testing
#' @param schoenfeld_transform Residual test transformation
#' @param internal_validation Cross-validation assessment
#' @param cv_folds CV fold specification
#' @param bootstrap_validation Bootstrap assessment
#' @param n_bootstrap Bootstrap iterations
#' @param compare_models Model comparison
#' @param comparison_metric Comparison measure
#' @param plot_time_varying_effects Time-varying coefficient plots
#' @param plot_roc_curves TD-ROC visualization
#' @param plot_auc_trajectory AUC evolution plot
#' @param plot_cutpoint_stability Cutpoint trajectory plot
#' @param plot_landmark_predictions Landmark prediction plots
#' @param plot_schoenfeld_residuals Residual diagnostic plots
#' @param confidence_level CI level
#' @param decimals Output precision
#' @param export_predictions Save predictions
#' @param export_roc_data Save ROC results
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$model_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$cox_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$time_varying_effects} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$landmark_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$roc_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$model_comparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$validation_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$time_varying_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$roc_curves_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$auc_trajectory_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cutpoint_stability_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$landmark_predictions_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$schoenfeld_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$recommendations} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$cox_results$asDF}
#'
#' \code{as.data.frame(results$cox_results)}
#'
#' @export
timedependent <- function(
    data,
    id,
    start_time,
    stop_time,
    event,
    time_dependent_vars,
    baseline_vars,
    perform_landmark = TRUE,
    landmark_times = "6,12,24",
    prediction_window = 12,
    time_dependent_roc = TRUE,
    roc_times = "1,2,3,5",
    roc_method = "incident_dynamic",
    optimal_cutpoint = TRUE,
    cutpoint_method = "youden",
    model_type = "extended_cox",
    time_transform = "none",
    test_proportional_hazards = TRUE,
    schoenfeld_transform = "km",
    internal_validation = TRUE,
    cv_folds = 5,
    bootstrap_validation = FALSE,
    n_bootstrap = 100,
    compare_models = FALSE,
    comparison_metric = "iauc",
    plot_time_varying_effects = TRUE,
    plot_roc_curves = TRUE,
    plot_auc_trajectory = TRUE,
    plot_cutpoint_stability = TRUE,
    plot_landmark_predictions = TRUE,
    plot_schoenfeld_residuals = TRUE,
    confidence_level = 0.95,
    decimals = 3,
    export_predictions = FALSE,
    export_roc_data = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("timedependent requires jmvcore to be installed (restart may be required)")

    if ( ! missing(id)) id <- jmvcore::resolveQuo(jmvcore::enquo(id))
    if ( ! missing(start_time)) start_time <- jmvcore::resolveQuo(jmvcore::enquo(start_time))
    if ( ! missing(stop_time)) stop_time <- jmvcore::resolveQuo(jmvcore::enquo(stop_time))
    if ( ! missing(event)) event <- jmvcore::resolveQuo(jmvcore::enquo(event))
    if ( ! missing(time_dependent_vars)) time_dependent_vars <- jmvcore::resolveQuo(jmvcore::enquo(time_dependent_vars))
    if ( ! missing(baseline_vars)) baseline_vars <- jmvcore::resolveQuo(jmvcore::enquo(baseline_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(id), id, NULL),
            `if`( ! missing(start_time), start_time, NULL),
            `if`( ! missing(stop_time), stop_time, NULL),
            `if`( ! missing(event), event, NULL),
            `if`( ! missing(time_dependent_vars), time_dependent_vars, NULL),
            `if`( ! missing(baseline_vars), baseline_vars, NULL))


    options <- timedependentOptions$new(
        id = id,
        start_time = start_time,
        stop_time = stop_time,
        event = event,
        time_dependent_vars = time_dependent_vars,
        baseline_vars = baseline_vars,
        perform_landmark = perform_landmark,
        landmark_times = landmark_times,
        prediction_window = prediction_window,
        time_dependent_roc = time_dependent_roc,
        roc_times = roc_times,
        roc_method = roc_method,
        optimal_cutpoint = optimal_cutpoint,
        cutpoint_method = cutpoint_method,
        model_type = model_type,
        time_transform = time_transform,
        test_proportional_hazards = test_proportional_hazards,
        schoenfeld_transform = schoenfeld_transform,
        internal_validation = internal_validation,
        cv_folds = cv_folds,
        bootstrap_validation = bootstrap_validation,
        n_bootstrap = n_bootstrap,
        compare_models = compare_models,
        comparison_metric = comparison_metric,
        plot_time_varying_effects = plot_time_varying_effects,
        plot_roc_curves = plot_roc_curves,
        plot_auc_trajectory = plot_auc_trajectory,
        plot_cutpoint_stability = plot_cutpoint_stability,
        plot_landmark_predictions = plot_landmark_predictions,
        plot_schoenfeld_residuals = plot_schoenfeld_residuals,
        confidence_level = confidence_level,
        decimals = decimals,
        export_predictions = export_predictions,
        export_roc_data = export_roc_data)

    analysis <- timedependentClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

