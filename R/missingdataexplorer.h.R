
# This file is automatically generated, you probably don't want to edit this

missingdataexplorerOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataexplorerOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            analysis_vars = NULL,
            group_var = NULL,
            time_var = NULL,
            id_var = NULL,
            pattern_analysis = TRUE,
            mechanism_testing = TRUE,
            correlation_analysis = TRUE,
            temporal_analysis = FALSE,
            group_comparison = FALSE,
            mcar_test = "little",
            min_pattern_freq = 0.05,
            max_patterns_display = 20,
            pattern_plot = TRUE,
            correlation_plot = TRUE,
            temporal_plot = FALSE,
            upset_plot = TRUE,
            cumulative_plot = FALSE,
            monotonic_test = TRUE,
            dropout_analysis = FALSE,
            informative_missingness = TRUE,
            completeness_threshold = 0.8,
            case_completeness = TRUE,
            variable_importance = TRUE,
            chi_square_test = TRUE,
            logistic_regression = FALSE,
            survival_analysis = FALSE,
            detailed_patterns = TRUE,
            summary_statistics = TRUE,
            clinical_interpretation = TRUE,
            export_patterns = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="missingdataexplorer",
                requiresData=TRUE,
                ...)

            private$..analysis_vars <- jmvcore::OptionVariables$new(
                "analysis_vars",
                analysis_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..group_var <- jmvcore::OptionVariable$new(
                "group_var",
                group_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..id_var <- jmvcore::OptionVariable$new(
                "id_var",
                id_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "id"))
            private$..pattern_analysis <- jmvcore::OptionBool$new(
                "pattern_analysis",
                pattern_analysis,
                default=TRUE)
            private$..mechanism_testing <- jmvcore::OptionBool$new(
                "mechanism_testing",
                mechanism_testing,
                default=TRUE)
            private$..correlation_analysis <- jmvcore::OptionBool$new(
                "correlation_analysis",
                correlation_analysis,
                default=TRUE)
            private$..temporal_analysis <- jmvcore::OptionBool$new(
                "temporal_analysis",
                temporal_analysis,
                default=FALSE)
            private$..group_comparison <- jmvcore::OptionBool$new(
                "group_comparison",
                group_comparison,
                default=FALSE)
            private$..mcar_test <- jmvcore::OptionList$new(
                "mcar_test",
                mcar_test,
                options=list(
                    "little",
                    "naniar",
                    "both"),
                default="little")
            private$..min_pattern_freq <- jmvcore::OptionNumber$new(
                "min_pattern_freq",
                min_pattern_freq,
                min=0.01,
                max=0.5,
                default=0.05)
            private$..max_patterns_display <- jmvcore::OptionInteger$new(
                "max_patterns_display",
                max_patterns_display,
                min=5,
                max=50,
                default=20)
            private$..pattern_plot <- jmvcore::OptionBool$new(
                "pattern_plot",
                pattern_plot,
                default=TRUE)
            private$..correlation_plot <- jmvcore::OptionBool$new(
                "correlation_plot",
                correlation_plot,
                default=TRUE)
            private$..temporal_plot <- jmvcore::OptionBool$new(
                "temporal_plot",
                temporal_plot,
                default=FALSE)
            private$..upset_plot <- jmvcore::OptionBool$new(
                "upset_plot",
                upset_plot,
                default=TRUE)
            private$..cumulative_plot <- jmvcore::OptionBool$new(
                "cumulative_plot",
                cumulative_plot,
                default=FALSE)
            private$..monotonic_test <- jmvcore::OptionBool$new(
                "monotonic_test",
                monotonic_test,
                default=TRUE)
            private$..dropout_analysis <- jmvcore::OptionBool$new(
                "dropout_analysis",
                dropout_analysis,
                default=FALSE)
            private$..informative_missingness <- jmvcore::OptionBool$new(
                "informative_missingness",
                informative_missingness,
                default=TRUE)
            private$..completeness_threshold <- jmvcore::OptionNumber$new(
                "completeness_threshold",
                completeness_threshold,
                min=0.1,
                max=1,
                default=0.8)
            private$..case_completeness <- jmvcore::OptionBool$new(
                "case_completeness",
                case_completeness,
                default=TRUE)
            private$..variable_importance <- jmvcore::OptionBool$new(
                "variable_importance",
                variable_importance,
                default=TRUE)
            private$..chi_square_test <- jmvcore::OptionBool$new(
                "chi_square_test",
                chi_square_test,
                default=TRUE)
            private$..logistic_regression <- jmvcore::OptionBool$new(
                "logistic_regression",
                logistic_regression,
                default=FALSE)
            private$..survival_analysis <- jmvcore::OptionBool$new(
                "survival_analysis",
                survival_analysis,
                default=FALSE)
            private$..detailed_patterns <- jmvcore::OptionBool$new(
                "detailed_patterns",
                detailed_patterns,
                default=TRUE)
            private$..summary_statistics <- jmvcore::OptionBool$new(
                "summary_statistics",
                summary_statistics,
                default=TRUE)
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)
            private$..export_patterns <- jmvcore::OptionBool$new(
                "export_patterns",
                export_patterns,
                default=FALSE)

            self$.addOption(private$..analysis_vars)
            self$.addOption(private$..group_var)
            self$.addOption(private$..time_var)
            self$.addOption(private$..id_var)
            self$.addOption(private$..pattern_analysis)
            self$.addOption(private$..mechanism_testing)
            self$.addOption(private$..correlation_analysis)
            self$.addOption(private$..temporal_analysis)
            self$.addOption(private$..group_comparison)
            self$.addOption(private$..mcar_test)
            self$.addOption(private$..min_pattern_freq)
            self$.addOption(private$..max_patterns_display)
            self$.addOption(private$..pattern_plot)
            self$.addOption(private$..correlation_plot)
            self$.addOption(private$..temporal_plot)
            self$.addOption(private$..upset_plot)
            self$.addOption(private$..cumulative_plot)
            self$.addOption(private$..monotonic_test)
            self$.addOption(private$..dropout_analysis)
            self$.addOption(private$..informative_missingness)
            self$.addOption(private$..completeness_threshold)
            self$.addOption(private$..case_completeness)
            self$.addOption(private$..variable_importance)
            self$.addOption(private$..chi_square_test)
            self$.addOption(private$..logistic_regression)
            self$.addOption(private$..survival_analysis)
            self$.addOption(private$..detailed_patterns)
            self$.addOption(private$..summary_statistics)
            self$.addOption(private$..clinical_interpretation)
            self$.addOption(private$..export_patterns)
        }),
    active = list(
        analysis_vars = function() private$..analysis_vars$value,
        group_var = function() private$..group_var$value,
        time_var = function() private$..time_var$value,
        id_var = function() private$..id_var$value,
        pattern_analysis = function() private$..pattern_analysis$value,
        mechanism_testing = function() private$..mechanism_testing$value,
        correlation_analysis = function() private$..correlation_analysis$value,
        temporal_analysis = function() private$..temporal_analysis$value,
        group_comparison = function() private$..group_comparison$value,
        mcar_test = function() private$..mcar_test$value,
        min_pattern_freq = function() private$..min_pattern_freq$value,
        max_patterns_display = function() private$..max_patterns_display$value,
        pattern_plot = function() private$..pattern_plot$value,
        correlation_plot = function() private$..correlation_plot$value,
        temporal_plot = function() private$..temporal_plot$value,
        upset_plot = function() private$..upset_plot$value,
        cumulative_plot = function() private$..cumulative_plot$value,
        monotonic_test = function() private$..monotonic_test$value,
        dropout_analysis = function() private$..dropout_analysis$value,
        informative_missingness = function() private$..informative_missingness$value,
        completeness_threshold = function() private$..completeness_threshold$value,
        case_completeness = function() private$..case_completeness$value,
        variable_importance = function() private$..variable_importance$value,
        chi_square_test = function() private$..chi_square_test$value,
        logistic_regression = function() private$..logistic_regression$value,
        survival_analysis = function() private$..survival_analysis$value,
        detailed_patterns = function() private$..detailed_patterns$value,
        summary_statistics = function() private$..summary_statistics$value,
        clinical_interpretation = function() private$..clinical_interpretation$value,
        export_patterns = function() private$..export_patterns$value),
    private = list(
        ..analysis_vars = NA,
        ..group_var = NA,
        ..time_var = NA,
        ..id_var = NA,
        ..pattern_analysis = NA,
        ..mechanism_testing = NA,
        ..correlation_analysis = NA,
        ..temporal_analysis = NA,
        ..group_comparison = NA,
        ..mcar_test = NA,
        ..min_pattern_freq = NA,
        ..max_patterns_display = NA,
        ..pattern_plot = NA,
        ..correlation_plot = NA,
        ..temporal_plot = NA,
        ..upset_plot = NA,
        ..cumulative_plot = NA,
        ..monotonic_test = NA,
        ..dropout_analysis = NA,
        ..informative_missingness = NA,
        ..completeness_threshold = NA,
        ..case_completeness = NA,
        ..variable_importance = NA,
        ..chi_square_test = NA,
        ..logistic_regression = NA,
        ..survival_analysis = NA,
        ..detailed_patterns = NA,
        ..summary_statistics = NA,
        ..clinical_interpretation = NA,
        ..export_patterns = NA)
)

missingdataexplorerResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataexplorerResults",
    inherit = jmvcore::Group,
    active = list(),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Missing Data Pattern Explorer")}))

missingdataexplorerBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "missingdataexplorerBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "missingdataexplorer",
                version = c(1,0,0),
                options = options,
                results = missingdataexplorerResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Missing Data Pattern Explorer
#'
#' Comprehensive missing data pattern exploration and visualization for 
#' clinical research.
#' Analyzes missing data mechanisms, patterns, and correlations to inform 
#' imputation
#' strategies. Includes advanced diagnostics for missing completely at random 
#' (MCAR),
#' missing at random (MAR), and missing not at random (MNAR) assessments. 
#' Essential
#' for understanding missingness before imputation and for regulatory 
#' documentation
#' of missing data handling strategies.
#' 
#'
#' @examples
#' data('clinical_data')
#'
#' missingdataexplorer(
#'     data = clinical_data,
#'     analysis_vars = c("primary_endpoint", "biomarker", "demographics"),
#'     group_var = "treatment_arm",
#'     pattern_analysis = TRUE,
#'     mechanism_testing = TRUE
#' )
#'
#' @param data the data as a data frame
#' @param analysis_vars Variables to include in missing data pattern analysis
#' @param group_var Grouping variable for comparing missingness patterns
#'   (e.g., treatment arm, study site)
#' @param time_var Time variable for temporal missingness analysis (e.g.,
#'   visit number, time since baseline)
#' @param id_var Subject identifier for longitudinal missingness analysis
#' @param pattern_analysis Analyze missing data patterns and frequencies
#' @param mechanism_testing Test missing data mechanisms (MCAR, MAR, MNAR)
#' @param correlation_analysis Analyze correlations between missingness
#'   indicators
#' @param temporal_analysis Analyze missingness patterns over time
#' @param group_comparison Compare missingness patterns between groups
#' @param mcar_test Method for testing Missing Completely At Random assumption
#' @param min_pattern_freq Minimum frequency for reporting missing data
#'   patterns (5\% = 0.05)
#' @param max_patterns_display Maximum number of missing data patterns to
#'   display in detail
#' @param pattern_plot Generate missing data pattern plots
#' @param correlation_plot Generate missingness correlation heatmap
#' @param temporal_plot Generate temporal missingness plots
#' @param upset_plot Generate UpSet plot for pattern visualization
#' @param cumulative_plot Generate cumulative missingness over variables plot
#' @param monotonic_test Test whether missingness follows monotonic patterns
#' @param dropout_analysis Analyze dropout patterns in longitudinal data
#' @param informative_missingness Test whether missingness is informative
#'   (related to outcomes)
#' @param completeness_threshold Threshold for acceptable variable
#'   completeness (80\% = 0.8)
#' @param case_completeness Analyze completeness at the case/subject level
#' @param variable_importance Assess which variables predict missingness in
#'   others
#' @param chi_square_test Chi-square tests for independence of missingness
#' @param logistic_regression Logistic regression to predict missingness
#'   patterns
#' @param survival_analysis Survival analysis for time to dropout/missingness
#' @param detailed_patterns Show detailed information for each missing data
#'   pattern
#' @param summary_statistics Include comprehensive summary statistics
#' @param clinical_interpretation Provide clinical interpretation and
#'   recommendations
#' @param export_patterns Export missing data patterns for external analysis
#' @return A results object containing:
#' \tabular{llllll}{
#' }
#'
#' @export
missingdataexplorer <- function(
    data,
    analysis_vars,
    group_var,
    time_var,
    id_var,
    pattern_analysis = TRUE,
    mechanism_testing = TRUE,
    correlation_analysis = TRUE,
    temporal_analysis = FALSE,
    group_comparison = FALSE,
    mcar_test = "little",
    min_pattern_freq = 0.05,
    max_patterns_display = 20,
    pattern_plot = TRUE,
    correlation_plot = TRUE,
    temporal_plot = FALSE,
    upset_plot = TRUE,
    cumulative_plot = FALSE,
    monotonic_test = TRUE,
    dropout_analysis = FALSE,
    informative_missingness = TRUE,
    completeness_threshold = 0.8,
    case_completeness = TRUE,
    variable_importance = TRUE,
    chi_square_test = TRUE,
    logistic_regression = FALSE,
    survival_analysis = FALSE,
    detailed_patterns = TRUE,
    summary_statistics = TRUE,
    clinical_interpretation = TRUE,
    export_patterns = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("missingdataexplorer requires jmvcore to be installed (restart may be required)")

    if ( ! missing(analysis_vars)) analysis_vars <- jmvcore::resolveQuo(jmvcore::enquo(analysis_vars))
    if ( ! missing(group_var)) group_var <- jmvcore::resolveQuo(jmvcore::enquo(group_var))
    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(id_var)) id_var <- jmvcore::resolveQuo(jmvcore::enquo(id_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(analysis_vars), analysis_vars, NULL),
            `if`( ! missing(group_var), group_var, NULL),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(id_var), id_var, NULL))

    for (v in group_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- missingdataexplorerOptions$new(
        analysis_vars = analysis_vars,
        group_var = group_var,
        time_var = time_var,
        id_var = id_var,
        pattern_analysis = pattern_analysis,
        mechanism_testing = mechanism_testing,
        correlation_analysis = correlation_analysis,
        temporal_analysis = temporal_analysis,
        group_comparison = group_comparison,
        mcar_test = mcar_test,
        min_pattern_freq = min_pattern_freq,
        max_patterns_display = max_patterns_display,
        pattern_plot = pattern_plot,
        correlation_plot = correlation_plot,
        temporal_plot = temporal_plot,
        upset_plot = upset_plot,
        cumulative_plot = cumulative_plot,
        monotonic_test = monotonic_test,
        dropout_analysis = dropout_analysis,
        informative_missingness = informative_missingness,
        completeness_threshold = completeness_threshold,
        case_completeness = case_completeness,
        variable_importance = variable_importance,
        chi_square_test = chi_square_test,
        logistic_regression = logistic_regression,
        survival_analysis = survival_analysis,
        detailed_patterns = detailed_patterns,
        summary_statistics = summary_statistics,
        clinical_interpretation = clinical_interpretation,
        export_patterns = export_patterns)

    analysis <- missingdataexplorerClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

