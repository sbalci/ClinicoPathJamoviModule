
# This file is automatically generated, you probably don't want to edit this

bayesiandiagnosticOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bayesiandiagnosticOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            test_result = NULL,
            disease_status = NULL,
            covariates = NULL,
            analysis_type = "single_test",
            prior_type = "fixed_prior",
            prior_prob = 0.1,
            alpha_prior = 1,
            beta_prior = 1,
            test_sequence = "test1,test2,test3",
            credible_level = 0.95,
            mcmc_samples = 5000,
            burnin_samples = 1000,
            likelihood_method = "exact",
            posterior_summary = TRUE,
            diagnostic_plots = TRUE,
            sensitivity_analysis = FALSE,
            model_comparison = FALSE,
            predictive_checking = FALSE,
            multilevel_structure = FALSE,
            overdispersion_model = FALSE,
            conditional_independence = TRUE,
            network_analysis = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="bayesiandiagnostic",
                requiresData=FALSE,
                ...)

            private$..test_result <- jmvcore::OptionVariable$new(
                "test_result",
                test_result,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..disease_status <- jmvcore::OptionVariable$new(
                "disease_status",
                disease_status,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"),
                default=NULL)
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "single_test",
                    "test_chain",
                    "parallel_tests",
                    "hierarchical_bayes",
                    "beta_binomial"),
                default="single_test")
            private$..prior_type <- jmvcore::OptionList$new(
                "prior_type",
                prior_type,
                options=list(
                    "fixed_prior",
                    "empirical_prior",
                    "reference_prior",
                    "informative_prior",
                    "hierarchical_prior"),
                default="fixed_prior")
            private$..prior_prob <- jmvcore::OptionNumber$new(
                "prior_prob",
                prior_prob,
                default=0.1,
                min=0.001,
                max=0.999)
            private$..alpha_prior <- jmvcore::OptionNumber$new(
                "alpha_prior",
                alpha_prior,
                default=1,
                min=0.1,
                max=100)
            private$..beta_prior <- jmvcore::OptionNumber$new(
                "beta_prior",
                beta_prior,
                default=1,
                min=0.1,
                max=100)
            private$..test_sequence <- jmvcore::OptionString$new(
                "test_sequence",
                test_sequence,
                default="test1,test2,test3")
            private$..credible_level <- jmvcore::OptionNumber$new(
                "credible_level",
                credible_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..mcmc_samples <- jmvcore::OptionInteger$new(
                "mcmc_samples",
                mcmc_samples,
                default=5000,
                min=1000,
                max=20000)
            private$..burnin_samples <- jmvcore::OptionInteger$new(
                "burnin_samples",
                burnin_samples,
                default=1000,
                min=100,
                max=5000)
            private$..likelihood_method <- jmvcore::OptionList$new(
                "likelihood_method",
                likelihood_method,
                options=list(
                    "exact",
                    "asymptotic",
                    "bootstrap",
                    "bayesian_bootstrap"),
                default="exact")
            private$..posterior_summary <- jmvcore::OptionBool$new(
                "posterior_summary",
                posterior_summary,
                default=TRUE)
            private$..diagnostic_plots <- jmvcore::OptionBool$new(
                "diagnostic_plots",
                diagnostic_plots,
                default=TRUE)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=FALSE)
            private$..model_comparison <- jmvcore::OptionBool$new(
                "model_comparison",
                model_comparison,
                default=FALSE)
            private$..predictive_checking <- jmvcore::OptionBool$new(
                "predictive_checking",
                predictive_checking,
                default=FALSE)
            private$..multilevel_structure <- jmvcore::OptionBool$new(
                "multilevel_structure",
                multilevel_structure,
                default=FALSE)
            private$..overdispersion_model <- jmvcore::OptionBool$new(
                "overdispersion_model",
                overdispersion_model,
                default=FALSE)
            private$..conditional_independence <- jmvcore::OptionBool$new(
                "conditional_independence",
                conditional_independence,
                default=TRUE)
            private$..network_analysis <- jmvcore::OptionBool$new(
                "network_analysis",
                network_analysis,
                default=FALSE)

            self$.addOption(private$..test_result)
            self$.addOption(private$..disease_status)
            self$.addOption(private$..covariates)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..prior_type)
            self$.addOption(private$..prior_prob)
            self$.addOption(private$..alpha_prior)
            self$.addOption(private$..beta_prior)
            self$.addOption(private$..test_sequence)
            self$.addOption(private$..credible_level)
            self$.addOption(private$..mcmc_samples)
            self$.addOption(private$..burnin_samples)
            self$.addOption(private$..likelihood_method)
            self$.addOption(private$..posterior_summary)
            self$.addOption(private$..diagnostic_plots)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..model_comparison)
            self$.addOption(private$..predictive_checking)
            self$.addOption(private$..multilevel_structure)
            self$.addOption(private$..overdispersion_model)
            self$.addOption(private$..conditional_independence)
            self$.addOption(private$..network_analysis)
        }),
    active = list(
        test_result = function() private$..test_result$value,
        disease_status = function() private$..disease_status$value,
        covariates = function() private$..covariates$value,
        analysis_type = function() private$..analysis_type$value,
        prior_type = function() private$..prior_type$value,
        prior_prob = function() private$..prior_prob$value,
        alpha_prior = function() private$..alpha_prior$value,
        beta_prior = function() private$..beta_prior$value,
        test_sequence = function() private$..test_sequence$value,
        credible_level = function() private$..credible_level$value,
        mcmc_samples = function() private$..mcmc_samples$value,
        burnin_samples = function() private$..burnin_samples$value,
        likelihood_method = function() private$..likelihood_method$value,
        posterior_summary = function() private$..posterior_summary$value,
        diagnostic_plots = function() private$..diagnostic_plots$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        model_comparison = function() private$..model_comparison$value,
        predictive_checking = function() private$..predictive_checking$value,
        multilevel_structure = function() private$..multilevel_structure$value,
        overdispersion_model = function() private$..overdispersion_model$value,
        conditional_independence = function() private$..conditional_independence$value,
        network_analysis = function() private$..network_analysis$value),
    private = list(
        ..test_result = NA,
        ..disease_status = NA,
        ..covariates = NA,
        ..analysis_type = NA,
        ..prior_type = NA,
        ..prior_prob = NA,
        ..alpha_prior = NA,
        ..beta_prior = NA,
        ..test_sequence = NA,
        ..credible_level = NA,
        ..mcmc_samples = NA,
        ..burnin_samples = NA,
        ..likelihood_method = NA,
        ..posterior_summary = NA,
        ..diagnostic_plots = NA,
        ..sensitivity_analysis = NA,
        ..model_comparison = NA,
        ..predictive_checking = NA,
        ..multilevel_structure = NA,
        ..overdispersion_model = NA,
        ..conditional_independence = NA,
        ..network_analysis = NA)
)

bayesiandiagnosticResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bayesiandiagnosticResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        priorSummary = function() private$.items[["priorSummary"]],
        likelihoodTable = function() private$.items[["likelihoodTable"]],
        posteriorSummary = function() private$.items[["posteriorSummary"]],
        bayesianUpdates = function() private$.items[["bayesianUpdates"]],
        hierarchicalResults = function() private$.items[["hierarchicalResults"]],
        modelComparison = function() private$.items[["modelComparison"]],
        sensitivityAnalysis = function() private$.items[["sensitivityAnalysis"]],
        predictiveChecks = function() private$.items[["predictiveChecks"]],
        priorPosteriorPlot = function() private$.items[["priorPosteriorPlot"]],
        likelihoodPlot = function() private$.items[["likelihoodPlot"]],
        posteriorPredictivePlot = function() private$.items[["posteriorPredictivePlot"]],
        sensitivityPlot = function() private$.items[["sensitivityPlot"]],
        networkDiagram = function() private$.items[["networkDiagram"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Bayesian Diagnostic Probability Updates")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="priorSummary",
                title="Prior Distribution Summary",
                visible="(posterior_summary)",
                rows=1,
                clearWith=list(
                    "prior_type",
                    "prior_prob",
                    "alpha_prior",
                    "beta_prior"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="median", 
                        `title`="Median", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="mode", 
                        `title`="Mode", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="variance", 
                        `title`="Variance", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="likelihoodTable",
                title="Diagnostic Test Likelihood",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "analysis_type"),
                columns=list(
                    list(
                        `name`="test_outcome", 
                        `title`="Test Result", 
                        `type`="text"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="lr_positive", 
                        `title`="LR+", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="lr_negative", 
                        `title`="LR-", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="se_sensitivity", 
                        `title`="SE(Sens)", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="se_specificity", 
                        `title`="SE(Spec)", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="posteriorSummary",
                title="Posterior Distribution Summary",
                visible="(posterior_summary)",
                rows=1,
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "prior_type",
                    "analysis_type"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Posterior Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_median", 
                        `title`="Posterior Median", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_mode", 
                        `title`="Posterior Mode", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Posterior SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower Credible", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper Credible", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="bayesianUpdates",
                title="Bayesian Probability Updates",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "prior_prob",
                    "analysis_type"),
                columns=list(
                    list(
                        `name`="test_sequence", 
                        `title`="Test Step", 
                        `type`="text"),
                    list(
                        `name`="prior_prob", 
                        `title`="Prior Probability", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="likelihood_ratio", 
                        `title`="Likelihood Ratio", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="posterior_prob", 
                        `title`="Posterior Probability", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="bayes_factor", 
                        `title`="Bayes Factor", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="odds_ratio", 
                        `title`="Post-test Odds", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="probability_gain", 
                        `title`="Information Gain", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hierarchicalResults",
                title="Hierarchical Bayesian Results",
                visible="(multilevel_structure)",
                rows=1,
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "analysis_type",
                    "covariates"),
                columns=list(
                    list(
                        `name`="level", 
                        `title`="Hierarchical Level", 
                        `type`="text"),
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="tau_squared", 
                        `title`="\u03C4\u00B2", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="i_squared", 
                        `title`="I\u00B2", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelComparison",
                title="Bayesian Model Comparison",
                visible="(model_comparison)",
                rows=1,
                clearWith=list(
                    "analysis_type",
                    "multilevel_structure",
                    "overdispersion_model"),
                columns=list(
                    list(
                        `name`="model", 
                        `title`="Model", 
                        `type`="text"),
                    list(
                        `name`="dic", 
                        `title`="DIC", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="waic", 
                        `title`="WAIC", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="loo_ic", 
                        `title`="LOO-IC", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="marginal_likelihood", 
                        `title`="Log ML", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="bayes_factor", 
                        `title`="Bayes Factor", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="model_weight", 
                        `title`="Model Weight", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityAnalysis",
                title="Prior Sensitivity Analysis",
                visible="(sensitivity_analysis)",
                rows=1,
                clearWith=list(
                    "prior_type",
                    "alpha_prior",
                    "beta_prior"),
                columns=list(
                    list(
                        `name`="prior_specification", 
                        `title`="Prior", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Post. Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_median", 
                        `title`="Post. Median", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_width", 
                        `title`="CI Width", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="kl_divergence", 
                        `title`="KL Divergence", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="robustness_index", 
                        `title`="Robustness", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="predictiveChecks",
                title="Posterior Predictive Checks",
                visible="(predictive_checking)",
                rows=1,
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "analysis_type"),
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="text"),
                    list(
                        `name`="observed", 
                        `title`="Observed", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="predicted_mean", 
                        `title`="Predicted Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="predicted_sd", 
                        `title`="Predicted SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="p_value", 
                        `title`="Bayesian p-value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="priorPosteriorPlot",
                title="Prior vs Posterior Distributions",
                visible="(diagnostic_plots)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotPriorPosterior",
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "prior_type",
                    "analysis_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="likelihoodPlot",
                title="Likelihood Function Plot",
                visible="(diagnostic_plots)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotLikelihood",
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "likelihood_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="posteriorPredictivePlot",
                title="Posterior Predictive Distribution",
                visible="(predictive_checking)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotPosteriorPredictive",
                clearWith=list(
                    "test_result",
                    "disease_status",
                    "analysis_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="sensitivityPlot",
                title="Prior Sensitivity Analysis Plot",
                visible="(sensitivity_analysis)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotSensitivity",
                clearWith=list(
                    "prior_type",
                    "alpha_prior",
                    "beta_prior")))
            self$add(jmvcore::Image$new(
                options=options,
                name="networkDiagram",
                title="Diagnostic Network Diagram",
                visible="(network_analysis)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotNetworkDiagram",
                clearWith=list(
                    "test_sequence",
                    "conditional_independence")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Interpretation",
                visible=TRUE))}))

bayesiandiagnosticBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "bayesiandiagnosticBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "bayesiandiagnostic",
                version = c(0,0,3),
                options = options,
                results = bayesiandiagnosticResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'na')
        }))

#' Bayesian Diagnostic Probability Updates
#'
#' Bayesian diagnostic probability calculations with prior probability 
#' updates.
#' Implements likelihood ratios, posterior probability calculations, and
#' diagnostic test chain analysis with sequential updating.
#' 
#'
#' @examples
#' # Example: Bayesian diagnostic update
#' bayesiandiagnostic(
#'     data = diagnostic_data,
#'     test_result = test_outcome,
#'     disease_status = actual_disease,
#'     prior_prob = 0.15,
#'     analysis_type = "single_test"
#' )
#'
#' @param test_result Test result variable for diagnostic analysis
#' @param disease_status Gold standard disease status variable
#' @param covariates Covariates for risk-stratified diagnostic analysis
#' @param analysis_type Statistical approach for diagnostic probability
#'   updates
#' @param prior_type Prior probability specification approach
#' @param prior_prob Prior probability of disease in the population
#' @param alpha_prior Alpha parameter for informative beta prior
#' @param beta_prior Beta parameter for informative beta prior
#' @param test_sequence Sequential test names for chain analysis
#' @param credible_level Level for Bayesian credible intervals
#' @param mcmc_samples MCMC iterations for posterior sampling
#' @param burnin_samples MCMC burn-in iterations
#' @param likelihood_method Approach for computing diagnostic likelihood
#' @param posterior_summary Whether to compute posterior summary statistics
#' @param diagnostic_plots Whether to create diagnostic probability plots
#' @param sensitivity_analysis Whether to perform prior sensitivity analysis
#' @param model_comparison Whether to perform Bayesian model comparison
#' @param predictive_checking Whether to perform posterior predictive checks
#' @param multilevel_structure Whether to use hierarchical Bayesian modeling
#' @param overdispersion_model Whether to model overdispersion in diagnostic
#'   accuracy
#' @param conditional_independence Whether tests are conditionally independent
#'   given disease status
#' @param network_analysis Whether to use Bayesian network modeling
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$priorSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$likelihoodTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$posteriorSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$bayesianUpdates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hierarchicalResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivityAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$predictiveChecks} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$priorPosteriorPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$likelihoodPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$posteriorPredictivePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sensitivityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$networkDiagram} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$priorSummary$asDF}
#'
#' \code{as.data.frame(results$priorSummary)}
#'
#' @export
bayesiandiagnostic <- function(
    test_result,
    disease_status,
    covariates = NULL,
    analysis_type = "single_test",
    prior_type = "fixed_prior",
    prior_prob = 0.1,
    alpha_prior = 1,
    beta_prior = 1,
    test_sequence = "test1,test2,test3",
    credible_level = 0.95,
    mcmc_samples = 5000,
    burnin_samples = 1000,
    likelihood_method = "exact",
    posterior_summary = TRUE,
    diagnostic_plots = TRUE,
    sensitivity_analysis = FALSE,
    model_comparison = FALSE,
    predictive_checking = FALSE,
    multilevel_structure = FALSE,
    overdispersion_model = FALSE,
    conditional_independence = TRUE,
    network_analysis = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("bayesiandiagnostic requires jmvcore to be installed (restart may be required)")

    if ( ! missing(test_result)) test_result <- jmvcore::resolveQuo(jmvcore::enquo(test_result))
    if ( ! missing(disease_status)) disease_status <- jmvcore::resolveQuo(jmvcore::enquo(disease_status))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))

    options <- bayesiandiagnosticOptions$new(
        test_result = test_result,
        disease_status = disease_status,
        covariates = covariates,
        analysis_type = analysis_type,
        prior_type = prior_type,
        prior_prob = prior_prob,
        alpha_prior = alpha_prior,
        beta_prior = beta_prior,
        test_sequence = test_sequence,
        credible_level = credible_level,
        mcmc_samples = mcmc_samples,
        burnin_samples = burnin_samples,
        likelihood_method = likelihood_method,
        posterior_summary = posterior_summary,
        diagnostic_plots = diagnostic_plots,
        sensitivity_analysis = sensitivity_analysis,
        model_comparison = model_comparison,
        predictive_checking = predictive_checking,
        multilevel_structure = multilevel_structure,
        overdispersion_model = overdispersion_model,
        conditional_independence = conditional_independence,
        network_analysis = network_analysis)

    analysis <- bayesiandiagnosticClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

