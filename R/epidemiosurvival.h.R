
# This file is automatically generated, you probably don't want to edit this

epidemiosurvivalOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "epidemiosurvivalOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_var = NULL,
            event_var = NULL,
            exposure_var = NULL,
            age_var = NULL,
            calendar_time = NULL,
            population_weights = NULL,
            subcohort_indicator = NULL,
            stratification_vars = NULL,
            competing_events = NULL,
            analysis_type = "cohort_survival",
            cohort_design = "prospective",
            sampling_method = "simple_random",
            survival_method = "kaplan_meier",
            regression_method = "cox_robust",
            age_standardization = "none",
            reference_population = "study_population",
            age_groups = "0-49,50-59,60-69,70+",
            calendar_periods = "1990-1999,2000-2009,2010-2019",
            subcohort_size = 1000,
            case_cohort_method = "prentice",
            par_method = "levin",
            confidence_level = 0.95,
            cohort_life_tables = TRUE,
            competing_risks_analysis = FALSE,
            age_period_cohort_effects = FALSE,
            population_impact_measures = FALSE,
            survival_disparities = FALSE,
            trend_analysis = FALSE,
            excess_mortality = FALSE,
            standardized_mortality_ratio = FALSE,
            survival_curves = TRUE,
            cumulative_incidence_plots = FALSE,
            age_specific_rates = FALSE,
            trend_plots = FALSE,
            forest_plots = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="epidemiosurvival",
                requiresData=TRUE,
                ...)

            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_var <- jmvcore::OptionVariable$new(
                "event_var",
                event_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..exposure_var <- jmvcore::OptionVariable$new(
                "exposure_var",
                exposure_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..age_var <- jmvcore::OptionVariable$new(
                "age_var",
                age_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..calendar_time <- jmvcore::OptionVariable$new(
                "calendar_time",
                calendar_time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..population_weights <- jmvcore::OptionVariable$new(
                "population_weights",
                population_weights,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..subcohort_indicator <- jmvcore::OptionVariable$new(
                "subcohort_indicator",
                subcohort_indicator,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..stratification_vars <- jmvcore::OptionVariables$new(
                "stratification_vars",
                stratification_vars,
                suggested=list(
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..competing_events <- jmvcore::OptionVariables$new(
                "competing_events",
                competing_events,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "cohort_survival",
                    "case_cohort",
                    "population_attributable_risk",
                    "competing_mortality",
                    "age_period_cohort"),
                default="cohort_survival")
            private$..cohort_design <- jmvcore::OptionList$new(
                "cohort_design",
                cohort_design,
                options=list(
                    "prospective",
                    "retrospective",
                    "ambidirectional",
                    "registry_based"),
                default="prospective")
            private$..sampling_method <- jmvcore::OptionList$new(
                "sampling_method",
                sampling_method,
                options=list(
                    "simple_random",
                    "stratified",
                    "cluster",
                    "multistage",
                    "case_cohort"),
                default="simple_random")
            private$..survival_method <- jmvcore::OptionList$new(
                "survival_method",
                survival_method,
                options=list(
                    "kaplan_meier",
                    "life_table",
                    "weighted_survival",
                    "poisson_regression"),
                default="kaplan_meier")
            private$..regression_method <- jmvcore::OptionList$new(
                "regression_method",
                regression_method,
                options=list(
                    "cox_robust",
                    "weighted_cox",
                    "poisson_glm",
                    "case_cohort_cox"),
                default="cox_robust")
            private$..age_standardization <- jmvcore::OptionList$new(
                "age_standardization",
                age_standardization,
                options=list(
                    "none",
                    "direct",
                    "indirect",
                    "world_standard",
                    "segi_standard"),
                default="none")
            private$..reference_population <- jmvcore::OptionString$new(
                "reference_population",
                reference_population,
                default="study_population")
            private$..age_groups <- jmvcore::OptionString$new(
                "age_groups",
                age_groups,
                default="0-49,50-59,60-69,70+")
            private$..calendar_periods <- jmvcore::OptionString$new(
                "calendar_periods",
                calendar_periods,
                default="1990-1999,2000-2009,2010-2019")
            private$..subcohort_size <- jmvcore::OptionNumber$new(
                "subcohort_size",
                subcohort_size,
                default=1000,
                min=50)
            private$..case_cohort_method <- jmvcore::OptionList$new(
                "case_cohort_method",
                case_cohort_method,
                options=list(
                    "prentice",
                    "self_prentice",
                    "lin_ying",
                    "barlow"),
                default="prentice")
            private$..par_method <- jmvcore::OptionList$new(
                "par_method",
                par_method,
                options=list(
                    "levin",
                    "adjusted",
                    "sequential",
                    "miettinen"),
                default="levin")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..cohort_life_tables <- jmvcore::OptionBool$new(
                "cohort_life_tables",
                cohort_life_tables,
                default=TRUE)
            private$..competing_risks_analysis <- jmvcore::OptionBool$new(
                "competing_risks_analysis",
                competing_risks_analysis,
                default=FALSE)
            private$..age_period_cohort_effects <- jmvcore::OptionBool$new(
                "age_period_cohort_effects",
                age_period_cohort_effects,
                default=FALSE)
            private$..population_impact_measures <- jmvcore::OptionBool$new(
                "population_impact_measures",
                population_impact_measures,
                default=FALSE)
            private$..survival_disparities <- jmvcore::OptionBool$new(
                "survival_disparities",
                survival_disparities,
                default=FALSE)
            private$..trend_analysis <- jmvcore::OptionBool$new(
                "trend_analysis",
                trend_analysis,
                default=FALSE)
            private$..excess_mortality <- jmvcore::OptionBool$new(
                "excess_mortality",
                excess_mortality,
                default=FALSE)
            private$..standardized_mortality_ratio <- jmvcore::OptionBool$new(
                "standardized_mortality_ratio",
                standardized_mortality_ratio,
                default=FALSE)
            private$..survival_curves <- jmvcore::OptionBool$new(
                "survival_curves",
                survival_curves,
                default=TRUE)
            private$..cumulative_incidence_plots <- jmvcore::OptionBool$new(
                "cumulative_incidence_plots",
                cumulative_incidence_plots,
                default=FALSE)
            private$..age_specific_rates <- jmvcore::OptionBool$new(
                "age_specific_rates",
                age_specific_rates,
                default=FALSE)
            private$..trend_plots <- jmvcore::OptionBool$new(
                "trend_plots",
                trend_plots,
                default=FALSE)
            private$..forest_plots <- jmvcore::OptionBool$new(
                "forest_plots",
                forest_plots,
                default=FALSE)

            self$.addOption(private$..time_var)
            self$.addOption(private$..event_var)
            self$.addOption(private$..exposure_var)
            self$.addOption(private$..age_var)
            self$.addOption(private$..calendar_time)
            self$.addOption(private$..population_weights)
            self$.addOption(private$..subcohort_indicator)
            self$.addOption(private$..stratification_vars)
            self$.addOption(private$..competing_events)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..cohort_design)
            self$.addOption(private$..sampling_method)
            self$.addOption(private$..survival_method)
            self$.addOption(private$..regression_method)
            self$.addOption(private$..age_standardization)
            self$.addOption(private$..reference_population)
            self$.addOption(private$..age_groups)
            self$.addOption(private$..calendar_periods)
            self$.addOption(private$..subcohort_size)
            self$.addOption(private$..case_cohort_method)
            self$.addOption(private$..par_method)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..cohort_life_tables)
            self$.addOption(private$..competing_risks_analysis)
            self$.addOption(private$..age_period_cohort_effects)
            self$.addOption(private$..population_impact_measures)
            self$.addOption(private$..survival_disparities)
            self$.addOption(private$..trend_analysis)
            self$.addOption(private$..excess_mortality)
            self$.addOption(private$..standardized_mortality_ratio)
            self$.addOption(private$..survival_curves)
            self$.addOption(private$..cumulative_incidence_plots)
            self$.addOption(private$..age_specific_rates)
            self$.addOption(private$..trend_plots)
            self$.addOption(private$..forest_plots)
        }),
    active = list(
        time_var = function() private$..time_var$value,
        event_var = function() private$..event_var$value,
        exposure_var = function() private$..exposure_var$value,
        age_var = function() private$..age_var$value,
        calendar_time = function() private$..calendar_time$value,
        population_weights = function() private$..population_weights$value,
        subcohort_indicator = function() private$..subcohort_indicator$value,
        stratification_vars = function() private$..stratification_vars$value,
        competing_events = function() private$..competing_events$value,
        analysis_type = function() private$..analysis_type$value,
        cohort_design = function() private$..cohort_design$value,
        sampling_method = function() private$..sampling_method$value,
        survival_method = function() private$..survival_method$value,
        regression_method = function() private$..regression_method$value,
        age_standardization = function() private$..age_standardization$value,
        reference_population = function() private$..reference_population$value,
        age_groups = function() private$..age_groups$value,
        calendar_periods = function() private$..calendar_periods$value,
        subcohort_size = function() private$..subcohort_size$value,
        case_cohort_method = function() private$..case_cohort_method$value,
        par_method = function() private$..par_method$value,
        confidence_level = function() private$..confidence_level$value,
        cohort_life_tables = function() private$..cohort_life_tables$value,
        competing_risks_analysis = function() private$..competing_risks_analysis$value,
        age_period_cohort_effects = function() private$..age_period_cohort_effects$value,
        population_impact_measures = function() private$..population_impact_measures$value,
        survival_disparities = function() private$..survival_disparities$value,
        trend_analysis = function() private$..trend_analysis$value,
        excess_mortality = function() private$..excess_mortality$value,
        standardized_mortality_ratio = function() private$..standardized_mortality_ratio$value,
        survival_curves = function() private$..survival_curves$value,
        cumulative_incidence_plots = function() private$..cumulative_incidence_plots$value,
        age_specific_rates = function() private$..age_specific_rates$value,
        trend_plots = function() private$..trend_plots$value,
        forest_plots = function() private$..forest_plots$value),
    private = list(
        ..time_var = NA,
        ..event_var = NA,
        ..exposure_var = NA,
        ..age_var = NA,
        ..calendar_time = NA,
        ..population_weights = NA,
        ..subcohort_indicator = NA,
        ..stratification_vars = NA,
        ..competing_events = NA,
        ..analysis_type = NA,
        ..cohort_design = NA,
        ..sampling_method = NA,
        ..survival_method = NA,
        ..regression_method = NA,
        ..age_standardization = NA,
        ..reference_population = NA,
        ..age_groups = NA,
        ..calendar_periods = NA,
        ..subcohort_size = NA,
        ..case_cohort_method = NA,
        ..par_method = NA,
        ..confidence_level = NA,
        ..cohort_life_tables = NA,
        ..competing_risks_analysis = NA,
        ..age_period_cohort_effects = NA,
        ..population_impact_measures = NA,
        ..survival_disparities = NA,
        ..trend_analysis = NA,
        ..excess_mortality = NA,
        ..standardized_mortality_ratio = NA,
        ..survival_curves = NA,
        ..cumulative_incidence_plots = NA,
        ..age_specific_rates = NA,
        ..trend_plots = NA,
        ..forest_plots = NA)
)

epidemiosurvivalResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "epidemiosurvivalResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        cohort_summary = function() private$.items[["cohort_summary"]],
        survival_estimates = function() private$.items[["survival_estimates"]],
        hazard_ratios = function() private$.items[["hazard_ratios"]],
        population_attributable_risk = function() private$.items[["population_attributable_risk"]],
        age_standardized_rates = function() private$.items[["age_standardized_rates"]],
        life_table = function() private$.items[["life_table"]],
        case_cohort_results = function() private$.items[["case_cohort_results"]],
        competing_mortality = function() private$.items[["competing_mortality"]],
        apc_effects = function() private$.items[["apc_effects"]],
        survival_disparities_table = function() private$.items[["survival_disparities_table"]],
        trend_analysis_table = function() private$.items[["trend_analysis_table"]],
        excess_mortality_table = function() private$.items[["excess_mortality_table"]],
        survival_curves_plot = function() private$.items[["survival_curves_plot"]],
        cumulative_incidence_plot = function() private$.items[["cumulative_incidence_plot"]],
        age_specific_rates_plot = function() private$.items[["age_specific_rates_plot"]],
        trend_plot = function() private$.items[["trend_plot"]],
        forest_plot = function() private$.items[["forest_plot"]],
        epidemiological_interpretation = function() private$.items[["epidemiological_interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Epidemiological Survival Analysis",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "urvminer",
                    "survival",
                    "epitools"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="cohort_summary",
                title="Cohort Study Summary",
                rows=1,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="study_design", 
                        `title`="Study Design", 
                        `type`="text"),
                    list(
                        `name`="total_participants", 
                        `title`="Total Participants (N)", 
                        `type`="integer"),
                    list(
                        `name`="total_person_years", 
                        `title`="Total Person-Years", 
                        `type`="number"),
                    list(
                        `name`="total_events", 
                        `title`="Total Events (N)", 
                        `type`="integer"),
                    list(
                        `name`="incidence_rate", 
                        `title`="Incidence Rate (per 100,000)", 
                        `type`="number"),
                    list(
                        `name`="median_followup", 
                        `title`="Median Follow-up (years)", 
                        `type`="number"),
                    list(
                        `name`="study_period", 
                        `title`="Study Period", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="survival_estimates",
                title="Survival Estimates by Exposure",
                rows=0,
                visible="(survival_curves)",
                columns=list(
                    list(
                        `name`="exposure_group", 
                        `title`="Exposure Group", 
                        `type`="text"),
                    list(
                        `name`="n_participants", 
                        `title`="N Participants", 
                        `type`="integer"),
                    list(
                        `name`="n_events", 
                        `title`="N Events", 
                        `type`="integer"),
                    list(
                        `name`="person_years", 
                        `title`="Person-Years", 
                        `type`="number"),
                    list(
                        `name`="incidence_rate", 
                        `title`="Rate (per 100,000)", 
                        `type`="number"),
                    list(
                        `name`="rate_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="rate_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="survival_5yr", 
                        `title`="5-year Survival (%)", 
                        `type`="number"),
                    list(
                        `name`="survival_10yr", 
                        `title`="10-year Survival (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hazard_ratios",
                title="Hazard Ratios and Risk Estimates",
                rows=0,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="hazard_ratio", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="rate_ratio", 
                        `title`="Rate Ratio", 
                        `type`="number"),
                    list(
                        `name`="rr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="rr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="population_attributable_risk",
                title="Population Attributable Risk",
                rows=0,
                visible="(population_impact_measures)",
                columns=list(
                    list(
                        `name`="exposure_factor", 
                        `title`="Exposure Factor", 
                        `type`="text"),
                    list(
                        `name`="prevalence", 
                        `title`="Prevalence (%)", 
                        `type`="number"),
                    list(
                        `name`="relative_risk", 
                        `title`="Relative Risk", 
                        `type`="number"),
                    list(
                        `name`="par_percent", 
                        `title`="PAR (%)", 
                        `type`="number"),
                    list(
                        `name`="par_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="par_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="paf_percent", 
                        `title`="PAF (%)", 
                        `type`="number"),
                    list(
                        `name`="number_needed_treat", 
                        `title`="NNT", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="age_standardized_rates",
                title="Age-Standardized Rates",
                rows=0,
                visible="(!age_standardization:none)",
                columns=list(
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="crude_rate", 
                        `title`="Crude Rate", 
                        `type`="number"),
                    list(
                        `name`="asr", 
                        `title`="Age-Standardized Rate", 
                        `type`="number"),
                    list(
                        `name`="asr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="asr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="standardization_method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="reference_population", 
                        `title`="Reference", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="life_table",
                title="Cohort Life Table",
                rows=0,
                visible="(cohort_life_tables)",
                columns=list(
                    list(
                        `name`="age_interval", 
                        `title`="Age Interval", 
                        `type`="text"),
                    list(
                        `name`="n_at_risk", 
                        `title`="N at Risk", 
                        `type`="integer"),
                    list(
                        `name`="deaths", 
                        `title`="Deaths", 
                        `type`="integer"),
                    list(
                        `name`="person_years", 
                        `title`="Person-Years", 
                        `type`="number"),
                    list(
                        `name`="mortality_rate", 
                        `title`="Mortality Rate", 
                        `type`="number"),
                    list(
                        `name`="survival_prob", 
                        `title`="Survival Probability", 
                        `type`="number"),
                    list(
                        `name`="cumulative_survival", 
                        `title`="Cumulative Survival", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="case_cohort_results",
                title="Case-Cohort Analysis Results",
                rows=0,
                visible="(analysis_type:case_cohort)",
                columns=list(
                    list(
                        `name`="subcohort_size", 
                        `title`="Subcohort Size", 
                        `type`="integer"),
                    list(
                        `name`="cases_in_subcohort", 
                        `title`="Cases in Subcohort", 
                        `type`="integer"),
                    list(
                        `name`="total_cases", 
                        `title`="Total Cases", 
                        `type`="integer"),
                    list(
                        `name`="sampling_fraction", 
                        `title`="Sampling Fraction", 
                        `type`="number"),
                    list(
                        `name`="weighted_hr", 
                        `title`="Weighted HR", 
                        `type`="number"),
                    list(
                        `name`="whr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="whr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="efficiency", 
                        `title`="Relative Efficiency (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="competing_mortality",
                title="Competing Mortality Analysis",
                rows=0,
                visible="(competing_risks_analysis)",
                columns=list(
                    list(
                        `name`="cause", 
                        `title`="Cause of Death", 
                        `type`="text"),
                    list(
                        `name`="events", 
                        `title`="Events", 
                        `type`="integer"),
                    list(
                        `name`="crude_rate", 
                        `title`="Crude Rate", 
                        `type`="number"),
                    list(
                        `name`="cause_specific_hr", 
                        `title`="Cause-Specific HR", 
                        `type`="number"),
                    list(
                        `name`="cshr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="cshr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="subdistribution_hr", 
                        `title`="Subdistribution HR", 
                        `type`="number"),
                    list(
                        `name`="shr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="shr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="apc_effects",
                title="Age-Period-Cohort Effects",
                rows=0,
                visible="(age_period_cohort_effects)",
                columns=list(
                    list(
                        `name`="effect_type", 
                        `title`="Effect Type", 
                        `type`="text"),
                    list(
                        `name`="category", 
                        `title`="Category", 
                        `type`="text"),
                    list(
                        `name`="log_rate_ratio", 
                        `title`="Log Rate Ratio", 
                        `type`="number"),
                    list(
                        `name`="rate_ratio", 
                        `title`="Rate Ratio", 
                        `type`="number"),
                    list(
                        `name`="rr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="rr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="significance", 
                        `title`="Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="survival_disparities_table",
                title="Survival Disparities Analysis",
                rows=0,
                visible="(survival_disparities)",
                columns=list(
                    list(
                        `name`="demographic_factor", 
                        `title`="Demographic Factor", 
                        `type`="text"),
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="hazard_ratio", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="absolute_difference", 
                        `title`="Absolute Difference (%)", 
                        `type`="number"),
                    list(
                        `name`="relative_difference", 
                        `title`="Relative Difference (%)", 
                        `type`="number"),
                    list(
                        `name`="disparity_index", 
                        `title`="Disparity Index", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="trend_analysis_table",
                title="Temporal Trend Analysis",
                rows=0,
                visible="(trend_analysis)",
                columns=list(
                    list(
                        `name`="period", 
                        `title`="Calendar Period", 
                        `type`="text"),
                    list(
                        `name`="incidence_rate", 
                        `title`="Incidence Rate", 
                        `type`="number"),
                    list(
                        `name`="asr", 
                        `title`="Age-Standardized Rate", 
                        `type`="number"),
                    list(
                        `name`="survival_rate", 
                        `title`="Survival Rate (%)", 
                        `type`="number"),
                    list(
                        `name`="annual_change", 
                        `title`="Annual % Change", 
                        `type`="number"),
                    list(
                        `name`="trend_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="trend_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="trend_p_value", 
                        `title`="P-trend", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="excess_mortality_table",
                title="Excess Mortality Analysis",
                rows=0,
                visible="(excess_mortality)",
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="observed_deaths", 
                        `title`="Observed Deaths", 
                        `type`="integer"),
                    list(
                        `name`="expected_deaths", 
                        `title`="Expected Deaths", 
                        `type`="number"),
                    list(
                        `name`="smr", 
                        `title`="SMR", 
                        `type`="number"),
                    list(
                        `name`="smr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="smr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="excess_deaths", 
                        `title`="Excess Deaths", 
                        `type`="number"),
                    list(
                        `name`="excess_rate", 
                        `title`="Excess Rate", 
                        `type`="number"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="survival_curves_plot",
                title="Survival Curves by Exposure",
                width=600,
                height=450,
                visible="(survival_curves)",
                renderFun=".plot_survival_curves"))
            self$add(jmvcore::Image$new(
                options=options,
                name="cumulative_incidence_plot",
                title="Cumulative Incidence Functions",
                width=600,
                height=450,
                visible="(cumulative_incidence_plots)",
                renderFun=".plot_cumulative_incidence"))
            self$add(jmvcore::Image$new(
                options=options,
                name="age_specific_rates_plot",
                title="Age-Specific Rates",
                width=600,
                height=450,
                visible="(age_specific_rates)",
                renderFun=".plot_age_specific_rates"))
            self$add(jmvcore::Image$new(
                options=options,
                name="trend_plot",
                title="Temporal Trends in Survival",
                width=600,
                height=450,
                visible="(trend_plots)",
                renderFun=".plot_temporal_trends"))
            self$add(jmvcore::Image$new(
                options=options,
                name="forest_plot",
                title="Forest Plot of Risk Estimates",
                width=600,
                height=450,
                visible="(forest_plots)",
                renderFun=".plot_forest_estimates"))
            self$add(jmvcore::Html$new(
                options=options,
                name="epidemiological_interpretation",
                title="Epidemiological Interpretation",
                visible=TRUE))}))

epidemiosurvivalBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "epidemiosurvivalBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "epidemiosurvival",
                version = c(1,0,0),
                options = options,
                results = epidemiosurvivalResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Epidemiological Survival Analysis
#'
#' Epidemiological survival analysis for population-based studies and 
#' observational research.
#' Provides specialized methods for cohort survival analysis, case-cohort 
#' designs, and 
#' population attributable risk calculation. Includes adjustment for sampling 
#' schemes,
#' competing mortality, and population stratification. Designed for 
#' epidemiological
#' research including cancer registry studies, cohort studies, and population 
#' surveillance.
#' 
#'
#' @examples
#' data('population_cohort')
#'
#' epidemiosurvival(
#'     data = population_cohort,
#'     time_var = "followup_time",
#'     event_var = "death",
#'     exposure_var = "smoking_status",
#'     age_var = "age_at_entry",
#'     calendar_time = "entry_year",
#'     population_weights = "sampling_weight"
#' )
#'
#' @param data the data as a data frame
#' @param time_var Follow-up time (years, months, or days)
#' @param event_var Event indicator (1=event, 0=censored)
#' @param exposure_var Primary exposure of interest for epidemiological
#'   analysis
#' @param age_var Age at study entry or baseline (years)
#' @param calendar_time Calendar year or period of study entry
#' @param population_weights Sampling or population weights for complex survey
#'   designs
#' @param subcohort_indicator Subcohort membership indicator for case-cohort
#'   designs
#' @param stratification_vars Variables for stratified analysis (e.g., sex,
#'   region, socioeconomic status)
#' @param competing_events Competing event indicators for competing mortality
#'   analysis
#' @param analysis_type Type of epidemiological survival analysis
#' @param cohort_design Type of cohort study design
#' @param sampling_method Sampling method used in the study design
#' @param survival_method Method for survival function estimation
#' @param regression_method Regression method for hazard estimation
#' @param age_standardization Method for age standardization
#' @param reference_population Reference population for standardization
#'   (study_population, external, or custom)
#' @param age_groups Age group categories for stratified analysis
#'   (comma-separated)
#' @param calendar_periods Calendar period categories for period analysis
#' @param subcohort_size Size of subcohort for case-cohort analysis
#' @param case_cohort_method Estimation method for case-cohort designs
#' @param par_method Method for population attributable risk calculation
#' @param confidence_level Confidence level for intervals
#' @param cohort_life_tables Generate cohort life tables
#' @param competing_risks_analysis Analyze competing mortality risks
#' @param age_period_cohort_effects Estimate age, period, and cohort effects
#' @param population_impact_measures Calculate population impact measures
#'   (PAR, PAF, NNT)
#' @param survival_disparities Analyze survival disparities by demographic
#'   factors
#' @param trend_analysis Analyze temporal trends in survival
#' @param excess_mortality Calculate excess mortality compared to general
#'   population
#' @param standardized_mortality_ratio Calculate SMR with confidence intervals
#' @param survival_curves Generate survival curves by exposure groups
#' @param cumulative_incidence_plots Plot cumulative incidence functions
#' @param age_specific_rates Plot age-specific mortality/incidence rates
#' @param trend_plots Plot survival trends over calendar time
#' @param forest_plots Generate forest plots for subgroup analyses
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$cohort_summary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survival_estimates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hazard_ratios} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$population_attributable_risk} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$age_standardized_rates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$life_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$case_cohort_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$competing_mortality} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$apc_effects} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survival_disparities_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$trend_analysis_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$excess_mortality_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survival_curves_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cumulative_incidence_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$age_specific_rates_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$trend_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$forest_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$epidemiological_interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$cohort_summary$asDF}
#'
#' \code{as.data.frame(results$cohort_summary)}
#'
#' @export
epidemiosurvival <- function(
    data,
    time_var,
    event_var,
    exposure_var,
    age_var,
    calendar_time,
    population_weights,
    subcohort_indicator,
    stratification_vars,
    competing_events,
    analysis_type = "cohort_survival",
    cohort_design = "prospective",
    sampling_method = "simple_random",
    survival_method = "kaplan_meier",
    regression_method = "cox_robust",
    age_standardization = "none",
    reference_population = "study_population",
    age_groups = "0-49,50-59,60-69,70+",
    calendar_periods = "1990-1999,2000-2009,2010-2019",
    subcohort_size = 1000,
    case_cohort_method = "prentice",
    par_method = "levin",
    confidence_level = 0.95,
    cohort_life_tables = TRUE,
    competing_risks_analysis = FALSE,
    age_period_cohort_effects = FALSE,
    population_impact_measures = FALSE,
    survival_disparities = FALSE,
    trend_analysis = FALSE,
    excess_mortality = FALSE,
    standardized_mortality_ratio = FALSE,
    survival_curves = TRUE,
    cumulative_incidence_plots = FALSE,
    age_specific_rates = FALSE,
    trend_plots = FALSE,
    forest_plots = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("epidemiosurvival requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(event_var)) event_var <- jmvcore::resolveQuo(jmvcore::enquo(event_var))
    if ( ! missing(exposure_var)) exposure_var <- jmvcore::resolveQuo(jmvcore::enquo(exposure_var))
    if ( ! missing(age_var)) age_var <- jmvcore::resolveQuo(jmvcore::enquo(age_var))
    if ( ! missing(calendar_time)) calendar_time <- jmvcore::resolveQuo(jmvcore::enquo(calendar_time))
    if ( ! missing(population_weights)) population_weights <- jmvcore::resolveQuo(jmvcore::enquo(population_weights))
    if ( ! missing(subcohort_indicator)) subcohort_indicator <- jmvcore::resolveQuo(jmvcore::enquo(subcohort_indicator))
    if ( ! missing(stratification_vars)) stratification_vars <- jmvcore::resolveQuo(jmvcore::enquo(stratification_vars))
    if ( ! missing(competing_events)) competing_events <- jmvcore::resolveQuo(jmvcore::enquo(competing_events))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(event_var), event_var, NULL),
            `if`( ! missing(exposure_var), exposure_var, NULL),
            `if`( ! missing(age_var), age_var, NULL),
            `if`( ! missing(calendar_time), calendar_time, NULL),
            `if`( ! missing(population_weights), population_weights, NULL),
            `if`( ! missing(subcohort_indicator), subcohort_indicator, NULL),
            `if`( ! missing(stratification_vars), stratification_vars, NULL),
            `if`( ! missing(competing_events), competing_events, NULL))

    for (v in event_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in exposure_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in subcohort_indicator) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in competing_events) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- epidemiosurvivalOptions$new(
        time_var = time_var,
        event_var = event_var,
        exposure_var = exposure_var,
        age_var = age_var,
        calendar_time = calendar_time,
        population_weights = population_weights,
        subcohort_indicator = subcohort_indicator,
        stratification_vars = stratification_vars,
        competing_events = competing_events,
        analysis_type = analysis_type,
        cohort_design = cohort_design,
        sampling_method = sampling_method,
        survival_method = survival_method,
        regression_method = regression_method,
        age_standardization = age_standardization,
        reference_population = reference_population,
        age_groups = age_groups,
        calendar_periods = calendar_periods,
        subcohort_size = subcohort_size,
        case_cohort_method = case_cohort_method,
        par_method = par_method,
        confidence_level = confidence_level,
        cohort_life_tables = cohort_life_tables,
        competing_risks_analysis = competing_risks_analysis,
        age_period_cohort_effects = age_period_cohort_effects,
        population_impact_measures = population_impact_measures,
        survival_disparities = survival_disparities,
        trend_analysis = trend_analysis,
        excess_mortality = excess_mortality,
        standardized_mortality_ratio = standardized_mortality_ratio,
        survival_curves = survival_curves,
        cumulative_incidence_plots = cumulative_incidence_plots,
        age_specific_rates = age_specific_rates,
        trend_plots = trend_plots,
        forest_plots = forest_plots)

    analysis <- epidemiosurvivalClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

