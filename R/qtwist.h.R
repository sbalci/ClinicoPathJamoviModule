
# This file is automatically generated, you probably don't want to edit this

qtwistOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "qtwistOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_os = NULL,
            event_os = NULL,
            event_os_level = NULL,
            time_pfs = NULL,
            event_pfs = NULL,
            event_pfs_level = NULL,
            treatment = NULL,
            toxicity_method = "fixed_window",
            toxicity_window = 3,
            toxicity_probability = 0.5,
            toxicity_duration_var = NULL,
            toxicity_indicator_var = NULL,
            toxicity_indicator_level = NULL,
            toxicity_start_var = NULL,
            toxicity_end_var = NULL,
            tau = 24,
            tau_selection = "user_specified",
            utility_tox = 0.5,
            utility_twist = 1,
            utility_rel = 0.5,
            sensitivity_analysis = TRUE,
            utility_range_tox = "0, 0.25, 0.5, 0.75, 1.0",
            utility_range_rel = "0, 0.25, 0.5, 0.75, 1.0",
            threshold_analysis = FALSE,
            confidence_level = 0.95,
            bootstrap_ci = TRUE,
            bootstrap_samples = 1000,
            bootstrap_seed = 2025,
            stratify_by = NULL,
            pooled_analysis = TRUE,
            show_state_partition = TRUE,
            show_qtwist_scores = TRUE,
            show_treatment_difference = TRUE,
            show_sensitivity_table = TRUE,
            show_rmst_components = FALSE,
            show_descriptive_stats = TRUE,
            plot_partitioned_survival = TRUE,
            plot_qtwist_comparison = TRUE,
            plot_sensitivity = TRUE,
            plot_km_curves = FALSE,
            plot_color_scheme = "clinical",
            showExplanations = TRUE,
            showClinicalGuidance = TRUE,
            showFormulas = FALSE,
            showReferences = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="qtwist",
                requiresData=TRUE,
                ...)

            private$..time_os <- jmvcore::OptionVariable$new(
                "time_os",
                time_os,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_os <- jmvcore::OptionVariable$new(
                "event_os",
                event_os,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..event_os_level <- jmvcore::OptionLevel$new(
                "event_os_level",
                event_os_level,
                variable="(event_os)")
            private$..time_pfs <- jmvcore::OptionVariable$new(
                "time_pfs",
                time_pfs,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_pfs <- jmvcore::OptionVariable$new(
                "event_pfs",
                event_pfs,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..event_pfs_level <- jmvcore::OptionLevel$new(
                "event_pfs_level",
                event_pfs_level,
                variable="(event_pfs)")
            private$..treatment <- jmvcore::OptionVariable$new(
                "treatment",
                treatment,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..toxicity_method <- jmvcore::OptionList$new(
                "toxicity_method",
                toxicity_method,
                options=list(
                    "fixed_window",
                    "individual_duration",
                    "time_period"),
                default="fixed_window")
            private$..toxicity_window <- jmvcore::OptionNumber$new(
                "toxicity_window",
                toxicity_window,
                default=3,
                min=0.5,
                max=24)
            private$..toxicity_probability <- jmvcore::OptionNumber$new(
                "toxicity_probability",
                toxicity_probability,
                default=0.5,
                min=0,
                max=1)
            private$..toxicity_duration_var <- jmvcore::OptionVariable$new(
                "toxicity_duration_var",
                toxicity_duration_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..toxicity_indicator_var <- jmvcore::OptionVariable$new(
                "toxicity_indicator_var",
                toxicity_indicator_var,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..toxicity_indicator_level <- jmvcore::OptionLevel$new(
                "toxicity_indicator_level",
                toxicity_indicator_level,
                variable="(toxicity_indicator_var)")
            private$..toxicity_start_var <- jmvcore::OptionVariable$new(
                "toxicity_start_var",
                toxicity_start_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..toxicity_end_var <- jmvcore::OptionVariable$new(
                "toxicity_end_var",
                toxicity_end_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..tau <- jmvcore::OptionNumber$new(
                "tau",
                tau,
                default=24,
                min=6,
                max=120)
            private$..tau_selection <- jmvcore::OptionList$new(
                "tau_selection",
                tau_selection,
                options=list(
                    "user_specified",
                    "auto_percentile",
                    "max_followup"),
                default="user_specified")
            private$..utility_tox <- jmvcore::OptionNumber$new(
                "utility_tox",
                utility_tox,
                default=0.5,
                min=0,
                max=1)
            private$..utility_twist <- jmvcore::OptionNumber$new(
                "utility_twist",
                utility_twist,
                default=1,
                min=0,
                max=1)
            private$..utility_rel <- jmvcore::OptionNumber$new(
                "utility_rel",
                utility_rel,
                default=0.5,
                min=0,
                max=1)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=TRUE)
            private$..utility_range_tox <- jmvcore::OptionString$new(
                "utility_range_tox",
                utility_range_tox,
                default="0, 0.25, 0.5, 0.75, 1.0")
            private$..utility_range_rel <- jmvcore::OptionString$new(
                "utility_range_rel",
                utility_range_rel,
                default="0, 0.25, 0.5, 0.75, 1.0")
            private$..threshold_analysis <- jmvcore::OptionBool$new(
                "threshold_analysis",
                threshold_analysis,
                default=FALSE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..bootstrap_ci <- jmvcore::OptionBool$new(
                "bootstrap_ci",
                bootstrap_ci,
                default=TRUE)
            private$..bootstrap_samples <- jmvcore::OptionNumber$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=1000,
                min=100,
                max=10000)
            private$..bootstrap_seed <- jmvcore::OptionNumber$new(
                "bootstrap_seed",
                bootstrap_seed,
                default=2025)
            private$..stratify_by <- jmvcore::OptionVariables$new(
                "stratify_by",
                stratify_by,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..pooled_analysis <- jmvcore::OptionBool$new(
                "pooled_analysis",
                pooled_analysis,
                default=TRUE)
            private$..show_state_partition <- jmvcore::OptionBool$new(
                "show_state_partition",
                show_state_partition,
                default=TRUE)
            private$..show_qtwist_scores <- jmvcore::OptionBool$new(
                "show_qtwist_scores",
                show_qtwist_scores,
                default=TRUE)
            private$..show_treatment_difference <- jmvcore::OptionBool$new(
                "show_treatment_difference",
                show_treatment_difference,
                default=TRUE)
            private$..show_sensitivity_table <- jmvcore::OptionBool$new(
                "show_sensitivity_table",
                show_sensitivity_table,
                default=TRUE)
            private$..show_rmst_components <- jmvcore::OptionBool$new(
                "show_rmst_components",
                show_rmst_components,
                default=FALSE)
            private$..show_descriptive_stats <- jmvcore::OptionBool$new(
                "show_descriptive_stats",
                show_descriptive_stats,
                default=TRUE)
            private$..plot_partitioned_survival <- jmvcore::OptionBool$new(
                "plot_partitioned_survival",
                plot_partitioned_survival,
                default=TRUE)
            private$..plot_qtwist_comparison <- jmvcore::OptionBool$new(
                "plot_qtwist_comparison",
                plot_qtwist_comparison,
                default=TRUE)
            private$..plot_sensitivity <- jmvcore::OptionBool$new(
                "plot_sensitivity",
                plot_sensitivity,
                default=TRUE)
            private$..plot_km_curves <- jmvcore::OptionBool$new(
                "plot_km_curves",
                plot_km_curves,
                default=FALSE)
            private$..plot_color_scheme <- jmvcore::OptionList$new(
                "plot_color_scheme",
                plot_color_scheme,
                options=list(
                    "clinical",
                    "colorblind",
                    "grayscale",
                    "viridis"),
                default="clinical")
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=TRUE)
            private$..showClinicalGuidance <- jmvcore::OptionBool$new(
                "showClinicalGuidance",
                showClinicalGuidance,
                default=TRUE)
            private$..showFormulas <- jmvcore::OptionBool$new(
                "showFormulas",
                showFormulas,
                default=FALSE)
            private$..showReferences <- jmvcore::OptionBool$new(
                "showReferences",
                showReferences,
                default=TRUE)

            self$.addOption(private$..time_os)
            self$.addOption(private$..event_os)
            self$.addOption(private$..event_os_level)
            self$.addOption(private$..time_pfs)
            self$.addOption(private$..event_pfs)
            self$.addOption(private$..event_pfs_level)
            self$.addOption(private$..treatment)
            self$.addOption(private$..toxicity_method)
            self$.addOption(private$..toxicity_window)
            self$.addOption(private$..toxicity_probability)
            self$.addOption(private$..toxicity_duration_var)
            self$.addOption(private$..toxicity_indicator_var)
            self$.addOption(private$..toxicity_indicator_level)
            self$.addOption(private$..toxicity_start_var)
            self$.addOption(private$..toxicity_end_var)
            self$.addOption(private$..tau)
            self$.addOption(private$..tau_selection)
            self$.addOption(private$..utility_tox)
            self$.addOption(private$..utility_twist)
            self$.addOption(private$..utility_rel)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..utility_range_tox)
            self$.addOption(private$..utility_range_rel)
            self$.addOption(private$..threshold_analysis)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..bootstrap_ci)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..bootstrap_seed)
            self$.addOption(private$..stratify_by)
            self$.addOption(private$..pooled_analysis)
            self$.addOption(private$..show_state_partition)
            self$.addOption(private$..show_qtwist_scores)
            self$.addOption(private$..show_treatment_difference)
            self$.addOption(private$..show_sensitivity_table)
            self$.addOption(private$..show_rmst_components)
            self$.addOption(private$..show_descriptive_stats)
            self$.addOption(private$..plot_partitioned_survival)
            self$.addOption(private$..plot_qtwist_comparison)
            self$.addOption(private$..plot_sensitivity)
            self$.addOption(private$..plot_km_curves)
            self$.addOption(private$..plot_color_scheme)
            self$.addOption(private$..showExplanations)
            self$.addOption(private$..showClinicalGuidance)
            self$.addOption(private$..showFormulas)
            self$.addOption(private$..showReferences)
        }),
    active = list(
        time_os = function() private$..time_os$value,
        event_os = function() private$..event_os$value,
        event_os_level = function() private$..event_os_level$value,
        time_pfs = function() private$..time_pfs$value,
        event_pfs = function() private$..event_pfs$value,
        event_pfs_level = function() private$..event_pfs_level$value,
        treatment = function() private$..treatment$value,
        toxicity_method = function() private$..toxicity_method$value,
        toxicity_window = function() private$..toxicity_window$value,
        toxicity_probability = function() private$..toxicity_probability$value,
        toxicity_duration_var = function() private$..toxicity_duration_var$value,
        toxicity_indicator_var = function() private$..toxicity_indicator_var$value,
        toxicity_indicator_level = function() private$..toxicity_indicator_level$value,
        toxicity_start_var = function() private$..toxicity_start_var$value,
        toxicity_end_var = function() private$..toxicity_end_var$value,
        tau = function() private$..tau$value,
        tau_selection = function() private$..tau_selection$value,
        utility_tox = function() private$..utility_tox$value,
        utility_twist = function() private$..utility_twist$value,
        utility_rel = function() private$..utility_rel$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        utility_range_tox = function() private$..utility_range_tox$value,
        utility_range_rel = function() private$..utility_range_rel$value,
        threshold_analysis = function() private$..threshold_analysis$value,
        confidence_level = function() private$..confidence_level$value,
        bootstrap_ci = function() private$..bootstrap_ci$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        bootstrap_seed = function() private$..bootstrap_seed$value,
        stratify_by = function() private$..stratify_by$value,
        pooled_analysis = function() private$..pooled_analysis$value,
        show_state_partition = function() private$..show_state_partition$value,
        show_qtwist_scores = function() private$..show_qtwist_scores$value,
        show_treatment_difference = function() private$..show_treatment_difference$value,
        show_sensitivity_table = function() private$..show_sensitivity_table$value,
        show_rmst_components = function() private$..show_rmst_components$value,
        show_descriptive_stats = function() private$..show_descriptive_stats$value,
        plot_partitioned_survival = function() private$..plot_partitioned_survival$value,
        plot_qtwist_comparison = function() private$..plot_qtwist_comparison$value,
        plot_sensitivity = function() private$..plot_sensitivity$value,
        plot_km_curves = function() private$..plot_km_curves$value,
        plot_color_scheme = function() private$..plot_color_scheme$value,
        showExplanations = function() private$..showExplanations$value,
        showClinicalGuidance = function() private$..showClinicalGuidance$value,
        showFormulas = function() private$..showFormulas$value,
        showReferences = function() private$..showReferences$value),
    private = list(
        ..time_os = NA,
        ..event_os = NA,
        ..event_os_level = NA,
        ..time_pfs = NA,
        ..event_pfs = NA,
        ..event_pfs_level = NA,
        ..treatment = NA,
        ..toxicity_method = NA,
        ..toxicity_window = NA,
        ..toxicity_probability = NA,
        ..toxicity_duration_var = NA,
        ..toxicity_indicator_var = NA,
        ..toxicity_indicator_level = NA,
        ..toxicity_start_var = NA,
        ..toxicity_end_var = NA,
        ..tau = NA,
        ..tau_selection = NA,
        ..utility_tox = NA,
        ..utility_twist = NA,
        ..utility_rel = NA,
        ..sensitivity_analysis = NA,
        ..utility_range_tox = NA,
        ..utility_range_rel = NA,
        ..threshold_analysis = NA,
        ..confidence_level = NA,
        ..bootstrap_ci = NA,
        ..bootstrap_samples = NA,
        ..bootstrap_seed = NA,
        ..stratify_by = NA,
        ..pooled_analysis = NA,
        ..show_state_partition = NA,
        ..show_qtwist_scores = NA,
        ..show_treatment_difference = NA,
        ..show_sensitivity_table = NA,
        ..show_rmst_components = NA,
        ..show_descriptive_stats = NA,
        ..plot_partitioned_survival = NA,
        ..plot_qtwist_comparison = NA,
        ..plot_sensitivity = NA,
        ..plot_km_curves = NA,
        ..plot_color_scheme = NA,
        ..showExplanations = NA,
        ..showClinicalGuidance = NA,
        ..showFormulas = NA,
        ..showReferences = NA)
)

qtwistResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "qtwistResults",
    inherit = jmvcore::Group,
    active = list(
        welcomeMessage = function() private$.items[["welcomeMessage"]],
        methodologyExplanation = function() private$.items[["methodologyExplanation"]],
        descriptiveStats = function() private$.items[["descriptiveStats"]],
        rmstComponents = function() private$.items[["rmstComponents"]],
        statePartition = function() private$.items[["statePartition"]],
        qtwistScores = function() private$.items[["qtwistScores"]],
        treatmentDifference = function() private$.items[["treatmentDifference"]],
        stateDifferences = function() private$.items[["stateDifferences"]],
        sensitivityTable = function() private$.items[["sensitivityTable"]],
        thresholdAnalysis = function() private$.items[["thresholdAnalysis"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        statisticalFormulas = function() private$.items[["statisticalFormulas"]],
        keyReferences = function() private$.items[["keyReferences"]],
        partitionedSurvivalPlot = function() private$.items[["partitionedSurvivalPlot"]],
        qtwistComparisonPlot = function() private$.items[["qtwistComparisonPlot"]],
        sensitivityPlot = function() private$.items[["sensitivityPlot"]],
        kmCurvesPlot = function() private$.items[["kmCurvesPlot"]],
        forestPlot = function() private$.items[["forestPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Q-TWiST Analysis",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "gelber1986",
                    "glasziou1990",
                    "cole2004",
                    "revicki2006",
                    "survival",
                    "survRM2",
                    "ggplot2"))
            self$add(jmvcore::Html$new(
                options=options,
                name="welcomeMessage",
                title="Q-TWiST Analysis Overview",
                clearWith=list(
                    "time_os",
                    "event_os",
                    "time_pfs",
                    "event_pfs",
                    "treatment")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodologyExplanation",
                title="Understanding Q-TWiST Methodology",
                visible="(showExplanations)",
                clearWith=list(
                    "showExplanations")))
            self$add(jmvcore::Table$new(
                options=options,
                name="descriptiveStats",
                title="Descriptive Statistics by Treatment",
                visible="(show_descriptive_stats)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment"),
                columns=list(
                    list(
                        `name`="Treatment", 
                        `title`="Treatment", 
                        `type`="text"),
                    list(
                        `name`="N", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="Median_OS", 
                        `title`="Median OS", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="OS_Events", 
                        `title`="OS Events", 
                        `type`="integer"),
                    list(
                        `name`="OS_EventRate", 
                        `title`="OS Event %", 
                        `type`="number", 
                        `format`="zto,pc"),
                    list(
                        `name`="Median_PFS", 
                        `title`="Median PFS", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="PFS_Events", 
                        `title`="PFS Events", 
                        `type`="integer"),
                    list(
                        `name`="PFS_EventRate", 
                        `title`="PFS Event %", 
                        `type`="number", 
                        `format`="zto,pc"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="rmstComponents",
                title="Restricted Mean Survival Time Components",
                visible="(show_rmst_components)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "tau"),
                columns=list(
                    list(
                        `name`="Treatment", 
                        `title`="Treatment", 
                        `type`="text"),
                    list(
                        `name`="RMST_OS", 
                        `title`="RMST(OS)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="RMST_OS_SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="RMST_PFS", 
                        `title`="RMST(PFS)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="RMST_PFS_SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Tau", 
                        `title`="\u03C4 (months)", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="statePartition",
                title="Health State Partition (months)",
                visible="(show_state_partition)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "toxicity_method",
                    "toxicity_window",
                    "toxicity_duration_var",
                    "tau"),
                columns=list(
                    list(
                        `name`="Treatment", 
                        `title`="Treatment", 
                        `type`="text"),
                    list(
                        `name`="N", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="E_TOX", 
                        `title`="E[TOX]", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Mean Time (months)"),
                    list(
                        `name`="E_TWIST", 
                        `title`="E[TWiST]", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Mean Time (months)"),
                    list(
                        `name`="E_REL", 
                        `title`="E[REL]", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Mean Time (months)"),
                    list(
                        `name`="Total_RMST", 
                        `title`="Total", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Mean Time (months)"),
                    list(
                        `name`="TOX_Percent", 
                        `title`="TOX %", 
                        `type`="number", 
                        `format`="zto,pc", 
                        `superTitle`="Proportion of Survival"),
                    list(
                        `name`="TWIST_Percent", 
                        `title`="TWiST %", 
                        `type`="number", 
                        `format`="zto,pc", 
                        `superTitle`="Proportion of Survival"),
                    list(
                        `name`="REL_Percent", 
                        `title`="REL %", 
                        `type`="number", 
                        `format`="zto,pc", 
                        `superTitle`="Proportion of Survival"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="qtwistScores",
                title="Quality-Adjusted Survival (Q-TWiST) Scores",
                visible="(show_qtwist_scores)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "utility_tox",
                    "utility_twist",
                    "utility_rel",
                    "tau"),
                columns=list(
                    list(
                        `name`="Treatment", 
                        `title`="Treatment", 
                        `type`="text"),
                    list(
                        `name`="QTWIST", 
                        `title`="Q-TWiST", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Quality-Adjusted Months"),
                    list(
                        `name`="QTWIST_SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Quality-Adjusted Months"),
                    list(
                        `name`="QTWIST_CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Quality-Adjusted Months"),
                    list(
                        `name`="QTWIST_CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Quality-Adjusted Months"),
                    list(
                        `name`="Utility_TOX", 
                        `title`="\u03BC_TOX", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Utilities Used"),
                    list(
                        `name`="Utility_TWIST", 
                        `title`="\u03BC_TWiST", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Utilities Used"),
                    list(
                        `name`="Utility_REL", 
                        `title`="\u03BC_REL", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Utilities Used"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="treatmentDifference",
                title="Q-TWiST Treatment Difference",
                visible="(show_treatment_difference)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "utility_tox",
                    "utility_twist",
                    "utility_rel",
                    "bootstrap_ci"),
                columns=list(
                    list(
                        `name`="Comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="Delta_QTWIST", 
                        `title`="\u0394 Q-TWiST", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Difference (months)"),
                    list(
                        `name`="SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Difference (months)"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Difference (months)"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Difference (months)"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Favors", 
                        `title`="Favors", 
                        `type`="text"),
                    list(
                        `name`="ClinicalSignificance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stateDifferences",
                title="Treatment Differences by Health State",
                visible="(show_treatment_difference)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment"),
                columns=list(
                    list(
                        `name`="HealthState", 
                        `title`="Health State", 
                        `type`="text"),
                    list(
                        `name`="Difference", 
                        `title`="Difference (months)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityTable",
                title="Sensitivity Analysis - Varying Utility Weights",
                visible="(show_sensitivity_table && sensitivity_analysis)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "utility_range_tox",
                    "utility_range_rel",
                    "sensitivity_analysis"),
                columns=list(
                    list(
                        `name`="Utility_TOX", 
                        `title`="\u03BC_TOX", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Utility_REL", 
                        `title`="\u03BC_REL", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="QTWIST_Arm1", 
                        `title`="Arm 1", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Q-TWiST (months)"),
                    list(
                        `name`="QTWIST_Arm2", 
                        `title`="Arm 2", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Q-TWiST (months)"),
                    list(
                        `name`="Delta_QTWIST", 
                        `title`="Difference", 
                        `type`="number", 
                        `format`="zto", 
                        `superTitle`="Q-TWiST (months)"),
                    list(
                        `name`="Favors", 
                        `title`="Favors", 
                        `type`="text"),
                    list(
                        `name`="ClinicallySignificant", 
                        `title`="Clinically Significant", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="thresholdAnalysis",
                title="Threshold Utility Analysis",
                visible="(threshold_analysis && sensitivity_analysis)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "sensitivity_analysis",
                    "threshold_analysis"),
                columns=list(
                    list(
                        `name`="Parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="ThresholdValue", 
                        `title`="Threshold Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation of Q-TWiST Results",
                visible="(showClinicalGuidance)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "showClinicalGuidance")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statisticalFormulas",
                title="Q-TWiST Statistical Formulas",
                visible="(showFormulas)",
                clearWith=list(
                    "showFormulas")))
            self$add(jmvcore::Html$new(
                options=options,
                name="keyReferences",
                title="Key References for Q-TWiST Analysis",
                visible="(showReferences)",
                clearWith=list(
                    "showReferences")))
            self$add(jmvcore::Image$new(
                options=options,
                name="partitionedSurvivalPlot",
                title="Partitioned Survival by Health State",
                width=900,
                height=600,
                renderFun=".plotPartitionedSurvival",
                visible="(plot_partitioned_survival)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "toxicity_method",
                    "tau",
                    "plot_partitioned_survival",
                    "plot_color_scheme")))
            self$add(jmvcore::Image$new(
                options=options,
                name="qtwistComparisonPlot",
                title="Q-TWiST Component Comparison by Treatment",
                width=800,
                height=600,
                renderFun=".plotQTWISTComparison",
                visible="(plot_qtwist_comparison)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "utility_tox",
                    "utility_twist",
                    "utility_rel",
                    "plot_qtwist_comparison",
                    "plot_color_scheme")))
            self$add(jmvcore::Image$new(
                options=options,
                name="sensitivityPlot",
                title="Sensitivity Analysis - Q-TWiST Difference Across Utilities",
                width=800,
                height=700,
                renderFun=".plotSensitivity",
                visible="(plot_sensitivity && sensitivity_analysis)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "utility_range_tox",
                    "utility_range_rel",
                    "sensitivity_analysis",
                    "plot_sensitivity")))
            self$add(jmvcore::Image$new(
                options=options,
                name="kmCurvesPlot",
                title="Kaplan-Meier Survival Curves (OS and PFS)",
                width=900,
                height=500,
                renderFun=".plotKMCurves",
                visible="(plot_km_curves)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "plot_km_curves")))
            self$add(jmvcore::Image$new(
                options=options,
                name="forestPlot",
                title="Q-TWiST Differences Across Strata",
                width=800,
                height=600,
                renderFun=".plotForest",
                visible="(!is.null(stratify_by) && length(stratify_by) > 0)",
                clearWith=list(
                    "time_os",
                    "time_pfs",
                    "treatment",
                    "stratify_by")))}))

qtwistBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "qtwistBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "qtwist",
                version = c(0,0,1),
                options = options,
                results = qtwistResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Q-TWiST Analysis
#'
#' Perform Quality-adjusted Time Without Symptoms or Toxicity (Q-TWiST) 
#' analysis 
#' to compare treatments using both quantity and quality of life.
#' Particularly valuable in oncology trials where treatments may extend 
#' survival but
#' with significant toxicity or disease symptoms.
#' 
#' **What Q-TWiST Does:**
#' Partitions overall survival into three health states with different 
#' quality-of-life weights:
#' - TOX: Time with treatment toxicity (typically μ = 0-0.5)
#' - TWiST: Time without symptoms or toxicity (μ = 1.0, perfect health)
#' - REL: Time after disease relapse/progression (typically μ = 0-0.5)
#' 
#' **Key Features:**
#' - State-based survival partitioning with clinical significance
#' - Utility weight application for quality adjustment
#' - Sensitivity analysis across utility values
#' - Bootstrap confidence intervals for treatment differences
#' - Visual comparison with partitioned survival plots
#' 
#' **Clinical Applications:**
#' - Adjuvant therapy evaluation (balancing toxicity vs. benefit)
#' - Treatment comparison when survival similar but quality differs
#' - Shared decision-making (patient-relevant quality metrics)
#' - Regulatory submissions (FDA/EMA recognized endpoint)
#' 
#'
#' @examples
#' # Load example data
#' data("qtwist_breast_cancer")
#'
#' # Example 1: Basic Q-TWiST Analysis
#' qtwist(
#'     data = qtwist_breast_cancer,
#'     time_os = "overall_survival_months",
#'     event_os = "death_event",
#'     event_os_level = 1,
#'     time_pfs = "progression_free_months",
#'     event_pfs = "progression_event",
#'     event_pfs_level = 1,
#'     treatment = "treatment",
#'     toxicity_method = "fixed_window",
#'     toxicity_window = 3,
#'     tau = 24,
#'     utility_tox = 0.5,
#'     utility_twist = 1.0,
#'     utility_rel = 0.5
#' )
#'
#' # Example 2: With Individual Toxicity Durations
#' qtwist(
#'     data = qtwist_breast_cancer,
#'     time_os = "overall_survival_months",
#'     event_os = "death_event",
#'     time_pfs = "progression_free_months",
#'     event_pfs = "progression_event",
#'     treatment = "treatment",
#'     toxicity_method = "individual_duration",
#'     toxicity_duration_var = "toxicity_duration_months",
#'     tau = 24,
#'     sensitivity_analysis = TRUE,
#'     plot_partitioned_survival = TRUE,
#'     plot_sensitivity = TRUE
#' )
#'
#' @param data Dataset containing overall survival, progression-free survival,
#'   and toxicity information.
#' @param time_os Time to death or censoring in consistent units (months
#'   recommended). This represents the total follow-up time from
#'   randomization/enrollment.
#' @param event_os Event indicator for overall survival. Can be numeric
#'   (1=death, 0=censored) or factor (specify death level below).
#' @param event_os_level The level indicating death when using factor
#'   variables (e.g., "Dead", "Deceased"). If numeric, use level "1" for death.
#' @param time_pfs Time to disease progression, relapse, or death (whichever
#'   comes first). Must be in the same units as overall survival time. PFS time
#'   should be ≤ OS time for each patient.
#' @param event_pfs Event indicator for progression-free survival. 1 =
#'   progression or death, 0 = censored (or specify factor level).
#' @param event_pfs_level The level indicating progression or death when using
#'   factor variables.
#' @param treatment Treatment or group variable for comparison. Q-TWiST
#'   analysis requires exactly 2 treatment groups for comparison. The analysis
#'   will use all available levels (must be exactly 2 groups).
#' @param toxicity_method Method for defining the toxicity (TOX) period in
#'   Q-TWiST analysis. Fixed window uses same period for all patients;
#'   individual duration allows patient-specific toxicity times.
#' @param toxicity_window Duration of toxicity assessment window in months
#'   (default: 3 months). Commonly used values: 3 months (1 treatment cycle), 6
#'   months (adjuvant therapy). This defines the TOX period for all patients
#'   when using fixed window method.
#' @param toxicity_probability Proportion of patients experiencing grade 3-4
#'   toxicity during the window. Used when toxicity indicator variable not
#'   provided. Can be estimated from pilot data or literature.
#' @param toxicity_duration_var Variable containing individual patient
#'   toxicity durations (in months). For patients without toxicity, use 0. For
#'   those with toxicity, specify duration of grade 3-4 adverse events.
#' @param toxicity_indicator_var Optional binary indicator of whether patient
#'   experienced grade 3-4 toxicity. If provided, used to weight toxicity time
#'   calculations.
#' @param toxicity_indicator_level Level indicating presence of grade 3-4
#'   toxicity (e.g., "Yes", "Grade 3-4", 1).
#' @param toxicity_start_var Time when toxicity begins (months from baseline).
#'   Use 0 for toxicity starting at treatment initiation.
#' @param toxicity_end_var Time when toxicity resolves (months from baseline).
#'   TOX duration = toxicity_end - toxicity_start.
#' @param tau Restricted time horizon for Q-TWiST analysis in months. All
#'   survival estimates are restricted to this maximum follow-up time. Common
#'   values: 24 months (2 years), 36 months (3 years), 60 months (5 years).
#'   Choose based on median survival and clinical relevance.
#' @param tau_selection Method for selecting time horizon (tau).
#'   User-specified allows manual entry; automatic methods select based on data
#'   characteristics.
#' @param utility_tox Quality-of-life utility weight for time with treatment
#'   toxicity. 0 = worst possible health, 1 = perfect health. Typical range:
#'   0.3-0.7 depending on toxicity severity. Literature values: chemotherapy
#'   toxicity ≈ 0.5, severe toxicity ≈ 0.3.
#' @param utility_twist Quality-of-life utility weight for time without
#'   symptoms or toxicity. Typically set to 1.0 (perfect health) as the
#'   reference state. Should generally be ≥ utility_tox and ≥ utility_rel.
#' @param utility_rel Quality-of-life utility weight for time after disease
#'   relapse/progression. Accounts for symptomatic disease burden. Typical
#'   range: 0.3-0.6 depending on disease severity and symptoms. Literature
#'   values: metastatic disease ≈ 0.5, symptomatic relapse ≈ 0.4.
#' @param sensitivity_analysis Examine how Q-TWiST results vary across
#'   different utility weight assumptions. Essential for robust conclusions, as
#'   utility weights are subjective. Shows when treatment preference changes
#'   based on quality-of-life values.
#' @param utility_range_tox Comma-separated list of utility values for TOX
#'   state sensitivity analysis. Example: "0, 0.3, 0.5, 0.7, 1.0"
#' @param utility_range_rel Comma-separated list of utility values for REL
#'   state sensitivity analysis.
#' @param threshold_analysis Find threshold utility values where treatment
#'   preference changes. Identifies "break-even" points for clinical
#'   decision-making.
#' @param confidence_level Confidence level for interval estimation (default:
#'   0.95 for 95\% CI).
#' @param bootstrap_ci Use bootstrap resampling to calculate confidence
#'   intervals for Q-TWiST treatment differences. Recommended for robust
#'   inference.
#' @param bootstrap_samples Number of bootstrap resamples for confidence
#'   interval calculation. More samples = more precise estimates but longer
#'   computation time. 1000 samples is usually sufficient; use 2000+ for
#'   publication.
#' @param bootstrap_seed Random seed for bootstrap sampling (for
#'   reproducibility).
#' @param stratify_by Variables for stratified analysis (e.g., site, stage,
#'   biomarker status). Separate Q-TWiST analyses will be performed for each
#'   stratum.
#' @param pooled_analysis Display overall Q-TWiST results in addition to
#'   stratified results.
#' @param show_state_partition Display table showing mean time spent in each
#'   health state (TOX, TWiST, REL) for each treatment arm.
#' @param show_qtwist_scores Display quality-adjusted survival (Q-TWiST)
#'   scores for each treatment with applied utility weights.
#' @param show_treatment_difference Display Q-TWiST difference between
#'   treatment arms with confidence intervals and statistical significance.
#' @param show_sensitivity_table Display results across varying utility weight
#'   combinations.
#' @param show_rmst_components Show underlying restricted mean survival time
#'   calculations for overall survival and progression-free survival.
#' @param show_descriptive_stats Display sample sizes, median survival times,
#'   and event rates for each treatment arm.
#' @param plot_partitioned_survival Display stacked area plot showing TOX,
#'   TWiST, and REL components over time for each treatment arm.
#' @param plot_qtwist_comparison Bar chart comparing Q-TWiST components (TOX,
#'   TWiST, REL) between treatment arms with utility weights applied.
#' @param plot_sensitivity Contour plot or heatmap showing Q-TWiST treatment
#'   difference across varying utility weight combinations.
#' @param plot_km_curves Display standard Kaplan-Meier survival curves for OS
#'   and PFS for reference alongside Q-TWiST results.
#' @param plot_color_scheme Color scheme for partitioned survival plots. TOX
#'   (toxicity), TWiST (good quality), REL (relapse) states.
#' @param showExplanations Include detailed explanations of Q-TWiST
#'   methodology, interpretation guidance, and clinical significance.
#' @param showClinicalGuidance Provide clinical interpretation assistance
#'   including treatment implications and decision-making considerations.
#' @param showFormulas Display mathematical formulas for Q-TWiST calculations
#'   and statistical tests.
#' @param showReferences Display key references for Q-TWiST methodology and
#'   applications.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$welcomeMessage} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodologyExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$descriptiveStats} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$rmstComponents} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$statePartition} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$qtwistScores} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$treatmentDifference} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$stateDifferences} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivityTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$thresholdAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$statisticalFormulas} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$keyReferences} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$partitionedSurvivalPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$qtwistComparisonPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sensitivityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$kmCurvesPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$forestPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$descriptiveStats$asDF}
#'
#' \code{as.data.frame(results$descriptiveStats)}
#'
#' @export
qtwist <- function(
    data,
    time_os,
    event_os,
    event_os_level,
    time_pfs,
    event_pfs,
    event_pfs_level,
    treatment,
    toxicity_method = "fixed_window",
    toxicity_window = 3,
    toxicity_probability = 0.5,
    toxicity_duration_var,
    toxicity_indicator_var,
    toxicity_indicator_level,
    toxicity_start_var,
    toxicity_end_var,
    tau = 24,
    tau_selection = "user_specified",
    utility_tox = 0.5,
    utility_twist = 1,
    utility_rel = 0.5,
    sensitivity_analysis = TRUE,
    utility_range_tox = "0, 0.25, 0.5, 0.75, 1.0",
    utility_range_rel = "0, 0.25, 0.5, 0.75, 1.0",
    threshold_analysis = FALSE,
    confidence_level = 0.95,
    bootstrap_ci = TRUE,
    bootstrap_samples = 1000,
    bootstrap_seed = 2025,
    stratify_by,
    pooled_analysis = TRUE,
    show_state_partition = TRUE,
    show_qtwist_scores = TRUE,
    show_treatment_difference = TRUE,
    show_sensitivity_table = TRUE,
    show_rmst_components = FALSE,
    show_descriptive_stats = TRUE,
    plot_partitioned_survival = TRUE,
    plot_qtwist_comparison = TRUE,
    plot_sensitivity = TRUE,
    plot_km_curves = FALSE,
    plot_color_scheme = "clinical",
    showExplanations = TRUE,
    showClinicalGuidance = TRUE,
    showFormulas = FALSE,
    showReferences = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("qtwist requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_os)) time_os <- jmvcore::resolveQuo(jmvcore::enquo(time_os))
    if ( ! missing(event_os)) event_os <- jmvcore::resolveQuo(jmvcore::enquo(event_os))
    if ( ! missing(time_pfs)) time_pfs <- jmvcore::resolveQuo(jmvcore::enquo(time_pfs))
    if ( ! missing(event_pfs)) event_pfs <- jmvcore::resolveQuo(jmvcore::enquo(event_pfs))
    if ( ! missing(treatment)) treatment <- jmvcore::resolveQuo(jmvcore::enquo(treatment))
    if ( ! missing(toxicity_duration_var)) toxicity_duration_var <- jmvcore::resolveQuo(jmvcore::enquo(toxicity_duration_var))
    if ( ! missing(toxicity_indicator_var)) toxicity_indicator_var <- jmvcore::resolveQuo(jmvcore::enquo(toxicity_indicator_var))
    if ( ! missing(toxicity_start_var)) toxicity_start_var <- jmvcore::resolveQuo(jmvcore::enquo(toxicity_start_var))
    if ( ! missing(toxicity_end_var)) toxicity_end_var <- jmvcore::resolveQuo(jmvcore::enquo(toxicity_end_var))
    if ( ! missing(stratify_by)) stratify_by <- jmvcore::resolveQuo(jmvcore::enquo(stratify_by))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_os), time_os, NULL),
            `if`( ! missing(event_os), event_os, NULL),
            `if`( ! missing(time_pfs), time_pfs, NULL),
            `if`( ! missing(event_pfs), event_pfs, NULL),
            `if`( ! missing(treatment), treatment, NULL),
            `if`( ! missing(toxicity_duration_var), toxicity_duration_var, NULL),
            `if`( ! missing(toxicity_indicator_var), toxicity_indicator_var, NULL),
            `if`( ! missing(toxicity_start_var), toxicity_start_var, NULL),
            `if`( ! missing(toxicity_end_var), toxicity_end_var, NULL),
            `if`( ! missing(stratify_by), stratify_by, NULL))

    for (v in treatment) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in stratify_by) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- qtwistOptions$new(
        time_os = time_os,
        event_os = event_os,
        event_os_level = event_os_level,
        time_pfs = time_pfs,
        event_pfs = event_pfs,
        event_pfs_level = event_pfs_level,
        treatment = treatment,
        toxicity_method = toxicity_method,
        toxicity_window = toxicity_window,
        toxicity_probability = toxicity_probability,
        toxicity_duration_var = toxicity_duration_var,
        toxicity_indicator_var = toxicity_indicator_var,
        toxicity_indicator_level = toxicity_indicator_level,
        toxicity_start_var = toxicity_start_var,
        toxicity_end_var = toxicity_end_var,
        tau = tau,
        tau_selection = tau_selection,
        utility_tox = utility_tox,
        utility_twist = utility_twist,
        utility_rel = utility_rel,
        sensitivity_analysis = sensitivity_analysis,
        utility_range_tox = utility_range_tox,
        utility_range_rel = utility_range_rel,
        threshold_analysis = threshold_analysis,
        confidence_level = confidence_level,
        bootstrap_ci = bootstrap_ci,
        bootstrap_samples = bootstrap_samples,
        bootstrap_seed = bootstrap_seed,
        stratify_by = stratify_by,
        pooled_analysis = pooled_analysis,
        show_state_partition = show_state_partition,
        show_qtwist_scores = show_qtwist_scores,
        show_treatment_difference = show_treatment_difference,
        show_sensitivity_table = show_sensitivity_table,
        show_rmst_components = show_rmst_components,
        show_descriptive_stats = show_descriptive_stats,
        plot_partitioned_survival = plot_partitioned_survival,
        plot_qtwist_comparison = plot_qtwist_comparison,
        plot_sensitivity = plot_sensitivity,
        plot_km_curves = plot_km_curves,
        plot_color_scheme = plot_color_scheme,
        showExplanations = showExplanations,
        showClinicalGuidance = showClinicalGuidance,
        showFormulas = showFormulas,
        showReferences = showReferences)

    analysis <- qtwistClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

