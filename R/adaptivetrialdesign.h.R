
# This file is automatically generated, you probably don't want to edit this

adaptivetrialdesignOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "adaptivetrialdesignOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            outcome = NULL,
            treatment = NULL,
            outcomeLevel = NULL,
            stratification_variables = NULL,
            time_variable = NULL,
            adaptation_type = "sample_size",
            design_framework = "bayesian",
            interim_analysis = TRUE,
            interim_timing = "information",
            interim_fractions = "0.25,0.50,0.75",
            max_interim_analyses = 3,
            efficacy_boundary = 0.95,
            futility_boundary = 0.1,
            boundary_type = "obrien_fleming",
            planned_sample_size = 100,
            minimum_effect_size = 0.5,
            target_power = 0.8,
            type1_error_rate = 0.05,
            max_sample_size_inflation = 2,
            prior_type = "weakly_informative",
            historical_data_weight = 0.1,
            prior_parameters = "",
            decision_criterion = "posterior_probability",
            bayes_factor_threshold = 3,
            predictive_power_threshold = 0.8,
            run_simulations = TRUE,
            n_simulations = 1000,
            true_effect_scenarios = "0,0.3,0.5,0.8",
            mcmc_samples = 5000,
            mcmc_burnin = 2000,
            mcmc_chains = 3,
            show_design_summary = TRUE,
            show_interim_results = TRUE,
            show_stopping_boundaries = TRUE,
            show_sample_size_evolution = TRUE,
            show_operating_characteristics = TRUE,
            show_posterior_evolution = TRUE,
            show_decision_analysis = TRUE,
            show_interpretation = TRUE,
            alpha_spending_function = "obf_type",
            spending_parameter = 1,
            blinded_sample_size_reestimation = FALSE,
            conditional_power_threshold = 0.2,
            clinical_context = "general",
            set_seed = TRUE,
            seed_value = 42,
            regulatory_framework = "general",
            dmb_recommendations = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="adaptivetrialdesign",
                requiresData=TRUE,
                ...)

            private$..outcome <- jmvcore::OptionVariable$new(
                "outcome",
                outcome,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..treatment <- jmvcore::OptionVariable$new(
                "treatment",
                treatment,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..outcomeLevel <- jmvcore::OptionLevel$new(
                "outcomeLevel",
                outcomeLevel,
                variable="(outcome)")
            private$..stratification_variables <- jmvcore::OptionVariables$new(
                "stratification_variables",
                stratification_variables,
                suggested=list(
                    "nominal",
                    "ordinal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..time_variable <- jmvcore::OptionVariable$new(
                "time_variable",
                time_variable,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"),
                default=NULL)
            private$..adaptation_type <- jmvcore::OptionList$new(
                "adaptation_type",
                adaptation_type,
                options=list(
                    "sample_size",
                    "arm_selection",
                    "dose_finding",
                    "futility",
                    "efficacy",
                    "seamless",
                    "group_sequential"),
                default="sample_size")
            private$..design_framework <- jmvcore::OptionList$new(
                "design_framework",
                design_framework,
                options=list(
                    "bayesian",
                    "frequentist",
                    "hybrid",
                    "decision_theory"),
                default="bayesian")
            private$..interim_analysis <- jmvcore::OptionBool$new(
                "interim_analysis",
                interim_analysis,
                default=TRUE)
            private$..interim_timing <- jmvcore::OptionList$new(
                "interim_timing",
                interim_timing,
                options=list(
                    "information",
                    "calendar",
                    "patient_number",
                    "event_based"),
                default="information")
            private$..interim_fractions <- jmvcore::OptionString$new(
                "interim_fractions",
                interim_fractions,
                default="0.25,0.50,0.75")
            private$..max_interim_analyses <- jmvcore::OptionInteger$new(
                "max_interim_analyses",
                max_interim_analyses,
                default=3,
                min=1,
                max=10)
            private$..efficacy_boundary <- jmvcore::OptionNumber$new(
                "efficacy_boundary",
                efficacy_boundary,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..futility_boundary <- jmvcore::OptionNumber$new(
                "futility_boundary",
                futility_boundary,
                default=0.1,
                min=0.01,
                max=0.5)
            private$..boundary_type <- jmvcore::OptionList$new(
                "boundary_type",
                boundary_type,
                options=list(
                    "obrien_fleming",
                    "pocock",
                    "lan_demets_obf",
                    "lan_demets_pocock",
                    "custom_spending"),
                default="obrien_fleming")
            private$..planned_sample_size <- jmvcore::OptionInteger$new(
                "planned_sample_size",
                planned_sample_size,
                default=100,
                min=20,
                max=10000)
            private$..minimum_effect_size <- jmvcore::OptionNumber$new(
                "minimum_effect_size",
                minimum_effect_size,
                default=0.5,
                min=0.01,
                max=10)
            private$..target_power <- jmvcore::OptionNumber$new(
                "target_power",
                target_power,
                default=0.8,
                min=0.5,
                max=0.99)
            private$..type1_error_rate <- jmvcore::OptionNumber$new(
                "type1_error_rate",
                type1_error_rate,
                default=0.05,
                min=0.01,
                max=0.2)
            private$..max_sample_size_inflation <- jmvcore::OptionNumber$new(
                "max_sample_size_inflation",
                max_sample_size_inflation,
                default=2,
                min=1,
                max=5)
            private$..prior_type <- jmvcore::OptionList$new(
                "prior_type",
                prior_type,
                options=list(
                    "noninformative",
                    "weakly_informative",
                    "informative",
                    "skeptical",
                    "optimistic"),
                default="weakly_informative")
            private$..historical_data_weight <- jmvcore::OptionNumber$new(
                "historical_data_weight",
                historical_data_weight,
                default=0.1,
                min=0,
                max=1)
            private$..prior_parameters <- jmvcore::OptionString$new(
                "prior_parameters",
                prior_parameters,
                default="")
            private$..decision_criterion <- jmvcore::OptionList$new(
                "decision_criterion",
                decision_criterion,
                options=list(
                    "posterior_probability",
                    "bayes_factor",
                    "predictive_probability",
                    "expected_utility",
                    "value_of_information"),
                default="posterior_probability")
            private$..bayes_factor_threshold <- jmvcore::OptionNumber$new(
                "bayes_factor_threshold",
                bayes_factor_threshold,
                default=3,
                min=1,
                max=100)
            private$..predictive_power_threshold <- jmvcore::OptionNumber$new(
                "predictive_power_threshold",
                predictive_power_threshold,
                default=0.8,
                min=0.5,
                max=0.99)
            private$..run_simulations <- jmvcore::OptionBool$new(
                "run_simulations",
                run_simulations,
                default=TRUE)
            private$..n_simulations <- jmvcore::OptionInteger$new(
                "n_simulations",
                n_simulations,
                default=1000,
                min=100,
                max=10000)
            private$..true_effect_scenarios <- jmvcore::OptionString$new(
                "true_effect_scenarios",
                true_effect_scenarios,
                default="0,0.3,0.5,0.8")
            private$..mcmc_samples <- jmvcore::OptionInteger$new(
                "mcmc_samples",
                mcmc_samples,
                default=5000,
                min=1000,
                max=20000)
            private$..mcmc_burnin <- jmvcore::OptionInteger$new(
                "mcmc_burnin",
                mcmc_burnin,
                default=2000,
                min=500,
                max=10000)
            private$..mcmc_chains <- jmvcore::OptionInteger$new(
                "mcmc_chains",
                mcmc_chains,
                default=3,
                min=1,
                max=6)
            private$..show_design_summary <- jmvcore::OptionBool$new(
                "show_design_summary",
                show_design_summary,
                default=TRUE)
            private$..show_interim_results <- jmvcore::OptionBool$new(
                "show_interim_results",
                show_interim_results,
                default=TRUE)
            private$..show_stopping_boundaries <- jmvcore::OptionBool$new(
                "show_stopping_boundaries",
                show_stopping_boundaries,
                default=TRUE)
            private$..show_sample_size_evolution <- jmvcore::OptionBool$new(
                "show_sample_size_evolution",
                show_sample_size_evolution,
                default=TRUE)
            private$..show_operating_characteristics <- jmvcore::OptionBool$new(
                "show_operating_characteristics",
                show_operating_characteristics,
                default=TRUE)
            private$..show_posterior_evolution <- jmvcore::OptionBool$new(
                "show_posterior_evolution",
                show_posterior_evolution,
                default=TRUE)
            private$..show_decision_analysis <- jmvcore::OptionBool$new(
                "show_decision_analysis",
                show_decision_analysis,
                default=TRUE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)
            private$..alpha_spending_function <- jmvcore::OptionList$new(
                "alpha_spending_function",
                alpha_spending_function,
                options=list(
                    "obf_type",
                    "pocock_type",
                    "power_family",
                    "custom"),
                default="obf_type")
            private$..spending_parameter <- jmvcore::OptionNumber$new(
                "spending_parameter",
                spending_parameter,
                default=1,
                min=0.1,
                max=10)
            private$..blinded_sample_size_reestimation <- jmvcore::OptionBool$new(
                "blinded_sample_size_reestimation",
                blinded_sample_size_reestimation,
                default=FALSE)
            private$..conditional_power_threshold <- jmvcore::OptionNumber$new(
                "conditional_power_threshold",
                conditional_power_threshold,
                default=0.2,
                min=0.05,
                max=0.5)
            private$..clinical_context <- jmvcore::OptionList$new(
                "clinical_context",
                clinical_context,
                options=list(
                    "phase2_efficacy",
                    "phase3_confirmatory",
                    "oncology",
                    "cardiovascular",
                    "rare_disease",
                    "pediatric",
                    "general"),
                default="general")
            private$..set_seed <- jmvcore::OptionBool$new(
                "set_seed",
                set_seed,
                default=TRUE)
            private$..seed_value <- jmvcore::OptionInteger$new(
                "seed_value",
                seed_value,
                default=42,
                min=1,
                max=999999)
            private$..regulatory_framework <- jmvcore::OptionList$new(
                "regulatory_framework",
                regulatory_framework,
                options=list(
                    "fda",
                    "ema",
                    "ich_e9",
                    "general"),
                default="general")
            private$..dmb_recommendations <- jmvcore::OptionBool$new(
                "dmb_recommendations",
                dmb_recommendations,
                default=TRUE)

            self$.addOption(private$..outcome)
            self$.addOption(private$..treatment)
            self$.addOption(private$..outcomeLevel)
            self$.addOption(private$..stratification_variables)
            self$.addOption(private$..time_variable)
            self$.addOption(private$..adaptation_type)
            self$.addOption(private$..design_framework)
            self$.addOption(private$..interim_analysis)
            self$.addOption(private$..interim_timing)
            self$.addOption(private$..interim_fractions)
            self$.addOption(private$..max_interim_analyses)
            self$.addOption(private$..efficacy_boundary)
            self$.addOption(private$..futility_boundary)
            self$.addOption(private$..boundary_type)
            self$.addOption(private$..planned_sample_size)
            self$.addOption(private$..minimum_effect_size)
            self$.addOption(private$..target_power)
            self$.addOption(private$..type1_error_rate)
            self$.addOption(private$..max_sample_size_inflation)
            self$.addOption(private$..prior_type)
            self$.addOption(private$..historical_data_weight)
            self$.addOption(private$..prior_parameters)
            self$.addOption(private$..decision_criterion)
            self$.addOption(private$..bayes_factor_threshold)
            self$.addOption(private$..predictive_power_threshold)
            self$.addOption(private$..run_simulations)
            self$.addOption(private$..n_simulations)
            self$.addOption(private$..true_effect_scenarios)
            self$.addOption(private$..mcmc_samples)
            self$.addOption(private$..mcmc_burnin)
            self$.addOption(private$..mcmc_chains)
            self$.addOption(private$..show_design_summary)
            self$.addOption(private$..show_interim_results)
            self$.addOption(private$..show_stopping_boundaries)
            self$.addOption(private$..show_sample_size_evolution)
            self$.addOption(private$..show_operating_characteristics)
            self$.addOption(private$..show_posterior_evolution)
            self$.addOption(private$..show_decision_analysis)
            self$.addOption(private$..show_interpretation)
            self$.addOption(private$..alpha_spending_function)
            self$.addOption(private$..spending_parameter)
            self$.addOption(private$..blinded_sample_size_reestimation)
            self$.addOption(private$..conditional_power_threshold)
            self$.addOption(private$..clinical_context)
            self$.addOption(private$..set_seed)
            self$.addOption(private$..seed_value)
            self$.addOption(private$..regulatory_framework)
            self$.addOption(private$..dmb_recommendations)
        }),
    active = list(
        outcome = function() private$..outcome$value,
        treatment = function() private$..treatment$value,
        outcomeLevel = function() private$..outcomeLevel$value,
        stratification_variables = function() private$..stratification_variables$value,
        time_variable = function() private$..time_variable$value,
        adaptation_type = function() private$..adaptation_type$value,
        design_framework = function() private$..design_framework$value,
        interim_analysis = function() private$..interim_analysis$value,
        interim_timing = function() private$..interim_timing$value,
        interim_fractions = function() private$..interim_fractions$value,
        max_interim_analyses = function() private$..max_interim_analyses$value,
        efficacy_boundary = function() private$..efficacy_boundary$value,
        futility_boundary = function() private$..futility_boundary$value,
        boundary_type = function() private$..boundary_type$value,
        planned_sample_size = function() private$..planned_sample_size$value,
        minimum_effect_size = function() private$..minimum_effect_size$value,
        target_power = function() private$..target_power$value,
        type1_error_rate = function() private$..type1_error_rate$value,
        max_sample_size_inflation = function() private$..max_sample_size_inflation$value,
        prior_type = function() private$..prior_type$value,
        historical_data_weight = function() private$..historical_data_weight$value,
        prior_parameters = function() private$..prior_parameters$value,
        decision_criterion = function() private$..decision_criterion$value,
        bayes_factor_threshold = function() private$..bayes_factor_threshold$value,
        predictive_power_threshold = function() private$..predictive_power_threshold$value,
        run_simulations = function() private$..run_simulations$value,
        n_simulations = function() private$..n_simulations$value,
        true_effect_scenarios = function() private$..true_effect_scenarios$value,
        mcmc_samples = function() private$..mcmc_samples$value,
        mcmc_burnin = function() private$..mcmc_burnin$value,
        mcmc_chains = function() private$..mcmc_chains$value,
        show_design_summary = function() private$..show_design_summary$value,
        show_interim_results = function() private$..show_interim_results$value,
        show_stopping_boundaries = function() private$..show_stopping_boundaries$value,
        show_sample_size_evolution = function() private$..show_sample_size_evolution$value,
        show_operating_characteristics = function() private$..show_operating_characteristics$value,
        show_posterior_evolution = function() private$..show_posterior_evolution$value,
        show_decision_analysis = function() private$..show_decision_analysis$value,
        show_interpretation = function() private$..show_interpretation$value,
        alpha_spending_function = function() private$..alpha_spending_function$value,
        spending_parameter = function() private$..spending_parameter$value,
        blinded_sample_size_reestimation = function() private$..blinded_sample_size_reestimation$value,
        conditional_power_threshold = function() private$..conditional_power_threshold$value,
        clinical_context = function() private$..clinical_context$value,
        set_seed = function() private$..set_seed$value,
        seed_value = function() private$..seed_value$value,
        regulatory_framework = function() private$..regulatory_framework$value,
        dmb_recommendations = function() private$..dmb_recommendations$value),
    private = list(
        ..outcome = NA,
        ..treatment = NA,
        ..outcomeLevel = NA,
        ..stratification_variables = NA,
        ..time_variable = NA,
        ..adaptation_type = NA,
        ..design_framework = NA,
        ..interim_analysis = NA,
        ..interim_timing = NA,
        ..interim_fractions = NA,
        ..max_interim_analyses = NA,
        ..efficacy_boundary = NA,
        ..futility_boundary = NA,
        ..boundary_type = NA,
        ..planned_sample_size = NA,
        ..minimum_effect_size = NA,
        ..target_power = NA,
        ..type1_error_rate = NA,
        ..max_sample_size_inflation = NA,
        ..prior_type = NA,
        ..historical_data_weight = NA,
        ..prior_parameters = NA,
        ..decision_criterion = NA,
        ..bayes_factor_threshold = NA,
        ..predictive_power_threshold = NA,
        ..run_simulations = NA,
        ..n_simulations = NA,
        ..true_effect_scenarios = NA,
        ..mcmc_samples = NA,
        ..mcmc_burnin = NA,
        ..mcmc_chains = NA,
        ..show_design_summary = NA,
        ..show_interim_results = NA,
        ..show_stopping_boundaries = NA,
        ..show_sample_size_evolution = NA,
        ..show_operating_characteristics = NA,
        ..show_posterior_evolution = NA,
        ..show_decision_analysis = NA,
        ..show_interpretation = NA,
        ..alpha_spending_function = NA,
        ..spending_parameter = NA,
        ..blinded_sample_size_reestimation = NA,
        ..conditional_power_threshold = NA,
        ..clinical_context = NA,
        ..set_seed = NA,
        ..seed_value = NA,
        ..regulatory_framework = NA,
        ..dmb_recommendations = NA)
)

adaptivetrialdesignResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "adaptivetrialdesignResults",
    inherit = jmvcore::Group,
    active = list(
        designSummary = function() private$.items[["designSummary"]],
        interimResults = function() private$.items[["interimResults"]],
        stoppingBoundaries = function() private$.items[["stoppingBoundaries"]],
        sampleSizeEvolution = function() private$.items[["sampleSizeEvolution"]],
        operatingCharacteristics = function() private$.items[["operatingCharacteristics"]],
        posteriorEvolution = function() private$.items[["posteriorEvolution"]],
        decisionAnalysis = function() private$.items[["decisionAnalysis"]],
        bayesFactors = function() private$.items[["bayesFactors"]],
        predictivePower = function() private$.items[["predictivePower"]],
        regulatoryConsiderations = function() private$.items[["regulatoryConsiderations"]],
        dmbRecommendations = function() private$.items[["dmbRecommendations"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        methodsExplanation = function() private$.items[["methodsExplanation"]],
        stoppingBoundaryPlot = function() private$.items[["stoppingBoundaryPlot"]],
        sampleSizeEvolutionPlot = function() private$.items[["sampleSizeEvolutionPlot"]],
        posteriorEvolutionPlot = function() private$.items[["posteriorEvolutionPlot"]],
        operatingCharacteristicsPlot = function() private$.items[["operatingCharacteristicsPlot"]],
        decisionAnalysisPlot = function() private$.items[["decisionAnalysisPlot"]],
        predictivePowerPlot = function() private$.items[["predictivePowerPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Analysis Results",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Table$new(
                options=options,
                name="designSummary",
                title="Adaptive Trial Design Summary",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Design Parameter", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="justification", 
                        `title`="Statistical Justification", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="interimResults",
                title="Interim Analysis Results",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="information_fraction", 
                        `title`="Information Fraction", 
                        `type`="number"),
                    list(
                        `name`="sample_size", 
                        `title`="Sample Size", 
                        `type`="integer"),
                    list(
                        `name`="treatment_effect", 
                        `title`="Treatment Effect", 
                        `type`="number"),
                    list(
                        `name`="posterior_prob_efficacy", 
                        `title`="P(Efficacy)", 
                        `type`="number"),
                    list(
                        `name`="posterior_prob_futility", 
                        `title`="P(Futility)", 
                        `type`="number"),
                    list(
                        `name`="decision", 
                        `title`="Decision", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stoppingBoundaries",
                title="Stopping Boundaries",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="information_fraction", 
                        `title`="Information Fraction", 
                        `type`="number"),
                    list(
                        `name`="efficacy_boundary", 
                        `title`="Efficacy Boundary", 
                        `type`="number"),
                    list(
                        `name`="futility_boundary", 
                        `title`="Futility Boundary", 
                        `type`="number"),
                    list(
                        `name`="alpha_spent", 
                        `title`="Alpha Spent", 
                        `type`="number"),
                    list(
                        `name`="cumulative_alpha", 
                        `title`="Cumulative Alpha", 
                        `type`="number"),
                    list(
                        `name`="conditional_power", 
                        `title`="Conditional Power", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sampleSizeEvolution",
                title="Sample Size Evolution",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="planned_n", 
                        `title`="Planned N", 
                        `type`="integer"),
                    list(
                        `name`="observed_n", 
                        `title`="Observed N", 
                        `type`="integer"),
                    list(
                        `name`="recommended_n", 
                        `title`="Recommended N", 
                        `type`="integer"),
                    list(
                        `name`="increase_factor", 
                        `title`="Increase Factor", 
                        `type`="number"),
                    list(
                        `name`="rationale", 
                        `title`="Rationale", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="operatingCharacteristics",
                title="Operating Characteristics (Simulation Results)",
                columns=list(
                    list(
                        `name`="true_effect", 
                        `title`="True Effect Size", 
                        `type`="number"),
                    list(
                        `name`="power", 
                        `title`="Power", 
                        `type`="number"),
                    list(
                        `name`="type1_error", 
                        `title`="Type I Error", 
                        `type`="number"),
                    list(
                        `name`="expected_n", 
                        `title`="Expected Sample Size", 
                        `type`="number"),
                    list(
                        `name`="prob_early_efficacy", 
                        `title`="P(Early Efficacy Stop)", 
                        `type`="number"),
                    list(
                        `name`="prob_early_futility", 
                        `title`="P(Early Futility Stop)", 
                        `type`="number"),
                    list(
                        `name`="expected_duration", 
                        `title`="Expected Duration", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="posteriorEvolution",
                title="Posterior Distribution Evolution",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Posterior Mean", 
                        `type`="number"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Posterior SD", 
                        `type`="number"),
                    list(
                        `name`="credible_interval_lower", 
                        `title`="CI Lower", 
                        `type`="number"),
                    list(
                        `name`="credible_interval_upper", 
                        `title`="CI Upper", 
                        `type`="number"),
                    list(
                        `name`="posterior_prob_positive", 
                        `title`="P(Effect > 0)", 
                        `type`="number"),
                    list(
                        `name`="posterior_prob_mcid", 
                        `title`="P(Effect > MCID)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="decisionAnalysis",
                title="Decision Analysis Framework",
                columns=list(
                    list(
                        `name`="decision", 
                        `title`="Decision Option", 
                        `type`="text"),
                    list(
                        `name`="expected_utility", 
                        `title`="Expected Utility", 
                        `type`="number"),
                    list(
                        `name`="expected_cost", 
                        `title`="Expected Cost", 
                        `type`="number"),
                    list(
                        `name`="expected_benefit", 
                        `title`="Expected Benefit", 
                        `type`="number"),
                    list(
                        `name`="value_of_information", 
                        `title`="Value of Information", 
                        `type`="number"),
                    list(
                        `name`="optimal", 
                        `title`="Optimal Decision", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="bayesFactors",
                title="Bayes Factors Evolution",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="bf_efficacy", 
                        `title`="BF (Efficacy)", 
                        `type`="number"),
                    list(
                        `name`="bf_futility", 
                        `title`="BF (Futility)", 
                        `type`="number"),
                    list(
                        `name`="bf_interpretation_efficacy", 
                        `title`="BF Efficacy Interpretation", 
                        `type`="text"),
                    list(
                        `name`="bf_interpretation_futility", 
                        `title`="BF Futility Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="predictivePower",
                title="Predictive Power Analysis",
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="predictive_power_current", 
                        `title`="Predictive Power (Current Design)", 
                        `type`="number"),
                    list(
                        `name`="predictive_power_reestimated", 
                        `title`="Predictive Power (Re-estimated)", 
                        `type`="number"),
                    list(
                        `name`="recommended_n_predictive", 
                        `title`="Recommended N (Predictive)", 
                        `type`="integer"),
                    list(
                        `name`="probability_success", 
                        `title`="P(Trial Success)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="regulatoryConsiderations",
                title="Regulatory Considerations",
                columns=list(
                    list(
                        `name`="aspect", 
                        `title`="Regulatory Aspect", 
                        `type`="text"),
                    list(
                        `name`="requirement", 
                        `title`="Requirement", 
                        `type`="text"),
                    list(
                        `name`="compliance_status", 
                        `title`="Compliance Status", 
                        `type`="text"),
                    list(
                        `name`="recommendations", 
                        `title`="Recommendations", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="dmbRecommendations",
                title="Data Monitoring Board Recommendation Templates",
                columns=list(
                    list(
                        `name`="scenario", 
                        `title`="Scenario", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="DMB Recommendation", 
                        `type`="text"),
                    list(
                        `name`="statistical_basis", 
                        `title`="Statistical Basis", 
                        `type`="text"),
                    list(
                        `name`="clinical_rationale", 
                        `title`="Clinical Rationale", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation and Guidance"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodsExplanation",
                title="Statistical Methods and Regulatory Framework"))
            self$add(jmvcore::Image$new(
                options=options,
                name="stoppingBoundaryPlot",
                title="Stopping Boundary Visualization",
                width=600,
                height=400,
                renderFun=".plotStoppingBoundaries"))
            self$add(jmvcore::Image$new(
                options=options,
                name="sampleSizeEvolutionPlot",
                title="Sample Size Evolution Plot",
                width=600,
                height=400,
                renderFun=".plotSampleSizeEvolution"))
            self$add(jmvcore::Image$new(
                options=options,
                name="posteriorEvolutionPlot",
                title="Posterior Evolution Visualization",
                width=600,
                height=450,
                renderFun=".plotPosteriorEvolution"))
            self$add(jmvcore::Image$new(
                options=options,
                name="operatingCharacteristicsPlot",
                title="Operating Characteristics Visualization",
                width=700,
                height=500,
                renderFun=".plotOperatingCharacteristics"))
            self$add(jmvcore::Image$new(
                options=options,
                name="decisionAnalysisPlot",
                title="Decision Analysis Visualization",
                width=600,
                height=400,
                renderFun=".plotDecisionAnalysis"))
            self$add(jmvcore::Image$new(
                options=options,
                name="predictivePowerPlot",
                title="Predictive Power Evolution",
                width=600,
                height=400,
                renderFun=".plotPredictivePower"))}))

adaptivetrialdesignBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "adaptivetrialdesignBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "adaptivetrialdesign",
                version = c(0,0,31),
                options = options,
                results = adaptivetrialdesignResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Adaptive Trial Design Methods
#'
#' Advanced adaptive trial design methods for clinical research including
#' Bayesian interim analysis, adaptive sample size re-estimation, futility
#' stopping rules, and group sequential designs. Designed for efficient
#' clinical trial conduct with ethical early stopping capabilities.
#' 
#'
#' @examples
#' # Adaptive trial design with interim analysis
#' adaptivetrialdesign(
#'     data = trial_data,
#'     outcome = "response",
#'     treatment = "arm",
#'     adaptation_type = "sample_size",
#'     interim_analysis = TRUE,
#'     futility_boundary = 0.1
#' )
#'
#' @param data The data as a data frame for adaptive trial design analysis.
#' @param outcome .
#' @param treatment .
#' @param outcomeLevel .
#' @param stratification_variables .
#' @param time_variable For time-to-event endpoints
#' @param adaptation_type .
#' @param design_framework .
#' @param interim_analysis .
#' @param interim_timing .
#' @param interim_fractions Comma-separated fractions of planned
#'   information/sample size
#' @param max_interim_analyses .
#' @param efficacy_boundary Posterior probability threshold for efficacy
#'   stopping
#' @param futility_boundary Posterior probability threshold for futility
#'   stopping
#' @param boundary_type .
#' @param planned_sample_size .
#' @param minimum_effect_size Standardized or raw effect size
#' @param target_power .
#' @param type1_error_rate .
#' @param max_sample_size_inflation Maximum fold increase from planned sample
#'   size
#' @param prior_type .
#' @param historical_data_weight Weight given to historical data in
#'   informative priors
#' @param prior_parameters Comma-separated prior parameters (mean,sd for
#'   normal)
#' @param decision_criterion .
#' @param bayes_factor_threshold .
#' @param predictive_power_threshold .
#' @param run_simulations .
#' @param n_simulations .
#' @param true_effect_scenarios Comma-separated effect sizes for simulation
#' @param mcmc_samples .
#' @param mcmc_burnin .
#' @param mcmc_chains .
#' @param show_design_summary .
#' @param show_interim_results .
#' @param show_stopping_boundaries .
#' @param show_sample_size_evolution .
#' @param show_operating_characteristics .
#' @param show_posterior_evolution .
#' @param show_decision_analysis .
#' @param show_interpretation .
#' @param alpha_spending_function .
#' @param spending_parameter .
#' @param blinded_sample_size_reestimation .
#' @param conditional_power_threshold .
#' @param clinical_context .
#' @param set_seed .
#' @param seed_value .
#' @param regulatory_framework .
#' @param dmb_recommendations Generate templates for Data Monitoring Board
#'   recommendations
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$designSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interimResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$stoppingBoundaries} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sampleSizeEvolution} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$operatingCharacteristics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$posteriorEvolution} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$decisionAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$bayesFactors} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$predictivePower} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$regulatoryConsiderations} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$dmbRecommendations} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodsExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$stoppingBoundaryPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sampleSizeEvolutionPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$posteriorEvolutionPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$operatingCharacteristicsPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$decisionAnalysisPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$predictivePowerPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$designSummary$asDF}
#'
#' \code{as.data.frame(results$designSummary)}
#'
#' @export
adaptivetrialdesign <- function(
    data,
    outcome,
    treatment,
    outcomeLevel,
    stratification_variables = NULL,
    time_variable = NULL,
    adaptation_type = "sample_size",
    design_framework = "bayesian",
    interim_analysis = TRUE,
    interim_timing = "information",
    interim_fractions = "0.25,0.50,0.75",
    max_interim_analyses = 3,
    efficacy_boundary = 0.95,
    futility_boundary = 0.1,
    boundary_type = "obrien_fleming",
    planned_sample_size = 100,
    minimum_effect_size = 0.5,
    target_power = 0.8,
    type1_error_rate = 0.05,
    max_sample_size_inflation = 2,
    prior_type = "weakly_informative",
    historical_data_weight = 0.1,
    prior_parameters = "",
    decision_criterion = "posterior_probability",
    bayes_factor_threshold = 3,
    predictive_power_threshold = 0.8,
    run_simulations = TRUE,
    n_simulations = 1000,
    true_effect_scenarios = "0,0.3,0.5,0.8",
    mcmc_samples = 5000,
    mcmc_burnin = 2000,
    mcmc_chains = 3,
    show_design_summary = TRUE,
    show_interim_results = TRUE,
    show_stopping_boundaries = TRUE,
    show_sample_size_evolution = TRUE,
    show_operating_characteristics = TRUE,
    show_posterior_evolution = TRUE,
    show_decision_analysis = TRUE,
    show_interpretation = TRUE,
    alpha_spending_function = "obf_type",
    spending_parameter = 1,
    blinded_sample_size_reestimation = FALSE,
    conditional_power_threshold = 0.2,
    clinical_context = "general",
    set_seed = TRUE,
    seed_value = 42,
    regulatory_framework = "general",
    dmb_recommendations = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("adaptivetrialdesign requires jmvcore to be installed (restart may be required)")

    if ( ! missing(outcome)) outcome <- jmvcore::resolveQuo(jmvcore::enquo(outcome))
    if ( ! missing(treatment)) treatment <- jmvcore::resolveQuo(jmvcore::enquo(treatment))
    if ( ! missing(stratification_variables)) stratification_variables <- jmvcore::resolveQuo(jmvcore::enquo(stratification_variables))
    if ( ! missing(time_variable)) time_variable <- jmvcore::resolveQuo(jmvcore::enquo(time_variable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(outcome), outcome, NULL),
            `if`( ! missing(treatment), treatment, NULL),
            `if`( ! missing(stratification_variables), stratification_variables, NULL),
            `if`( ! missing(time_variable), time_variable, NULL))

    for (v in treatment) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- adaptivetrialdesignOptions$new(
        outcome = outcome,
        treatment = treatment,
        outcomeLevel = outcomeLevel,
        stratification_variables = stratification_variables,
        time_variable = time_variable,
        adaptation_type = adaptation_type,
        design_framework = design_framework,
        interim_analysis = interim_analysis,
        interim_timing = interim_timing,
        interim_fractions = interim_fractions,
        max_interim_analyses = max_interim_analyses,
        efficacy_boundary = efficacy_boundary,
        futility_boundary = futility_boundary,
        boundary_type = boundary_type,
        planned_sample_size = planned_sample_size,
        minimum_effect_size = minimum_effect_size,
        target_power = target_power,
        type1_error_rate = type1_error_rate,
        max_sample_size_inflation = max_sample_size_inflation,
        prior_type = prior_type,
        historical_data_weight = historical_data_weight,
        prior_parameters = prior_parameters,
        decision_criterion = decision_criterion,
        bayes_factor_threshold = bayes_factor_threshold,
        predictive_power_threshold = predictive_power_threshold,
        run_simulations = run_simulations,
        n_simulations = n_simulations,
        true_effect_scenarios = true_effect_scenarios,
        mcmc_samples = mcmc_samples,
        mcmc_burnin = mcmc_burnin,
        mcmc_chains = mcmc_chains,
        show_design_summary = show_design_summary,
        show_interim_results = show_interim_results,
        show_stopping_boundaries = show_stopping_boundaries,
        show_sample_size_evolution = show_sample_size_evolution,
        show_operating_characteristics = show_operating_characteristics,
        show_posterior_evolution = show_posterior_evolution,
        show_decision_analysis = show_decision_analysis,
        show_interpretation = show_interpretation,
        alpha_spending_function = alpha_spending_function,
        spending_parameter = spending_parameter,
        blinded_sample_size_reestimation = blinded_sample_size_reestimation,
        conditional_power_threshold = conditional_power_threshold,
        clinical_context = clinical_context,
        set_seed = set_seed,
        seed_value = seed_value,
        regulatory_framework = regulatory_framework,
        dmb_recommendations = dmb_recommendations)

    analysis <- adaptivetrialdesignClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

