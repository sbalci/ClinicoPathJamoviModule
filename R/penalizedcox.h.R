
# This file is automatically generated, you probably don't want to edit this

penalizedcoxOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "penalizedcoxOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            elapsedtime = NULL,
            tint = FALSE,
            dxdate = NULL,
            fudate = NULL,
            timetypedata = "ymd",
            timetypeoutput = "months",
            outcome = NULL,
            outcomeLevel = NULL,
            predictors = NULL,
            penalty_type = "lasso",
            alpha = 0.5,
            lambda_selection = "1se",
            lambda_custom = 0.01,
            cv_folds = 10,
            cv_type = "deviance",
            variable_selection = TRUE,
            standardize = TRUE,
            include_intercept = FALSE,
            bootstrap_validation = FALSE,
            bootstrap_samples = 100,
            predict_risk = TRUE,
            survival_curves = FALSE,
            risk_groups = "3",
            coefficient_plot = TRUE,
            cv_plot = TRUE,
            variable_importance = FALSE,
            lambda_sequence = "",
            max_variables = 100,
            convergence_threshold = 1e-7,
            show_coefficients = TRUE,
            show_model_metrics = TRUE,
            show_lambda_path = FALSE,
            showSummaries = FALSE,
            showExplanations = FALSE,
            addRiskScore = FALSE,
            addRiskGroup = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="penalizedcox",
                requiresData=TRUE,
                ...)

            private$..elapsedtime <- jmvcore::OptionVariable$new(
                "elapsedtime",
                elapsedtime,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"),
                default=NULL)
            private$..tint <- jmvcore::OptionBool$new(
                "tint",
                tint,
                default=FALSE)
            private$..dxdate <- jmvcore::OptionVariable$new(
                "dxdate",
                dxdate,
                default=NULL)
            private$..fudate <- jmvcore::OptionVariable$new(
                "fudate",
                fudate,
                default=NULL)
            private$..timetypedata <- jmvcore::OptionList$new(
                "timetypedata",
                timetypedata,
                options=list(
                    "ymd",
                    "mdy",
                    "dmy"),
                default="ymd")
            private$..timetypeoutput <- jmvcore::OptionList$new(
                "timetypeoutput",
                timetypeoutput,
                options=list(
                    "days",
                    "weeks",
                    "months",
                    "years"),
                default="months")
            private$..outcome <- jmvcore::OptionVariable$new(
                "outcome",
                outcome,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..outcomeLevel <- jmvcore::OptionLevel$new(
                "outcomeLevel",
                outcomeLevel,
                variable="(outcome)")
            private$..predictors <- jmvcore::OptionVariables$new(
                "predictors",
                predictors,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..penalty_type <- jmvcore::OptionList$new(
                "penalty_type",
                penalty_type,
                options=list(
                    "lasso",
                    "ridge",
                    "elastic_net"),
                default="lasso")
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                min=0,
                max=1,
                default=0.5)
            private$..lambda_selection <- jmvcore::OptionList$new(
                "lambda_selection",
                lambda_selection,
                options=list(
                    "min",
                    "1se",
                    "custom"),
                default="1se")
            private$..lambda_custom <- jmvcore::OptionNumber$new(
                "lambda_custom",
                lambda_custom,
                min=0,
                default=0.01)
            private$..cv_folds <- jmvcore::OptionInteger$new(
                "cv_folds",
                cv_folds,
                min=3,
                max=20,
                default=10)
            private$..cv_type <- jmvcore::OptionList$new(
                "cv_type",
                cv_type,
                options=list(
                    "deviance",
                    "C"),
                default="deviance")
            private$..variable_selection <- jmvcore::OptionBool$new(
                "variable_selection",
                variable_selection,
                default=TRUE)
            private$..standardize <- jmvcore::OptionBool$new(
                "standardize",
                standardize,
                default=TRUE)
            private$..include_intercept <- jmvcore::OptionBool$new(
                "include_intercept",
                include_intercept,
                default=FALSE)
            private$..bootstrap_validation <- jmvcore::OptionBool$new(
                "bootstrap_validation",
                bootstrap_validation,
                default=FALSE)
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                min=50,
                max=1000,
                default=100)
            private$..predict_risk <- jmvcore::OptionBool$new(
                "predict_risk",
                predict_risk,
                default=TRUE)
            private$..survival_curves <- jmvcore::OptionBool$new(
                "survival_curves",
                survival_curves,
                default=FALSE)
            private$..risk_groups <- jmvcore::OptionList$new(
                "risk_groups",
                risk_groups,
                options=list(
                    "2",
                    "3",
                    "4"),
                default="3")
            private$..coefficient_plot <- jmvcore::OptionBool$new(
                "coefficient_plot",
                coefficient_plot,
                default=TRUE)
            private$..cv_plot <- jmvcore::OptionBool$new(
                "cv_plot",
                cv_plot,
                default=TRUE)
            private$..variable_importance <- jmvcore::OptionBool$new(
                "variable_importance",
                variable_importance,
                default=FALSE)
            private$..lambda_sequence <- jmvcore::OptionString$new(
                "lambda_sequence",
                lambda_sequence,
                default="")
            private$..max_variables <- jmvcore::OptionInteger$new(
                "max_variables",
                max_variables,
                min=1,
                max=1000,
                default=100)
            private$..convergence_threshold <- jmvcore::OptionNumber$new(
                "convergence_threshold",
                convergence_threshold,
                min=1e-8,
                max=0.001,
                default=1e-7)
            private$..show_coefficients <- jmvcore::OptionBool$new(
                "show_coefficients",
                show_coefficients,
                default=TRUE)
            private$..show_model_metrics <- jmvcore::OptionBool$new(
                "show_model_metrics",
                show_model_metrics,
                default=TRUE)
            private$..show_lambda_path <- jmvcore::OptionBool$new(
                "show_lambda_path",
                show_lambda_path,
                default=FALSE)
            private$..showSummaries <- jmvcore::OptionBool$new(
                "showSummaries",
                showSummaries,
                default=FALSE)
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=FALSE)
            private$..addRiskScore <- jmvcore::OptionBool$new(
                "addRiskScore",
                addRiskScore,
                default=FALSE)
            private$..addRiskGroup <- jmvcore::OptionBool$new(
                "addRiskGroup",
                addRiskGroup,
                default=FALSE)

            self$.addOption(private$..elapsedtime)
            self$.addOption(private$..tint)
            self$.addOption(private$..dxdate)
            self$.addOption(private$..fudate)
            self$.addOption(private$..timetypedata)
            self$.addOption(private$..timetypeoutput)
            self$.addOption(private$..outcome)
            self$.addOption(private$..outcomeLevel)
            self$.addOption(private$..predictors)
            self$.addOption(private$..penalty_type)
            self$.addOption(private$..alpha)
            self$.addOption(private$..lambda_selection)
            self$.addOption(private$..lambda_custom)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..cv_type)
            self$.addOption(private$..variable_selection)
            self$.addOption(private$..standardize)
            self$.addOption(private$..include_intercept)
            self$.addOption(private$..bootstrap_validation)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..predict_risk)
            self$.addOption(private$..survival_curves)
            self$.addOption(private$..risk_groups)
            self$.addOption(private$..coefficient_plot)
            self$.addOption(private$..cv_plot)
            self$.addOption(private$..variable_importance)
            self$.addOption(private$..lambda_sequence)
            self$.addOption(private$..max_variables)
            self$.addOption(private$..convergence_threshold)
            self$.addOption(private$..show_coefficients)
            self$.addOption(private$..show_model_metrics)
            self$.addOption(private$..show_lambda_path)
            self$.addOption(private$..showSummaries)
            self$.addOption(private$..showExplanations)
            self$.addOption(private$..addRiskScore)
            self$.addOption(private$..addRiskGroup)
        }),
    active = list(
        elapsedtime = function() private$..elapsedtime$value,
        tint = function() private$..tint$value,
        dxdate = function() private$..dxdate$value,
        fudate = function() private$..fudate$value,
        timetypedata = function() private$..timetypedata$value,
        timetypeoutput = function() private$..timetypeoutput$value,
        outcome = function() private$..outcome$value,
        outcomeLevel = function() private$..outcomeLevel$value,
        predictors = function() private$..predictors$value,
        penalty_type = function() private$..penalty_type$value,
        alpha = function() private$..alpha$value,
        lambda_selection = function() private$..lambda_selection$value,
        lambda_custom = function() private$..lambda_custom$value,
        cv_folds = function() private$..cv_folds$value,
        cv_type = function() private$..cv_type$value,
        variable_selection = function() private$..variable_selection$value,
        standardize = function() private$..standardize$value,
        include_intercept = function() private$..include_intercept$value,
        bootstrap_validation = function() private$..bootstrap_validation$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        predict_risk = function() private$..predict_risk$value,
        survival_curves = function() private$..survival_curves$value,
        risk_groups = function() private$..risk_groups$value,
        coefficient_plot = function() private$..coefficient_plot$value,
        cv_plot = function() private$..cv_plot$value,
        variable_importance = function() private$..variable_importance$value,
        lambda_sequence = function() private$..lambda_sequence$value,
        max_variables = function() private$..max_variables$value,
        convergence_threshold = function() private$..convergence_threshold$value,
        show_coefficients = function() private$..show_coefficients$value,
        show_model_metrics = function() private$..show_model_metrics$value,
        show_lambda_path = function() private$..show_lambda_path$value,
        showSummaries = function() private$..showSummaries$value,
        showExplanations = function() private$..showExplanations$value,
        addRiskScore = function() private$..addRiskScore$value,
        addRiskGroup = function() private$..addRiskGroup$value),
    private = list(
        ..elapsedtime = NA,
        ..tint = NA,
        ..dxdate = NA,
        ..fudate = NA,
        ..timetypedata = NA,
        ..timetypeoutput = NA,
        ..outcome = NA,
        ..outcomeLevel = NA,
        ..predictors = NA,
        ..penalty_type = NA,
        ..alpha = NA,
        ..lambda_selection = NA,
        ..lambda_custom = NA,
        ..cv_folds = NA,
        ..cv_type = NA,
        ..variable_selection = NA,
        ..standardize = NA,
        ..include_intercept = NA,
        ..bootstrap_validation = NA,
        ..bootstrap_samples = NA,
        ..predict_risk = NA,
        ..survival_curves = NA,
        ..risk_groups = NA,
        ..coefficient_plot = NA,
        ..cv_plot = NA,
        ..variable_importance = NA,
        ..lambda_sequence = NA,
        ..max_variables = NA,
        ..convergence_threshold = NA,
        ..show_coefficients = NA,
        ..show_model_metrics = NA,
        ..show_lambda_path = NA,
        ..showSummaries = NA,
        ..showExplanations = NA,
        ..addRiskScore = NA,
        ..addRiskGroup = NA)
)

penalizedcoxResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "penalizedcoxResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        modelSummary = function() private$.items[["modelSummary"]],
        coefficientTable = function() private$.items[["coefficientTable"]],
        performanceTable = function() private$.items[["performanceTable"]],
        crossValidationSummary = function() private$.items[["crossValidationSummary"]],
        lambdaTable = function() private$.items[["lambdaTable"]],
        variableImportanceTable = function() private$.items[["variableImportanceTable"]],
        riskScoreTable = function() private$.items[["riskScoreTable"]],
        riskGroupTable = function() private$.items[["riskGroupTable"]],
        bootstrapTable = function() private$.items[["bootstrapTable"]],
        coefficientPlot = function() private$.items[["coefficientPlot"]],
        cvPlot = function() private$.items[["cvPlot"]],
        importancePlot = function() private$.items[["importancePlot"]],
        survivalPlot = function() private$.items[["survivalPlot"]],
        analysisSummary = function() private$.items[["analysisSummary"]],
        methodExplanation = function() private$.items[["methodExplanation"]],
        regularizationExplanation = function() private$.items[["regularizationExplanation"]],
        variableSelectionExplanation = function() private$.items[["variableSelectionExplanation"]],
        crossValidationExplanation = function() private$.items[["crossValidationExplanation"]],
        performanceExplanation = function() private$.items[["performanceExplanation"]],
        calculatedtime = function() private$.items[["calculatedtime"]],
        riskScoreOutput = function() private$.items[["riskScoreOutput"]],
        riskGroupOutput = function() private$.items[["riskGroupOutput"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Penalized Cox Regression",
                refs=list(
                    "glmnet",
                    "survival",
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="To Do",
                clearWith=list(
                    "outcome",
                    "outcomeLevel",
                    "elapsedtime",
                    "predictors",
                    "penalty_type",
                    "lambda_selection",
                    "cv_folds",
                    "fudate",
                    "dxdate",
                    "tint")))
            self$add(jmvcore::Html$new(
                options=options,
                name="modelSummary",
                title="Penalized Cox Model Summary",
                visible="(show_model_metrics)",
                clearWith=list(
                    "penalty_type",
                    "alpha",
                    "lambda_selection",
                    "cv_folds",
                    "outcome",
                    "outcomeLevel",
                    "elapsedtime",
                    "predictors")))
            self$add(jmvcore::Table$new(
                options=options,
                name="coefficientTable",
                title="Selected Variables and Coefficients",
                visible="(show_coefficients && variable_selection)",
                rows=0,
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="coefficient", 
                        `title`="Coefficient", 
                        `type`="number"),
                    list(
                        `name`="hazard_ratio", 
                        `title`="Hazard Ratio", 
                        `type`="number")),
                clearWith=list(
                    "penalty_type",
                    "alpha",
                    "lambda_selection",
                    "predictors",
                    "variable_selection")))
            self$add(jmvcore::Table$new(
                options=options,
                name="performanceTable",
                title="Model Performance Metrics",
                visible="(show_model_metrics)",
                rows=0,
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text")),
                clearWith=list(
                    "penalty_type",
                    "cv_folds",
                    "cv_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="crossValidationSummary",
                title="Cross-Validation Results",
                visible="(show_lambda_path)",
                clearWith=list(
                    "cv_folds",
                    "cv_type",
                    "lambda_selection",
                    "penalty_type")))
            self$add(jmvcore::Table$new(
                options=options,
                name="lambdaTable",
                title="Lambda Selection Details",
                visible="(show_lambda_path)",
                rows=0,
                columns=list(
                    list(
                        `name`="lambda_type", 
                        `title`="Lambda Type", 
                        `type`="text"),
                    list(
                        `name`="lambda_value", 
                        `title`="Lambda Value", 
                        `type`="number"),
                    list(
                        `name`="cv_error", 
                        `title`="CV Error", 
                        `type`="number"),
                    list(
                        `name`="n_variables", 
                        `title`="Variables Selected", 
                        `type`="integer")),
                clearWith=list(
                    "lambda_selection",
                    "cv_folds",
                    "penalty_type")))
            self$add(jmvcore::Table$new(
                options=options,
                name="variableImportanceTable",
                title="Variable Importance Ranking",
                visible="(variable_importance)",
                rows=0,
                columns=list(
                    list(
                        `name`="rank", 
                        `title`="Rank", 
                        `type`="integer"),
                    list(
                        `name`="variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="importance", 
                        `title`="Importance Score", 
                        `type`="number"),
                    list(
                        `name`="coefficient", 
                        `title`="Coefficient", 
                        `type`="number")),
                clearWith=list(
                    "penalty_type",
                    "predictors",
                    "variable_selection")))
            self$add(jmvcore::Table$new(
                options=options,
                name="riskScoreTable",
                title="Risk Score Summary Statistics",
                visible="(predict_risk)",
                rows=0,
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number")),
                clearWith=list(
                    "penalty_type",
                    "predictors",
                    "lambda_selection")))
            self$add(jmvcore::Table$new(
                options=options,
                name="riskGroupTable",
                title="Risk Group Analysis",
                visible="(survival_curves)",
                rows=0,
                columns=list(
                    list(
                        `name`="risk_group", 
                        `title`="Risk Group", 
                        `type`="text"),
                    list(
                        `name`="n_patients", 
                        `title`="N Patients", 
                        `type`="integer"),
                    list(
                        `name`="n_events", 
                        `title`="N Events", 
                        `type`="integer"),
                    list(
                        `name`="median_survival", 
                        `title`="Median Survival", 
                        `type`="number"),
                    list(
                        `name`="mean_risk_score", 
                        `title`="Mean Risk Score", 
                        `type`="number")),
                clearWith=list(
                    "predict_risk",
                    "survival_curves",
                    "risk_groups")))
            self$add(jmvcore::Table$new(
                options=options,
                name="bootstrapTable",
                title="Bootstrap Validation Results",
                visible="(bootstrap_validation)",
                rows=0,
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Validation Metric", 
                        `type`="text"),
                    list(
                        `name`="original", 
                        `title`="Original", 
                        `type`="number"),
                    list(
                        `name`="optimism", 
                        `title`="Optimism", 
                        `type`="number"),
                    list(
                        `name`="corrected", 
                        `title`="Bias-Corrected", 
                        `type`="number")),
                clearWith=list(
                    "bootstrap_validation",
                    "bootstrap_samples",
                    "penalty_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="coefficientPlot",
                title="Coefficient Path Plot",
                width=600,
                height=450,
                renderFun=".plotCoefficients",
                requiresData=TRUE,
                visible="(coefficient_plot)",
                clearWith=list(
                    "penalty_type",
                    "alpha",
                    "predictors",
                    "lambda_selection")))
            self$add(jmvcore::Image$new(
                options=options,
                name="cvPlot",
                title="Cross-Validation Error Plot",
                width=600,
                height=450,
                renderFun=".plotCrossValidation",
                requiresData=TRUE,
                visible="(cv_plot)",
                clearWith=list(
                    "cv_folds",
                    "cv_type",
                    "penalty_type",
                    "lambda_selection")))
            self$add(jmvcore::Image$new(
                options=options,
                name="importancePlot",
                title="Variable Importance Plot",
                width=600,
                height=450,
                renderFun=".plotVariableImportance",
                requiresData=TRUE,
                visible="(variable_importance)",
                clearWith=list(
                    "penalty_type",
                    "predictors",
                    "variable_selection")))
            self$add(jmvcore::Image$new(
                options=options,
                name="survivalPlot",
                title="Survival Curves by Risk Groups",
                width=600,
                height=450,
                renderFun=".plotSurvivalCurves",
                requiresData=TRUE,
                visible="(survival_curves)",
                clearWith=list(
                    "predict_risk",
                    "survival_curves",
                    "risk_groups",
                    "outcome",
                    "elapsedtime")))
            self$add(jmvcore::Html$new(
                options=options,
                name="analysisSummary",
                title="Analysis Summary",
                visible="(showSummaries)",
                clearWith=list(
                    "penalty_type",
                    "variable_selection",
                    "predictors")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Penalized Cox Regression Methods",
                visible="(showExplanations)",
                clearWith=list(
                    "penalty_type",
                    "alpha",
                    "lambda_selection")))
            self$add(jmvcore::Html$new(
                options=options,
                name="regularizationExplanation",
                title="Understanding Regularization in Cox Models",
                visible="(showExplanations)",
                clearWith=list(
                    "penalty_type",
                    "alpha")))
            self$add(jmvcore::Html$new(
                options=options,
                name="variableSelectionExplanation",
                title="Understanding Variable Selection",
                visible="(variable_selection && showExplanations)",
                clearWith=list(
                    "penalty_type",
                    "variable_selection")))
            self$add(jmvcore::Html$new(
                options=options,
                name="crossValidationExplanation",
                title="Understanding Cross-Validation for Model Selection",
                visible="(showExplanations)",
                clearWith=list(
                    "cv_folds",
                    "cv_type",
                    "lambda_selection")))
            self$add(jmvcore::Html$new(
                options=options,
                name="performanceExplanation",
                title="Understanding Model Performance Metrics",
                visible="(show_model_metrics && showExplanations)",
                clearWith=list(
                    "cv_type",
                    "penalty_type")))
            self$add(jmvcore::Output$new(
                options=options,
                name="calculatedtime",
                title="Add Calculated Time to Data",
                varTitle="`Calculated Time in Penalized Cox Function - from ${ dxdate } to { fudate }`",
                varDescription="Calculated Time from given Dates in Penalized Cox Regression",
                clearWith=list(
                    "tint",
                    "dxdate",
                    "fudate")))
            self$add(jmvcore::Output$new(
                options=options,
                name="riskScoreOutput",
                title="Add Risk Score to Data",
                varTitle="`Penalized Cox Risk Score`",
                varDescription="Linear predictor (risk score) from penalized Cox regression",
                clearWith=list(
                    "addRiskScore",
                    "penalty_type",
                    "lambda_selection",
                    "predictors")))
            self$add(jmvcore::Output$new(
                options=options,
                name="riskGroupOutput",
                title="Add Risk Group to Data",
                varTitle="`Penalized Cox Risk Group`",
                varDescription="Risk group classification based on penalized Cox model",
                clearWith=list(
                    "addRiskGroup",
                    "penalty_type",
                    "risk_groups",
                    "predictors")))}))

penalizedcoxBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "penalizedcoxBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "penalizedcox",
                version = c(0,0,1),
                options = options,
                results = penalizedcoxResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Penalized Cox Regression
#'
#' Performs penalized Cox proportional hazards regression using regularization 
#' methods (LASSO, Ridge, Elastic Net) for high-dimensional survival data. 
#' This method is particularly useful when the number of variables is large 
#' relative to the number of observations, or when multicollinearity is 
#' present. The regularization helps with variable selection and prevents 
#' overfitting.
#'
#' @examples
#' # Example 1: LASSO penalized Cox regression
#' library(survival)
#' library(glmnet)
#'
#' penalizedcox(
#'     data = lung_data,
#'     elapsedtime = "time",
#'     outcome = "status",
#'     outcomeLevel = "2",
#'     predictors = c("age", "sex", "ph.ecog", "ph.karno"),
#'     penalty_type = "lasso",
#'     cv_folds = 10
#' )
#'
#' # Example 2: Elastic Net with variable selection
#' penalizedcox(
#'     data = genomic_data,
#'     elapsedtime = "survival_time",
#'     outcome = "event",
#'     outcomeLevel = "1",
#'     predictors = c("gene1", "gene2", "gene3", "gene4"),
#'     penalty_type = "elastic_net",
#'     alpha = 0.5,
#'     lambda_selection = "1se",
#'     variable_selection = TRUE
#' )
#'
#' @param data The dataset for analysis, provided as a data frame. Should
#'   contain survival variables and predictor variables for penalized
#'   regression.
#' @param elapsedtime The numeric variable representing follow-up time until
#'   the event or censoring.
#' @param tint If true, survival time will be calculated from diagnosis and
#'   follow-up dates.
#' @param dxdate Date of diagnosis or start of follow-up. Required if tint =
#'   true.
#' @param fudate Follow-up date or date of last observation. Required if tint
#'   = true.
#' @param timetypedata Specifies the format of date variables in the input
#'   data.
#' @param timetypeoutput The units in which survival time is reported in the
#'   output.
#' @param outcome The outcome variable indicating event status (e.g., death,
#'   recurrence).
#' @param outcomeLevel The level of outcome considered as the event.
#' @param predictors Variables to include in the penalized Cox regression
#'   model.
#' @param penalty_type Type of penalty to apply. LASSO performs variable
#'   selection, Ridge shrinks coefficients, Elastic Net combines both.
#' @param alpha Mixing parameter for Elastic Net. Alpha=1 is LASSO, alpha=0 is
#'   Ridge. Used only when penalty_type = "elastic_net".
#' @param lambda_selection Method for selecting the regularization parameter
#'   lambda.
#' @param lambda_custom Custom lambda value when lambda_selection = "custom".
#' @param cv_folds Number of folds for cross-validation to select optimal
#'   lambda.
#' @param cv_type Cross-validation error measure for model selection.
#' @param variable_selection Extract and display selected variables (non-zero
#'   coefficients).
#' @param standardize Whether to standardize predictor variables before
#'   fitting.
#' @param include_intercept Whether to include an intercept in the model
#'   (usually false for Cox models).
#' @param bootstrap_validation Perform bootstrap validation of the penalized
#'   model.
#' @param bootstrap_samples Number of bootstrap samples for validation.
#' @param predict_risk Calculate linear predictors (risk scores) for each
#'   observation.
#' @param survival_curves Generate survival curves stratified by risk score
#'   groups.
#' @param risk_groups Number of risk groups for survival curve stratification.
#' @param coefficient_plot Display coefficient paths showing shrinkage across
#'   lambda values.
#' @param cv_plot Display cross-validation error plot for lambda selection.
#' @param variable_importance Display variable importance based on coefficient
#'   magnitudes.
#' @param lambda_sequence Custom sequence of lambda values (comma-separated).
#'   If empty, glmnet will choose automatically.
#' @param max_variables Maximum number of variables to include in the model
#'   path.
#' @param convergence_threshold Convergence threshold for coordinate descent
#'   algorithm.
#' @param show_coefficients Display table of selected variables and their
#'   coefficients.
#' @param show_model_metrics Display model performance metrics including
#'   deviance and C-index.
#' @param show_lambda_path Display detailed information about lambda selection
#'   process.
#' @param showSummaries Display natural language summaries alongside tables
#'   and plots for interpretation of penalized Cox regression results.
#' @param showExplanations Display detailed explanations of penalized Cox
#'   regression methods and interpretation guidelines.
#' @param addRiskScore Add calculated linear predictor (risk score) as new
#'   variable to dataset.
#' @param addRiskGroup Add risk group classification as new variable to
#'   dataset.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$coefficientTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$performanceTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crossValidationSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$lambdaTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$variableImportanceTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$riskScoreTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$riskGroupTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$bootstrapTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$coefficientPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cvPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$importancePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$survivalPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$analysisSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$regularizationExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$variableSelectionExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$crossValidationExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$performanceExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$calculatedtime} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$riskScoreOutput} \tab \tab \tab \tab \tab an output \cr
#'   \code{results$riskGroupOutput} \tab \tab \tab \tab \tab an output \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$coefficientTable$asDF}
#'
#' \code{as.data.frame(results$coefficientTable)}
#'
#' @export
penalizedcox <- function(
    data,
    elapsedtime = NULL,
    tint = FALSE,
    dxdate = NULL,
    fudate = NULL,
    timetypedata = "ymd",
    timetypeoutput = "months",
    outcome = NULL,
    outcomeLevel,
    predictors = NULL,
    penalty_type = "lasso",
    alpha = 0.5,
    lambda_selection = "1se",
    lambda_custom = 0.01,
    cv_folds = 10,
    cv_type = "deviance",
    variable_selection = TRUE,
    standardize = TRUE,
    include_intercept = FALSE,
    bootstrap_validation = FALSE,
    bootstrap_samples = 100,
    predict_risk = TRUE,
    survival_curves = FALSE,
    risk_groups = "3",
    coefficient_plot = TRUE,
    cv_plot = TRUE,
    variable_importance = FALSE,
    lambda_sequence = "",
    max_variables = 100,
    convergence_threshold = 1e-7,
    show_coefficients = TRUE,
    show_model_metrics = TRUE,
    show_lambda_path = FALSE,
    showSummaries = FALSE,
    showExplanations = FALSE,
    addRiskScore = FALSE,
    addRiskGroup = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("penalizedcox requires jmvcore to be installed (restart may be required)")

    if ( ! missing(elapsedtime)) elapsedtime <- jmvcore::resolveQuo(jmvcore::enquo(elapsedtime))
    if ( ! missing(dxdate)) dxdate <- jmvcore::resolveQuo(jmvcore::enquo(dxdate))
    if ( ! missing(fudate)) fudate <- jmvcore::resolveQuo(jmvcore::enquo(fudate))
    if ( ! missing(outcome)) outcome <- jmvcore::resolveQuo(jmvcore::enquo(outcome))
    if ( ! missing(predictors)) predictors <- jmvcore::resolveQuo(jmvcore::enquo(predictors))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(elapsedtime), elapsedtime, NULL),
            `if`( ! missing(dxdate), dxdate, NULL),
            `if`( ! missing(fudate), fudate, NULL),
            `if`( ! missing(outcome), outcome, NULL),
            `if`( ! missing(predictors), predictors, NULL))


    options <- penalizedcoxOptions$new(
        elapsedtime = elapsedtime,
        tint = tint,
        dxdate = dxdate,
        fudate = fudate,
        timetypedata = timetypedata,
        timetypeoutput = timetypeoutput,
        outcome = outcome,
        outcomeLevel = outcomeLevel,
        predictors = predictors,
        penalty_type = penalty_type,
        alpha = alpha,
        lambda_selection = lambda_selection,
        lambda_custom = lambda_custom,
        cv_folds = cv_folds,
        cv_type = cv_type,
        variable_selection = variable_selection,
        standardize = standardize,
        include_intercept = include_intercept,
        bootstrap_validation = bootstrap_validation,
        bootstrap_samples = bootstrap_samples,
        predict_risk = predict_risk,
        survival_curves = survival_curves,
        risk_groups = risk_groups,
        coefficient_plot = coefficient_plot,
        cv_plot = cv_plot,
        variable_importance = variable_importance,
        lambda_sequence = lambda_sequence,
        max_variables = max_variables,
        convergence_threshold = convergence_threshold,
        show_coefficients = show_coefficients,
        show_model_metrics = show_model_metrics,
        show_lambda_path = show_lambda_path,
        showSummaries = showSummaries,
        showExplanations = showExplanations,
        addRiskScore = addRiskScore,
        addRiskGroup = addRiskGroup)

    analysis <- penalizedcoxClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

