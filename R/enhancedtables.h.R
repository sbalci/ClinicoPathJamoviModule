
# This file is automatically generated, you probably don't want to edit this

enhancedtablesOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtablesOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            vars = NULL,
            group_var = NULL,
            strata_var = NULL,
            table_type = "summary",
            stats_continuous = "mean_sd",
            stats_categorical = "n_percent",
            include_total = TRUE,
            include_pvalues = FALSE,
            test_type = "auto",
            missing_handling = "show",
            table_theme = "clinical",
            table_title = "Enhanced Data Summary",
            table_subtitle = "",
            source_note = "",
            show_footnotes = TRUE,
            decimal_places = 2,
            font_size = "normal",
            table_width = "auto",
            stripe_rows = TRUE,
            group_colors = TRUE,
            highlight_significant = TRUE,
            confidence_level = 0.95,
            show_interpretation = TRUE,
            export_format = "html", ...) {

            super$initialize(
                package="ClinicoPath",
                name="enhancedtables",
                requiresData=TRUE,
                ...)

            private$..vars <- jmvcore::OptionVariables$new(
                "vars",
                vars,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..group_var <- jmvcore::OptionVariable$new(
                "group_var",
                group_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..strata_var <- jmvcore::OptionVariable$new(
                "strata_var",
                strata_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..table_type <- jmvcore::OptionList$new(
                "table_type",
                table_type,
                options=list(
                    "summary",
                    "grouped",
                    "descriptive",
                    "clinical",
                    "tableone",
                    "custom"),
                default="summary")
            private$..stats_continuous <- jmvcore::OptionList$new(
                "stats_continuous",
                stats_continuous,
                options=list(
                    "mean_sd",
                    "median_iqr",
                    "both",
                    "mean_sd_range",
                    "all"),
                default="mean_sd")
            private$..stats_categorical <- jmvcore::OptionList$new(
                "stats_categorical",
                stats_categorical,
                options=list(
                    "n_percent",
                    "n_only",
                    "percent_only",
                    "n_percent_missing"),
                default="n_percent")
            private$..include_total <- jmvcore::OptionBool$new(
                "include_total",
                include_total,
                default=TRUE)
            private$..include_pvalues <- jmvcore::OptionBool$new(
                "include_pvalues",
                include_pvalues,
                default=FALSE)
            private$..test_type <- jmvcore::OptionList$new(
                "test_type",
                test_type,
                options=list(
                    "auto",
                    "parametric",
                    "nonparametric",
                    "categorical"),
                default="auto")
            private$..missing_handling <- jmvcore::OptionList$new(
                "missing_handling",
                missing_handling,
                options=list(
                    "show",
                    "hide",
                    "exclude",
                    "category"),
                default="show")
            private$..table_theme <- jmvcore::OptionList$new(
                "table_theme",
                table_theme,
                options=list(
                    "clinical",
                    "publication",
                    "modern",
                    "traditional",
                    "minimal",
                    "journal"),
                default="clinical")
            private$..table_title <- jmvcore::OptionString$new(
                "table_title",
                table_title,
                default="Enhanced Data Summary")
            private$..table_subtitle <- jmvcore::OptionString$new(
                "table_subtitle",
                table_subtitle,
                default="")
            private$..source_note <- jmvcore::OptionString$new(
                "source_note",
                source_note,
                default="")
            private$..show_footnotes <- jmvcore::OptionBool$new(
                "show_footnotes",
                show_footnotes,
                default=TRUE)
            private$..decimal_places <- jmvcore::OptionNumber$new(
                "decimal_places",
                decimal_places,
                min=0,
                max=4,
                default=2)
            private$..font_size <- jmvcore::OptionList$new(
                "font_size",
                font_size,
                options=list(
                    "small",
                    "normal",
                    "large"),
                default="normal")
            private$..table_width <- jmvcore::OptionList$new(
                "table_width",
                table_width,
                options=list(
                    "auto",
                    "full",
                    "compact",
                    "wide"),
                default="auto")
            private$..stripe_rows <- jmvcore::OptionBool$new(
                "stripe_rows",
                stripe_rows,
                default=TRUE)
            private$..group_colors <- jmvcore::OptionBool$new(
                "group_colors",
                group_colors,
                default=TRUE)
            private$..highlight_significant <- jmvcore::OptionBool$new(
                "highlight_significant",
                highlight_significant,
                default=TRUE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)
            private$..export_format <- jmvcore::OptionList$new(
                "export_format",
                export_format,
                options=list(
                    "html",
                    "word",
                    "latex",
                    "rtf"),
                default="html")

            self$.addOption(private$..vars)
            self$.addOption(private$..group_var)
            self$.addOption(private$..strata_var)
            self$.addOption(private$..table_type)
            self$.addOption(private$..stats_continuous)
            self$.addOption(private$..stats_categorical)
            self$.addOption(private$..include_total)
            self$.addOption(private$..include_pvalues)
            self$.addOption(private$..test_type)
            self$.addOption(private$..missing_handling)
            self$.addOption(private$..table_theme)
            self$.addOption(private$..table_title)
            self$.addOption(private$..table_subtitle)
            self$.addOption(private$..source_note)
            self$.addOption(private$..show_footnotes)
            self$.addOption(private$..decimal_places)
            self$.addOption(private$..font_size)
            self$.addOption(private$..table_width)
            self$.addOption(private$..stripe_rows)
            self$.addOption(private$..group_colors)
            self$.addOption(private$..highlight_significant)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..show_interpretation)
            self$.addOption(private$..export_format)
        }),
    active = list(
        vars = function() private$..vars$value,
        group_var = function() private$..group_var$value,
        strata_var = function() private$..strata_var$value,
        table_type = function() private$..table_type$value,
        stats_continuous = function() private$..stats_continuous$value,
        stats_categorical = function() private$..stats_categorical$value,
        include_total = function() private$..include_total$value,
        include_pvalues = function() private$..include_pvalues$value,
        test_type = function() private$..test_type$value,
        missing_handling = function() private$..missing_handling$value,
        table_theme = function() private$..table_theme$value,
        table_title = function() private$..table_title$value,
        table_subtitle = function() private$..table_subtitle$value,
        source_note = function() private$..source_note$value,
        show_footnotes = function() private$..show_footnotes$value,
        decimal_places = function() private$..decimal_places$value,
        font_size = function() private$..font_size$value,
        table_width = function() private$..table_width$value,
        stripe_rows = function() private$..stripe_rows$value,
        group_colors = function() private$..group_colors$value,
        highlight_significant = function() private$..highlight_significant$value,
        confidence_level = function() private$..confidence_level$value,
        show_interpretation = function() private$..show_interpretation$value,
        export_format = function() private$..export_format$value),
    private = list(
        ..vars = NA,
        ..group_var = NA,
        ..strata_var = NA,
        ..table_type = NA,
        ..stats_continuous = NA,
        ..stats_categorical = NA,
        ..include_total = NA,
        ..include_pvalues = NA,
        ..test_type = NA,
        ..missing_handling = NA,
        ..table_theme = NA,
        ..table_title = NA,
        ..table_subtitle = NA,
        ..source_note = NA,
        ..show_footnotes = NA,
        ..decimal_places = NA,
        ..font_size = NA,
        ..table_width = NA,
        ..stripe_rows = NA,
        ..group_colors = NA,
        ..highlight_significant = NA,
        ..confidence_level = NA,
        ..show_interpretation = NA,
        ..export_format = NA)
)

enhancedtablesResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtablesResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        enhanced_table = function() private$.items[["enhanced_table"]],
        summary_stats = function() private$.items[["summary_stats"]],
        group_comparison = function() private$.items[["group_comparison"]],
        interpretation = function() private$.items[["interpretation"]],
        export_table = function() private$.items[["export_table"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Tables Results",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "janitor",
                    "gt"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="enhanced_table",
                title="Enhanced Table",
                visible="(vars)",
                clearWith=list(
                    "vars",
                    "group_var",
                    "strata_var",
                    "table_type",
                    "stats_continuous",
                    "stats_categorical",
                    "table_theme")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary_stats",
                title="Summary Statistics",
                visible="(table_type:summary)",
                clearWith=list(
                    "vars",
                    "group_var",
                    "stats_continuous",
                    "stats_categorical")))
            self$add(jmvcore::Html$new(
                options=options,
                name="group_comparison",
                title="Group Comparison Results",
                visible="(include_pvalues)",
                clearWith=list(
                    "vars",
                    "group_var",
                    "include_pvalues",
                    "test_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Clinical Interpretation",
                visible="(show_interpretation)",
                clearWith=list(
                    "vars",
                    "group_var",
                    "table_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="export_table",
                title="Export Ready Table",
                visible="(export_format)",
                clearWith=list(
                    "vars",
                    "export_format",
                    "table_theme")))}))

enhancedtablesBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedtablesBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "enhancedtables",
                version = c(0,0,3),
                options = options,
                results = enhancedtablesResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Tables with gt
#'
#' Creates professional, publication-ready tables using the gt package.
#' This module provides comprehensive table formatting with advanced styling,
#' grouping, summary statistics, and clinical research optimizations. 
#' Designed for high-quality table presentation in medical publications,
#' reports, and presentations. Features include conditional formatting,
#' custom themes, statistical summaries, and multi-level grouping.
#' 
#'
#' @examples
#' \donttest{
#' # Example:
#' # 1. Select variables for analysis
#' # 2. Choose grouping and summary options
#' # 3. Apply clinical formatting themes
#' # 4. Generate publication-ready tables
#'}
#' @param data The data as a data frame.
#' @param vars Variables to include in the enhanced table display.
#' @param group_var Variable for grouping rows and creating summary
#'   comparisons.
#' @param strata_var Additional variable for creating stratified analysis
#'   tables.
#' @param table_type Type of enhanced table to generate with appropriate
#'   clinical formatting.
#' @param stats_continuous Statistical summaries to display for continuous
#'   variables.
#' @param stats_categorical Statistical summaries to display for categorical
#'   variables.
#' @param include_total If TRUE, includes a total column with overall
#'   statistics.
#' @param include_pvalues If TRUE, includes statistical tests and p-values for
#'   group comparisons.
#' @param test_type Type of statistical tests to use for group comparisons.
#' @param missing_handling How to handle missing values in the analysis.
#' @param table_theme Visual theme for professional table appearance.
#' @param table_title Title for the enhanced table.
#' @param table_subtitle Optional subtitle for additional context.
#' @param source_note Optional source note to display below the table.
#' @param show_footnotes If TRUE, includes footnotes explaining statistical
#'   methods and symbols.
#' @param decimal_places Number of decimal places for numeric displays.
#' @param font_size Font size for table text.
#' @param table_width Width setting for the table layout.
#' @param stripe_rows If TRUE, applies alternating row background colors for
#'   readability.
#' @param group_colors If TRUE, applies color coding to group headers.
#' @param highlight_significant If TRUE, highlights statistically significant
#'   p-values.
#' @param confidence_level Confidence level for statistical tests and
#'   intervals.
#' @param show_interpretation If TRUE, displays clinical interpretation and
#'   usage guidelines.
#' @param export_format Additional export format for the enhanced table.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$enhanced_table} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary_stats} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$group_comparison} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$export_table} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
enhancedtables <- function(
    data,
    vars,
    group_var,
    strata_var,
    table_type = "summary",
    stats_continuous = "mean_sd",
    stats_categorical = "n_percent",
    include_total = TRUE,
    include_pvalues = FALSE,
    test_type = "auto",
    missing_handling = "show",
    table_theme = "clinical",
    table_title = "Enhanced Data Summary",
    table_subtitle = "",
    source_note = "",
    show_footnotes = TRUE,
    decimal_places = 2,
    font_size = "normal",
    table_width = "auto",
    stripe_rows = TRUE,
    group_colors = TRUE,
    highlight_significant = TRUE,
    confidence_level = 0.95,
    show_interpretation = TRUE,
    export_format = "html") {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("enhancedtables requires jmvcore to be installed (restart may be required)")

    if ( ! missing(vars)) vars <- jmvcore::resolveQuo(jmvcore::enquo(vars))
    if ( ! missing(group_var)) group_var <- jmvcore::resolveQuo(jmvcore::enquo(group_var))
    if ( ! missing(strata_var)) strata_var <- jmvcore::resolveQuo(jmvcore::enquo(strata_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(vars), vars, NULL),
            `if`( ! missing(group_var), group_var, NULL),
            `if`( ! missing(strata_var), strata_var, NULL))

    for (v in group_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in strata_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- enhancedtablesOptions$new(
        vars = vars,
        group_var = group_var,
        strata_var = strata_var,
        table_type = table_type,
        stats_continuous = stats_continuous,
        stats_categorical = stats_categorical,
        include_total = include_total,
        include_pvalues = include_pvalues,
        test_type = test_type,
        missing_handling = missing_handling,
        table_theme = table_theme,
        table_title = table_title,
        table_subtitle = table_subtitle,
        source_note = source_note,
        show_footnotes = show_footnotes,
        decimal_places = decimal_places,
        font_size = font_size,
        table_width = table_width,
        stripe_rows = stripe_rows,
        group_colors = group_colors,
        highlight_significant = highlight_significant,
        confidence_level = confidence_level,
        show_interpretation = show_interpretation,
        export_format = export_format)

    analysis <- enhancedtablesClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

