
# This file is automatically generated, you probably don't want to edit this

decisiongraphOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "decisiongraphOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            treeType = "costeffectiveness",
            decisions = NULL,
            healthStates = NULL,
            transitionProbs = NULL,
            cycleLength = 1,
            probabilities = NULL,
            costs = NULL,
            utilities = NULL,
            outcomes = NULL,
            layout = "horizontal",
            nodeShapes = TRUE,
            showProbabilities = TRUE,
            showCosts = TRUE,
            showUtilities = TRUE,
            calculateExpectedValues = TRUE,
            calculateNMB = TRUE,
            willingnessToPay = 50000,
            sensitivityAnalysis = FALSE,
            discountRate = 0.03,
            timeHorizon = 10,
            nodeLabels = TRUE,
            branchLabels = TRUE,
            colorScheme = "medical",
            summaryTable = TRUE,
            tornado = FALSE,
            decisionComparison = TRUE,
            incrementalAnalysis = TRUE,
            dominanceAnalysis = TRUE,
            icer_confidence_intervals = FALSE,
            probabilisticAnalysis = FALSE,
            psa_advanced_outputs = FALSE,
            numSimulations = 1000,
            markovAdvanced = FALSE,
            tunnelStates = NULL,
            timeVaryingTransitions = FALSE,
            ageSpecificTransitions = NULL,
            chanceNodeMethod = "simple",
            riskAdjustment = FALSE,
            cycleCorrection = TRUE,
            cohortTrace = FALSE,
            cohortSize = 1000,
            valueOfInformation = FALSE,
            evpi_parameters = NULL,
            budgetImpactAnalysis = FALSE,
            targetPopulationSize = 10000,
            marketPenetration = 0.5,
            ceacThresholds = "0,100000,5000",
            psa_distributions = "normal",
            correlatedParameters = FALSE,
            correlationMatrix = NULL, ...) {

            super$initialize(
                package="ClinicoPath",
                name="decisiongraph",
                requiresData=TRUE,
                ...)

            private$..treeType <- jmvcore::OptionList$new(
                "treeType",
                treeType,
                options=list(
                    "simple",
                    "markov",
                    "costeffectiveness"),
                default="costeffectiveness")
            private$..decisions <- jmvcore::OptionVariables$new(
                "decisions",
                decisions,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..healthStates <- jmvcore::OptionVariables$new(
                "healthStates",
                healthStates,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..transitionProbs <- jmvcore::OptionVariables$new(
                "transitionProbs",
                transitionProbs,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..cycleLength <- jmvcore::OptionNumber$new(
                "cycleLength",
                cycleLength,
                default=1,
                min=0.1,
                max=10)
            private$..probabilities <- jmvcore::OptionVariables$new(
                "probabilities",
                probabilities,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..costs <- jmvcore::OptionVariables$new(
                "costs",
                costs,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..utilities <- jmvcore::OptionVariables$new(
                "utilities",
                utilities,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..outcomes <- jmvcore::OptionVariables$new(
                "outcomes",
                outcomes,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..layout <- jmvcore::OptionList$new(
                "layout",
                layout,
                options=list(
                    "horizontal",
                    "vertical",
                    "radial"),
                default="horizontal")
            private$..nodeShapes <- jmvcore::OptionBool$new(
                "nodeShapes",
                nodeShapes,
                default=TRUE)
            private$..showProbabilities <- jmvcore::OptionBool$new(
                "showProbabilities",
                showProbabilities,
                default=TRUE)
            private$..showCosts <- jmvcore::OptionBool$new(
                "showCosts",
                showCosts,
                default=TRUE)
            private$..showUtilities <- jmvcore::OptionBool$new(
                "showUtilities",
                showUtilities,
                default=TRUE)
            private$..calculateExpectedValues <- jmvcore::OptionBool$new(
                "calculateExpectedValues",
                calculateExpectedValues,
                default=TRUE)
            private$..calculateNMB <- jmvcore::OptionBool$new(
                "calculateNMB",
                calculateNMB,
                default=TRUE)
            private$..willingnessToPay <- jmvcore::OptionNumber$new(
                "willingnessToPay",
                willingnessToPay,
                default=50000,
                min=0,
                max=500000)
            private$..sensitivityAnalysis <- jmvcore::OptionBool$new(
                "sensitivityAnalysis",
                sensitivityAnalysis,
                default=FALSE)
            private$..discountRate <- jmvcore::OptionNumber$new(
                "discountRate",
                discountRate,
                default=0.03,
                min=0,
                max=0.2)
            private$..timeHorizon <- jmvcore::OptionNumber$new(
                "timeHorizon",
                timeHorizon,
                default=10,
                min=1,
                max=100)
            private$..nodeLabels <- jmvcore::OptionBool$new(
                "nodeLabels",
                nodeLabels,
                default=TRUE)
            private$..branchLabels <- jmvcore::OptionBool$new(
                "branchLabels",
                branchLabels,
                default=TRUE)
            private$..colorScheme <- jmvcore::OptionList$new(
                "colorScheme",
                colorScheme,
                options=list(
                    "default",
                    "colorblind",
                    "medical",
                    "economic"),
                default="medical")
            private$..summaryTable <- jmvcore::OptionBool$new(
                "summaryTable",
                summaryTable,
                default=TRUE)
            private$..tornado <- jmvcore::OptionBool$new(
                "tornado",
                tornado,
                default=FALSE)
            private$..decisionComparison <- jmvcore::OptionBool$new(
                "decisionComparison",
                decisionComparison,
                default=TRUE)
            private$..incrementalAnalysis <- jmvcore::OptionBool$new(
                "incrementalAnalysis",
                incrementalAnalysis,
                default=TRUE)
            private$..dominanceAnalysis <- jmvcore::OptionBool$new(
                "dominanceAnalysis",
                dominanceAnalysis,
                default=TRUE)
            private$..icer_confidence_intervals <- jmvcore::OptionBool$new(
                "icer_confidence_intervals",
                icer_confidence_intervals,
                default=FALSE)
            private$..probabilisticAnalysis <- jmvcore::OptionBool$new(
                "probabilisticAnalysis",
                probabilisticAnalysis,
                default=FALSE)
            private$..psa_advanced_outputs <- jmvcore::OptionBool$new(
                "psa_advanced_outputs",
                psa_advanced_outputs,
                default=FALSE)
            private$..numSimulations <- jmvcore::OptionInteger$new(
                "numSimulations",
                numSimulations,
                default=1000,
                min=100,
                max=10000)
            private$..markovAdvanced <- jmvcore::OptionBool$new(
                "markovAdvanced",
                markovAdvanced,
                default=FALSE)
            private$..tunnelStates <- jmvcore::OptionVariables$new(
                "tunnelStates",
                tunnelStates,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..timeVaryingTransitions <- jmvcore::OptionBool$new(
                "timeVaryingTransitions",
                timeVaryingTransitions,
                default=FALSE)
            private$..ageSpecificTransitions <- jmvcore::OptionVariables$new(
                "ageSpecificTransitions",
                ageSpecificTransitions,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..chanceNodeMethod <- jmvcore::OptionList$new(
                "chanceNodeMethod",
                chanceNodeMethod,
                options=list(
                    "simple",
                    "conditional",
                    "bayesian"),
                default="simple")
            private$..riskAdjustment <- jmvcore::OptionBool$new(
                "riskAdjustment",
                riskAdjustment,
                default=FALSE)
            private$..cycleCorrection <- jmvcore::OptionBool$new(
                "cycleCorrection",
                cycleCorrection,
                default=TRUE)
            private$..cohortTrace <- jmvcore::OptionBool$new(
                "cohortTrace",
                cohortTrace,
                default=FALSE)
            private$..cohortSize <- jmvcore::OptionInteger$new(
                "cohortSize",
                cohortSize,
                default=1000,
                min=100,
                max=1000000)
            private$..valueOfInformation <- jmvcore::OptionBool$new(
                "valueOfInformation",
                valueOfInformation,
                default=FALSE)
            private$..evpi_parameters <- jmvcore::OptionVariables$new(
                "evpi_parameters",
                evpi_parameters,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..budgetImpactAnalysis <- jmvcore::OptionBool$new(
                "budgetImpactAnalysis",
                budgetImpactAnalysis,
                default=FALSE)
            private$..targetPopulationSize <- jmvcore::OptionInteger$new(
                "targetPopulationSize",
                targetPopulationSize,
                default=10000,
                min=1000,
                max=10000000)
            private$..marketPenetration <- jmvcore::OptionNumber$new(
                "marketPenetration",
                marketPenetration,
                default=0.5,
                min=0,
                max=1)
            private$..ceacThresholds <- jmvcore::OptionString$new(
                "ceacThresholds",
                ceacThresholds,
                default="0,100000,5000")
            private$..psa_distributions <- jmvcore::OptionList$new(
                "psa_distributions",
                psa_distributions,
                options=list(
                    "normal",
                    "lognormal",
                    "beta",
                    "gamma",
                    "dirichlet"),
                default="normal")
            private$..correlatedParameters <- jmvcore::OptionBool$new(
                "correlatedParameters",
                correlatedParameters,
                default=FALSE)
            private$..correlationMatrix <- jmvcore::OptionVariables$new(
                "correlationMatrix",
                correlationMatrix,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))

            self$.addOption(private$..treeType)
            self$.addOption(private$..decisions)
            self$.addOption(private$..healthStates)
            self$.addOption(private$..transitionProbs)
            self$.addOption(private$..cycleLength)
            self$.addOption(private$..probabilities)
            self$.addOption(private$..costs)
            self$.addOption(private$..utilities)
            self$.addOption(private$..outcomes)
            self$.addOption(private$..layout)
            self$.addOption(private$..nodeShapes)
            self$.addOption(private$..showProbabilities)
            self$.addOption(private$..showCosts)
            self$.addOption(private$..showUtilities)
            self$.addOption(private$..calculateExpectedValues)
            self$.addOption(private$..calculateNMB)
            self$.addOption(private$..willingnessToPay)
            self$.addOption(private$..sensitivityAnalysis)
            self$.addOption(private$..discountRate)
            self$.addOption(private$..timeHorizon)
            self$.addOption(private$..nodeLabels)
            self$.addOption(private$..branchLabels)
            self$.addOption(private$..colorScheme)
            self$.addOption(private$..summaryTable)
            self$.addOption(private$..tornado)
            self$.addOption(private$..decisionComparison)
            self$.addOption(private$..incrementalAnalysis)
            self$.addOption(private$..dominanceAnalysis)
            self$.addOption(private$..icer_confidence_intervals)
            self$.addOption(private$..probabilisticAnalysis)
            self$.addOption(private$..psa_advanced_outputs)
            self$.addOption(private$..numSimulations)
            self$.addOption(private$..markovAdvanced)
            self$.addOption(private$..tunnelStates)
            self$.addOption(private$..timeVaryingTransitions)
            self$.addOption(private$..ageSpecificTransitions)
            self$.addOption(private$..chanceNodeMethod)
            self$.addOption(private$..riskAdjustment)
            self$.addOption(private$..cycleCorrection)
            self$.addOption(private$..cohortTrace)
            self$.addOption(private$..cohortSize)
            self$.addOption(private$..valueOfInformation)
            self$.addOption(private$..evpi_parameters)
            self$.addOption(private$..budgetImpactAnalysis)
            self$.addOption(private$..targetPopulationSize)
            self$.addOption(private$..marketPenetration)
            self$.addOption(private$..ceacThresholds)
            self$.addOption(private$..psa_distributions)
            self$.addOption(private$..correlatedParameters)
            self$.addOption(private$..correlationMatrix)
        }),
    active = list(
        treeType = function() private$..treeType$value,
        decisions = function() private$..decisions$value,
        healthStates = function() private$..healthStates$value,
        transitionProbs = function() private$..transitionProbs$value,
        cycleLength = function() private$..cycleLength$value,
        probabilities = function() private$..probabilities$value,
        costs = function() private$..costs$value,
        utilities = function() private$..utilities$value,
        outcomes = function() private$..outcomes$value,
        layout = function() private$..layout$value,
        nodeShapes = function() private$..nodeShapes$value,
        showProbabilities = function() private$..showProbabilities$value,
        showCosts = function() private$..showCosts$value,
        showUtilities = function() private$..showUtilities$value,
        calculateExpectedValues = function() private$..calculateExpectedValues$value,
        calculateNMB = function() private$..calculateNMB$value,
        willingnessToPay = function() private$..willingnessToPay$value,
        sensitivityAnalysis = function() private$..sensitivityAnalysis$value,
        discountRate = function() private$..discountRate$value,
        timeHorizon = function() private$..timeHorizon$value,
        nodeLabels = function() private$..nodeLabels$value,
        branchLabels = function() private$..branchLabels$value,
        colorScheme = function() private$..colorScheme$value,
        summaryTable = function() private$..summaryTable$value,
        tornado = function() private$..tornado$value,
        decisionComparison = function() private$..decisionComparison$value,
        incrementalAnalysis = function() private$..incrementalAnalysis$value,
        dominanceAnalysis = function() private$..dominanceAnalysis$value,
        icer_confidence_intervals = function() private$..icer_confidence_intervals$value,
        probabilisticAnalysis = function() private$..probabilisticAnalysis$value,
        psa_advanced_outputs = function() private$..psa_advanced_outputs$value,
        numSimulations = function() private$..numSimulations$value,
        markovAdvanced = function() private$..markovAdvanced$value,
        tunnelStates = function() private$..tunnelStates$value,
        timeVaryingTransitions = function() private$..timeVaryingTransitions$value,
        ageSpecificTransitions = function() private$..ageSpecificTransitions$value,
        chanceNodeMethod = function() private$..chanceNodeMethod$value,
        riskAdjustment = function() private$..riskAdjustment$value,
        cycleCorrection = function() private$..cycleCorrection$value,
        cohortTrace = function() private$..cohortTrace$value,
        cohortSize = function() private$..cohortSize$value,
        valueOfInformation = function() private$..valueOfInformation$value,
        evpi_parameters = function() private$..evpi_parameters$value,
        budgetImpactAnalysis = function() private$..budgetImpactAnalysis$value,
        targetPopulationSize = function() private$..targetPopulationSize$value,
        marketPenetration = function() private$..marketPenetration$value,
        ceacThresholds = function() private$..ceacThresholds$value,
        psa_distributions = function() private$..psa_distributions$value,
        correlatedParameters = function() private$..correlatedParameters$value,
        correlationMatrix = function() private$..correlationMatrix$value),
    private = list(
        ..treeType = NA,
        ..decisions = NA,
        ..healthStates = NA,
        ..transitionProbs = NA,
        ..cycleLength = NA,
        ..probabilities = NA,
        ..costs = NA,
        ..utilities = NA,
        ..outcomes = NA,
        ..layout = NA,
        ..nodeShapes = NA,
        ..showProbabilities = NA,
        ..showCosts = NA,
        ..showUtilities = NA,
        ..calculateExpectedValues = NA,
        ..calculateNMB = NA,
        ..willingnessToPay = NA,
        ..sensitivityAnalysis = NA,
        ..discountRate = NA,
        ..timeHorizon = NA,
        ..nodeLabels = NA,
        ..branchLabels = NA,
        ..colorScheme = NA,
        ..summaryTable = NA,
        ..tornado = NA,
        ..decisionComparison = NA,
        ..incrementalAnalysis = NA,
        ..dominanceAnalysis = NA,
        ..icer_confidence_intervals = NA,
        ..probabilisticAnalysis = NA,
        ..psa_advanced_outputs = NA,
        ..numSimulations = NA,
        ..markovAdvanced = NA,
        ..tunnelStates = NA,
        ..timeVaryingTransitions = NA,
        ..ageSpecificTransitions = NA,
        ..chanceNodeMethod = NA,
        ..riskAdjustment = NA,
        ..cycleCorrection = NA,
        ..cohortTrace = NA,
        ..cohortSize = NA,
        ..valueOfInformation = NA,
        ..evpi_parameters = NA,
        ..budgetImpactAnalysis = NA,
        ..targetPopulationSize = NA,
        ..marketPenetration = NA,
        ..ceacThresholds = NA,
        ..psa_distributions = NA,
        ..correlatedParameters = NA,
        ..correlationMatrix = NA)
)

decisiongraphResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "decisiongraphResults",
    inherit = jmvcore::Group,
    active = list(
        treeplot = function() private$.items[["treeplot"]],
        summaryTable = function() private$.items[["summaryTable"]],
        nodeTable = function() private$.items[["nodeTable"]],
        tornadoplot = function() private$.items[["tornadoplot"]],
        sensitivityTable = function() private$.items[["sensitivityTable"]],
        text1 = function() private$.items[["text1"]],
        text2 = function() private$.items[["text2"]],
        markovTable = function() private$.items[["markovTable"]],
        markovCohortTable = function() private$.items[["markovCohortTable"]],
        markovPlot = function() private$.items[["markovPlot"]],
        decisionComparisonTable = function() private$.items[["decisionComparisonTable"]],
        nmbAnalysis = function() private$.items[["nmbAnalysis"]],
        icerTable = function() private$.items[["icerTable"]],
        psaResults = function() private$.items[["psaResults"]],
        ceacPlot = function() private$.items[["ceacPlot"]],
        scatterPlot = function() private$.items[["scatterPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Decision Tree Graph")
            self$add(jmvcore::Image$new(
                options=options,
                name="treeplot",
                title="Decision Tree",
                width=700,
                height=500,
                renderFun=".treeplot"))
            self$add(jmvcore::Table$new(
                options=options,
                name="summaryTable",
                title="Expected Values Summary",
                visible="(summaryTable)",
                rows=0,
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="expectedCost", 
                        `title`="Expected Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="expectedUtility", 
                        `title`="Expected Utility", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="icer", 
                        `title`="ICER", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="netBenefit", 
                        `title`="Net Benefit", 
                        `type`="number", 
                        `format`="currency"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="nodeTable",
                title="Node Details",
                rows=0,
                columns=list(
                    list(
                        `name`="nodeId", 
                        `title`="Node ID", 
                        `type`="text"),
                    list(
                        `name`="nodeType", 
                        `title`="Type", 
                        `type`="text"),
                    list(
                        `name`="nodeLabel", 
                        `title`="Label", 
                        `type`="text"),
                    list(
                        `name`="probability", 
                        `title`="Probability", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="cost", 
                        `title`="Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="utility", 
                        `title`="Utility", 
                        `type`="number", 
                        `format`="zto3"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="tornadoplot",
                title="Tornado Diagram",
                width=600,
                height=400,
                renderFun=".tornadoplot",
                visible="(tornado)"))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityTable",
                title="Sensitivity Analysis",
                visible="(sensitivityAnalysis)",
                rows=0,
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="baseValue", 
                        `title`="Base Value", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="lowValue", 
                        `title`="Low Value", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="highValue", 
                        `title`="High Value", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="lowResult", 
                        `title`="Low Result", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="highResult", 
                        `title`="High Result", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="range", 
                        `title`="Range", 
                        `type`="number", 
                        `format`="currency"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="text1",
                title="Tree Structure",
                visible=FALSE))
            self$add(jmvcore::Html$new(
                options=options,
                name="text2",
                title="Calculations",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="markovTable",
                title="Markov Transition Matrix",
                visible="(treeType:markov)",
                rows=0,
                columns=list(
                    list(
                        `name`="fromState", 
                        `title`="From State", 
                        `type`="text"),
                    list(
                        `name`="toState", 
                        `title`="To State", 
                        `type`="text"),
                    list(
                        `name`="transitionProb", 
                        `title`="Transition Probability", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="annualCost", 
                        `title`="Annual Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="annualUtility", 
                        `title`="Annual Utility", 
                        `type`="number", 
                        `format`="zto3"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="markovCohortTable",
                title="Markov Cohort Analysis",
                visible="(treeType:markov)",
                rows=0,
                columns=list(
                    list(
                        `name`="cycle", 
                        `title`="Cycle", 
                        `type`="integer"),
                    list(
                        `name`="healthyProp", 
                        `title`="Healthy %", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="sickProp", 
                        `title`="Sick %", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="deadProp", 
                        `title`="Dead %", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="cumulativeCost", 
                        `title`="Cumulative Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="cumulativeUtility", 
                        `title`="Cumulative Utility", 
                        `type`="number", 
                        `format`="zto3"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="markovPlot",
                title="Markov State Transitions",
                width=600,
                height=400,
                renderFun=".markovPlot",
                visible="(treeType:markov)"))
            self$add(jmvcore::Table$new(
                options=options,
                name="decisionComparisonTable",
                title="Decision Comparison",
                visible="(decisionComparison)",
                rows=0,
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="expectedCost", 
                        `title`="Expected Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="expectedUtility", 
                        `title`="Expected Utility", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="nmb", 
                        `title`="Net Monetary Benefit", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="icer", 
                        `title`="ICER", 
                        `type`="number", 
                        `format`="sf3"),
                    list(
                        `name`="rank", 
                        `title`="Rank", 
                        `type`="integer"),
                    list(
                        `name`="status", 
                        `title`="Dominance Status", 
                        `type`="text"),
                    list(
                        `name`="optimal", 
                        `title`="Optimal", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="nmbAnalysis",
                title="Net Monetary Benefit Analysis",
                visible="(calculateNMB)"))
            self$add(jmvcore::Table$new(
                options=options,
                name="icerTable",
                title="Incremental Cost-Effectiveness Analysis",
                visible="(incrementalAnalysis)",
                rows=0,
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="cost", 
                        `title`="Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="utility", 
                        `title`="Utility", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="incrementalCost", 
                        `title`="Incremental Cost", 
                        `type`="number", 
                        `format`="currency"),
                    list(
                        `name`="incrementalUtility", 
                        `title`="Incremental Utility", 
                        `type`="number", 
                        `format`="zto3"),
                    list(
                        `name`="icer", 
                        `title`="ICER", 
                        `type`="number", 
                        `format`="sf3"),
                    list(
                        `name`="dominated", 
                        `title`="Dominated", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="psaResults",
                title="Probabilistic Sensitivity Analysis",
                visible="(probabilisticAnalysis)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="ceacPlot",
                title="Cost-Effectiveness Acceptability Curve",
                width=600,
                height=400,
                renderFun=".ceacPlot",
                visible="(probabilisticAnalysis)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="scatterPlot",
                title="Cost-Effectiveness Scatter Plot",
                width=600,
                height=400,
                renderFun=".scatterPlot",
                visible="(probabilisticAnalysis)"))}))

decisiongraphBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "decisiongraphBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "decisiongraph",
                version = c(0,0,3),
                options = options,
                results = decisiongraphResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Decision Tree Graph
#'
#' Creates decision tree graphs for cost-effectiveness analysis with typical 
#' decision nodes, chance nodes, and terminal nodes. Supports visualization of 
#' treatment pathways, probabilities, costs, and outcomes.
#' 
#'
#' @examples
#' \donttest{
#' # example will be added
#'}
#' @param data The data as a data frame containing decision tree parameters.
#' @param treeType Type of decision tree to create.
#' @param decisions Variables representing decision nodes (treatment options).
#' @param healthStates Variables defining health states for Markov model.
#' @param transitionProbs Variables containing transition probabilities
#'   between health states.
#' @param cycleLength Length of each Markov cycle in years.
#' @param probabilities Variables containing probability values for chance
#'   nodes.
#' @param costs Variables containing cost values for terminal nodes.
#' @param utilities Variables containing utility/effectiveness values.
#' @param outcomes Variables representing clinical outcomes.
#' @param layout Layout orientation for the decision tree.
#' @param nodeShapes Use different shapes for different node types.
#' @param showProbabilities Display probability values on tree branches.
#' @param showCosts Display cost values at terminal nodes.
#' @param showUtilities Display utility/effectiveness values.
#' @param calculateExpectedValues Calculate and display expected costs and
#'   utilities.
#' @param calculateNMB Calculate net monetary benefit (NMB) for decision paths
#'   using threshold analysis.
#' @param willingnessToPay Willingness to pay threshold (cost per QALY) for
#'   NMB calculations.
#' @param sensitivityAnalysis Perform one-way sensitivity analysis on key
#'   parameters.
#' @param discountRate Annual discount rate for future costs and benefits.
#' @param timeHorizon Time horizon for the analysis in years.
#' @param nodeLabels Display descriptive labels for nodes.
#' @param branchLabels Display labels on tree branches.
#' @param colorScheme Color scheme for the decision tree visualization.
#' @param summaryTable Show summary table with expected values and
#'   cost-effectiveness ratios.
#' @param tornado Create tornado diagram for sensitivity analysis.
#' @param decisionComparison Show comparison table with NMB scores for all
#'   decision paths.
#' @param incrementalAnalysis Perform incremental cost-effectiveness ratio
#'   (ICER) calculations.
#' @param dominanceAnalysis Identify dominated and extendedly dominated
#'   strategies in ICER analysis.
#' @param icer_confidence_intervals Calculate confidence intervals for ICERs
#'   using bootstrap or PSA results.
#' @param probabilisticAnalysis Perform probabilistic sensitivity analysis
#'   using Monte Carlo simulation.
#' @param psa_advanced_outputs Generate advanced PSA outputs (CEAC, EVPI, net
#'   benefit distributions).
#' @param numSimulations Number of Monte Carlo simulations for probabilistic
#'   analysis.
#' @param markovAdvanced Enable advanced Markov modeling features.
#' @param tunnelStates Define tunnel states for temporary health states.
#' @param timeVaryingTransitions Allow transition probabilities to change over
#'   time.
#' @param ageSpecificTransitions Variables defining age-specific transition
#'   rates.
#' @param chanceNodeMethod Method for calculating probabilities at chance
#'   nodes.
#' @param riskAdjustment Apply risk adjustment to probabilities based on
#'   patient characteristics.
#' @param cycleCorrection Apply half-cycle correction for more accurate
#'   discounting in Markov models.
#' @param cohortTrace Generate cohort trace showing population distribution
#'   across health states over time.
#' @param cohortSize Size of hypothetical cohort for trace analysis and budget
#'   impact modeling.
#' @param valueOfInformation Perform Expected Value of Perfect Information
#'   (EVPI) and partial EVPI analysis.
#' @param evpi_parameters Parameters for partial EVPI analysis.
#' @param budgetImpactAnalysis Perform budget impact analysis comparing total
#'   costs of alternative strategies.
#' @param targetPopulationSize Size of target population for budget impact
#'   calculations.
#' @param marketPenetration Expected market penetration rate for new
#'   intervention.
#' @param ceacThresholds Cost-effectiveness acceptability curve thresholds
#'   (min,max,step).
#' @param psa_distributions Default probability distribution for uncertain
#'   parameters in PSA.
#' @param correlatedParameters Account for correlations between uncertain
#'   parameters in PSA.
#' @param correlationMatrix Variables defining correlation structure between
#'   uncertain parameters.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$treeplot} \tab \tab \tab \tab \tab Decision tree visualization with nodes and branches \cr
#'   \code{results$summaryTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$nodeTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$tornadoplot} \tab \tab \tab \tab \tab Sensitivity analysis tornado diagram \cr
#'   \code{results$sensitivityTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$text1} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$text2} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$markovTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$markovCohortTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$markovPlot} \tab \tab \tab \tab \tab Markov state transition diagram \cr
#'   \code{results$decisionComparisonTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$nmbAnalysis} \tab \tab \tab \tab \tab Net monetary benefit calculation details \cr
#'   \code{results$icerTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$psaResults} \tab \tab \tab \tab \tab Monte Carlo simulation results \cr
#'   \code{results$ceacPlot} \tab \tab \tab \tab \tab CEAC showing probability of cost-effectiveness \cr
#'   \code{results$scatterPlot} \tab \tab \tab \tab \tab Cost-effectiveness plane scatter plot \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$summaryTable$asDF}
#'
#' \code{as.data.frame(results$summaryTable)}
#'
#' @export
decisiongraph <- function(
    data,
    treeType = "costeffectiveness",
    decisions,
    healthStates,
    transitionProbs,
    cycleLength = 1,
    probabilities,
    costs,
    utilities,
    outcomes,
    layout = "horizontal",
    nodeShapes = TRUE,
    showProbabilities = TRUE,
    showCosts = TRUE,
    showUtilities = TRUE,
    calculateExpectedValues = TRUE,
    calculateNMB = TRUE,
    willingnessToPay = 50000,
    sensitivityAnalysis = FALSE,
    discountRate = 0.03,
    timeHorizon = 10,
    nodeLabels = TRUE,
    branchLabels = TRUE,
    colorScheme = "medical",
    summaryTable = TRUE,
    tornado = FALSE,
    decisionComparison = TRUE,
    incrementalAnalysis = TRUE,
    dominanceAnalysis = TRUE,
    icer_confidence_intervals = FALSE,
    probabilisticAnalysis = FALSE,
    psa_advanced_outputs = FALSE,
    numSimulations = 1000,
    markovAdvanced = FALSE,
    tunnelStates,
    timeVaryingTransitions = FALSE,
    ageSpecificTransitions,
    chanceNodeMethod = "simple",
    riskAdjustment = FALSE,
    cycleCorrection = TRUE,
    cohortTrace = FALSE,
    cohortSize = 1000,
    valueOfInformation = FALSE,
    evpi_parameters,
    budgetImpactAnalysis = FALSE,
    targetPopulationSize = 10000,
    marketPenetration = 0.5,
    ceacThresholds = "0,100000,5000",
    psa_distributions = "normal",
    correlatedParameters = FALSE,
    correlationMatrix) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("decisiongraph requires jmvcore to be installed (restart may be required)")

    if ( ! missing(decisions)) decisions <- jmvcore::resolveQuo(jmvcore::enquo(decisions))
    if ( ! missing(healthStates)) healthStates <- jmvcore::resolveQuo(jmvcore::enquo(healthStates))
    if ( ! missing(transitionProbs)) transitionProbs <- jmvcore::resolveQuo(jmvcore::enquo(transitionProbs))
    if ( ! missing(probabilities)) probabilities <- jmvcore::resolveQuo(jmvcore::enquo(probabilities))
    if ( ! missing(costs)) costs <- jmvcore::resolveQuo(jmvcore::enquo(costs))
    if ( ! missing(utilities)) utilities <- jmvcore::resolveQuo(jmvcore::enquo(utilities))
    if ( ! missing(outcomes)) outcomes <- jmvcore::resolveQuo(jmvcore::enquo(outcomes))
    if ( ! missing(tunnelStates)) tunnelStates <- jmvcore::resolveQuo(jmvcore::enquo(tunnelStates))
    if ( ! missing(ageSpecificTransitions)) ageSpecificTransitions <- jmvcore::resolveQuo(jmvcore::enquo(ageSpecificTransitions))
    if ( ! missing(evpi_parameters)) evpi_parameters <- jmvcore::resolveQuo(jmvcore::enquo(evpi_parameters))
    if ( ! missing(correlationMatrix)) correlationMatrix <- jmvcore::resolveQuo(jmvcore::enquo(correlationMatrix))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(decisions), decisions, NULL),
            `if`( ! missing(healthStates), healthStates, NULL),
            `if`( ! missing(transitionProbs), transitionProbs, NULL),
            `if`( ! missing(probabilities), probabilities, NULL),
            `if`( ! missing(costs), costs, NULL),
            `if`( ! missing(utilities), utilities, NULL),
            `if`( ! missing(outcomes), outcomes, NULL),
            `if`( ! missing(tunnelStates), tunnelStates, NULL),
            `if`( ! missing(ageSpecificTransitions), ageSpecificTransitions, NULL),
            `if`( ! missing(evpi_parameters), evpi_parameters, NULL),
            `if`( ! missing(correlationMatrix), correlationMatrix, NULL))

    for (v in decisions) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in healthStates) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in outcomes) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in tunnelStates) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- decisiongraphOptions$new(
        treeType = treeType,
        decisions = decisions,
        healthStates = healthStates,
        transitionProbs = transitionProbs,
        cycleLength = cycleLength,
        probabilities = probabilities,
        costs = costs,
        utilities = utilities,
        outcomes = outcomes,
        layout = layout,
        nodeShapes = nodeShapes,
        showProbabilities = showProbabilities,
        showCosts = showCosts,
        showUtilities = showUtilities,
        calculateExpectedValues = calculateExpectedValues,
        calculateNMB = calculateNMB,
        willingnessToPay = willingnessToPay,
        sensitivityAnalysis = sensitivityAnalysis,
        discountRate = discountRate,
        timeHorizon = timeHorizon,
        nodeLabels = nodeLabels,
        branchLabels = branchLabels,
        colorScheme = colorScheme,
        summaryTable = summaryTable,
        tornado = tornado,
        decisionComparison = decisionComparison,
        incrementalAnalysis = incrementalAnalysis,
        dominanceAnalysis = dominanceAnalysis,
        icer_confidence_intervals = icer_confidence_intervals,
        probabilisticAnalysis = probabilisticAnalysis,
        psa_advanced_outputs = psa_advanced_outputs,
        numSimulations = numSimulations,
        markovAdvanced = markovAdvanced,
        tunnelStates = tunnelStates,
        timeVaryingTransitions = timeVaryingTransitions,
        ageSpecificTransitions = ageSpecificTransitions,
        chanceNodeMethod = chanceNodeMethod,
        riskAdjustment = riskAdjustment,
        cycleCorrection = cycleCorrection,
        cohortTrace = cohortTrace,
        cohortSize = cohortSize,
        valueOfInformation = valueOfInformation,
        evpi_parameters = evpi_parameters,
        budgetImpactAnalysis = budgetImpactAnalysis,
        targetPopulationSize = targetPopulationSize,
        marketPenetration = marketPenetration,
        ceacThresholds = ceacThresholds,
        psa_distributions = psa_distributions,
        correlatedParameters = correlatedParameters,
        correlationMatrix = correlationMatrix)

    analysis <- decisiongraphClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

