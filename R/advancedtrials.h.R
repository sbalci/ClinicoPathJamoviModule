
# This file is automatically generated, you probably don't want to edit this

advancedtrialsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedtrialsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_var = NULL,
            event_var = NULL,
            treatment_var = NULL,
            biomarker_var = NULL,
            interim_time_var = NULL,
            stratification_vars = NULL,
            design_type = "group_sequential",
            primary_endpoint = "overall_survival",
            statistical_test = "log_rank",
            alpha_spending = "obrien_fleming",
            beta_spending = "obrien_fleming",
            number_of_looks = 3,
            information_fractions = "0.5,0.75,1.0",
            efficacy_boundaries = "auto",
            adaptation_type = "sample_size_reestimation",
            adaptation_timing = 50,
            conditional_power_threshold = 0.3,
            ni_margin = 1.25,
            ni_margin_type = "hazard_ratio",
            overall_alpha = 0.025,
            overall_power = 0.8,
            expected_hr = 0.75,
            accrual_rate = 25,
            dropout_rate = 0.05,
            number_of_arms = 2,
            control_arm_sharing = TRUE,
            interim_arm_addition = FALSE,
            interim_arm_dropping = FALSE,
            biomarker_strategy = "all_comers",
            biomarker_prevalence = 0.3,
            futility_analysis = TRUE,
            stochastic_curtailment = FALSE,
            predictive_power_threshold = 0.1,
            interim_monitoring_plan = TRUE,
            operating_characteristics = TRUE,
            boundary_plots = TRUE,
            conditional_power_analysis = FALSE,
            predictive_power_analysis = FALSE,
            bias_adjustment = FALSE,
            multiplicity_adjustment = FALSE,
            simulation_runs = 10000,
            seed_value = 12345, ...) {

            super$initialize(
                package="ClinicoPath",
                name="advancedtrials",
                requiresData=TRUE,
                ...)

            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event_var <- jmvcore::OptionVariable$new(
                "event_var",
                event_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..treatment_var <- jmvcore::OptionVariable$new(
                "treatment_var",
                treatment_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..biomarker_var <- jmvcore::OptionVariable$new(
                "biomarker_var",
                biomarker_var,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..interim_time_var <- jmvcore::OptionVariable$new(
                "interim_time_var",
                interim_time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..stratification_vars <- jmvcore::OptionVariables$new(
                "stratification_vars",
                stratification_vars,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..design_type <- jmvcore::OptionList$new(
                "design_type",
                design_type,
                options=list(
                    "group_sequential",
                    "adaptive_design",
                    "seamless_phase23",
                    "platform_trial",
                    "basket_trial",
                    "umbrella_trial",
                    "master_protocol",
                    "biomarker_driven"),
                default="group_sequential")
            private$..primary_endpoint <- jmvcore::OptionList$new(
                "primary_endpoint",
                primary_endpoint,
                options=list(
                    "overall_survival",
                    "progression_free_survival",
                    "disease_free_survival",
                    "objective_response_rate",
                    "pathologic_complete_response",
                    "event_free_survival"),
                default="overall_survival")
            private$..statistical_test <- jmvcore::OptionList$new(
                "statistical_test",
                statistical_test,
                options=list(
                    "log_rank",
                    "weighted_log_rank",
                    "maxcombo",
                    "fleming_harrington",
                    "cox_regression",
                    "rmst_test"),
                default="log_rank")
            private$..alpha_spending <- jmvcore::OptionList$new(
                "alpha_spending",
                alpha_spending,
                options=list(
                    "obrien_fleming",
                    "pocock",
                    "lan_demets",
                    "hwang_shih_decani",
                    "gamma_family"),
                default="obrien_fleming")
            private$..beta_spending <- jmvcore::OptionList$new(
                "beta_spending",
                beta_spending,
                options=list(
                    "obrien_fleming",
                    "pocock",
                    "symmetric",
                    "none"),
                default="obrien_fleming")
            private$..number_of_looks <- jmvcore::OptionNumber$new(
                "number_of_looks",
                number_of_looks,
                default=3,
                min=1,
                max=10)
            private$..information_fractions <- jmvcore::OptionString$new(
                "information_fractions",
                information_fractions,
                default="0.5,0.75,1.0")
            private$..efficacy_boundaries <- jmvcore::OptionString$new(
                "efficacy_boundaries",
                efficacy_boundaries,
                default="auto")
            private$..adaptation_type <- jmvcore::OptionList$new(
                "adaptation_type",
                adaptation_type,
                options=list(
                    "sample_size_reestimation",
                    "population_enrichment",
                    "treatment_selection",
                    "dose_escalation",
                    "endpoint_selection",
                    "biomarker_cutoff"),
                default="sample_size_reestimation")
            private$..adaptation_timing <- jmvcore::OptionNumber$new(
                "adaptation_timing",
                adaptation_timing,
                default=50,
                min=10,
                max=90)
            private$..conditional_power_threshold <- jmvcore::OptionNumber$new(
                "conditional_power_threshold",
                conditional_power_threshold,
                default=0.3,
                min=0.1,
                max=0.8)
            private$..ni_margin <- jmvcore::OptionNumber$new(
                "ni_margin",
                ni_margin,
                default=1.25,
                min=1,
                max=2)
            private$..ni_margin_type <- jmvcore::OptionList$new(
                "ni_margin_type",
                ni_margin_type,
                options=list(
                    "hazard_ratio",
                    "risk_difference",
                    "survival_difference"),
                default="hazard_ratio")
            private$..overall_alpha <- jmvcore::OptionNumber$new(
                "overall_alpha",
                overall_alpha,
                default=0.025,
                min=0.005,
                max=0.05)
            private$..overall_power <- jmvcore::OptionNumber$new(
                "overall_power",
                overall_power,
                default=0.8,
                min=0.7,
                max=0.95)
            private$..expected_hr <- jmvcore::OptionNumber$new(
                "expected_hr",
                expected_hr,
                default=0.75,
                min=0.1,
                max=2)
            private$..accrual_rate <- jmvcore::OptionNumber$new(
                "accrual_rate",
                accrual_rate,
                default=25,
                min=1,
                max=1000)
            private$..dropout_rate <- jmvcore::OptionNumber$new(
                "dropout_rate",
                dropout_rate,
                default=0.05,
                min=0,
                max=0.5)
            private$..number_of_arms <- jmvcore::OptionNumber$new(
                "number_of_arms",
                number_of_arms,
                default=2,
                min=2,
                max=10)
            private$..control_arm_sharing <- jmvcore::OptionBool$new(
                "control_arm_sharing",
                control_arm_sharing,
                default=TRUE)
            private$..interim_arm_addition <- jmvcore::OptionBool$new(
                "interim_arm_addition",
                interim_arm_addition,
                default=FALSE)
            private$..interim_arm_dropping <- jmvcore::OptionBool$new(
                "interim_arm_dropping",
                interim_arm_dropping,
                default=FALSE)
            private$..biomarker_strategy <- jmvcore::OptionList$new(
                "biomarker_strategy",
                biomarker_strategy,
                options=list(
                    "all_comers",
                    "enrichment",
                    "stratified",
                    "adaptive_enrichment"),
                default="all_comers")
            private$..biomarker_prevalence <- jmvcore::OptionNumber$new(
                "biomarker_prevalence",
                biomarker_prevalence,
                default=0.3,
                min=0.05,
                max=0.95)
            private$..futility_analysis <- jmvcore::OptionBool$new(
                "futility_analysis",
                futility_analysis,
                default=TRUE)
            private$..stochastic_curtailment <- jmvcore::OptionBool$new(
                "stochastic_curtailment",
                stochastic_curtailment,
                default=FALSE)
            private$..predictive_power_threshold <- jmvcore::OptionNumber$new(
                "predictive_power_threshold",
                predictive_power_threshold,
                default=0.1,
                min=0.05,
                max=0.3)
            private$..interim_monitoring_plan <- jmvcore::OptionBool$new(
                "interim_monitoring_plan",
                interim_monitoring_plan,
                default=TRUE)
            private$..operating_characteristics <- jmvcore::OptionBool$new(
                "operating_characteristics",
                operating_characteristics,
                default=TRUE)
            private$..boundary_plots <- jmvcore::OptionBool$new(
                "boundary_plots",
                boundary_plots,
                default=TRUE)
            private$..conditional_power_analysis <- jmvcore::OptionBool$new(
                "conditional_power_analysis",
                conditional_power_analysis,
                default=FALSE)
            private$..predictive_power_analysis <- jmvcore::OptionBool$new(
                "predictive_power_analysis",
                predictive_power_analysis,
                default=FALSE)
            private$..bias_adjustment <- jmvcore::OptionBool$new(
                "bias_adjustment",
                bias_adjustment,
                default=FALSE)
            private$..multiplicity_adjustment <- jmvcore::OptionBool$new(
                "multiplicity_adjustment",
                multiplicity_adjustment,
                default=FALSE)
            private$..simulation_runs <- jmvcore::OptionNumber$new(
                "simulation_runs",
                simulation_runs,
                default=10000,
                min=1000,
                max=100000)
            private$..seed_value <- jmvcore::OptionNumber$new(
                "seed_value",
                seed_value,
                default=12345,
                min=1,
                max=999999)

            self$.addOption(private$..time_var)
            self$.addOption(private$..event_var)
            self$.addOption(private$..treatment_var)
            self$.addOption(private$..biomarker_var)
            self$.addOption(private$..interim_time_var)
            self$.addOption(private$..stratification_vars)
            self$.addOption(private$..design_type)
            self$.addOption(private$..primary_endpoint)
            self$.addOption(private$..statistical_test)
            self$.addOption(private$..alpha_spending)
            self$.addOption(private$..beta_spending)
            self$.addOption(private$..number_of_looks)
            self$.addOption(private$..information_fractions)
            self$.addOption(private$..efficacy_boundaries)
            self$.addOption(private$..adaptation_type)
            self$.addOption(private$..adaptation_timing)
            self$.addOption(private$..conditional_power_threshold)
            self$.addOption(private$..ni_margin)
            self$.addOption(private$..ni_margin_type)
            self$.addOption(private$..overall_alpha)
            self$.addOption(private$..overall_power)
            self$.addOption(private$..expected_hr)
            self$.addOption(private$..accrual_rate)
            self$.addOption(private$..dropout_rate)
            self$.addOption(private$..number_of_arms)
            self$.addOption(private$..control_arm_sharing)
            self$.addOption(private$..interim_arm_addition)
            self$.addOption(private$..interim_arm_dropping)
            self$.addOption(private$..biomarker_strategy)
            self$.addOption(private$..biomarker_prevalence)
            self$.addOption(private$..futility_analysis)
            self$.addOption(private$..stochastic_curtailment)
            self$.addOption(private$..predictive_power_threshold)
            self$.addOption(private$..interim_monitoring_plan)
            self$.addOption(private$..operating_characteristics)
            self$.addOption(private$..boundary_plots)
            self$.addOption(private$..conditional_power_analysis)
            self$.addOption(private$..predictive_power_analysis)
            self$.addOption(private$..bias_adjustment)
            self$.addOption(private$..multiplicity_adjustment)
            self$.addOption(private$..simulation_runs)
            self$.addOption(private$..seed_value)
        }),
    active = list(
        time_var = function() private$..time_var$value,
        event_var = function() private$..event_var$value,
        treatment_var = function() private$..treatment_var$value,
        biomarker_var = function() private$..biomarker_var$value,
        interim_time_var = function() private$..interim_time_var$value,
        stratification_vars = function() private$..stratification_vars$value,
        design_type = function() private$..design_type$value,
        primary_endpoint = function() private$..primary_endpoint$value,
        statistical_test = function() private$..statistical_test$value,
        alpha_spending = function() private$..alpha_spending$value,
        beta_spending = function() private$..beta_spending$value,
        number_of_looks = function() private$..number_of_looks$value,
        information_fractions = function() private$..information_fractions$value,
        efficacy_boundaries = function() private$..efficacy_boundaries$value,
        adaptation_type = function() private$..adaptation_type$value,
        adaptation_timing = function() private$..adaptation_timing$value,
        conditional_power_threshold = function() private$..conditional_power_threshold$value,
        ni_margin = function() private$..ni_margin$value,
        ni_margin_type = function() private$..ni_margin_type$value,
        overall_alpha = function() private$..overall_alpha$value,
        overall_power = function() private$..overall_power$value,
        expected_hr = function() private$..expected_hr$value,
        accrual_rate = function() private$..accrual_rate$value,
        dropout_rate = function() private$..dropout_rate$value,
        number_of_arms = function() private$..number_of_arms$value,
        control_arm_sharing = function() private$..control_arm_sharing$value,
        interim_arm_addition = function() private$..interim_arm_addition$value,
        interim_arm_dropping = function() private$..interim_arm_dropping$value,
        biomarker_strategy = function() private$..biomarker_strategy$value,
        biomarker_prevalence = function() private$..biomarker_prevalence$value,
        futility_analysis = function() private$..futility_analysis$value,
        stochastic_curtailment = function() private$..stochastic_curtailment$value,
        predictive_power_threshold = function() private$..predictive_power_threshold$value,
        interim_monitoring_plan = function() private$..interim_monitoring_plan$value,
        operating_characteristics = function() private$..operating_characteristics$value,
        boundary_plots = function() private$..boundary_plots$value,
        conditional_power_analysis = function() private$..conditional_power_analysis$value,
        predictive_power_analysis = function() private$..predictive_power_analysis$value,
        bias_adjustment = function() private$..bias_adjustment$value,
        multiplicity_adjustment = function() private$..multiplicity_adjustment$value,
        simulation_runs = function() private$..simulation_runs$value,
        seed_value = function() private$..seed_value$value),
    private = list(
        ..time_var = NA,
        ..event_var = NA,
        ..treatment_var = NA,
        ..biomarker_var = NA,
        ..interim_time_var = NA,
        ..stratification_vars = NA,
        ..design_type = NA,
        ..primary_endpoint = NA,
        ..statistical_test = NA,
        ..alpha_spending = NA,
        ..beta_spending = NA,
        ..number_of_looks = NA,
        ..information_fractions = NA,
        ..efficacy_boundaries = NA,
        ..adaptation_type = NA,
        ..adaptation_timing = NA,
        ..conditional_power_threshold = NA,
        ..ni_margin = NA,
        ..ni_margin_type = NA,
        ..overall_alpha = NA,
        ..overall_power = NA,
        ..expected_hr = NA,
        ..accrual_rate = NA,
        ..dropout_rate = NA,
        ..number_of_arms = NA,
        ..control_arm_sharing = NA,
        ..interim_arm_addition = NA,
        ..interim_arm_dropping = NA,
        ..biomarker_strategy = NA,
        ..biomarker_prevalence = NA,
        ..futility_analysis = NA,
        ..stochastic_curtailment = NA,
        ..predictive_power_threshold = NA,
        ..interim_monitoring_plan = NA,
        ..operating_characteristics = NA,
        ..boundary_plots = NA,
        ..conditional_power_analysis = NA,
        ..predictive_power_analysis = NA,
        ..bias_adjustment = NA,
        ..multiplicity_adjustment = NA,
        ..simulation_runs = NA,
        ..seed_value = NA)
)

advancedtrialsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedtrialsResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        trial_design_summary = function() private$.items[["trial_design_summary"]],
        group_sequential_boundaries = function() private$.items[["group_sequential_boundaries"]],
        adaptive_design_parameters = function() private$.items[["adaptive_design_parameters"]],
        platform_trial_design = function() private$.items[["platform_trial_design"]],
        biomarker_strategy_results = function() private$.items[["biomarker_strategy_results"]],
        operating_characteristics = function() private$.items[["operating_characteristics"]],
        interim_monitoring_guidelines = function() private$.items[["interim_monitoring_guidelines"]],
        sample_size_calculations = function() private$.items[["sample_size_calculations"]],
        futility_analysis_results = function() private$.items[["futility_analysis_results"]],
        multiplicity_adjustment = function() private$.items[["multiplicity_adjustment"]],
        regulatory_compliance = function() private$.items[["regulatory_compliance"]],
        boundary_plot = function() private$.items[["boundary_plot"]],
        operating_characteristics_plot = function() private$.items[["operating_characteristics_plot"]],
        conditional_power_plot = function() private$.items[["conditional_power_plot"]],
        sample_size_sensitivity_plot = function() private$.items[["sample_size_sensitivity_plot"]],
        platform_trial_flowchart = function() private$.items[["platform_trial_flowchart"]],
        design_recommendations = function() private$.items[["design_recommendations"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Clinical Trial Methods",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "gsDesign"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="trial_design_summary",
                title="Trial Design Summary",
                rows=1,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="design_type", 
                        `title`="Design Type", 
                        `type`="text"),
                    list(
                        `name`="primary_endpoint", 
                        `title`="Primary Endpoint", 
                        `type`="text"),
                    list(
                        `name`="statistical_test", 
                        `title`="Statistical Test", 
                        `type`="text"),
                    list(
                        `name`="number_looks", 
                        `title`="Interim Looks", 
                        `type`="integer"),
                    list(
                        `name`="overall_alpha", 
                        `title`="Overall Alpha", 
                        `type`="number"),
                    list(
                        `name`="overall_power", 
                        `title`="Overall Power", 
                        `type`="number"),
                    list(
                        `name`="expected_effect", 
                        `title`="Expected Effect (HR)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="group_sequential_boundaries",
                title="Group Sequential Boundaries",
                rows=0,
                visible="(design_type:group_sequential)",
                columns=list(
                    list(
                        `name`="analysis_number", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="information_fraction", 
                        `title`="Information Fraction", 
                        `type`="number"),
                    list(
                        `name`="calendar_time", 
                        `title`="Calendar Time (months)", 
                        `type`="number"),
                    list(
                        `name`="cumulative_events", 
                        `title`="Cumulative Events", 
                        `type`="integer"),
                    list(
                        `name`="efficacy_boundary", 
                        `title`="Efficacy Boundary (Z)", 
                        `type`="number"),
                    list(
                        `name`="futility_boundary", 
                        `title`="Futility Boundary (Z)", 
                        `type`="number"),
                    list(
                        `name`="efficacy_p_value", 
                        `title`="Efficacy P-value", 
                        `type`="number"),
                    list(
                        `name`="conditional_power", 
                        `title`="Conditional Power", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="adaptive_design_parameters",
                title="Adaptive Design Parameters",
                rows=0,
                visible="(design_type:adaptive_design)",
                columns=list(
                    list(
                        `name`="adaptation_type", 
                        `title`="Adaptation Type", 
                        `type`="text"),
                    list(
                        `name`="adaptation_timing", 
                        `title`="Adaptation Timing", 
                        `type`="text"),
                    list(
                        `name`="decision_criterion", 
                        `title`="Decision Criterion", 
                        `type`="text"),
                    list(
                        `name`="pre_adaptation_sample_size", 
                        `title`="Pre-Adaptation N", 
                        `type`="integer"),
                    list(
                        `name`="post_adaptation_sample_size", 
                        `title`="Post-Adaptation N", 
                        `type`="integer"),
                    list(
                        `name`="alpha_adjustment", 
                        `title`="Alpha Adjustment", 
                        `type`="number"),
                    list(
                        `name`="power_adjustment", 
                        `title`="Power Adjustment", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="platform_trial_design",
                title="Platform Trial Design",
                rows=0,
                visible="(design_type:platform_trial)",
                columns=list(
                    list(
                        `name`="treatment_arm", 
                        `title`="Treatment Arm", 
                        `type`="text"),
                    list(
                        `name`="arm_status", 
                        `title`="Arm Status", 
                        `type`="text"),
                    list(
                        `name`="allocation_ratio", 
                        `title`="Allocation Ratio", 
                        `type`="number"),
                    list(
                        `name`="planned_sample_size", 
                        `title`="Planned N", 
                        `type`="integer"),
                    list(
                        `name`="interim_decision_rule", 
                        `title`="Interim Decision Rule", 
                        `type`="text"),
                    list(
                        `name`="graduation_threshold", 
                        `title`="Graduation Threshold", 
                        `type`="number"),
                    list(
                        `name`="futility_threshold", 
                        `title`="Futility Threshold", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="biomarker_strategy_results",
                title="Biomarker Strategy Results",
                rows=0,
                visible="(biomarker_strategy:!all_comers)",
                columns=list(
                    list(
                        `name`="population", 
                        `title`="Population", 
                        `type`="text"),
                    list(
                        `name`="biomarker_prevalence", 
                        `title`="Biomarker Prevalence (%)", 
                        `type`="number"),
                    list(
                        `name`="expected_hr", 
                        `title`="Expected HR", 
                        `type`="number"),
                    list(
                        `name`="sample_size", 
                        `title`="Sample Size", 
                        `type`="integer"),
                    list(
                        `name`="power", 
                        `title`="Power (%)", 
                        `type`="number"),
                    list(
                        `name`="analysis_strategy", 
                        `title`="Analysis Strategy", 
                        `type`="text"),
                    list(
                        `name`="decision_criterion", 
                        `title`="Decision Criterion", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="operating_characteristics",
                title="Operating Characteristics",
                rows=0,
                visible="(operating_characteristics)",
                columns=list(
                    list(
                        `name`="scenario", 
                        `title`="Scenario", 
                        `type`="text"),
                    list(
                        `name`="true_effect_size", 
                        `title`="True Effect (HR)", 
                        `type`="number"),
                    list(
                        `name`="power", 
                        `title`="Power (%)", 
                        `type`="number"),
                    list(
                        `name`="type1_error", 
                        `title`="Type I Error (%)", 
                        `type`="number"),
                    list(
                        `name`="expected_sample_size", 
                        `title`="Expected N", 
                        `type`="number"),
                    list(
                        `name`="expected_duration", 
                        `title`="Expected Duration (months)", 
                        `type`="number"),
                    list(
                        `name`="probability_early_stop", 
                        `title`="P(Early Stop) (%)", 
                        `type`="number"),
                    list(
                        `name`="probability_futility", 
                        `title`="P(Futility) (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="interim_monitoring_guidelines",
                title="Interim Monitoring Guidelines",
                rows=0,
                visible="(interim_monitoring_plan)",
                columns=list(
                    list(
                        `name`="analysis_time", 
                        `title`="Analysis Time", 
                        `type`="text"),
                    list(
                        `name`="data_cutoff_rule", 
                        `title`="Data Cutoff Rule", 
                        `type`="text"),
                    list(
                        `name`="analysis_population", 
                        `title`="Analysis Population", 
                        `type`="text"),
                    list(
                        `name`="statistical_methods", 
                        `title`="Statistical Methods", 
                        `type`="text"),
                    list(
                        `name`="decision_framework", 
                        `title`="Decision Framework", 
                        `type`="text"),
                    list(
                        `name`="communication_plan", 
                        `title`="Communication Plan", 
                        `type`="text"),
                    list(
                        `name`="regulatory_considerations", 
                        `title`="Regulatory Considerations", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sample_size_calculations",
                title="Sample Size Calculations",
                rows=0,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="analysis_type", 
                        `title`="Analysis Type", 
                        `type`="text"),
                    list(
                        `name`="events_required", 
                        `title`="Events Required", 
                        `type`="integer"),
                    list(
                        `name`="total_sample_size", 
                        `title`="Total Sample Size", 
                        `type`="integer"),
                    list(
                        `name`="per_arm_sample_size", 
                        `title`="Per Arm Sample Size", 
                        `type`="integer"),
                    list(
                        `name`="study_duration", 
                        `title`="Study Duration (months)", 
                        `type`="number"),
                    list(
                        `name`="accrual_period", 
                        `title`="Accrual Period (months)", 
                        `type`="number"),
                    list(
                        `name`="follow_up_period", 
                        `title`="Follow-up Period (months)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="futility_analysis_results",
                title="Futility Analysis Results",
                rows=0,
                visible="(futility_analysis)",
                columns=list(
                    list(
                        `name`="interim_analysis", 
                        `title`="Interim Analysis", 
                        `type`="integer"),
                    list(
                        `name`="conditional_power", 
                        `title`="Conditional Power", 
                        `type`="number"),
                    list(
                        `name`="predictive_power", 
                        `title`="Predictive Power", 
                        `type`="number"),
                    list(
                        `name`="futility_boundary", 
                        `title`="Futility Boundary", 
                        `type`="number"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"),
                    list(
                        `name`="rationale", 
                        `title`="Rationale", 
                        `type`="text"),
                    list(
                        `name`="continue_probability", 
                        `title`="P(Continue)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="multiplicity_adjustment",
                title="Multiplicity Adjustment",
                rows=0,
                visible="(multiplicity_adjustment)",
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="unadjusted_alpha", 
                        `title`="Unadjusted Alpha", 
                        `type`="number"),
                    list(
                        `name`="adjusted_alpha", 
                        `title`="Adjusted Alpha", 
                        `type`="number"),
                    list(
                        `name`="adjustment_method", 
                        `title`="Adjustment Method", 
                        `type`="text"),
                    list(
                        `name`="family_wise_error_rate", 
                        `title`="FWER", 
                        `type`="number"),
                    list(
                        `name`="power_impact", 
                        `title`="Power Impact (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="regulatory_compliance",
                title="Regulatory Compliance Summary",
                rows=1,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="regulatory_framework", 
                        `title`="Regulatory Framework", 
                        `type`="text"),
                    list(
                        `name`="design_qualification", 
                        `title`="Design Qualification", 
                        `type`="text"),
                    list(
                        `name`="statistical_considerations", 
                        `title`="Statistical Considerations", 
                        `type`="text"),
                    list(
                        `name`="documentation_requirements", 
                        `title`="Documentation Requirements", 
                        `type`="text"),
                    list(
                        `name`="submission_pathway", 
                        `title`="Submission Pathway", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="boundary_plot",
                title="Group Sequential Boundaries",
                width=600,
                height=450,
                visible="(boundary_plots)",
                renderFun=".plot_sequential_boundaries"))
            self$add(jmvcore::Image$new(
                options=options,
                name="operating_characteristics_plot",
                title="Operating Characteristics",
                width=600,
                height=450,
                visible="(operating_characteristics)",
                renderFun=".plot_operating_characteristics"))
            self$add(jmvcore::Image$new(
                options=options,
                name="conditional_power_plot",
                title="Conditional Power Analysis",
                width=600,
                height=450,
                visible="(conditional_power_analysis)",
                renderFun=".plot_conditional_power"))
            self$add(jmvcore::Image$new(
                options=options,
                name="sample_size_sensitivity_plot",
                title="Sample Size Sensitivity Analysis",
                width=600,
                height=450,
                visible="(operating_characteristics)",
                renderFun=".plot_sample_size_sensitivity"))
            self$add(jmvcore::Image$new(
                options=options,
                name="platform_trial_flowchart",
                title="Platform Trial Flow Diagram",
                width=700,
                height=500,
                visible="(design_type:platform_trial)",
                renderFun=".plot_platform_trial_flow"))
            self$add(jmvcore::Html$new(
                options=options,
                name="design_recommendations",
                title="Design Recommendations and Interpretation",
                visible=TRUE))}))

advancedtrialsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedtrialsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "advancedtrials",
                version = c(1,0,0),
                options = options,
                results = advancedtrialsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Advanced Clinical Trial Methods
#'
#' Advanced clinical trial methodologies including group sequential designs, 
#' adaptive
#' trials, and interim monitoring. Provides sophisticated statistical methods 
#' for
#' non-inferiority trials, futility analysis, and early stopping rules. 
#' Implements
#' cutting-edge designs such as seamless Phase II/III, platform trials, and 
#' master
#' protocol studies. Designed for clinical trialists requiring 
#' state-of-the-art
#' methodology and regulatory compliance.
#' 
#'
#' @examples
#' data('clinical_trial')
#'
#' advancedtrials(
#'     data = clinical_trial,
#'     time_var = "survival_time",
#'     event_var = "death",
#'     treatment_var = "arm",
#'     design_type = "group_sequential",
#'     alpha_spending = "obrien_fleming",
#'     number_of_looks = 3
#' )
#'
#' @param data the data as a data frame
#' @param time_var Time to primary endpoint (survival, progression, response)
#' @param event_var Event indicator (1=event, 0=censored)
#' @param treatment_var Treatment arm assignment (experimental vs control)
#' @param biomarker_var Biomarker for enrichment or stratification strategies
#' @param interim_time_var Calendar time of interim analysis
#' @param stratification_vars Variables for stratified randomization
#' @param design_type Advanced clinical trial design type
#' @param primary_endpoint Primary efficacy endpoint
#' @param statistical_test Statistical test for primary analysis
#' @param alpha_spending Alpha spending function for efficacy boundaries
#' @param beta_spending Beta spending function for futility boundaries
#' @param number_of_looks Total number of planned interim looks
#' @param information_fractions Information fractions for each analysis
#'   (comma-separated)
#' @param efficacy_boundaries Custom efficacy boundaries or 'auto' for
#'   spending function
#' @param adaptation_type Type of mid-trial adaptation
#' @param adaptation_timing Percentage of planned events for adaptation
#'   decision
#' @param conditional_power_threshold Threshold for sample size re-estimation
#' @param ni_margin Non-inferiority margin (hazard ratio scale)
#' @param ni_margin_type Scale for non-inferiority margin
#' @param overall_alpha One-sided Type I error rate
#' @param overall_power Overall study power
#' @param expected_hr Expected treatment effect (hazard ratio)
#' @param accrual_rate Expected patient accrual rate
#' @param dropout_rate Annual patient dropout rate
#' @param number_of_arms Total number of treatment arms
#' @param control_arm_sharing Share control arm across comparisons
#' @param interim_arm_addition Allow adding arms during trial
#' @param interim_arm_dropping Allow dropping arms for futility
#' @param biomarker_strategy Biomarker-driven design strategy
#' @param biomarker_prevalence Prevalence of positive biomarker
#' @param futility_analysis Include formal futility testing
#' @param stochastic_curtailment Use stochastic curtailment approach
#' @param predictive_power_threshold Threshold for futility based on
#'   predictive power
#' @param interim_monitoring_plan Generate detailed interim monitoring
#'   guidelines
#' @param operating_characteristics Calculate design operating characteristics
#'   via simulation
#' @param boundary_plots Generate efficacy and futility boundary plots
#' @param conditional_power_analysis Calculate conditional power at interim
#'   analyses
#' @param predictive_power_analysis Calculate predictive power for study
#'   completion
#' @param bias_adjustment Apply bias adjustment methods for adaptive designs
#' @param multiplicity_adjustment Apply multiplicity adjustment for multiple
#'   arms/endpoints
#' @param simulation_runs Number of simulations for operating characteristics
#' @param seed_value Random seed for reproducible simulations
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$trial_design_summary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$group_sequential_boundaries} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$adaptive_design_parameters} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$platform_trial_design} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$biomarker_strategy_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$operating_characteristics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interim_monitoring_guidelines} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sample_size_calculations} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$futility_analysis_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$multiplicity_adjustment} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$regulatory_compliance} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$boundary_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$operating_characteristics_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$conditional_power_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sample_size_sensitivity_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$platform_trial_flowchart} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$design_recommendations} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$trial_design_summary$asDF}
#'
#' \code{as.data.frame(results$trial_design_summary)}
#'
#' @export
advancedtrials <- function(
    data,
    time_var,
    event_var,
    treatment_var,
    biomarker_var,
    interim_time_var,
    stratification_vars,
    design_type = "group_sequential",
    primary_endpoint = "overall_survival",
    statistical_test = "log_rank",
    alpha_spending = "obrien_fleming",
    beta_spending = "obrien_fleming",
    number_of_looks = 3,
    information_fractions = "0.5,0.75,1.0",
    efficacy_boundaries = "auto",
    adaptation_type = "sample_size_reestimation",
    adaptation_timing = 50,
    conditional_power_threshold = 0.3,
    ni_margin = 1.25,
    ni_margin_type = "hazard_ratio",
    overall_alpha = 0.025,
    overall_power = 0.8,
    expected_hr = 0.75,
    accrual_rate = 25,
    dropout_rate = 0.05,
    number_of_arms = 2,
    control_arm_sharing = TRUE,
    interim_arm_addition = FALSE,
    interim_arm_dropping = FALSE,
    biomarker_strategy = "all_comers",
    biomarker_prevalence = 0.3,
    futility_analysis = TRUE,
    stochastic_curtailment = FALSE,
    predictive_power_threshold = 0.1,
    interim_monitoring_plan = TRUE,
    operating_characteristics = TRUE,
    boundary_plots = TRUE,
    conditional_power_analysis = FALSE,
    predictive_power_analysis = FALSE,
    bias_adjustment = FALSE,
    multiplicity_adjustment = FALSE,
    simulation_runs = 10000,
    seed_value = 12345) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("advancedtrials requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(event_var)) event_var <- jmvcore::resolveQuo(jmvcore::enquo(event_var))
    if ( ! missing(treatment_var)) treatment_var <- jmvcore::resolveQuo(jmvcore::enquo(treatment_var))
    if ( ! missing(biomarker_var)) biomarker_var <- jmvcore::resolveQuo(jmvcore::enquo(biomarker_var))
    if ( ! missing(interim_time_var)) interim_time_var <- jmvcore::resolveQuo(jmvcore::enquo(interim_time_var))
    if ( ! missing(stratification_vars)) stratification_vars <- jmvcore::resolveQuo(jmvcore::enquo(stratification_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(event_var), event_var, NULL),
            `if`( ! missing(treatment_var), treatment_var, NULL),
            `if`( ! missing(biomarker_var), biomarker_var, NULL),
            `if`( ! missing(interim_time_var), interim_time_var, NULL),
            `if`( ! missing(stratification_vars), stratification_vars, NULL))

    for (v in event_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in treatment_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in stratification_vars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- advancedtrialsOptions$new(
        time_var = time_var,
        event_var = event_var,
        treatment_var = treatment_var,
        biomarker_var = biomarker_var,
        interim_time_var = interim_time_var,
        stratification_vars = stratification_vars,
        design_type = design_type,
        primary_endpoint = primary_endpoint,
        statistical_test = statistical_test,
        alpha_spending = alpha_spending,
        beta_spending = beta_spending,
        number_of_looks = number_of_looks,
        information_fractions = information_fractions,
        efficacy_boundaries = efficacy_boundaries,
        adaptation_type = adaptation_type,
        adaptation_timing = adaptation_timing,
        conditional_power_threshold = conditional_power_threshold,
        ni_margin = ni_margin,
        ni_margin_type = ni_margin_type,
        overall_alpha = overall_alpha,
        overall_power = overall_power,
        expected_hr = expected_hr,
        accrual_rate = accrual_rate,
        dropout_rate = dropout_rate,
        number_of_arms = number_of_arms,
        control_arm_sharing = control_arm_sharing,
        interim_arm_addition = interim_arm_addition,
        interim_arm_dropping = interim_arm_dropping,
        biomarker_strategy = biomarker_strategy,
        biomarker_prevalence = biomarker_prevalence,
        futility_analysis = futility_analysis,
        stochastic_curtailment = stochastic_curtailment,
        predictive_power_threshold = predictive_power_threshold,
        interim_monitoring_plan = interim_monitoring_plan,
        operating_characteristics = operating_characteristics,
        boundary_plots = boundary_plots,
        conditional_power_analysis = conditional_power_analysis,
        predictive_power_analysis = predictive_power_analysis,
        bias_adjustment = bias_adjustment,
        multiplicity_adjustment = multiplicity_adjustment,
        simulation_runs = simulation_runs,
        seed_value = seed_value)

    analysis <- advancedtrialsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

