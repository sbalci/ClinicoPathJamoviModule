
# This file is automatically generated, you probably don't want to edit this

biopsysimulationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "biopsysimulationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            wholesection = NULL,
            biopsy1 = NULL,
            biopsy2 = NULL,
            biopsy3 = NULL,
            biopsy4 = NULL,
            biopsies = NULL,
            spatial_id = NULL,
            analysis_type = "comprehensive",
            sampling_strategy = "unknown",
            cv_threshold = 20,
            correlation_threshold = 0.8,
            show_variability_plots = TRUE,
            variance_components = TRUE,
            power_analysis = FALSE,
            generate_recommendations = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="biopsysimulation",
                requiresData=TRUE,
                ...)

            private$..wholesection <- jmvcore::OptionVariable$new(
                "wholesection",
                wholesection,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..biopsy1 <- jmvcore::OptionVariable$new(
                "biopsy1",
                biopsy1,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..biopsy2 <- jmvcore::OptionVariable$new(
                "biopsy2",
                biopsy2,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..biopsy3 <- jmvcore::OptionVariable$new(
                "biopsy3",
                biopsy3,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..biopsy4 <- jmvcore::OptionVariable$new(
                "biopsy4",
                biopsy4,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..biopsies <- jmvcore::OptionVariables$new(
                "biopsies",
                biopsies,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..spatial_id <- jmvcore::OptionVariable$new(
                "spatial_id",
                spatial_id,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "reproducibility",
                    "bias",
                    "variability",
                    "comprehensive"),
                default="comprehensive")
            private$..sampling_strategy <- jmvcore::OptionList$new(
                "sampling_strategy",
                sampling_strategy,
                options=list(
                    "random",
                    "systematic",
                    "stratified",
                    "unknown"),
                default="unknown")
            private$..cv_threshold <- jmvcore::OptionNumber$new(
                "cv_threshold",
                cv_threshold,
                min=5,
                max=50,
                default=20)
            private$..correlation_threshold <- jmvcore::OptionNumber$new(
                "correlation_threshold",
                correlation_threshold,
                min=0.5,
                max=0.99,
                default=0.8)
            private$..show_variability_plots <- jmvcore::OptionBool$new(
                "show_variability_plots",
                show_variability_plots,
                default=TRUE)
            private$..variance_components <- jmvcore::OptionBool$new(
                "variance_components",
                variance_components,
                default=TRUE)
            private$..power_analysis <- jmvcore::OptionBool$new(
                "power_analysis",
                power_analysis,
                default=FALSE)
            private$..generate_recommendations <- jmvcore::OptionBool$new(
                "generate_recommendations",
                generate_recommendations,
                default=TRUE)

            self$.addOption(private$..wholesection)
            self$.addOption(private$..biopsy1)
            self$.addOption(private$..biopsy2)
            self$.addOption(private$..biopsy3)
            self$.addOption(private$..biopsy4)
            self$.addOption(private$..biopsies)
            self$.addOption(private$..spatial_id)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..sampling_strategy)
            self$.addOption(private$..cv_threshold)
            self$.addOption(private$..correlation_threshold)
            self$.addOption(private$..show_variability_plots)
            self$.addOption(private$..variance_components)
            self$.addOption(private$..power_analysis)
            self$.addOption(private$..generate_recommendations)
        }),
    active = list(
        wholesection = function() private$..wholesection$value,
        biopsy1 = function() private$..biopsy1$value,
        biopsy2 = function() private$..biopsy2$value,
        biopsy3 = function() private$..biopsy3$value,
        biopsy4 = function() private$..biopsy4$value,
        biopsies = function() private$..biopsies$value,
        spatial_id = function() private$..spatial_id$value,
        analysis_type = function() private$..analysis_type$value,
        sampling_strategy = function() private$..sampling_strategy$value,
        cv_threshold = function() private$..cv_threshold$value,
        correlation_threshold = function() private$..correlation_threshold$value,
        show_variability_plots = function() private$..show_variability_plots$value,
        variance_components = function() private$..variance_components$value,
        power_analysis = function() private$..power_analysis$value,
        generate_recommendations = function() private$..generate_recommendations$value),
    private = list(
        ..wholesection = NA,
        ..biopsy1 = NA,
        ..biopsy2 = NA,
        ..biopsy3 = NA,
        ..biopsy4 = NA,
        ..biopsies = NA,
        ..spatial_id = NA,
        ..analysis_type = NA,
        ..sampling_strategy = NA,
        ..cv_threshold = NA,
        ..correlation_threshold = NA,
        ..show_variability_plots = NA,
        ..variance_components = NA,
        ..power_analysis = NA,
        ..generate_recommendations = NA)
)

biopsysimulationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "biopsysimulationResults",
    inherit = jmvcore::Group,
    active = list(),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Biopsy Simulation Analysis")}))

biopsysimulationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "biopsysimulationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "biopsysimulation",
                version = c(1,0,0),
                options = options,
                results = biopsysimulationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Biopsy Simulation Analysis
#'
#' 
#' @param data the data as a data frame
#' @param wholesection biomarker measurement from entire tissue section
#' @param biopsy1 first simulated biopsy measurement
#' @param biopsy2 second simulated biopsy measurement
#' @param biopsy3 third simulated biopsy measurement
#' @param biopsy4 fourth simulated biopsy measurement
#' @param biopsies additional simulated biopsy measurements
#' @param spatial_id identifier for spatial regions or tissue areas
#' @param analysis_type primary focus of biopsy simulation analysis
#' @param sampling_strategy biopsy sampling strategy used
#' @param cv_threshold coefficient of variation threshold for acceptable
#'   sampling variability
#' @param correlation_threshold minimum correlation between biopsy and whole
#'   section
#' @param show_variability_plots display plots showing sampling variability
#' @param variance_components perform variance component decomposition
#' @param power_analysis perform power analysis for sample size
#'   recommendations
#' @param generate_recommendations provide recommendations for optimal
#'   sampling strategy
#' @return A results object containing:
#' \tabular{llllll}{
#' }
#'
#' @export
biopsysimulation <- function(
    data,
    wholesection,
    biopsy1,
    biopsy2,
    biopsy3,
    biopsy4,
    biopsies,
    spatial_id,
    analysis_type = "comprehensive",
    sampling_strategy = "unknown",
    cv_threshold = 20,
    correlation_threshold = 0.8,
    show_variability_plots = TRUE,
    variance_components = TRUE,
    power_analysis = FALSE,
    generate_recommendations = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("biopsysimulation requires jmvcore to be installed (restart may be required)")

    if ( ! missing(wholesection)) wholesection <- jmvcore::resolveQuo(jmvcore::enquo(wholesection))
    if ( ! missing(biopsy1)) biopsy1 <- jmvcore::resolveQuo(jmvcore::enquo(biopsy1))
    if ( ! missing(biopsy2)) biopsy2 <- jmvcore::resolveQuo(jmvcore::enquo(biopsy2))
    if ( ! missing(biopsy3)) biopsy3 <- jmvcore::resolveQuo(jmvcore::enquo(biopsy3))
    if ( ! missing(biopsy4)) biopsy4 <- jmvcore::resolveQuo(jmvcore::enquo(biopsy4))
    if ( ! missing(biopsies)) biopsies <- jmvcore::resolveQuo(jmvcore::enquo(biopsies))
    if ( ! missing(spatial_id)) spatial_id <- jmvcore::resolveQuo(jmvcore::enquo(spatial_id))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(wholesection), wholesection, NULL),
            `if`( ! missing(biopsy1), biopsy1, NULL),
            `if`( ! missing(biopsy2), biopsy2, NULL),
            `if`( ! missing(biopsy3), biopsy3, NULL),
            `if`( ! missing(biopsy4), biopsy4, NULL),
            `if`( ! missing(biopsies), biopsies, NULL),
            `if`( ! missing(spatial_id), spatial_id, NULL))

    for (v in spatial_id) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- biopsysimulationOptions$new(
        wholesection = wholesection,
        biopsy1 = biopsy1,
        biopsy2 = biopsy2,
        biopsy3 = biopsy3,
        biopsy4 = biopsy4,
        biopsies = biopsies,
        spatial_id = spatial_id,
        analysis_type = analysis_type,
        sampling_strategy = sampling_strategy,
        cv_threshold = cv_threshold,
        correlation_threshold = correlation_threshold,
        show_variability_plots = show_variability_plots,
        variance_components = variance_components,
        power_analysis = power_analysis,
        generate_recommendations = generate_recommendations)

    analysis <- biopsysimulationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

