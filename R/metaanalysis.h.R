
# This file is automatically generated, you probably don't want to edit this

metaanalysisOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "metaanalysisOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            effect_size = NULL,
            variance = NULL,
            study_id = NULL,
            sample_size = NULL,
            year = NULL,
            analysis_type = "generic",
            model_type = "random_effects",
            effect_measure = "odds_ratio",
            heterogeneity_method = "dersimonian_laird",
            true_positives = NULL,
            false_positives = NULL,
            false_negatives = NULL,
            true_negatives = NULL,
            dta_model_type = "bivariate",
            treatment_arm = NULL,
            comparison_arm = NULL,
            network_method = "frequentist",
            publication_bias = TRUE,
            bias_tests = "all_tests",
            subgroup_var = NULL,
            moderator_vars = NULL,
            meta_regression = FALSE,
            sensitivity_analysis = TRUE,
            outlier_detection = TRUE,
            forest_plot_options = TRUE,
            prediction_interval = TRUE,
            confidence_level = 0.95,
            robust_methods = FALSE,
            small_sample_correction = TRUE,
            knha_adjustment = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="metaanalysis",
                requiresData=TRUE,
                ...)

            private$..effect_size <- jmvcore::OptionVariable$new(
                "effect_size",
                effect_size,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..variance <- jmvcore::OptionVariable$new(
                "variance",
                variance,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..study_id <- jmvcore::OptionVariable$new(
                "study_id",
                study_id,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..sample_size <- jmvcore::OptionVariable$new(
                "sample_size",
                sample_size,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..year <- jmvcore::OptionVariable$new(
                "year",
                year,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "generic",
                    "diagnostic_accuracy",
                    "network",
                    "individual_patient"),
                default="generic")
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "fixed_effects",
                    "random_effects",
                    "mixed_effects"),
                default="random_effects")
            private$..effect_measure <- jmvcore::OptionList$new(
                "effect_measure",
                effect_measure,
                options=list(
                    "mean_difference",
                    "standardized_mean_diff",
                    "odds_ratio",
                    "risk_ratio",
                    "hazard_ratio",
                    "correlation"),
                default="odds_ratio")
            private$..heterogeneity_method <- jmvcore::OptionList$new(
                "heterogeneity_method",
                heterogeneity_method,
                options=list(
                    "dersimonian_laird",
                    "restricted_ml",
                    "maximum_likelihood",
                    "empirical_bayes",
                    "paule_mandel"),
                default="dersimonian_laird")
            private$..true_positives <- jmvcore::OptionVariable$new(
                "true_positives",
                true_positives,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..false_positives <- jmvcore::OptionVariable$new(
                "false_positives",
                false_positives,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..false_negatives <- jmvcore::OptionVariable$new(
                "false_negatives",
                false_negatives,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..true_negatives <- jmvcore::OptionVariable$new(
                "true_negatives",
                true_negatives,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..dta_model_type <- jmvcore::OptionList$new(
                "dta_model_type",
                dta_model_type,
                options=list(
                    "bivariate",
                    "hsroc",
                    "univariate"),
                default="bivariate")
            private$..treatment_arm <- jmvcore::OptionVariable$new(
                "treatment_arm",
                treatment_arm,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..comparison_arm <- jmvcore::OptionVariable$new(
                "comparison_arm",
                comparison_arm,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..network_method <- jmvcore::OptionList$new(
                "network_method",
                network_method,
                options=list(
                    "frequentist",
                    "bayesian",
                    "mixed_treatment"),
                default="frequentist")
            private$..publication_bias <- jmvcore::OptionBool$new(
                "publication_bias",
                publication_bias,
                default=TRUE)
            private$..bias_tests <- jmvcore::OptionList$new(
                "bias_tests",
                bias_tests,
                options=list(
                    "egger",
                    "begg",
                    "trim_fill",
                    "all_tests"),
                default="all_tests")
            private$..subgroup_var <- jmvcore::OptionVariable$new(
                "subgroup_var",
                subgroup_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..moderator_vars <- jmvcore::OptionVariables$new(
                "moderator_vars",
                moderator_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..meta_regression <- jmvcore::OptionBool$new(
                "meta_regression",
                meta_regression,
                default=FALSE)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=TRUE)
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=TRUE)
            private$..forest_plot_options <- jmvcore::OptionBool$new(
                "forest_plot_options",
                forest_plot_options,
                default=TRUE)
            private$..prediction_interval <- jmvcore::OptionBool$new(
                "prediction_interval",
                prediction_interval,
                default=TRUE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..robust_methods <- jmvcore::OptionBool$new(
                "robust_methods",
                robust_methods,
                default=FALSE)
            private$..small_sample_correction <- jmvcore::OptionBool$new(
                "small_sample_correction",
                small_sample_correction,
                default=TRUE)
            private$..knha_adjustment <- jmvcore::OptionBool$new(
                "knha_adjustment",
                knha_adjustment,
                default=TRUE)

            self$.addOption(private$..effect_size)
            self$.addOption(private$..variance)
            self$.addOption(private$..study_id)
            self$.addOption(private$..sample_size)
            self$.addOption(private$..year)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..model_type)
            self$.addOption(private$..effect_measure)
            self$.addOption(private$..heterogeneity_method)
            self$.addOption(private$..true_positives)
            self$.addOption(private$..false_positives)
            self$.addOption(private$..false_negatives)
            self$.addOption(private$..true_negatives)
            self$.addOption(private$..dta_model_type)
            self$.addOption(private$..treatment_arm)
            self$.addOption(private$..comparison_arm)
            self$.addOption(private$..network_method)
            self$.addOption(private$..publication_bias)
            self$.addOption(private$..bias_tests)
            self$.addOption(private$..subgroup_var)
            self$.addOption(private$..moderator_vars)
            self$.addOption(private$..meta_regression)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..forest_plot_options)
            self$.addOption(private$..prediction_interval)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..robust_methods)
            self$.addOption(private$..small_sample_correction)
            self$.addOption(private$..knha_adjustment)
        }),
    active = list(
        effect_size = function() private$..effect_size$value,
        variance = function() private$..variance$value,
        study_id = function() private$..study_id$value,
        sample_size = function() private$..sample_size$value,
        year = function() private$..year$value,
        analysis_type = function() private$..analysis_type$value,
        model_type = function() private$..model_type$value,
        effect_measure = function() private$..effect_measure$value,
        heterogeneity_method = function() private$..heterogeneity_method$value,
        true_positives = function() private$..true_positives$value,
        false_positives = function() private$..false_positives$value,
        false_negatives = function() private$..false_negatives$value,
        true_negatives = function() private$..true_negatives$value,
        dta_model_type = function() private$..dta_model_type$value,
        treatment_arm = function() private$..treatment_arm$value,
        comparison_arm = function() private$..comparison_arm$value,
        network_method = function() private$..network_method$value,
        publication_bias = function() private$..publication_bias$value,
        bias_tests = function() private$..bias_tests$value,
        subgroup_var = function() private$..subgroup_var$value,
        moderator_vars = function() private$..moderator_vars$value,
        meta_regression = function() private$..meta_regression$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        outlier_detection = function() private$..outlier_detection$value,
        forest_plot_options = function() private$..forest_plot_options$value,
        prediction_interval = function() private$..prediction_interval$value,
        confidence_level = function() private$..confidence_level$value,
        robust_methods = function() private$..robust_methods$value,
        small_sample_correction = function() private$..small_sample_correction$value,
        knha_adjustment = function() private$..knha_adjustment$value),
    private = list(
        ..effect_size = NA,
        ..variance = NA,
        ..study_id = NA,
        ..sample_size = NA,
        ..year = NA,
        ..analysis_type = NA,
        ..model_type = NA,
        ..effect_measure = NA,
        ..heterogeneity_method = NA,
        ..true_positives = NA,
        ..false_positives = NA,
        ..false_negatives = NA,
        ..true_negatives = NA,
        ..dta_model_type = NA,
        ..treatment_arm = NA,
        ..comparison_arm = NA,
        ..network_method = NA,
        ..publication_bias = NA,
        ..bias_tests = NA,
        ..subgroup_var = NA,
        ..moderator_vars = NA,
        ..meta_regression = NA,
        ..sensitivity_analysis = NA,
        ..outlier_detection = NA,
        ..forest_plot_options = NA,
        ..prediction_interval = NA,
        ..confidence_level = NA,
        ..robust_methods = NA,
        ..small_sample_correction = NA,
        ..knha_adjustment = NA)
)

metaanalysisResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "metaanalysisResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        studySummary = function() private$.items[["studySummary"]],
        overallResults = function() private$.items[["overallResults"]],
        heterogeneityAssessment = function() private$.items[["heterogeneityAssessment"]],
        publicationBiasResults = function() private$.items[["publicationBiasResults"]],
        subgroupAnalysis = function() private$.items[["subgroupAnalysis"]],
        metaRegressionResults = function() private$.items[["metaRegressionResults"]],
        diagnosticAccuracyResults = function() private$.items[["diagnosticAccuracyResults"]],
        networkResults = function() private$.items[["networkResults"]],
        sensitivityAnalysis = function() private$.items[["sensitivityAnalysis"]],
        outlierAnalysis = function() private$.items[["outlierAnalysis"]],
        modelFitStatistics = function() private$.items[["modelFitStatistics"]],
        forestPlot = function() private$.items[["forestPlot"]],
        funnelPlot = function() private$.items[["funnelPlot"]],
        heterogeneityPlot = function() private$.items[["heterogeneityPlot"]],
        metaRegressionPlot = function() private$.items[["metaRegressionPlot"]],
        srocPlot = function() private$.items[["srocPlot"]],
        networkPlot = function() private$.items[["networkPlot"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Meta-Analysis & Evidence Synthesis")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="studySummary",
                title="Study Summary Statistics",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "effect_size",
                    "variance",
                    "study_id"),
                columns=list(
                    list(
                        `name`="study", 
                        `title`="Study", 
                        `type`="text"),
                    list(
                        `name`="effect_size", 
                        `title`="Effect Size", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="standard_error", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="weight", 
                        `title`="Weight (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="sample_size", 
                        `title`="n", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="overallResults",
                title="Overall Meta-Analysis Results",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "effect_size",
                    "variance",
                    "model_type"),
                columns=list(
                    list(
                        `name`="model", 
                        `title`="Model", 
                        `type`="text"),
                    list(
                        `name`="pooled_effect", 
                        `title`="Pooled Effect", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="standard_error", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="z_value", 
                        `title`="z-value", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="prediction_interval", 
                        `title`="Prediction Interval", 
                        `type`="text", 
                        `visible`="(prediction_interval)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="heterogeneityAssessment",
                title="Heterogeneity Assessment",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "effect_size",
                    "variance",
                    "heterogeneity_method"),
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="publicationBiasResults",
                title="Publication Bias Assessment",
                visible="(publication_bias)",
                rows=1,
                clearWith=list(
                    "publication_bias",
                    "bias_tests"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="subgroupAnalysis",
                title="Subgroup Analysis",
                visible="(subgroup_var)",
                rows=1,
                clearWith=list(
                    "subgroup_var",
                    "effect_size"),
                columns=list(
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="studies", 
                        `title`="Studies", 
                        `type`="integer"),
                    list(
                        `name`="pooled_effect", 
                        `title`="Pooled Effect", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="heterogeneity_i2", 
                        `title`="I\u00B2 (%)", 
                        `type`="number", 
                        `format`="zto:1"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="metaRegressionResults",
                title="Meta-Regression Results",
                visible="(meta_regression)",
                rows=1,
                clearWith=list(
                    "meta_regression",
                    "moderator_vars"),
                columns=list(
                    list(
                        `name`="moderator", 
                        `title`="Moderator", 
                        `type`="text"),
                    list(
                        `name`="coefficient", 
                        `title`="Coefficient", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="standard_error", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="t_value", 
                        `title`="t-value", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="r_squared", 
                        `title`="R\u00B2", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="diagnosticAccuracyResults",
                title="Diagnostic Test Accuracy Meta-Analysis",
                visible="(analysis_type:diagnostic_accuracy)",
                rows=1,
                clearWith=list(
                    "analysis_type",
                    "dta_model_type"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="pooled_estimate", 
                        `title`="Pooled Estimate", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="prediction_region", 
                        `title`="Prediction Region", 
                        `type`="text"),
                    list(
                        `name`="heterogeneity", 
                        `title`="Heterogeneity", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="networkResults",
                title="Network Meta-Analysis Results",
                visible="(analysis_type:network)",
                rows=1,
                clearWith=list(
                    "analysis_type",
                    "network_method"),
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="effect_estimate", 
                        `title`="Effect Estimate", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_interval", 
                        `title`="Credible Interval", 
                        `type`="text"),
                    list(
                        `name`="probability_best", 
                        `title`="P(Best)", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="ranking", 
                        `title`="Ranking", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityAnalysis",
                title="Sensitivity Analysis",
                visible="(sensitivity_analysis)",
                rows=1,
                clearWith=list(
                    "sensitivity_analysis"),
                columns=list(
                    list(
                        `name`="analysis", 
                        `title`="Sensitivity Analysis", 
                        `type`="text"),
                    list(
                        `name`="excluded_studies", 
                        `title`="Excluded Studies", 
                        `type`="text"),
                    list(
                        `name`="pooled_effect", 
                        `title`="Pooled Effect", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="i2_change", 
                        `title`="\u0394 I\u00B2", 
                        `type`="number", 
                        `format`="zto:1"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="outlierAnalysis",
                title="Outlier Detection",
                visible="(outlier_detection)",
                rows=1,
                clearWith=list(
                    "outlier_detection"),
                columns=list(
                    list(
                        `name`="study", 
                        `title`="Study", 
                        `type`="text"),
                    list(
                        `name`="standardized_residual", 
                        `title`="Std. Residual", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="leverage", 
                        `title`="Leverage", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="cooks_distance", 
                        `title`="Cook's Distance", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="outlier_flag", 
                        `title`="Outlier", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelFitStatistics",
                title="Model Fit and Comparison",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "model_type",
                    "effect_size"),
                columns=list(
                    list(
                        `name`="model", 
                        `title`="Model", 
                        `type`="text"),
                    list(
                        `name`="log_likelihood", 
                        `title`="Log-Likelihood", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="aic", 
                        `title`="AIC", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="bic", 
                        `title`="BIC", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="deviance", 
                        `title`="Deviance", 
                        `type`="number", 
                        `format`="zto:2"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="forestPlot",
                title="Forest Plot",
                visible=TRUE,
                requiresData=TRUE,
                width=1000,
                height=700,
                renderFun=".plotForest",
                clearWith=list(
                    "effect_size",
                    "variance",
                    "model_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="funnelPlot",
                title="Funnel Plot",
                visible="(publication_bias)",
                requiresData=TRUE,
                width=700,
                height=600,
                renderFun=".plotFunnel",
                clearWith=list(
                    "effect_size",
                    "variance",
                    "publication_bias")))
            self$add(jmvcore::Image$new(
                options=options,
                name="heterogeneityPlot",
                title="Heterogeneity Exploration Plot",
                visible=TRUE,
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotHeterogeneity",
                clearWith=list(
                    "effect_size",
                    "variance")))
            self$add(jmvcore::Image$new(
                options=options,
                name="metaRegressionPlot",
                title="Meta-Regression Plot",
                visible="(meta_regression)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotMetaRegression",
                clearWith=list(
                    "meta_regression",
                    "moderator_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="srocPlot",
                title="Summary ROC Plot",
                visible="(analysis_type:diagnostic_accuracy)",
                requiresData=TRUE,
                width=800,
                height=800,
                renderFun=".plotSROC",
                clearWith=list(
                    "analysis_type",
                    "true_positives")))
            self$add(jmvcore::Image$new(
                options=options,
                name="networkPlot",
                title="Network Diagram",
                visible="(analysis_type:network)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotNetwork",
                clearWith=list(
                    "analysis_type",
                    "treatment_arm")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Interpretation Guide",
                visible=TRUE))}))

metaanalysisBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "metaanalysisBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "metaanalysis",
                version = c(1,0,0),
                options = options,
                results = metaanalysisResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Meta-Analysis & Evidence Synthesis
#'
#' Comprehensive meta-analysis and evidence synthesis including forest plots, 
#' heterogeneity testing, publication bias assessment, diagnostic test 
#' accuracy meta-analysis, and network meta-analysis.
#' 
#'
#' @examples
#' data \%>\%
#' metaanalysis(
#'     effect_size = "effect",
#'     variance = "variance",
#'     analysis_type = "generic",
#'     model_type = "random_effects"
#' )
#'
#' @param data the data as a data frame
#' @param effect_size Effect size variable (e.g., log odds ratio, Cohen's d,
#'   log hazard ratio)
#' @param variance Variance or standard error of the effect size
#' @param study_id Study identifier for each effect size (required for
#'   meta-analysis)
#' @param sample_size Sample size for each study (optional, used for
#'   sensitivity analysis)
#' @param year Publication year for temporal trend analysis and publication
#'   bias assessment
#' @param analysis_type Type of meta-analysis to perform
#' @param model_type Statistical model for meta-analysis
#' @param effect_measure Type of effect measure being meta-analyzed
#' @param heterogeneity_method Method for estimating between-study
#'   heterogeneity (tau-squared)
#' @param true_positives True positives for diagnostic test accuracy
#'   meta-analysis
#' @param false_positives False positives for diagnostic test accuracy
#'   meta-analysis
#' @param false_negatives False negatives for diagnostic test accuracy
#'   meta-analysis
#' @param true_negatives True negatives for diagnostic test accuracy
#'   meta-analysis
#' @param dta_model_type Model type for diagnostic test accuracy meta-analysis
#' @param treatment_arm Treatment arm identifier for network meta-analysis
#' @param comparison_arm Comparison arm identifier for network meta-analysis
#' @param network_method Statistical approach for network meta-analysis
#' @param publication_bias Perform publication bias assessment using funnel
#'   plots and statistical tests
#' @param bias_tests Statistical tests for publication bias assessment
#' @param subgroup_var Categorical variable for subgroup analysis
#' @param moderator_vars Variables for meta-regression analysis
#' @param meta_regression Perform meta-regression analysis with moderator
#'   variables
#' @param sensitivity_analysis Perform sensitivity analysis including
#'   leave-one-out and influence diagnostics
#' @param outlier_detection Detect outlying studies using standardized
#'   residuals and influence measures
#' @param forest_plot_options Enable forest plot customization options
#' @param prediction_interval Include prediction intervals in forest plots and
#'   results
#' @param confidence_level Confidence level for confidence and prediction
#'   intervals
#' @param robust_methods Use robust methods for outlier-resistant
#'   meta-analysis
#' @param small_sample_correction Apply small sample corrections
#'   (Hartung-Knapp adjustment)
#' @param knha_adjustment Apply Knapp-Hartung adjustment for random-effects
#'   models
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$studySummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$overallResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$heterogeneityAssessment} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$publicationBiasResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$subgroupAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$metaRegressionResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$diagnosticAccuracyResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$networkResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivityAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$outlierAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelFitStatistics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$forestPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$funnelPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$heterogeneityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$metaRegressionPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$srocPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$networkPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$studySummary$asDF}
#'
#' \code{as.data.frame(results$studySummary)}
#'
#' @export
metaanalysis <- function(
    data,
    effect_size,
    variance,
    study_id,
    sample_size,
    year,
    analysis_type = "generic",
    model_type = "random_effects",
    effect_measure = "odds_ratio",
    heterogeneity_method = "dersimonian_laird",
    true_positives,
    false_positives,
    false_negatives,
    true_negatives,
    dta_model_type = "bivariate",
    treatment_arm,
    comparison_arm,
    network_method = "frequentist",
    publication_bias = TRUE,
    bias_tests = "all_tests",
    subgroup_var,
    moderator_vars,
    meta_regression = FALSE,
    sensitivity_analysis = TRUE,
    outlier_detection = TRUE,
    forest_plot_options = TRUE,
    prediction_interval = TRUE,
    confidence_level = 0.95,
    robust_methods = FALSE,
    small_sample_correction = TRUE,
    knha_adjustment = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("metaanalysis requires jmvcore to be installed (restart may be required)")

    if ( ! missing(effect_size)) effect_size <- jmvcore::resolveQuo(jmvcore::enquo(effect_size))
    if ( ! missing(variance)) variance <- jmvcore::resolveQuo(jmvcore::enquo(variance))
    if ( ! missing(study_id)) study_id <- jmvcore::resolveQuo(jmvcore::enquo(study_id))
    if ( ! missing(sample_size)) sample_size <- jmvcore::resolveQuo(jmvcore::enquo(sample_size))
    if ( ! missing(year)) year <- jmvcore::resolveQuo(jmvcore::enquo(year))
    if ( ! missing(true_positives)) true_positives <- jmvcore::resolveQuo(jmvcore::enquo(true_positives))
    if ( ! missing(false_positives)) false_positives <- jmvcore::resolveQuo(jmvcore::enquo(false_positives))
    if ( ! missing(false_negatives)) false_negatives <- jmvcore::resolveQuo(jmvcore::enquo(false_negatives))
    if ( ! missing(true_negatives)) true_negatives <- jmvcore::resolveQuo(jmvcore::enquo(true_negatives))
    if ( ! missing(treatment_arm)) treatment_arm <- jmvcore::resolveQuo(jmvcore::enquo(treatment_arm))
    if ( ! missing(comparison_arm)) comparison_arm <- jmvcore::resolveQuo(jmvcore::enquo(comparison_arm))
    if ( ! missing(subgroup_var)) subgroup_var <- jmvcore::resolveQuo(jmvcore::enquo(subgroup_var))
    if ( ! missing(moderator_vars)) moderator_vars <- jmvcore::resolveQuo(jmvcore::enquo(moderator_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(effect_size), effect_size, NULL),
            `if`( ! missing(variance), variance, NULL),
            `if`( ! missing(study_id), study_id, NULL),
            `if`( ! missing(sample_size), sample_size, NULL),
            `if`( ! missing(year), year, NULL),
            `if`( ! missing(true_positives), true_positives, NULL),
            `if`( ! missing(false_positives), false_positives, NULL),
            `if`( ! missing(false_negatives), false_negatives, NULL),
            `if`( ! missing(true_negatives), true_negatives, NULL),
            `if`( ! missing(treatment_arm), treatment_arm, NULL),
            `if`( ! missing(comparison_arm), comparison_arm, NULL),
            `if`( ! missing(subgroup_var), subgroup_var, NULL),
            `if`( ! missing(moderator_vars), moderator_vars, NULL))

    for (v in study_id) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in treatment_arm) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in comparison_arm) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in subgroup_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- metaanalysisOptions$new(
        effect_size = effect_size,
        variance = variance,
        study_id = study_id,
        sample_size = sample_size,
        year = year,
        analysis_type = analysis_type,
        model_type = model_type,
        effect_measure = effect_measure,
        heterogeneity_method = heterogeneity_method,
        true_positives = true_positives,
        false_positives = false_positives,
        false_negatives = false_negatives,
        true_negatives = true_negatives,
        dta_model_type = dta_model_type,
        treatment_arm = treatment_arm,
        comparison_arm = comparison_arm,
        network_method = network_method,
        publication_bias = publication_bias,
        bias_tests = bias_tests,
        subgroup_var = subgroup_var,
        moderator_vars = moderator_vars,
        meta_regression = meta_regression,
        sensitivity_analysis = sensitivity_analysis,
        outlier_detection = outlier_detection,
        forest_plot_options = forest_plot_options,
        prediction_interval = prediction_interval,
        confidence_level = confidence_level,
        robust_methods = robust_methods,
        small_sample_correction = small_sample_correction,
        knha_adjustment = knha_adjustment)

    analysis <- metaanalysisClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

