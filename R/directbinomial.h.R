
# This file is automatically generated, you probably don't want to edit this

directbinomialOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "directbinomialOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time = NULL,
            event = NULL,
            covs = NULL,
            eventOfInterest = 1,
            times = "1, 3, 5",
            conf = 0.95,
            residuals = FALSE,
            predictions = TRUE,
            bootstrap = FALSE,
            nboot = 500,
            showModel = TRUE,
            showEducational = TRUE,
            plotCIF = TRUE,
            plotResiduals = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="directbinomial",
                requiresData=TRUE,
                ...)

            private$..time <- jmvcore::OptionVariable$new(
                "time",
                time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event <- jmvcore::OptionVariable$new(
                "event",
                event,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..covs <- jmvcore::OptionVariables$new(
                "covs",
                covs,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..eventOfInterest <- jmvcore::OptionNumber$new(
                "eventOfInterest",
                eventOfInterest,
                min=1,
                max=10,
                default=1)
            private$..times <- jmvcore::OptionString$new(
                "times",
                times,
                default="1, 3, 5")
            private$..conf <- jmvcore::OptionNumber$new(
                "conf",
                conf,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..residuals <- jmvcore::OptionBool$new(
                "residuals",
                residuals,
                default=FALSE)
            private$..predictions <- jmvcore::OptionBool$new(
                "predictions",
                predictions,
                default=TRUE)
            private$..bootstrap <- jmvcore::OptionBool$new(
                "bootstrap",
                bootstrap,
                default=FALSE)
            private$..nboot <- jmvcore::OptionNumber$new(
                "nboot",
                nboot,
                min=50,
                max=2000,
                default=500)
            private$..showModel <- jmvcore::OptionBool$new(
                "showModel",
                showModel,
                default=TRUE)
            private$..showEducational <- jmvcore::OptionBool$new(
                "showEducational",
                showEducational,
                default=TRUE)
            private$..plotCIF <- jmvcore::OptionBool$new(
                "plotCIF",
                plotCIF,
                default=TRUE)
            private$..plotResiduals <- jmvcore::OptionBool$new(
                "plotResiduals",
                plotResiduals,
                default=FALSE)

            self$.addOption(private$..time)
            self$.addOption(private$..event)
            self$.addOption(private$..covs)
            self$.addOption(private$..eventOfInterest)
            self$.addOption(private$..times)
            self$.addOption(private$..conf)
            self$.addOption(private$..residuals)
            self$.addOption(private$..predictions)
            self$.addOption(private$..bootstrap)
            self$.addOption(private$..nboot)
            self$.addOption(private$..showModel)
            self$.addOption(private$..showEducational)
            self$.addOption(private$..plotCIF)
            self$.addOption(private$..plotResiduals)
        }),
    active = list(
        time = function() private$..time$value,
        event = function() private$..event$value,
        covs = function() private$..covs$value,
        eventOfInterest = function() private$..eventOfInterest$value,
        times = function() private$..times$value,
        conf = function() private$..conf$value,
        residuals = function() private$..residuals$value,
        predictions = function() private$..predictions$value,
        bootstrap = function() private$..bootstrap$value,
        nboot = function() private$..nboot$value,
        showModel = function() private$..showModel$value,
        showEducational = function() private$..showEducational$value,
        plotCIF = function() private$..plotCIF$value,
        plotResiduals = function() private$..plotResiduals$value),
    private = list(
        ..time = NA,
        ..event = NA,
        ..covs = NA,
        ..eventOfInterest = NA,
        ..times = NA,
        ..conf = NA,
        ..residuals = NA,
        ..predictions = NA,
        ..bootstrap = NA,
        ..nboot = NA,
        ..showModel = NA,
        ..showEducational = NA,
        ..plotCIF = NA,
        ..plotResiduals = NA)
)

directbinomialResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "directbinomialResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        modelSummary = function() private$.items[["modelSummary"]],
        educationalInfo = function() private$.items[["educationalInfo"]],
        coefficientsTable = function() private$.items[["coefficientsTable"]],
        cumulativeIncidenceTable = function() private$.items[["cumulativeIncidenceTable"]],
        covariateEffectsTable = function() private$.items[["covariateEffectsTable"]],
        goodnessOfFit = function() private$.items[["goodnessOfFit"]],
        residualAnalysis = function() private$.items[["residualAnalysis"]],
        methodsInfo = function() private$.items[["methodsInfo"]],
        cifPlot = function() private$.items[["cifPlot"]],
        residualPlot = function() private$.items[["residualPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Direct Binomial Regression for Competing Risks",
                refs=list(
                    "timereg",
                    "cmprsk",
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="To Do",
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelSummary",
                title="Model Summary",
                visible="(showModel)",
                rows=1,
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Html$new(
                options=options,
                name="educationalInfo",
                title="Direct Binomial Regression Guide",
                visible="(showEducational)",
                clearWith=list(
                    "time",
                    "event")))
            self$add(jmvcore::Table$new(
                options=options,
                name="coefficientsTable",
                title="Parameter Estimates",
                columns=list(
                    list(
                        `name`="term", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="z", 
                        `title`="z-value", 
                        `type`="number"),
                    list(
                        `name`="pvalue", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="lower", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Effect", 
                        `type`="text")),
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Table$new(
                options=options,
                name="cumulativeIncidenceTable",
                title="Cumulative Incidence Predictions",
                visible="(predictions)",
                columns=list(
                    list(
                        `name`="time", 
                        `title`="Time", 
                        `type`="number"),
                    list(
                        `name`="cif", 
                        `title`="Cum. Incidence", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="lower", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Risk Level", 
                        `type`="text")),
                clearWith=list(
                    "time",
                    "event",
                    "covs",
                    "times")))
            self$add(jmvcore::Table$new(
                options=options,
                name="covariateEffectsTable",
                title="Covariate Effects on Cumulative Incidence",
                visible="(covs)",
                columns=list(
                    list(
                        `name`="covariate", 
                        `title`="Covariate", 
                        `type`="text"),
                    list(
                        `name`="level", 
                        `title`="Level/Value", 
                        `type`="text"),
                    list(
                        `name`="time", 
                        `title`="Time", 
                        `type`="number"),
                    list(
                        `name`="cif", 
                        `title`="Cum. Incidence", 
                        `type`="number"),
                    list(
                        `name`="difference", 
                        `title`="Difference", 
                        `type`="number"),
                    list(
                        `name`="pvalue", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue")),
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Table$new(
                options=options,
                name="goodnessOfFit",
                title="Model Goodness of Fit",
                visible="(residuals)",
                rows=1,
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number"),
                    list(
                        `name`="pvalue", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Html$new(
                options=options,
                name="residualAnalysis",
                title="Residual Analysis",
                visible="(residuals)",
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodsInfo",
                title="Statistical Methods",
                clearWith=list(
                    "time",
                    "event")))
            self$add(jmvcore::Image$new(
                options=options,
                name="cifPlot",
                title="Cumulative Incidence Functions",
                width=800,
                height=600,
                renderFun=".cifPlot",
                visible="(plotCIF)",
                requiresData=TRUE,
                clearWith=list(
                    "time",
                    "event",
                    "covs")))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualPlot",
                title="Model Residuals",
                width=700,
                height=500,
                renderFun=".residualPlot",
                visible="(plotResiduals)",
                requiresData=TRUE,
                clearWith=list(
                    "time",
                    "event",
                    "covs")))}))

directbinomialBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "directbinomialBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "directbinomial",
                version = c(0,0,1),
                options = options,
                results = directbinomialResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Direct Binomial Regression for Competing Risks
#'
#' Performs direct binomial regression modeling for cumulative incidence  
#' functions in competing risks analysis using the timereg package. This  
#' method provides direct modeling of cumulative incidence without  
#' proportional subdistribution hazards assumptions.
#' 
#'
#' @examples
#' \donttest{
#' # example will be added
#'}
#' @param data The data as a data frame.
#' @param time Follow-up time variable
#' @param event Event type variable (0=censored, 1=event of interest,
#'   2=competing event, etc.)
#' @param covs Covariates to include in the model
#' @param eventOfInterest Numeric code for the event of interest (primary
#'   event)
#' @param times Comma-separated list of time points for cumulative incidence
#'   prediction
#' @param conf Confidence level for confidence intervals
#' @param residuals Display model residuals and goodness-of-fit statistics
#' @param predictions Display predicted cumulative incidence at specified time
#'   points
#' @param bootstrap Use bootstrap methods for confidence interval estimation
#' @param nboot Number of bootstrap samples (when bootstrap is enabled)
#' @param showModel Display detailed model summary and parameter estimates
#' @param showEducational Display educational information about direct
#'   binomial regression
#' @param plotCIF Display cumulative incidence function plots
#' @param plotResiduals Display residual plots for model diagnostics
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$educationalInfo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$coefficientsTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$cumulativeIncidenceTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$covariateEffectsTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$goodnessOfFit} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$residualAnalysis} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodsInfo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$cifPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelSummary$asDF}
#'
#' \code{as.data.frame(results$modelSummary)}
#'
#' @export
directbinomial <- function(
    data,
    time,
    event,
    covs,
    eventOfInterest = 1,
    times = "1, 3, 5",
    conf = 0.95,
    residuals = FALSE,
    predictions = TRUE,
    bootstrap = FALSE,
    nboot = 500,
    showModel = TRUE,
    showEducational = TRUE,
    plotCIF = TRUE,
    plotResiduals = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("directbinomial requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time)) time <- jmvcore::resolveQuo(jmvcore::enquo(time))
    if ( ! missing(event)) event <- jmvcore::resolveQuo(jmvcore::enquo(event))
    if ( ! missing(covs)) covs <- jmvcore::resolveQuo(jmvcore::enquo(covs))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time), time, NULL),
            `if`( ! missing(event), event, NULL),
            `if`( ! missing(covs), covs, NULL))


    options <- directbinomialOptions$new(
        time = time,
        event = event,
        covs = covs,
        eventOfInterest = eventOfInterest,
        times = times,
        conf = conf,
        residuals = residuals,
        predictions = predictions,
        bootstrap = bootstrap,
        nboot = nboot,
        showModel = showModel,
        showEducational = showEducational,
        plotCIF = plotCIF,
        plotResiduals = plotResiduals)

    analysis <- directbinomialClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

