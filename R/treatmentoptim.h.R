
# This file is automatically generated, you probably don't want to edit this

treatmentoptimOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "treatmentoptimOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            patientVars = NULL,
            treatmentOptions = NULL,
            responseVar = NULL,
            medicationVars = NULL,
            labVars = NULL,
            comorbidityVars = NULL,
            treatment_selection = TRUE,
            drug_interaction = TRUE,
            dose_optimization = FALSE,
            safety_assessment = TRUE,
            treatment_comparison = TRUE,
            prediction_model = "logistic",
            interaction_severity = "major_critical",
            dose_adjustment = TRUE,
            confidence_level = 0.95,
            treatment_plots = TRUE,
            interaction_network = FALSE,
            dose_response_plots = FALSE,
            clinical_guidelines = TRUE,
            pharmacokinetic_model = FALSE,
            population_model = TRUE,
            individual_factors = TRUE,
            evidence_level = "high_moderate",
            clinical_interpretation = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="treatmentoptim",
                requiresData=TRUE,
                ...)

            private$..patientVars <- jmvcore::OptionVariables$new(
                "patientVars",
                patientVars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..treatmentOptions <- jmvcore::OptionVariable$new(
                "treatmentOptions",
                treatmentOptions,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..responseVar <- jmvcore::OptionVariable$new(
                "responseVar",
                responseVar,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..medicationVars <- jmvcore::OptionVariables$new(
                "medicationVars",
                medicationVars,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..labVars <- jmvcore::OptionVariables$new(
                "labVars",
                labVars,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..comorbidityVars <- jmvcore::OptionVariables$new(
                "comorbidityVars",
                comorbidityVars,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..treatment_selection <- jmvcore::OptionBool$new(
                "treatment_selection",
                treatment_selection,
                default=TRUE)
            private$..drug_interaction <- jmvcore::OptionBool$new(
                "drug_interaction",
                drug_interaction,
                default=TRUE)
            private$..dose_optimization <- jmvcore::OptionBool$new(
                "dose_optimization",
                dose_optimization,
                default=FALSE)
            private$..safety_assessment <- jmvcore::OptionBool$new(
                "safety_assessment",
                safety_assessment,
                default=TRUE)
            private$..treatment_comparison <- jmvcore::OptionBool$new(
                "treatment_comparison",
                treatment_comparison,
                default=TRUE)
            private$..prediction_model <- jmvcore::OptionList$new(
                "prediction_model",
                prediction_model,
                options=list(
                    "logistic",
                    "random_forest",
                    "gradient_boosting",
                    "ensemble"),
                default="logistic")
            private$..interaction_severity <- jmvcore::OptionList$new(
                "interaction_severity",
                interaction_severity,
                options=list(
                    "all",
                    "major_critical",
                    "critical_only"),
                default="major_critical")
            private$..dose_adjustment <- jmvcore::OptionBool$new(
                "dose_adjustment",
                dose_adjustment,
                default=TRUE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..treatment_plots <- jmvcore::OptionBool$new(
                "treatment_plots",
                treatment_plots,
                default=TRUE)
            private$..interaction_network <- jmvcore::OptionBool$new(
                "interaction_network",
                interaction_network,
                default=FALSE)
            private$..dose_response_plots <- jmvcore::OptionBool$new(
                "dose_response_plots",
                dose_response_plots,
                default=FALSE)
            private$..clinical_guidelines <- jmvcore::OptionBool$new(
                "clinical_guidelines",
                clinical_guidelines,
                default=TRUE)
            private$..pharmacokinetic_model <- jmvcore::OptionBool$new(
                "pharmacokinetic_model",
                pharmacokinetic_model,
                default=FALSE)
            private$..population_model <- jmvcore::OptionBool$new(
                "population_model",
                population_model,
                default=TRUE)
            private$..individual_factors <- jmvcore::OptionBool$new(
                "individual_factors",
                individual_factors,
                default=TRUE)
            private$..evidence_level <- jmvcore::OptionList$new(
                "evidence_level",
                evidence_level,
                options=list(
                    "all",
                    "high_moderate",
                    "high_only"),
                default="high_moderate")
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)

            self$.addOption(private$..patientVars)
            self$.addOption(private$..treatmentOptions)
            self$.addOption(private$..responseVar)
            self$.addOption(private$..medicationVars)
            self$.addOption(private$..labVars)
            self$.addOption(private$..comorbidityVars)
            self$.addOption(private$..treatment_selection)
            self$.addOption(private$..drug_interaction)
            self$.addOption(private$..dose_optimization)
            self$.addOption(private$..safety_assessment)
            self$.addOption(private$..treatment_comparison)
            self$.addOption(private$..prediction_model)
            self$.addOption(private$..interaction_severity)
            self$.addOption(private$..dose_adjustment)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..treatment_plots)
            self$.addOption(private$..interaction_network)
            self$.addOption(private$..dose_response_plots)
            self$.addOption(private$..clinical_guidelines)
            self$.addOption(private$..pharmacokinetic_model)
            self$.addOption(private$..population_model)
            self$.addOption(private$..individual_factors)
            self$.addOption(private$..evidence_level)
            self$.addOption(private$..clinical_interpretation)
        }),
    active = list(
        patientVars = function() private$..patientVars$value,
        treatmentOptions = function() private$..treatmentOptions$value,
        responseVar = function() private$..responseVar$value,
        medicationVars = function() private$..medicationVars$value,
        labVars = function() private$..labVars$value,
        comorbidityVars = function() private$..comorbidityVars$value,
        treatment_selection = function() private$..treatment_selection$value,
        drug_interaction = function() private$..drug_interaction$value,
        dose_optimization = function() private$..dose_optimization$value,
        safety_assessment = function() private$..safety_assessment$value,
        treatment_comparison = function() private$..treatment_comparison$value,
        prediction_model = function() private$..prediction_model$value,
        interaction_severity = function() private$..interaction_severity$value,
        dose_adjustment = function() private$..dose_adjustment$value,
        confidence_level = function() private$..confidence_level$value,
        treatment_plots = function() private$..treatment_plots$value,
        interaction_network = function() private$..interaction_network$value,
        dose_response_plots = function() private$..dose_response_plots$value,
        clinical_guidelines = function() private$..clinical_guidelines$value,
        pharmacokinetic_model = function() private$..pharmacokinetic_model$value,
        population_model = function() private$..population_model$value,
        individual_factors = function() private$..individual_factors$value,
        evidence_level = function() private$..evidence_level$value,
        clinical_interpretation = function() private$..clinical_interpretation$value),
    private = list(
        ..patientVars = NA,
        ..treatmentOptions = NA,
        ..responseVar = NA,
        ..medicationVars = NA,
        ..labVars = NA,
        ..comorbidityVars = NA,
        ..treatment_selection = NA,
        ..drug_interaction = NA,
        ..dose_optimization = NA,
        ..safety_assessment = NA,
        ..treatment_comparison = NA,
        ..prediction_model = NA,
        ..interaction_severity = NA,
        ..dose_adjustment = NA,
        ..confidence_level = NA,
        ..treatment_plots = NA,
        ..interaction_network = NA,
        ..dose_response_plots = NA,
        ..clinical_guidelines = NA,
        ..pharmacokinetic_model = NA,
        ..population_model = NA,
        ..individual_factors = NA,
        ..evidence_level = NA,
        ..clinical_interpretation = NA)
)

treatmentoptimResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "treatmentoptimResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        summary = function() private$.items[["summary"]],
        treatmentSelection = function() private$.items[["treatmentSelection"]],
        drugInteractions = function() private$.items[["drugInteractions"]],
        doseOptimization = function() private$.items[["doseOptimization"]],
        safetyAssessment = function() private$.items[["safetyAssessment"]],
        treatmentComparison = function() private$.items[["treatmentComparison"]],
        predictionModel = function() private$.items[["predictionModel"]],
        treatmentPlots = function() private$.items[["treatmentPlots"]],
        interactionNetwork = function() private$.items[["interactionNetwork"]],
        doseResponsePlots = function() private$.items[["doseResponsePlots"]],
        clinicalGuidelines = function() private$.items[["clinicalGuidelines"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        pharmacokineticModel = function() private$.items[["pharmacokineticModel"]],
        technicalNotes = function() private$.items[["technicalNotes"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Treatment Optimization Framework",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Analysis Summary",
                visible="(treatment_selection || drug_interaction || dose_optimization)"))
            self$add(jmvcore::Table$new(
                options=options,
                name="treatmentSelection",
                title="Personalized Treatment Selection",
                visible="(treatment_selection)",
                columns=list(
                    list(
                        `name`="treatment_option", 
                        `title`="Treatment Option", 
                        `type`="text"),
                    list(
                        `name`="predicted_response", 
                        `title`="Predicted Response", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="confidence_interval", 
                        `title`="95% Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="risk_score", 
                        `title`="Risk Score", 
                        `type`="number"),
                    list(
                        `name`="benefit_score", 
                        `title`="Benefit Score", 
                        `type`="number"),
                    list(
                        `name`="recommendation_rank", 
                        `title`="Recommendation Rank", 
                        `type`="integer"),
                    list(
                        `name`="evidence_level", 
                        `title`="Evidence Level", 
                        `type`="text"),
                    list(
                        `name`="clinical_notes", 
                        `title`="Clinical Considerations", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="drugInteractions",
                title="Drug Interaction Analysis",
                visible="(drug_interaction)",
                columns=list(
                    list(
                        `name`="drug_combination", 
                        `title`="Drug Combination", 
                        `type`="text"),
                    list(
                        `name`="interaction_type", 
                        `title`="Interaction Type", 
                        `type`="text"),
                    list(
                        `name`="severity_level", 
                        `title`="Severity Level", 
                        `type`="text"),
                    list(
                        `name`="clinical_effect", 
                        `title`="Clinical Effect", 
                        `type`="text"),
                    list(
                        `name`="mechanism", 
                        `title`="Mechanism", 
                        `type`="text"),
                    list(
                        `name`="management", 
                        `title`="Clinical Management", 
                        `type`="text"),
                    list(
                        `name`="alternative_options", 
                        `title`="Alternative Options", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="doseOptimization",
                title="Dose Optimization Results",
                visible="(dose_optimization)",
                columns=list(
                    list(
                        `name`="medication", 
                        `title`="Medication", 
                        `type`="text"),
                    list(
                        `name`="recommended_dose", 
                        `title`="Recommended Dose", 
                        `type`="text"),
                    list(
                        `name`="dose_range", 
                        `title`="Therapeutic Range", 
                        `type`="text"),
                    list(
                        `name`="adjustment_factors", 
                        `title`="Adjustment Factors", 
                        `type`="text"),
                    list(
                        `name`="monitoring_parameters", 
                        `title`="Monitoring Parameters", 
                        `type`="text"),
                    list(
                        `name`="dose_frequency", 
                        `title`="Dosing Frequency", 
                        `type`="text"),
                    list(
                        `name`="clinical_notes", 
                        `title`="Clinical Notes", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="safetyAssessment",
                title="Safety Assessment & Contraindications",
                visible="(safety_assessment)",
                columns=list(
                    list(
                        `name`="safety_category", 
                        `title`="Safety Category", 
                        `type`="text"),
                    list(
                        `name`="risk_level", 
                        `title`="Risk Level", 
                        `type`="text"),
                    list(
                        `name`="contraindications", 
                        `title`="Contraindications", 
                        `type`="text"),
                    list(
                        `name`="precautions", 
                        `title`="Precautions", 
                        `type`="text"),
                    list(
                        `name`="monitoring_required", 
                        `title`="Monitoring Required", 
                        `type`="text"),
                    list(
                        `name`="risk_mitigation", 
                        `title`="Risk Mitigation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="treatmentComparison",
                title="Treatment Option Comparison",
                visible="(treatment_comparison)",
                columns=list(
                    list(
                        `name`="comparison_criteria", 
                        `title`="Comparison Criteria", 
                        `type`="text"),
                    list(
                        `name`="treatment_a", 
                        `title`="Treatment A", 
                        `type`="text"),
                    list(
                        `name`="treatment_b", 
                        `title`="Treatment B", 
                        `type`="text"),
                    list(
                        `name`="statistical_difference", 
                        `title`="Statistical Significance", 
                        `type`="text"),
                    list(
                        `name`="clinical_difference", 
                        `title`="Clinical Significance", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="predictionModel",
                title="Prediction Model Performance",
                visible="(treatment_selection && responseVar)",
                columns=list(
                    list(
                        `name`="model_metric", 
                        `title`="Performance Metric", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number"),
                    list(
                        `name`="confidence_interval", 
                        `title`="95% CI", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="treatmentPlots",
                title="Treatment Comparison Plots",
                width=800,
                height=600,
                requiresData=TRUE,
                visible="(treatment_plots)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="interactionNetwork",
                title="Drug Interaction Network",
                width=700,
                height=500,
                requiresData=TRUE,
                visible="(interaction_network)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="doseResponsePlots",
                title="Dose-Response Relationship",
                width=800,
                height=400,
                requiresData=TRUE,
                visible="(dose_response_plots)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalGuidelines",
                title="Clinical Practice Guidelines",
                visible="(clinical_guidelines)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation & Implementation",
                visible="(clinical_interpretation)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="pharmacokineticModel",
                title="Pharmacokinetic Model Results",
                visible="(pharmacokinetic_model)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="technicalNotes",
                title="Technical Notes & Methodology",
                visible=FALSE))}))

treatmentoptimBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "treatmentoptimBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "treatmentoptim",
                version = c(1,0,0),
                options = options,
                results = treatmentoptimResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = TRUE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Treatment Optimization Framework
#'
#' Treatment Optimization Framework provides personalized treatment selection,
#' drug interaction screening, and dose optimization based on individual 
#' patient
#' characteristics, medical history, and evidence-based clinical guidelines 
#' for
#' optimal therapeutic decision-making.
#' 
#'
#' @examples
#' data('histopathology', package='ClinicoPath')
#'
#' # Basic treatment optimization analysis
#' treatmentoptim(histopathology,
#'              patientVars = c('Age', 'Gender'),
#'              treatmentOptions = 'Treatment',
#'              responseVar = 'Response',
#'              treatment_selection = TRUE,
#'              dose_optimization = TRUE)
#'
#' @param data .
#' @param patientVars Patient characteristics for personalized treatment (age,
#'   gender, comorbidities, biomarkers)
#' @param treatmentOptions Available treatment options for comparison and
#'   selection
#' @param responseVar Treatment response or outcome variable (optional, for
#'   model training)
#' @param medicationVars Current medications for drug interaction screening
#'   (optional)
#' @param labVars Laboratory values for dose optimization and safety
#'   assessment (optional)
#' @param comorbidityVars Comorbidity variables for treatment safety
#'   assessment (optional)
#' @param treatment_selection Perform personalized treatment selection
#'   analysis
#' @param drug_interaction Perform comprehensive drug interaction screening
#' @param dose_optimization Perform dose optimization based on patient
#'   characteristics
#' @param safety_assessment Perform comprehensive safety assessment and
#'   contraindication checking
#' @param treatment_comparison Compare multiple treatment options with
#'   risk-benefit analysis
#' @param prediction_model Machine learning model for treatment response
#'   prediction
#' @param interaction_severity Filter drug interactions by clinical
#'   significance level
#' @param dose_adjustment Consider dose adjustment for age, weight, organ
#'   function
#' @param confidence_level Confidence level for prediction intervals and
#'   safety assessments
#' @param treatment_plots Create treatment comparison and outcome prediction
#'   plots
#' @param interaction_network Create network visualization of drug
#'   interactions
#' @param dose_response_plots Create dose-response relationship plots
#' @param clinical_guidelines Integrate evidence-based clinical practice
#'   guidelines
#' @param pharmacokinetic_model Apply pharmacokinetic models for dose
#'   optimization
#' @param population_model Use population-based treatment response models
#' @param individual_factors Consider individual patient factors in treatment
#'   selection
#' @param evidence_level Filter recommendations by evidence quality level
#' @param clinical_interpretation Provide clinical interpretation and
#'   implementation guidance
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$treatmentSelection} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$drugInteractions} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$doseOptimization} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$safetyAssessment} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$treatmentComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$predictionModel} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$treatmentPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$interactionNetwork} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$doseResponsePlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$clinicalGuidelines} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$pharmacokineticModel} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$technicalNotes} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$treatmentSelection$asDF}
#'
#' \code{as.data.frame(results$treatmentSelection)}
#'
#' @export
treatmentoptim <- function(
    data,
    patientVars,
    treatmentOptions,
    responseVar,
    medicationVars,
    labVars,
    comorbidityVars,
    treatment_selection = TRUE,
    drug_interaction = TRUE,
    dose_optimization = FALSE,
    safety_assessment = TRUE,
    treatment_comparison = TRUE,
    prediction_model = "logistic",
    interaction_severity = "major_critical",
    dose_adjustment = TRUE,
    confidence_level = 0.95,
    treatment_plots = TRUE,
    interaction_network = FALSE,
    dose_response_plots = FALSE,
    clinical_guidelines = TRUE,
    pharmacokinetic_model = FALSE,
    population_model = TRUE,
    individual_factors = TRUE,
    evidence_level = "high_moderate",
    clinical_interpretation = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("treatmentoptim requires jmvcore to be installed (restart may be required)")

    if ( ! missing(patientVars)) patientVars <- jmvcore::resolveQuo(jmvcore::enquo(patientVars))
    if ( ! missing(treatmentOptions)) treatmentOptions <- jmvcore::resolveQuo(jmvcore::enquo(treatmentOptions))
    if ( ! missing(responseVar)) responseVar <- jmvcore::resolveQuo(jmvcore::enquo(responseVar))
    if ( ! missing(medicationVars)) medicationVars <- jmvcore::resolveQuo(jmvcore::enquo(medicationVars))
    if ( ! missing(labVars)) labVars <- jmvcore::resolveQuo(jmvcore::enquo(labVars))
    if ( ! missing(comorbidityVars)) comorbidityVars <- jmvcore::resolveQuo(jmvcore::enquo(comorbidityVars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(patientVars), patientVars, NULL),
            `if`( ! missing(treatmentOptions), treatmentOptions, NULL),
            `if`( ! missing(responseVar), responseVar, NULL),
            `if`( ! missing(medicationVars), medicationVars, NULL),
            `if`( ! missing(labVars), labVars, NULL),
            `if`( ! missing(comorbidityVars), comorbidityVars, NULL))

    for (v in treatmentOptions) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in medicationVars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in comorbidityVars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- treatmentoptimOptions$new(
        patientVars = patientVars,
        treatmentOptions = treatmentOptions,
        responseVar = responseVar,
        medicationVars = medicationVars,
        labVars = labVars,
        comorbidityVars = comorbidityVars,
        treatment_selection = treatment_selection,
        drug_interaction = drug_interaction,
        dose_optimization = dose_optimization,
        safety_assessment = safety_assessment,
        treatment_comparison = treatment_comparison,
        prediction_model = prediction_model,
        interaction_severity = interaction_severity,
        dose_adjustment = dose_adjustment,
        confidence_level = confidence_level,
        treatment_plots = treatment_plots,
        interaction_network = interaction_network,
        dose_response_plots = dose_response_plots,
        clinical_guidelines = clinical_guidelines,
        pharmacokinetic_model = pharmacokinetic_model,
        population_model = population_model,
        individual_factors = individual_factors,
        evidence_level = evidence_level,
        clinical_interpretation = clinical_interpretation)

    analysis <- treatmentoptimClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

