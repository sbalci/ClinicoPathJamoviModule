
# This file is automatically generated, you probably don't want to edit this

jointfrailtyOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jointfrailtyOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            subjectID = NULL,
            time = NULL,
            event = NULL,
            terminal_time = NULL,
            terminal_event = NULL,
            covariates = NULL,
            recurrent_covariates = NULL,
            terminal_covariates = NULL,
            frailty_distribution = "gamma",
            recurrent_baseline = "weibull",
            terminal_baseline = "weibull",
            association_type = "shared_frailty",
            confidence_level = 0.95,
            max_iterations = 1000,
            convergence_tolerance = 0.000001,
            include_predictions = TRUE,
            include_residuals = TRUE,
            plotRecurrentHazard = TRUE,
            plotTerminalHazard = TRUE,
            plotFrailtyDistribution = TRUE,
            plotSurvivalPredictions = FALSE,
            plotResiduals = FALSE,
            showEducation = TRUE,
            showInterpretation = TRUE,
            exportResults = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jointfrailty",
                requiresData=TRUE,
                ...)

            private$..subjectID <- jmvcore::OptionVariable$new(
                "subjectID",
                subjectID,
                suggested=list(
                    "id"),
                permitted=list(
                    "factor",
                    "id"))
            private$..time <- jmvcore::OptionVariable$new(
                "time",
                time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event <- jmvcore::OptionVariable$new(
                "event",
                event,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..terminal_time <- jmvcore::OptionVariable$new(
                "terminal_time",
                terminal_time,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..terminal_event <- jmvcore::OptionVariable$new(
                "terminal_event",
                terminal_event,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..recurrent_covariates <- jmvcore::OptionVariables$new(
                "recurrent_covariates",
                recurrent_covariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..terminal_covariates <- jmvcore::OptionVariables$new(
                "terminal_covariates",
                terminal_covariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..frailty_distribution <- jmvcore::OptionList$new(
                "frailty_distribution",
                frailty_distribution,
                options=list(
                    "gamma",
                    "lognormal",
                    "positive_stable"),
                default="gamma")
            private$..recurrent_baseline <- jmvcore::OptionList$new(
                "recurrent_baseline",
                recurrent_baseline,
                options=list(
                    "weibull",
                    "exponential",
                    "splines"),
                default="weibull")
            private$..terminal_baseline <- jmvcore::OptionList$new(
                "terminal_baseline",
                terminal_baseline,
                options=list(
                    "weibull",
                    "exponential",
                    "splines"),
                default="weibull")
            private$..association_type <- jmvcore::OptionList$new(
                "association_type",
                association_type,
                options=list(
                    "shared_frailty",
                    "copula",
                    "joint_random_effects"),
                default="shared_frailty")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..max_iterations <- jmvcore::OptionInteger$new(
                "max_iterations",
                max_iterations,
                min=100,
                max=5000,
                default=1000)
            private$..convergence_tolerance <- jmvcore::OptionNumber$new(
                "convergence_tolerance",
                convergence_tolerance,
                min=1e-8,
                max=0.001,
                default=0.000001)
            private$..include_predictions <- jmvcore::OptionBool$new(
                "include_predictions",
                include_predictions,
                default=TRUE)
            private$..include_residuals <- jmvcore::OptionBool$new(
                "include_residuals",
                include_residuals,
                default=TRUE)
            private$..plotRecurrentHazard <- jmvcore::OptionBool$new(
                "plotRecurrentHazard",
                plotRecurrentHazard,
                default=TRUE)
            private$..plotTerminalHazard <- jmvcore::OptionBool$new(
                "plotTerminalHazard",
                plotTerminalHazard,
                default=TRUE)
            private$..plotFrailtyDistribution <- jmvcore::OptionBool$new(
                "plotFrailtyDistribution",
                plotFrailtyDistribution,
                default=TRUE)
            private$..plotSurvivalPredictions <- jmvcore::OptionBool$new(
                "plotSurvivalPredictions",
                plotSurvivalPredictions,
                default=FALSE)
            private$..plotResiduals <- jmvcore::OptionBool$new(
                "plotResiduals",
                plotResiduals,
                default=FALSE)
            private$..showEducation <- jmvcore::OptionBool$new(
                "showEducation",
                showEducation,
                default=TRUE)
            private$..showInterpretation <- jmvcore::OptionBool$new(
                "showInterpretation",
                showInterpretation,
                default=TRUE)
            private$..exportResults <- jmvcore::OptionBool$new(
                "exportResults",
                exportResults,
                default=FALSE)

            self$.addOption(private$..subjectID)
            self$.addOption(private$..time)
            self$.addOption(private$..event)
            self$.addOption(private$..terminal_time)
            self$.addOption(private$..terminal_event)
            self$.addOption(private$..covariates)
            self$.addOption(private$..recurrent_covariates)
            self$.addOption(private$..terminal_covariates)
            self$.addOption(private$..frailty_distribution)
            self$.addOption(private$..recurrent_baseline)
            self$.addOption(private$..terminal_baseline)
            self$.addOption(private$..association_type)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..max_iterations)
            self$.addOption(private$..convergence_tolerance)
            self$.addOption(private$..include_predictions)
            self$.addOption(private$..include_residuals)
            self$.addOption(private$..plotRecurrentHazard)
            self$.addOption(private$..plotTerminalHazard)
            self$.addOption(private$..plotFrailtyDistribution)
            self$.addOption(private$..plotSurvivalPredictions)
            self$.addOption(private$..plotResiduals)
            self$.addOption(private$..showEducation)
            self$.addOption(private$..showInterpretation)
            self$.addOption(private$..exportResults)
        }),
    active = list(
        subjectID = function() private$..subjectID$value,
        time = function() private$..time$value,
        event = function() private$..event$value,
        terminal_time = function() private$..terminal_time$value,
        terminal_event = function() private$..terminal_event$value,
        covariates = function() private$..covariates$value,
        recurrent_covariates = function() private$..recurrent_covariates$value,
        terminal_covariates = function() private$..terminal_covariates$value,
        frailty_distribution = function() private$..frailty_distribution$value,
        recurrent_baseline = function() private$..recurrent_baseline$value,
        terminal_baseline = function() private$..terminal_baseline$value,
        association_type = function() private$..association_type$value,
        confidence_level = function() private$..confidence_level$value,
        max_iterations = function() private$..max_iterations$value,
        convergence_tolerance = function() private$..convergence_tolerance$value,
        include_predictions = function() private$..include_predictions$value,
        include_residuals = function() private$..include_residuals$value,
        plotRecurrentHazard = function() private$..plotRecurrentHazard$value,
        plotTerminalHazard = function() private$..plotTerminalHazard$value,
        plotFrailtyDistribution = function() private$..plotFrailtyDistribution$value,
        plotSurvivalPredictions = function() private$..plotSurvivalPredictions$value,
        plotResiduals = function() private$..plotResiduals$value,
        showEducation = function() private$..showEducation$value,
        showInterpretation = function() private$..showInterpretation$value,
        exportResults = function() private$..exportResults$value),
    private = list(
        ..subjectID = NA,
        ..time = NA,
        ..event = NA,
        ..terminal_time = NA,
        ..terminal_event = NA,
        ..covariates = NA,
        ..recurrent_covariates = NA,
        ..terminal_covariates = NA,
        ..frailty_distribution = NA,
        ..recurrent_baseline = NA,
        ..terminal_baseline = NA,
        ..association_type = NA,
        ..confidence_level = NA,
        ..max_iterations = NA,
        ..convergence_tolerance = NA,
        ..include_predictions = NA,
        ..include_residuals = NA,
        ..plotRecurrentHazard = NA,
        ..plotTerminalHazard = NA,
        ..plotFrailtyDistribution = NA,
        ..plotSurvivalPredictions = NA,
        ..plotResiduals = NA,
        ..showEducation = NA,
        ..showInterpretation = NA,
        ..exportResults = NA)
)

jointfrailtyResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jointfrailtyResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        modelfit = function() private$.items[["modelfit"]],
        recurrentCoefficients = function() private$.items[["recurrentCoefficients"]],
        terminalCoefficients = function() private$.items[["terminalCoefficients"]],
        frailtyParameters = function() private$.items[["frailtyParameters"]],
        associationMeasures = function() private$.items[["associationMeasures"]],
        individualPredictions = function() private$.items[["individualPredictions"]],
        residualAnalysis = function() private$.items[["residualAnalysis"]],
        educationalContent = function() private$.items[["educationalContent"]],
        interpretationContent = function() private$.items[["interpretationContent"]],
        recurrentHazardPlot = function() private$.items[["recurrentHazardPlot"]],
        terminalHazardPlot = function() private$.items[["terminalHazardPlot"]],
        frailtyPlot = function() private$.items[["frailtyPlot"]],
        predictionsPlot = function() private$.items[["predictionsPlot"]],
        residualsPlot = function() private$.items[["residualsPlot"]],
        exportTable = function() private$.items[["exportTable"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Joint Frailty Models for Recurrent Events",
                refs=list(
                    "frailtypack",
                    "survival",
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Summary",
                clearWith=list(
                    "subjectID",
                    "time",
                    "event",
                    "terminal_time",
                    "terminal_event")))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelfit",
                title="Joint Model Fit Summary",
                rows=1,
                columns=list(
                    list(
                        `name`="subjects", 
                        `title`="Subjects", 
                        `type`="integer"),
                    list(
                        `name`="recurrent_events", 
                        `title`="Recurrent Events", 
                        `type`="integer"),
                    list(
                        `name`="terminal_events", 
                        `title`="Terminal Events", 
                        `type`="integer"),
                    list(
                        `name`="frailty_dist", 
                        `title`="Frailty Distribution", 
                        `type`="text"),
                    list(
                        `name`="association", 
                        `title`="Association Type", 
                        `type`="text"),
                    list(
                        `name`="loglik", 
                        `title`="Log-Likelihood", 
                        `type`="number"),
                    list(
                        `name`="aic", 
                        `title`="AIC", 
                        `type`="number"),
                    list(
                        `name`="bic", 
                        `title`="BIC", 
                        `type`="number")),
                clearWith=list(
                    "subjectID",
                    "time",
                    "event",
                    "terminal_time",
                    "terminal_event",
                    "frailty_distribution",
                    "association_type")))
            self$add(jmvcore::Table$new(
                options=options,
                name="recurrentCoefficients",
                title="Recurrent Process Coefficients",
                columns=list(
                    list(
                        `name`="covariate", 
                        `title`="Covariate", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="Std. Error", 
                        `type`="number"),
                    list(
                        `name`="z", 
                        `title`="z-value", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="hr", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_lower", 
                        `title`="HR Lower CI", 
                        `type`="number"),
                    list(
                        `name`="hr_upper", 
                        `title`="HR Upper CI", 
                        `type`="number")),
                clearWith=list(
                    "subjectID",
                    "time",
                    "event",
                    "covariates",
                    "recurrent_covariates",
                    "confidence_level")))
            self$add(jmvcore::Table$new(
                options=options,
                name="terminalCoefficients",
                title="Terminal Process Coefficients",
                columns=list(
                    list(
                        `name`="covariate", 
                        `title`="Covariate", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="Std. Error", 
                        `type`="number"),
                    list(
                        `name`="z", 
                        `title`="z-value", 
                        `type`="number"),
                    list(
                        `name`="p", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="hr", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_lower", 
                        `title`="HR Lower CI", 
                        `type`="number"),
                    list(
                        `name`="hr_upper", 
                        `title`="HR Upper CI", 
                        `type`="number")),
                clearWith=list(
                    "terminal_time",
                    "terminal_event",
                    "covariates",
                    "terminal_covariates",
                    "confidence_level")))
            self$add(jmvcore::Table$new(
                options=options,
                name="frailtyParameters",
                title="Frailty Model Parameters",
                rows=3,
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="Std. Error", 
                        `type`="number"),
                    list(
                        `name`="lower", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "frailty_distribution",
                    "association_type",
                    "confidence_level")))
            self$add(jmvcore::Table$new(
                options=options,
                name="associationMeasures",
                title="Association Between Processes",
                rows=2,
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Association Measure", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="Std. Error", 
                        `type`="number"),
                    list(
                        `name`="lower", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "association_type",
                    "confidence_level")))
            self$add(jmvcore::Table$new(
                options=options,
                name="individualPredictions",
                title="Individual Risk Predictions",
                visible="(include_predictions)",
                columns=list(
                    list(
                        `name`="subject", 
                        `title`="Subject ID", 
                        `type`="text"),
                    list(
                        `name`="frailty_estimate", 
                        `title`="Frailty Estimate", 
                        `type`="number"),
                    list(
                        `name`="recurrent_risk", 
                        `title`="Recurrent Risk", 
                        `type`="number"),
                    list(
                        `name`="terminal_risk", 
                        `title`="Terminal Risk", 
                        `type`="number"),
                    list(
                        `name`="risk_category", 
                        `title`="Risk Category", 
                        `type`="text")),
                clearWith=list(
                    "subjectID",
                    "include_predictions",
                    "covariates")))
            self$add(jmvcore::Table$new(
                options=options,
                name="residualAnalysis",
                title="Residual Analysis",
                visible="(include_residuals)",
                rows=4,
                columns=list(
                    list(
                        `name`="residual_type", 
                        `title`="Residual Type", 
                        `type`="text"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number"),
                    list(
                        `name`="sd", 
                        `title`="Std. Dev.", 
                        `type`="number"),
                    list(
                        `name`="test_statistic", 
                        `title`="Test Statistic", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "include_residuals",
                    "subjectID",
                    "time",
                    "event")))
            self$add(jmvcore::Html$new(
                options=options,
                name="educationalContent",
                title="Educational Overview",
                visible="(showEducation)",
                clearWith=list(
                    "frailty_distribution",
                    "association_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretationContent",
                title="Results Interpretation",
                visible="(showInterpretation)",
                clearWith=list(
                    "subjectID",
                    "time",
                    "event",
                    "terminal_time",
                    "terminal_event")))
            self$add(jmvcore::Image$new(
                options=options,
                name="recurrentHazardPlot",
                title="Recurrent Process Hazard Function",
                width=700,
                height=500,
                renderFun=".recurrentHazardPlot",
                visible="(plotRecurrentHazard)",
                requiresData=TRUE,
                clearWith=list(
                    "subjectID",
                    "time",
                    "event",
                    "covariates")))
            self$add(jmvcore::Image$new(
                options=options,
                name="terminalHazardPlot",
                title="Terminal Process Hazard Function",
                width=700,
                height=500,
                renderFun=".terminalHazardPlot",
                visible="(plotTerminalHazard)",
                requiresData=TRUE,
                clearWith=list(
                    "terminal_time",
                    "terminal_event",
                    "terminal_covariates")))
            self$add(jmvcore::Image$new(
                options=options,
                name="frailtyPlot",
                title="Frailty Distribution",
                width=600,
                height=500,
                renderFun=".frailtyPlot",
                visible="(plotFrailtyDistribution)",
                requiresData=TRUE,
                clearWith=list(
                    "frailty_distribution",
                    "subjectID")))
            self$add(jmvcore::Image$new(
                options=options,
                name="predictionsPlot",
                title="Survival Predictions by Frailty",
                width=800,
                height=600,
                renderFun=".predictionsPlot",
                visible="(plotSurvivalPredictions)",
                requiresData=TRUE,
                clearWith=list(
                    "include_predictions",
                    "subjectID")))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualsPlot",
                title="Model Residuals",
                width=800,
                height=600,
                renderFun=".residualsPlot",
                visible="(plotResiduals)",
                requiresData=TRUE,
                clearWith=list(
                    "include_residuals",
                    "subjectID")))
            self$add(jmvcore::Table$new(
                options=options,
                name="exportTable",
                title="Exported Results",
                visible="(exportResults)",
                columns=list(
                    list(
                        `name`="component", 
                        `title`="Model Component", 
                        `type`="text"),
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "exportResults")))}))

jointfrailtyBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jointfrailtyBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jointfrailty",
                version = c(0,0,1),
                options = options,
                results = jointfrailtyResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Joint Frailty Models for Recurrent Events
#'
#' Joint frailty models for simultaneous analysis of recurrent and terminal 
#' events.  This analysis models both the recurrent event process and terminal 
#' event process  jointly, accounting for their association through shared 
#' frailty terms and providing  comprehensive risk assessment for subjects 
#' experiencing multiple types of events.
#'
#' @examples
#' data('histopathology', package='ClinicoPath')
#'
#' @param data .
#' @param subjectID .
#' @param time .
#' @param event .
#' @param terminal_time .
#' @param terminal_event .
#' @param covariates .
#' @param recurrent_covariates .
#' @param terminal_covariates .
#' @param frailty_distribution .
#' @param recurrent_baseline .
#' @param terminal_baseline .
#' @param association_type .
#' @param confidence_level .
#' @param max_iterations .
#' @param convergence_tolerance .
#' @param include_predictions .
#' @param include_residuals .
#' @param plotRecurrentHazard .
#' @param plotTerminalHazard .
#' @param plotFrailtyDistribution .
#' @param plotSurvivalPredictions .
#' @param plotResiduals .
#' @param showEducation .
#' @param showInterpretation .
#' @param exportResults .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelfit} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$recurrentCoefficients} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$terminalCoefficients} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$frailtyParameters} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$associationMeasures} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$individualPredictions} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$residualAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$educationalContent} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretationContent} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$recurrentHazardPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$terminalHazardPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$frailtyPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$predictionsPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualsPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$exportTable} \tab \tab \tab \tab \tab a table \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelfit$asDF}
#'
#' \code{as.data.frame(results$modelfit)}
#'
#' @export
jointfrailty <- function(
    data,
    subjectID,
    time,
    event,
    terminal_time,
    terminal_event,
    covariates,
    recurrent_covariates,
    terminal_covariates,
    frailty_distribution = "gamma",
    recurrent_baseline = "weibull",
    terminal_baseline = "weibull",
    association_type = "shared_frailty",
    confidence_level = 0.95,
    max_iterations = 1000,
    convergence_tolerance = 0.000001,
    include_predictions = TRUE,
    include_residuals = TRUE,
    plotRecurrentHazard = TRUE,
    plotTerminalHazard = TRUE,
    plotFrailtyDistribution = TRUE,
    plotSurvivalPredictions = FALSE,
    plotResiduals = FALSE,
    showEducation = TRUE,
    showInterpretation = TRUE,
    exportResults = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jointfrailty requires jmvcore to be installed (restart may be required)")

    if ( ! missing(subjectID)) subjectID <- jmvcore::resolveQuo(jmvcore::enquo(subjectID))
    if ( ! missing(time)) time <- jmvcore::resolveQuo(jmvcore::enquo(time))
    if ( ! missing(event)) event <- jmvcore::resolveQuo(jmvcore::enquo(event))
    if ( ! missing(terminal_time)) terminal_time <- jmvcore::resolveQuo(jmvcore::enquo(terminal_time))
    if ( ! missing(terminal_event)) terminal_event <- jmvcore::resolveQuo(jmvcore::enquo(terminal_event))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))
    if ( ! missing(recurrent_covariates)) recurrent_covariates <- jmvcore::resolveQuo(jmvcore::enquo(recurrent_covariates))
    if ( ! missing(terminal_covariates)) terminal_covariates <- jmvcore::resolveQuo(jmvcore::enquo(terminal_covariates))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(subjectID), subjectID, NULL),
            `if`( ! missing(time), time, NULL),
            `if`( ! missing(event), event, NULL),
            `if`( ! missing(terminal_time), terminal_time, NULL),
            `if`( ! missing(terminal_event), terminal_event, NULL),
            `if`( ! missing(covariates), covariates, NULL),
            `if`( ! missing(recurrent_covariates), recurrent_covariates, NULL),
            `if`( ! missing(terminal_covariates), terminal_covariates, NULL))

    for (v in event) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in terminal_event) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jointfrailtyOptions$new(
        subjectID = subjectID,
        time = time,
        event = event,
        terminal_time = terminal_time,
        terminal_event = terminal_event,
        covariates = covariates,
        recurrent_covariates = recurrent_covariates,
        terminal_covariates = terminal_covariates,
        frailty_distribution = frailty_distribution,
        recurrent_baseline = recurrent_baseline,
        terminal_baseline = terminal_baseline,
        association_type = association_type,
        confidence_level = confidence_level,
        max_iterations = max_iterations,
        convergence_tolerance = convergence_tolerance,
        include_predictions = include_predictions,
        include_residuals = include_residuals,
        plotRecurrentHazard = plotRecurrentHazard,
        plotTerminalHazard = plotTerminalHazard,
        plotFrailtyDistribution = plotFrailtyDistribution,
        plotSurvivalPredictions = plotSurvivalPredictions,
        plotResiduals = plotResiduals,
        showEducation = showEducation,
        showInterpretation = showInterpretation,
        exportResults = exportResults)

    analysis <- jointfrailtyClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

