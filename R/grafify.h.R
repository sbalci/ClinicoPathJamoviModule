
# This file is automatically generated, you probably don't want to edit this

grafifyOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "grafifyOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            vars = NULL,
            groups = NULL,
            blocks = NULL,
            facet_var = NULL,
            plot_type = "scatterbar",
            x_var = NULL,
            y_var = NULL,
            error_type = "sd",
            summary_function = "mean",
            color_palette = "default",
            reverse_palette = FALSE,
            use_grafify_theme = TRUE,
            jitter_width = 0.3,
            transparency = 0.7,
            point_size = 3,
            line_size = 1,
            log_transform = "none",
            add_statistics = FALSE,
            stat_method = "anova_1way",
            posthoc_comparisons = FALSE,
            comparison_method = "pairwise",
            befafter_shape_var = NULL,
            befafter_id_var = NULL,
            show_individual_points = TRUE,
            show_summary_stats = TRUE,
            show_model_diagnostics = FALSE,
            export_data = FALSE,
            plot_width = 8,
            plot_height = 6,
            title_text = "",
            x_label = "",
            y_label = "",
            legend_position = "right",
            experimental_design = "crd",
            random_effects = NULL,
            alpha_level = 0.05, ...) {

            super$initialize(
                package="ClinicoPath",
                name="grafify",
                requiresData=TRUE,
                ...)

            private$..vars <- jmvcore::OptionVariables$new(
                "vars",
                vars,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..groups <- jmvcore::OptionVariable$new(
                "groups",
                groups,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..blocks <- jmvcore::OptionVariable$new(
                "blocks",
                blocks,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "scatterbar",
                    "scatterbox",
                    "scatterviolin",
                    "dotbar",
                    "dotbox",
                    "dotviolin",
                    "befafter_box",
                    "befafter_colors",
                    "scatter_3d",
                    "scatter_4d",
                    "density",
                    "histogram",
                    "xy_catgroup",
                    "xy_numgroup"),
                default="scatterbar")
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "continuous",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..error_type <- jmvcore::OptionList$new(
                "error_type",
                error_type,
                options=list(
                    "sd",
                    "sem",
                    "ci95",
                    "none"),
                default="sd")
            private$..summary_function <- jmvcore::OptionList$new(
                "summary_function",
                summary_function,
                options=list(
                    "mean",
                    "median",
                    "geomean"),
                default="mean")
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "default",
                    "vibrant",
                    "contrast",
                    "bright",
                    "pale",
                    "dark",
                    "earth",
                    "spring",
                    "summer",
                    "autumn",
                    "winter",
                    "fishy"),
                default="default")
            private$..reverse_palette <- jmvcore::OptionBool$new(
                "reverse_palette",
                reverse_palette,
                default=FALSE)
            private$..use_grafify_theme <- jmvcore::OptionBool$new(
                "use_grafify_theme",
                use_grafify_theme,
                default=TRUE)
            private$..jitter_width <- jmvcore::OptionNumber$new(
                "jitter_width",
                jitter_width,
                default=0.3,
                min=0,
                max=1)
            private$..transparency <- jmvcore::OptionNumber$new(
                "transparency",
                transparency,
                default=0.7,
                min=0.1,
                max=1)
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                default=3,
                min=0.5,
                max=10)
            private$..line_size <- jmvcore::OptionNumber$new(
                "line_size",
                line_size,
                default=1,
                min=0.1,
                max=3)
            private$..log_transform <- jmvcore::OptionList$new(
                "log_transform",
                log_transform,
                options=list(
                    "none",
                    "log10_y",
                    "log10_x",
                    "log10_both",
                    "ln_y",
                    "ln_x",
                    "ln_both"),
                default="none")
            private$..add_statistics <- jmvcore::OptionBool$new(
                "add_statistics",
                add_statistics,
                default=FALSE)
            private$..stat_method <- jmvcore::OptionList$new(
                "stat_method",
                stat_method,
                options=list(
                    "anova_1way",
                    "anova_2way",
                    "mixed_model",
                    "ttest",
                    "correlation"),
                default="anova_1way")
            private$..posthoc_comparisons <- jmvcore::OptionBool$new(
                "posthoc_comparisons",
                posthoc_comparisons,
                default=FALSE)
            private$..comparison_method <- jmvcore::OptionList$new(
                "comparison_method",
                comparison_method,
                options=list(
                    "pairwise",
                    "vs_ref",
                    "trends",
                    "levelwise"),
                default="pairwise")
            private$..befafter_shape_var <- jmvcore::OptionVariable$new(
                "befafter_shape_var",
                befafter_shape_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..befafter_id_var <- jmvcore::OptionVariable$new(
                "befafter_id_var",
                befafter_id_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "id"),
                default=NULL)
            private$..show_individual_points <- jmvcore::OptionBool$new(
                "show_individual_points",
                show_individual_points,
                default=TRUE)
            private$..show_summary_stats <- jmvcore::OptionBool$new(
                "show_summary_stats",
                show_summary_stats,
                default=TRUE)
            private$..show_model_diagnostics <- jmvcore::OptionBool$new(
                "show_model_diagnostics",
                show_model_diagnostics,
                default=FALSE)
            private$..export_data <- jmvcore::OptionBool$new(
                "export_data",
                export_data,
                default=FALSE)
            private$..plot_width <- jmvcore::OptionNumber$new(
                "plot_width",
                plot_width,
                default=8,
                min=4,
                max=16)
            private$..plot_height <- jmvcore::OptionNumber$new(
                "plot_height",
                plot_height,
                default=6,
                min=3,
                max=12)
            private$..title_text <- jmvcore::OptionString$new(
                "title_text",
                title_text,
                default="")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..legend_position <- jmvcore::OptionList$new(
                "legend_position",
                legend_position,
                options=list(
                    "right",
                    "left",
                    "top",
                    "bottom",
                    "none"),
                default="right")
            private$..experimental_design <- jmvcore::OptionList$new(
                "experimental_design",
                experimental_design,
                options=list(
                    "crd",
                    "rbd",
                    "repeated",
                    "factorial",
                    "before_after"),
                default="crd")
            private$..random_effects <- jmvcore::OptionVariables$new(
                "random_effects",
                random_effects,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor",
                    "id"),
                default=NULL)
            private$..alpha_level <- jmvcore::OptionNumber$new(
                "alpha_level",
                alpha_level,
                default=0.05,
                min=0.001,
                max=0.1)

            self$.addOption(private$..vars)
            self$.addOption(private$..groups)
            self$.addOption(private$..blocks)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..error_type)
            self$.addOption(private$..summary_function)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..reverse_palette)
            self$.addOption(private$..use_grafify_theme)
            self$.addOption(private$..jitter_width)
            self$.addOption(private$..transparency)
            self$.addOption(private$..point_size)
            self$.addOption(private$..line_size)
            self$.addOption(private$..log_transform)
            self$.addOption(private$..add_statistics)
            self$.addOption(private$..stat_method)
            self$.addOption(private$..posthoc_comparisons)
            self$.addOption(private$..comparison_method)
            self$.addOption(private$..befafter_shape_var)
            self$.addOption(private$..befafter_id_var)
            self$.addOption(private$..show_individual_points)
            self$.addOption(private$..show_summary_stats)
            self$.addOption(private$..show_model_diagnostics)
            self$.addOption(private$..export_data)
            self$.addOption(private$..plot_width)
            self$.addOption(private$..plot_height)
            self$.addOption(private$..title_text)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..legend_position)
            self$.addOption(private$..experimental_design)
            self$.addOption(private$..random_effects)
            self$.addOption(private$..alpha_level)
        }),
    active = list(
        vars = function() private$..vars$value,
        groups = function() private$..groups$value,
        blocks = function() private$..blocks$value,
        facet_var = function() private$..facet_var$value,
        plot_type = function() private$..plot_type$value,
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        error_type = function() private$..error_type$value,
        summary_function = function() private$..summary_function$value,
        color_palette = function() private$..color_palette$value,
        reverse_palette = function() private$..reverse_palette$value,
        use_grafify_theme = function() private$..use_grafify_theme$value,
        jitter_width = function() private$..jitter_width$value,
        transparency = function() private$..transparency$value,
        point_size = function() private$..point_size$value,
        line_size = function() private$..line_size$value,
        log_transform = function() private$..log_transform$value,
        add_statistics = function() private$..add_statistics$value,
        stat_method = function() private$..stat_method$value,
        posthoc_comparisons = function() private$..posthoc_comparisons$value,
        comparison_method = function() private$..comparison_method$value,
        befafter_shape_var = function() private$..befafter_shape_var$value,
        befafter_id_var = function() private$..befafter_id_var$value,
        show_individual_points = function() private$..show_individual_points$value,
        show_summary_stats = function() private$..show_summary_stats$value,
        show_model_diagnostics = function() private$..show_model_diagnostics$value,
        export_data = function() private$..export_data$value,
        plot_width = function() private$..plot_width$value,
        plot_height = function() private$..plot_height$value,
        title_text = function() private$..title_text$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        legend_position = function() private$..legend_position$value,
        experimental_design = function() private$..experimental_design$value,
        random_effects = function() private$..random_effects$value,
        alpha_level = function() private$..alpha_level$value),
    private = list(
        ..vars = NA,
        ..groups = NA,
        ..blocks = NA,
        ..facet_var = NA,
        ..plot_type = NA,
        ..x_var = NA,
        ..y_var = NA,
        ..error_type = NA,
        ..summary_function = NA,
        ..color_palette = NA,
        ..reverse_palette = NA,
        ..use_grafify_theme = NA,
        ..jitter_width = NA,
        ..transparency = NA,
        ..point_size = NA,
        ..line_size = NA,
        ..log_transform = NA,
        ..add_statistics = NA,
        ..stat_method = NA,
        ..posthoc_comparisons = NA,
        ..comparison_method = NA,
        ..befafter_shape_var = NA,
        ..befafter_id_var = NA,
        ..show_individual_points = NA,
        ..show_summary_stats = NA,
        ..show_model_diagnostics = NA,
        ..export_data = NA,
        ..plot_width = NA,
        ..plot_height = NA,
        ..title_text = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..legend_position = NA,
        ..experimental_design = NA,
        ..random_effects = NA,
        ..alpha_level = NA)
)

grafifyResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "grafifyResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        main_plot = function() private$.items[["main_plot"]],
        summary_stats = function() private$.items[["summary_stats"]],
        statistical_analysis = function() private$.items[["statistical_analysis"]],
        posthoc_results = function() private$.items[["posthoc_results"]],
        diagnostic_plots = function() private$.items[["diagnostic_plots"]],
        qqplot = function() private$.items[["qqplot"]],
        palette_preview = function() private$.items[["palette_preview"]],
        plot_interpretation = function() private$.items[["plot_interpretation"]],
        export_info = function() private$.items[["export_info"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Scientific Visualization with Grafify")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Image$new(
                options=options,
                name="main_plot",
                title="Grafify Scientific Plot",
                width=800,
                height=600,
                renderFun=".plot_main",
                visible=TRUE,
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "plot_type",
                    "color_palette",
                    "error_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary_stats",
                title="Summary Statistics",
                visible="(show_summary_stats)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "summary_function")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistical_analysis",
                title="Statistical Analysis Results",
                visible="(add_statistics)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "stat_method",
                    "experimental_design")))
            self$add(jmvcore::Html$new(
                options=options,
                name="posthoc_results",
                title="Post-hoc Comparisons",
                visible="(posthoc_comparisons && add_statistics)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "comparison_method",
                    "alpha_level")))
            self$add(jmvcore::Image$new(
                options=options,
                name="diagnostic_plots",
                title="Model Diagnostic Plots",
                width=800,
                height=600,
                renderFun=".plot_diagnostics",
                visible="(show_model_diagnostics && add_statistics)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "stat_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="qqplot",
                title="Q-Q Plot for Normality",
                width=600,
                height=500,
                renderFun=".plot_qq",
                visible="(show_model_diagnostics && add_statistics)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups",
                    "stat_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="palette_preview",
                title="Color Palette Preview",
                width=600,
                height=200,
                renderFun=".plot_palette",
                visible=TRUE,
                clearWith=list(
                    "color_palette",
                    "reverse_palette")))
            self$add(jmvcore::Html$new(
                options=options,
                name="plot_interpretation",
                title="Plot Interpretation Guide",
                visible=TRUE,
                clearWith=list(
                    "plot_type",
                    "experimental_design")))
            self$add(jmvcore::Html$new(
                options=options,
                name="export_info",
                title="Data Export Information",
                visible="(export_data)",
                clearWith=list(
                    "vars",
                    "x_var",
                    "y_var",
                    "groups")))}))

grafifyBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "grafifyBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "grafify",
                version = c(0,0,31),
                options = options,
                results = grafifyResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Scientific Visualization with Grafify
#'
#' Scientific data visualization using the grafify R package for easy and 
#' accessible plotting.
#' Provides quick exploration graphs with few lines of code, color-blind 
#' friendly palettes,
#' and integrated statistical analysis. Perfect for clinical research, 
#' experimental data,
#' and scientific publications. Features scatter plots with error bars, 
#' distribution plots,
#' before-after comparisons, and factorial designs with professional styling.
#' 
#'
#' @examples
#' # Example: Scientific scatter plot with error bars
#' data(clinical_data)
#' grafify(
#'     data = clinical_data,
#'     vars = c("biomarker1", "biomarker2"),
#'     groups = "treatment_group",
#'     plot_type = "scatterbar",
#'     error_type = "sd",
#'     color_palette = "vibrant"
#' )
#'
#' @param data The data as a data frame containing scientific or clinical
#'   variables for professional visualization with grafify.
#' @param vars Continuous variables for plotting. Can be used as X, Y
#'   variables or multiple variables for distribution analysis.
#' @param groups Categorical variable for grouping data in plots. Creates
#'   different colors, shapes, or panels for each group.
#' @param blocks Variable for blocking or pairing observations. Used in
#'   randomized block designs or before-after comparisons.
#' @param facet_var Variable for creating multiple panels (facets). Useful for
#'   complex experimental designs with multiple factors.
#' @param plot_type Type of plot to create. Each type is optimized for
#'   different data structures and research questions.
#' @param x_var Variable for X-axis. Can be continuous or categorical
#'   depending on the plot type selected.
#' @param y_var Variable for Y-axis. Should be continuous for most plot types.
#' @param error_type Type of error bars to display. SD shows data spread, SEM
#'   shows precision of mean, CI95 shows statistical confidence.
#' @param summary_function Function used to summarize data for central
#'   tendency. Geometric mean is useful for log-scaled or ratio data.
#' @param color_palette Color palette for the plot. All palettes are
#'   color-blind friendly and designed for scientific publications.
#' @param reverse_palette Reverse the order of colors in the selected palette.
#'   Useful for adjusting color assignments to groups.
#' @param use_grafify_theme Apply the grafify theme for classic-style
#'   scientific plots. Provides clean, publication-ready styling.
#' @param jitter_width Amount of horizontal jittering for data points. Helps
#'   avoid overlapping points in categorical plots.
#' @param transparency Transparency level for data points (alpha value). Lower
#'   values make points more transparent.
#' @param point_size Size of data points in the plot.
#' @param line_size Thickness of lines (error bars, connecting lines).
#' @param log_transform Apply logarithmic transformation to axes. Useful for
#'   data spanning multiple orders of magnitude.
#' @param add_statistics Perform and display statistical analysis on the plot.
#'   Integrates with grafify's built-in statistical functions.
#' @param stat_method Statistical method to apply. Results will be displayed
#'   as text annotations or in separate output sections.
#' @param posthoc_comparisons Perform post-hoc pairwise comparisons after
#'   ANOVA. Uses emmeans for estimated marginal means and contrasts.
#' @param comparison_method Method for post-hoc comparisons. Pairwise compares
#'   all groups, vs reference compares to control group, trends test for
#'   patterns.
#' @param befafter_shape_var Variable defining before/after or timepoint for
#'   paired data. Used in before-after plot types.
#' @param befafter_id_var Variable identifying individual subjects or
#'   experimental units. Used to connect paired observations in before-after
#'   plots.
#' @param show_individual_points Display individual data points on the plot.
#'   Recommended for transparency and data exploration.
#' @param show_summary_stats Display summary statistics table with means, SD,
#'   SEM, and sample sizes.
#' @param show_model_diagnostics Display model diagnostic plots (Q-Q plots,
#'   residuals) when statistical analysis is performed.
#' @param export_data Export the processed data used for plotting. Includes
#'   summary statistics and model results.
#' @param plot_width Width of the plot in inches for optimal display and
#'   export.
#' @param plot_height Height of the plot in inches for optimal display and
#'   export.
#' @param title_text Custom title for the plot. Leave empty for automatic
#'   title based on variables and analysis type.
#' @param x_label Custom label for X-axis. Leave empty to use variable name.
#' @param y_label Custom label for Y-axis. Leave empty to use variable name.
#' @param legend_position Position of the plot legend.
#' @param experimental_design Type of experimental design for appropriate
#'   statistical analysis. Affects model specification and interpretation.
#' @param random_effects Variables to include as random effects in mixed
#'   models. Typically subjects, blocks, or experimental units.
#' @param alpha_level Significance level for statistical tests and confidence
#'   intervals.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$main_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$summary_stats} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$statistical_analysis} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$posthoc_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$diagnostic_plots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$qqplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$palette_preview} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$plot_interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$export_info} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
grafify <- function(
    data,
    vars,
    groups = NULL,
    blocks = NULL,
    facet_var = NULL,
    plot_type = "scatterbar",
    x_var,
    y_var,
    error_type = "sd",
    summary_function = "mean",
    color_palette = "default",
    reverse_palette = FALSE,
    use_grafify_theme = TRUE,
    jitter_width = 0.3,
    transparency = 0.7,
    point_size = 3,
    line_size = 1,
    log_transform = "none",
    add_statistics = FALSE,
    stat_method = "anova_1way",
    posthoc_comparisons = FALSE,
    comparison_method = "pairwise",
    befafter_shape_var = NULL,
    befafter_id_var = NULL,
    show_individual_points = TRUE,
    show_summary_stats = TRUE,
    show_model_diagnostics = FALSE,
    export_data = FALSE,
    plot_width = 8,
    plot_height = 6,
    title_text = "",
    x_label = "",
    y_label = "",
    legend_position = "right",
    experimental_design = "crd",
    random_effects = NULL,
    alpha_level = 0.05) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("grafify requires jmvcore to be installed (restart may be required)")

    if ( ! missing(vars)) vars <- jmvcore::resolveQuo(jmvcore::enquo(vars))
    if ( ! missing(groups)) groups <- jmvcore::resolveQuo(jmvcore::enquo(groups))
    if ( ! missing(blocks)) blocks <- jmvcore::resolveQuo(jmvcore::enquo(blocks))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(befafter_shape_var)) befafter_shape_var <- jmvcore::resolveQuo(jmvcore::enquo(befafter_shape_var))
    if ( ! missing(befafter_id_var)) befafter_id_var <- jmvcore::resolveQuo(jmvcore::enquo(befafter_id_var))
    if ( ! missing(random_effects)) random_effects <- jmvcore::resolveQuo(jmvcore::enquo(random_effects))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(vars), vars, NULL),
            `if`( ! missing(groups), groups, NULL),
            `if`( ! missing(blocks), blocks, NULL),
            `if`( ! missing(facet_var), facet_var, NULL),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(befafter_shape_var), befafter_shape_var, NULL),
            `if`( ! missing(befafter_id_var), befafter_id_var, NULL),
            `if`( ! missing(random_effects), random_effects, NULL))

    for (v in groups) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in blocks) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in befafter_shape_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- grafifyOptions$new(
        vars = vars,
        groups = groups,
        blocks = blocks,
        facet_var = facet_var,
        plot_type = plot_type,
        x_var = x_var,
        y_var = y_var,
        error_type = error_type,
        summary_function = summary_function,
        color_palette = color_palette,
        reverse_palette = reverse_palette,
        use_grafify_theme = use_grafify_theme,
        jitter_width = jitter_width,
        transparency = transparency,
        point_size = point_size,
        line_size = line_size,
        log_transform = log_transform,
        add_statistics = add_statistics,
        stat_method = stat_method,
        posthoc_comparisons = posthoc_comparisons,
        comparison_method = comparison_method,
        befafter_shape_var = befafter_shape_var,
        befafter_id_var = befafter_id_var,
        show_individual_points = show_individual_points,
        show_summary_stats = show_summary_stats,
        show_model_diagnostics = show_model_diagnostics,
        export_data = export_data,
        plot_width = plot_width,
        plot_height = plot_height,
        title_text = title_text,
        x_label = x_label,
        y_label = y_label,
        legend_position = legend_position,
        experimental_design = experimental_design,
        random_effects = random_effects,
        alpha_level = alpha_level)

    analysis <- grafifyClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

