
# This file is automatically generated, you probably don't want to edit this

emfrailtyOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "emfrailtyOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            elapsedtime = NULL,
            outcome = NULL,
            covariates = NULL,
            frailty_variable = NULL,
            outcomeLevel = "1",
            frailty_distribution = "gamma",
            estimation_method = "em",
            baseline_hazard = "weibull",
            ties_method = "breslow",
            confidence_level = 0.95,
            max_iterations = 100,
            convergence_tolerance = 0.000001,
            em_acceleration = FALSE,
            variance_estimation = "observed_information",
            bootstrap_samples = 500,
            frailty_prediction = TRUE,
            model_selection = FALSE,
            diagnostic_plots = TRUE,
            show_model_summary = TRUE,
            show_coefficients = TRUE,
            show_frailty_analysis = TRUE,
            show_convergence = TRUE,
            show_diagnostics = TRUE,
            show_predictions = TRUE,
            show_comparison = TRUE,
            show_convergence_plots = TRUE,
            show_frailty_plots = TRUE,
            show_residual_plots = TRUE,
            show_survival_plots = TRUE,
            showSummaries = FALSE,
            showExplanations = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="emfrailty",
                requiresData=TRUE,
                ...)

            private$..elapsedtime <- jmvcore::OptionVariable$new(
                "elapsedtime",
                elapsedtime,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..outcome <- jmvcore::OptionVariable$new(
                "outcome",
                outcome,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..frailty_variable <- jmvcore::OptionVariable$new(
                "frailty_variable",
                frailty_variable,
                permitted=list(
                    "factor",
                    "numeric"))
            private$..outcomeLevel <- jmvcore::OptionString$new(
                "outcomeLevel",
                outcomeLevel,
                default="1")
            private$..frailty_distribution <- jmvcore::OptionList$new(
                "frailty_distribution",
                frailty_distribution,
                options=list(
                    "gamma",
                    "lognormal",
                    "inverse_gaussian",
                    "stable"),
                default="gamma")
            private$..estimation_method <- jmvcore::OptionList$new(
                "estimation_method",
                estimation_method,
                options=list(
                    "em",
                    "penalized_em",
                    "accelerated_em",
                    "stochastic_em"),
                default="em")
            private$..baseline_hazard <- jmvcore::OptionList$new(
                "baseline_hazard",
                baseline_hazard,
                options=list(
                    "weibull",
                    "exponential",
                    "spline",
                    "nonparametric"),
                default="weibull")
            private$..ties_method <- jmvcore::OptionList$new(
                "ties_method",
                ties_method,
                options=list(
                    "breslow",
                    "efron",
                    "exact"),
                default="breslow")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..max_iterations <- jmvcore::OptionNumber$new(
                "max_iterations",
                max_iterations,
                min=10,
                max=1000,
                default=100)
            private$..convergence_tolerance <- jmvcore::OptionNumber$new(
                "convergence_tolerance",
                convergence_tolerance,
                min=1e-8,
                max=0.01,
                default=0.000001)
            private$..em_acceleration <- jmvcore::OptionBool$new(
                "em_acceleration",
                em_acceleration,
                default=FALSE)
            private$..variance_estimation <- jmvcore::OptionList$new(
                "variance_estimation",
                variance_estimation,
                options=list(
                    "observed_information",
                    "louis_method",
                    "bootstrap",
                    "profile_likelihood"),
                default="observed_information")
            private$..bootstrap_samples <- jmvcore::OptionNumber$new(
                "bootstrap_samples",
                bootstrap_samples,
                min=100,
                max=2000,
                default=500)
            private$..frailty_prediction <- jmvcore::OptionBool$new(
                "frailty_prediction",
                frailty_prediction,
                default=TRUE)
            private$..model_selection <- jmvcore::OptionBool$new(
                "model_selection",
                model_selection,
                default=FALSE)
            private$..diagnostic_plots <- jmvcore::OptionBool$new(
                "diagnostic_plots",
                diagnostic_plots,
                default=TRUE)
            private$..show_model_summary <- jmvcore::OptionBool$new(
                "show_model_summary",
                show_model_summary,
                default=TRUE)
            private$..show_coefficients <- jmvcore::OptionBool$new(
                "show_coefficients",
                show_coefficients,
                default=TRUE)
            private$..show_frailty_analysis <- jmvcore::OptionBool$new(
                "show_frailty_analysis",
                show_frailty_analysis,
                default=TRUE)
            private$..show_convergence <- jmvcore::OptionBool$new(
                "show_convergence",
                show_convergence,
                default=TRUE)
            private$..show_diagnostics <- jmvcore::OptionBool$new(
                "show_diagnostics",
                show_diagnostics,
                default=TRUE)
            private$..show_predictions <- jmvcore::OptionBool$new(
                "show_predictions",
                show_predictions,
                default=TRUE)
            private$..show_comparison <- jmvcore::OptionBool$new(
                "show_comparison",
                show_comparison,
                default=TRUE)
            private$..show_convergence_plots <- jmvcore::OptionBool$new(
                "show_convergence_plots",
                show_convergence_plots,
                default=TRUE)
            private$..show_frailty_plots <- jmvcore::OptionBool$new(
                "show_frailty_plots",
                show_frailty_plots,
                default=TRUE)
            private$..show_residual_plots <- jmvcore::OptionBool$new(
                "show_residual_plots",
                show_residual_plots,
                default=TRUE)
            private$..show_survival_plots <- jmvcore::OptionBool$new(
                "show_survival_plots",
                show_survival_plots,
                default=TRUE)
            private$..showSummaries <- jmvcore::OptionBool$new(
                "showSummaries",
                showSummaries,
                default=FALSE)
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=FALSE)

            self$.addOption(private$..elapsedtime)
            self$.addOption(private$..outcome)
            self$.addOption(private$..covariates)
            self$.addOption(private$..frailty_variable)
            self$.addOption(private$..outcomeLevel)
            self$.addOption(private$..frailty_distribution)
            self$.addOption(private$..estimation_method)
            self$.addOption(private$..baseline_hazard)
            self$.addOption(private$..ties_method)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..max_iterations)
            self$.addOption(private$..convergence_tolerance)
            self$.addOption(private$..em_acceleration)
            self$.addOption(private$..variance_estimation)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..frailty_prediction)
            self$.addOption(private$..model_selection)
            self$.addOption(private$..diagnostic_plots)
            self$.addOption(private$..show_model_summary)
            self$.addOption(private$..show_coefficients)
            self$.addOption(private$..show_frailty_analysis)
            self$.addOption(private$..show_convergence)
            self$.addOption(private$..show_diagnostics)
            self$.addOption(private$..show_predictions)
            self$.addOption(private$..show_comparison)
            self$.addOption(private$..show_convergence_plots)
            self$.addOption(private$..show_frailty_plots)
            self$.addOption(private$..show_residual_plots)
            self$.addOption(private$..show_survival_plots)
            self$.addOption(private$..showSummaries)
            self$.addOption(private$..showExplanations)
        }),
    active = list(
        elapsedtime = function() private$..elapsedtime$value,
        outcome = function() private$..outcome$value,
        covariates = function() private$..covariates$value,
        frailty_variable = function() private$..frailty_variable$value,
        outcomeLevel = function() private$..outcomeLevel$value,
        frailty_distribution = function() private$..frailty_distribution$value,
        estimation_method = function() private$..estimation_method$value,
        baseline_hazard = function() private$..baseline_hazard$value,
        ties_method = function() private$..ties_method$value,
        confidence_level = function() private$..confidence_level$value,
        max_iterations = function() private$..max_iterations$value,
        convergence_tolerance = function() private$..convergence_tolerance$value,
        em_acceleration = function() private$..em_acceleration$value,
        variance_estimation = function() private$..variance_estimation$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        frailty_prediction = function() private$..frailty_prediction$value,
        model_selection = function() private$..model_selection$value,
        diagnostic_plots = function() private$..diagnostic_plots$value,
        show_model_summary = function() private$..show_model_summary$value,
        show_coefficients = function() private$..show_coefficients$value,
        show_frailty_analysis = function() private$..show_frailty_analysis$value,
        show_convergence = function() private$..show_convergence$value,
        show_diagnostics = function() private$..show_diagnostics$value,
        show_predictions = function() private$..show_predictions$value,
        show_comparison = function() private$..show_comparison$value,
        show_convergence_plots = function() private$..show_convergence_plots$value,
        show_frailty_plots = function() private$..show_frailty_plots$value,
        show_residual_plots = function() private$..show_residual_plots$value,
        show_survival_plots = function() private$..show_survival_plots$value,
        showSummaries = function() private$..showSummaries$value,
        showExplanations = function() private$..showExplanations$value),
    private = list(
        ..elapsedtime = NA,
        ..outcome = NA,
        ..covariates = NA,
        ..frailty_variable = NA,
        ..outcomeLevel = NA,
        ..frailty_distribution = NA,
        ..estimation_method = NA,
        ..baseline_hazard = NA,
        ..ties_method = NA,
        ..confidence_level = NA,
        ..max_iterations = NA,
        ..convergence_tolerance = NA,
        ..em_acceleration = NA,
        ..variance_estimation = NA,
        ..bootstrap_samples = NA,
        ..frailty_prediction = NA,
        ..model_selection = NA,
        ..diagnostic_plots = NA,
        ..show_model_summary = NA,
        ..show_coefficients = NA,
        ..show_frailty_analysis = NA,
        ..show_convergence = NA,
        ..show_diagnostics = NA,
        ..show_predictions = NA,
        ..show_comparison = NA,
        ..show_convergence_plots = NA,
        ..show_frailty_plots = NA,
        ..show_residual_plots = NA,
        ..show_survival_plots = NA,
        ..showSummaries = NA,
        ..showExplanations = NA)
)

emfrailtyResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "emfrailtyResults",
    inherit = jmvcore::Group,
    active = list(
        modelSummary = function() private$.items[["modelSummary"]],
        coefficients = function() private$.items[["coefficients"]],
        frailtyAnalysis = function() private$.items[["frailtyAnalysis"]],
        convergenceInfo = function() private$.items[["convergenceInfo"]],
        diagnostics = function() private$.items[["diagnostics"]],
        frailtyPredictions = function() private$.items[["frailtyPredictions"]],
        modelComparison = function() private$.items[["modelComparison"]],
        baselineHazard = function() private$.items[["baselineHazard"]],
        heterogeneityAnalysis = function() private$.items[["heterogeneityAnalysis"]],
        shrinkageAnalysis = function() private$.items[["shrinkageAnalysis"]],
        convergencePlots = function() private$.items[["convergencePlots"]],
        frailtyPlots = function() private$.items[["frailtyPlots"]],
        residualPlots = function() private$.items[["residualPlots"]],
        survivalPlots = function() private$.items[["survivalPlots"]],
        fitPlots = function() private$.items[["fitPlots"]],
        summaryTable = function() private$.items[["summaryTable"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="EM-Algorithm Frailty Models",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelSummary",
                title="Model Summary",
                visible="(show_model_summary)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="coefficients",
                title="Fixed Effects Coefficients",
                visible="(show_coefficients)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="frailtyAnalysis",
                title="Frailty Distribution Analysis",
                visible="(show_frailty_analysis)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="convergenceInfo",
                title="EM Algorithm Convergence",
                visible="(show_convergence)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="diagnostics",
                title="Model Diagnostics",
                visible="(show_diagnostics)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="frailtyPredictions",
                title="Empirical Bayes Frailty Predictions",
                visible="(show_predictions)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelComparison",
                title="Model Comparison",
                visible="(show_comparison)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="baselineHazard",
                title="Baseline Hazard Analysis",
                visible="(show_frailty_analysis)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="heterogeneityAnalysis",
                title="Heterogeneity Assessment",
                visible="(show_frailty_analysis)",
                columns=list()))
            self$add(jmvcore::Table$new(
                options=options,
                name="shrinkageAnalysis",
                title="Shrinkage Analysis",
                visible="(show_predictions)",
                columns=list()))
            self$add(jmvcore::Image$new(
                options=options,
                name="convergencePlots",
                title="EM Convergence Diagnostic Plots",
                visible="(show_convergence_plots)",
                width=800,
                height=600))
            self$add(jmvcore::Image$new(
                options=options,
                name="frailtyPlots",
                title="Frailty Distribution and Prediction Plots",
                visible="(show_frailty_plots)",
                width=800,
                height=600))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualPlots",
                title="Residual Diagnostic Plots",
                visible="(show_residual_plots)",
                width=800,
                height=600))
            self$add(jmvcore::Image$new(
                options=options,
                name="survivalPlots",
                title="Stratified Survival Curves",
                visible="(show_survival_plots)",
                width=800,
                height=600))
            self$add(jmvcore::Image$new(
                options=options,
                name="fitPlots",
                title="Model Fit Assessment Plots",
                visible="(diagnostic_plots)",
                width=800,
                height=600))
            self$add(jmvcore::Html$new(
                options=options,
                name="summaryTable",
                title="Analysis Summary",
                visible="(showSummaries)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method Explanation",
                visible="(showExplanations)"))}))

emfrailtyBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "emfrailtyBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "emfrailty",
                version = c(1,0,0),
                options = options,
                results = emfrailtyResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' EM-Algorithm Frailty Models
#'
#' Implements expectation-maximization (EM) algorithm based frailty models for 
#' survival analysis. Provides efficient estimation of frailty distributions 
#' and variance components in complex survival data with unobserved 
#' heterogeneity. Supports multiple frailty distributions and convergence 
#' diagnostics.
#' 
#'
#' @examples
#' data('lung', package='survival')
#'
#' emfrailty(data = lung,
#'          elapsedtime = 'time',
#'          outcome = 'status',
#'          covariates = c('age', 'sex'),
#'          frailty_variable = 'inst',
#'          frailty_distribution = 'gamma',
#'          estimation_method = 'em',
#'          max_iterations = 100)
#'
#' @param data the data as a data frame
#' @param elapsedtime Survival time or follow-up duration variable. Should
#'   contain positive  numeric values representing the time to event or
#'   censoring.
#' @param outcome Event indicator variable specifying whether the event of
#'   interest occurred. Can be coded as 0/1, TRUE/FALSE, or factor levels.
#' @param covariates Predictor variables for the frailty model. Can include
#'   continuous variables, factors, and interactions. Will be included as fixed
#'   effects in the model.
#' @param frailty_variable Variable defining the frailty groups (clusters).
#'   Each unique value represents a different frailty group sharing common
#'   unobserved risk factors.
#' @param outcomeLevel Specifies which level of the outcome variable
#'   represents the event of interest. For numeric variables, typically '1'. For
#'   factors, specify the appropriate level name.
#' @param frailty_distribution Distribution assumed for the frailty terms.
#'   Gamma is most commonly used and provides conjugate properties for efficient
#'   EM estimation.
#' @param estimation_method Method for parameter estimation. Standard EM is
#'   most robust, while accelerated variants may converge faster for large
#'   datasets.
#' @param baseline_hazard Specification for the baseline hazard function.
#'   Parametric forms provide efficiency while non-parametric allows maximum
#'   flexibility.
#' @param ties_method Method for handling tied event times. Breslow is
#'   fastest, Efron more accurate, exact method most precise but computationally
#'   intensive.
#' @param confidence_level Confidence level for parameter confidence intervals
#'   and hypothesis tests.
#' @param max_iterations Maximum number of EM algorithm iterations before
#'   forced termination.
#' @param convergence_tolerance Convergence tolerance for the EM algorithm.
#'   Smaller values require more precise convergence but may increase
#'   computation time.
#' @param em_acceleration Enable acceleration methods (SQUAREM, Anderson) to
#'   speed up EM convergence. Recommended for large datasets or complex models.
#' @param variance_estimation Method for estimating parameter variances and
#'   standard errors. Observed information is most common, bootstrap most
#'   robust.
#' @param bootstrap_samples Number of bootstrap samples for variance
#'   estimation when bootstrap method is selected.
#' @param frailty_prediction Compute empirical Bayes predictions of individual
#'   frailty values with prediction intervals and shrinkage estimates.
#' @param model_selection Perform automatic model selection comparing
#'   different frailty distributions and baseline hazard specifications using
#'   information criteria.
#' @param diagnostic_plots Generate comprehensive diagnostic plots including
#'   convergence traces, residuals, frailty predictions, and model fit
#'   assessments.
#' @param show_model_summary Display comprehensive model summary with sample
#'   characteristics and convergence information.
#' @param show_coefficients Display fixed effects coefficient estimates with
#'   confidence intervals and tests.
#' @param show_frailty_analysis Display frailty variance estimates,
#'   distribution parameters, and heterogeneity measures.
#' @param show_convergence Display EM algorithm convergence diagnostics and
#'   iteration history.
#' @param show_diagnostics Display comprehensive model diagnostics including
#'   fit statistics and residual analysis.
#' @param show_predictions Display empirical Bayes frailty predictions with
#'   shrinkage analysis.
#' @param show_comparison Compare EM frailty model with standard Cox model and
#'   alternative specifications.
#' @param show_convergence_plots Display EM algorithm convergence trace plots
#'   and diagnostic visualizations.
#' @param show_frailty_plots Display frailty distribution plots and empirical
#'   Bayes prediction visualizations.
#' @param show_residual_plots Display residual diagnostic plots for model
#'   adequacy assessment.
#' @param show_survival_plots Display survival curves stratified by frailty
#'   groups and predictions.
#' @param showSummaries Generate comprehensive explanatory text summarizing
#'   the analysis results, methodology, and clinical interpretation guidelines.
#' @param showExplanations Provide detailed explanations of the EM-algorithm
#'   frailty methodology, assumptions, advantages, and interpretation
#'   guidelines.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$modelSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$coefficients} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$frailtyAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$convergenceInfo} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$diagnostics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$frailtyPredictions} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$baselineHazard} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$heterogeneityAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$shrinkageAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$convergencePlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$frailtyPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$survivalPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$fitPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$summaryTable} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelSummary$asDF}
#'
#' \code{as.data.frame(results$modelSummary)}
#'
#' @export
emfrailty <- function(
    data,
    elapsedtime,
    outcome,
    covariates,
    frailty_variable,
    outcomeLevel = "1",
    frailty_distribution = "gamma",
    estimation_method = "em",
    baseline_hazard = "weibull",
    ties_method = "breslow",
    confidence_level = 0.95,
    max_iterations = 100,
    convergence_tolerance = 0.000001,
    em_acceleration = FALSE,
    variance_estimation = "observed_information",
    bootstrap_samples = 500,
    frailty_prediction = TRUE,
    model_selection = FALSE,
    diagnostic_plots = TRUE,
    show_model_summary = TRUE,
    show_coefficients = TRUE,
    show_frailty_analysis = TRUE,
    show_convergence = TRUE,
    show_diagnostics = TRUE,
    show_predictions = TRUE,
    show_comparison = TRUE,
    show_convergence_plots = TRUE,
    show_frailty_plots = TRUE,
    show_residual_plots = TRUE,
    show_survival_plots = TRUE,
    showSummaries = FALSE,
    showExplanations = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("emfrailty requires jmvcore to be installed (restart may be required)")

    if ( ! missing(elapsedtime)) elapsedtime <- jmvcore::resolveQuo(jmvcore::enquo(elapsedtime))
    if ( ! missing(outcome)) outcome <- jmvcore::resolveQuo(jmvcore::enquo(outcome))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))
    if ( ! missing(frailty_variable)) frailty_variable <- jmvcore::resolveQuo(jmvcore::enquo(frailty_variable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(elapsedtime), elapsedtime, NULL),
            `if`( ! missing(outcome), outcome, NULL),
            `if`( ! missing(covariates), covariates, NULL),
            `if`( ! missing(frailty_variable), frailty_variable, NULL))


    options <- emfrailtyOptions$new(
        elapsedtime = elapsedtime,
        outcome = outcome,
        covariates = covariates,
        frailty_variable = frailty_variable,
        outcomeLevel = outcomeLevel,
        frailty_distribution = frailty_distribution,
        estimation_method = estimation_method,
        baseline_hazard = baseline_hazard,
        ties_method = ties_method,
        confidence_level = confidence_level,
        max_iterations = max_iterations,
        convergence_tolerance = convergence_tolerance,
        em_acceleration = em_acceleration,
        variance_estimation = variance_estimation,
        bootstrap_samples = bootstrap_samples,
        frailty_prediction = frailty_prediction,
        model_selection = model_selection,
        diagnostic_plots = diagnostic_plots,
        show_model_summary = show_model_summary,
        show_coefficients = show_coefficients,
        show_frailty_analysis = show_frailty_analysis,
        show_convergence = show_convergence,
        show_diagnostics = show_diagnostics,
        show_predictions = show_predictions,
        show_comparison = show_comparison,
        show_convergence_plots = show_convergence_plots,
        show_frailty_plots = show_frailty_plots,
        show_residual_plots = show_residual_plots,
        show_survival_plots = show_survival_plots,
        showSummaries = showSummaries,
        showExplanations = showExplanations)

    analysis <- emfrailtyClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

