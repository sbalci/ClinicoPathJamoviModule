
# This file is automatically generated, you probably don't want to edit this

economistplotsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "economistplotsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            y_var = NULL,
            x_var = NULL,
            facet_var = NULL,
            color_var = NULL,
            plot_orientation = "vertical",
            economist_theme = TRUE,
            show_legend = TRUE,
            percentile_colors = FALSE,
            tenth_color = "#c7254e",
            ninetieth_color = "#18bc9c",
            median_color = "#2c3e50",
            distribution_fill = "#95a5a6",
            alpha_level = 0.7,
            bandwidth_adjust = 1,
            show_points = FALSE,
            point_jitter = 0.1,
            add_statistics = TRUE,
            stat_method = "anova",
            effect_size = TRUE,
            plot_title = "",
            x_title = "",
            y_title = "",
            caption_text = "",
            plot_width = 10,
            plot_height = 6,
            left_align_title = TRUE,
            custom_breaks = "",
            show_quartiles = TRUE,
            distribution_style = "classic",
            comparison_annotations = FALSE,
            outlier_treatment = "all",
            summary_statistics = TRUE,
            export_economist_code = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="economistplots",
                requiresData=TRUE,
                ...)

            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..color_var <- jmvcore::OptionVariable$new(
                "color_var",
                color_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..plot_orientation <- jmvcore::OptionList$new(
                "plot_orientation",
                plot_orientation,
                options=list(
                    "vertical",
                    "horizontal"),
                default="vertical")
            private$..economist_theme <- jmvcore::OptionBool$new(
                "economist_theme",
                economist_theme,
                default=TRUE)
            private$..show_legend <- jmvcore::OptionBool$new(
                "show_legend",
                show_legend,
                default=TRUE)
            private$..percentile_colors <- jmvcore::OptionBool$new(
                "percentile_colors",
                percentile_colors,
                default=FALSE)
            private$..tenth_color <- jmvcore::OptionString$new(
                "tenth_color",
                tenth_color,
                default="#c7254e")
            private$..ninetieth_color <- jmvcore::OptionString$new(
                "ninetieth_color",
                ninetieth_color,
                default="#18bc9c")
            private$..median_color <- jmvcore::OptionString$new(
                "median_color",
                median_color,
                default="#2c3e50")
            private$..distribution_fill <- jmvcore::OptionString$new(
                "distribution_fill",
                distribution_fill,
                default="#95a5a6")
            private$..alpha_level <- jmvcore::OptionNumber$new(
                "alpha_level",
                alpha_level,
                min=0.1,
                max=1,
                default=0.7)
            private$..bandwidth_adjust <- jmvcore::OptionNumber$new(
                "bandwidth_adjust",
                bandwidth_adjust,
                min=0.1,
                max=3,
                default=1)
            private$..show_points <- jmvcore::OptionBool$new(
                "show_points",
                show_points,
                default=FALSE)
            private$..point_jitter <- jmvcore::OptionNumber$new(
                "point_jitter",
                point_jitter,
                min=0,
                max=0.5,
                default=0.1)
            private$..add_statistics <- jmvcore::OptionBool$new(
                "add_statistics",
                add_statistics,
                default=TRUE)
            private$..stat_method <- jmvcore::OptionList$new(
                "stat_method",
                stat_method,
                options=list(
                    "anova",
                    "kruskal",
                    "ttest",
                    "wilcox"),
                default="anova")
            private$..effect_size <- jmvcore::OptionBool$new(
                "effect_size",
                effect_size,
                default=TRUE)
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..x_title <- jmvcore::OptionString$new(
                "x_title",
                x_title,
                default="")
            private$..y_title <- jmvcore::OptionString$new(
                "y_title",
                y_title,
                default="")
            private$..caption_text <- jmvcore::OptionString$new(
                "caption_text",
                caption_text,
                default="")
            private$..plot_width <- jmvcore::OptionNumber$new(
                "plot_width",
                plot_width,
                min=4,
                max=16,
                default=10)
            private$..plot_height <- jmvcore::OptionNumber$new(
                "plot_height",
                plot_height,
                min=3,
                max=12,
                default=6)
            private$..left_align_title <- jmvcore::OptionBool$new(
                "left_align_title",
                left_align_title,
                default=TRUE)
            private$..custom_breaks <- jmvcore::OptionString$new(
                "custom_breaks",
                custom_breaks,
                default="")
            private$..show_quartiles <- jmvcore::OptionBool$new(
                "show_quartiles",
                show_quartiles,
                default=TRUE)
            private$..distribution_style <- jmvcore::OptionList$new(
                "distribution_style",
                distribution_style,
                options=list(
                    "classic",
                    "minimal",
                    "enhanced",
                    "publication"),
                default="classic")
            private$..comparison_annotations <- jmvcore::OptionBool$new(
                "comparison_annotations",
                comparison_annotations,
                default=FALSE)
            private$..outlier_treatment <- jmvcore::OptionList$new(
                "outlier_treatment",
                outlier_treatment,
                options=list(
                    "all",
                    "hide_extreme",
                    "mark",
                    "transform"),
                default="all")
            private$..summary_statistics <- jmvcore::OptionBool$new(
                "summary_statistics",
                summary_statistics,
                default=TRUE)
            private$..export_economist_code <- jmvcore::OptionBool$new(
                "export_economist_code",
                export_economist_code,
                default=TRUE)

            self$.addOption(private$..y_var)
            self$.addOption(private$..x_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..color_var)
            self$.addOption(private$..plot_orientation)
            self$.addOption(private$..economist_theme)
            self$.addOption(private$..show_legend)
            self$.addOption(private$..percentile_colors)
            self$.addOption(private$..tenth_color)
            self$.addOption(private$..ninetieth_color)
            self$.addOption(private$..median_color)
            self$.addOption(private$..distribution_fill)
            self$.addOption(private$..alpha_level)
            self$.addOption(private$..bandwidth_adjust)
            self$.addOption(private$..show_points)
            self$.addOption(private$..point_jitter)
            self$.addOption(private$..add_statistics)
            self$.addOption(private$..stat_method)
            self$.addOption(private$..effect_size)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_title)
            self$.addOption(private$..y_title)
            self$.addOption(private$..caption_text)
            self$.addOption(private$..plot_width)
            self$.addOption(private$..plot_height)
            self$.addOption(private$..left_align_title)
            self$.addOption(private$..custom_breaks)
            self$.addOption(private$..show_quartiles)
            self$.addOption(private$..distribution_style)
            self$.addOption(private$..comparison_annotations)
            self$.addOption(private$..outlier_treatment)
            self$.addOption(private$..summary_statistics)
            self$.addOption(private$..export_economist_code)
        }),
    active = list(
        y_var = function() private$..y_var$value,
        x_var = function() private$..x_var$value,
        facet_var = function() private$..facet_var$value,
        color_var = function() private$..color_var$value,
        plot_orientation = function() private$..plot_orientation$value,
        economist_theme = function() private$..economist_theme$value,
        show_legend = function() private$..show_legend$value,
        percentile_colors = function() private$..percentile_colors$value,
        tenth_color = function() private$..tenth_color$value,
        ninetieth_color = function() private$..ninetieth_color$value,
        median_color = function() private$..median_color$value,
        distribution_fill = function() private$..distribution_fill$value,
        alpha_level = function() private$..alpha_level$value,
        bandwidth_adjust = function() private$..bandwidth_adjust$value,
        show_points = function() private$..show_points$value,
        point_jitter = function() private$..point_jitter$value,
        add_statistics = function() private$..add_statistics$value,
        stat_method = function() private$..stat_method$value,
        effect_size = function() private$..effect_size$value,
        plot_title = function() private$..plot_title$value,
        x_title = function() private$..x_title$value,
        y_title = function() private$..y_title$value,
        caption_text = function() private$..caption_text$value,
        plot_width = function() private$..plot_width$value,
        plot_height = function() private$..plot_height$value,
        left_align_title = function() private$..left_align_title$value,
        custom_breaks = function() private$..custom_breaks$value,
        show_quartiles = function() private$..show_quartiles$value,
        distribution_style = function() private$..distribution_style$value,
        comparison_annotations = function() private$..comparison_annotations$value,
        outlier_treatment = function() private$..outlier_treatment$value,
        summary_statistics = function() private$..summary_statistics$value,
        export_economist_code = function() private$..export_economist_code$value),
    private = list(
        ..y_var = NA,
        ..x_var = NA,
        ..facet_var = NA,
        ..color_var = NA,
        ..plot_orientation = NA,
        ..economist_theme = NA,
        ..show_legend = NA,
        ..percentile_colors = NA,
        ..tenth_color = NA,
        ..ninetieth_color = NA,
        ..median_color = NA,
        ..distribution_fill = NA,
        ..alpha_level = NA,
        ..bandwidth_adjust = NA,
        ..show_points = NA,
        ..point_jitter = NA,
        ..add_statistics = NA,
        ..stat_method = NA,
        ..effect_size = NA,
        ..plot_title = NA,
        ..x_title = NA,
        ..y_title = NA,
        ..caption_text = NA,
        ..plot_width = NA,
        ..plot_height = NA,
        ..left_align_title = NA,
        ..custom_breaks = NA,
        ..show_quartiles = NA,
        ..distribution_style = NA,
        ..comparison_annotations = NA,
        ..outlier_treatment = NA,
        ..summary_statistics = NA,
        ..export_economist_code = NA)
)

economistplotsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "economistplotsResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        main_plot = function() private$.items[["main_plot"]],
        statistical_results = function() private$.items[["statistical_results"]],
        summary_statistics = function() private$.items[["summary_statistics"]],
        economist_legend_info = function() private$.items[["economist_legend_info"]],
        comparison_results = function() private$.items[["comparison_results"]],
        distribution_diagnostics = function() private$.items[["distribution_diagnostics"]],
        r_code_output = function() private$.items[["r_code_output"]],
        interpretation_guide = function() private$.items[["interpretation_guide"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Economist-Style Distribution Plots",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "ggeconodist",
                    "ggplot2",
                    "dplyr",
                    "remotes",
                    "moments",
                    "systemfonts"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Image$new(
                options=options,
                name="main_plot",
                title="Economist Distribution Plot",
                width=800,
                height=600,
                renderFun=".plot_main",
                visible=TRUE,
                clearWith=list(
                    "y_var",
                    "x_var",
                    "facet_var",
                    "plot_orientation",
                    "economist_theme",
                    "distribution_style")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistical_results",
                title="Statistical Analysis Results",
                visible="(add_statistics && y_var && x_var)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "stat_method",
                    "add_statistics",
                    "effect_size")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary_statistics",
                title="Distribution Summary Statistics",
                visible="(summary_statistics && y_var && x_var)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "facet_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="economist_legend_info",
                title="Economist Legend Explanation",
                visible="(show_legend)",
                clearWith=list(
                    "show_legend",
                    "distribution_style")))
            self$add(jmvcore::Html$new(
                options=options,
                name="comparison_results",
                title="Pairwise Comparisons",
                visible="(comparison_annotations && add_statistics && y_var && x_var)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "comparison_annotations",
                    "stat_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="distribution_diagnostics",
                title="Distribution Diagnostics",
                width=800,
                height=400,
                renderFun=".plot_diagnostics",
                visible="(add_statistics && y_var && x_var)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "outlier_treatment")))
            self$add(jmvcore::Html$new(
                options=options,
                name="r_code_output",
                title="Reproducible R Code",
                visible="(export_economist_code)",
                clearWith=list(
                    "y_var",
                    "x_var",
                    "economist_theme",
                    "distribution_style")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation_guide",
                title="Plot Interpretation Guide",
                visible=TRUE,
                clearWith=list(
                    "distribution_style",
                    "economist_theme")))}))

economistplotsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "economistplotsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "economistplots",
                version = c(0,0,3),
                options = options,
                results = economistplotsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Economist-Style Distribution Plots
#'
#' Creates elegant Economist-style distribution plots using ggeconodist 
#' package
#' for professional publication-quality visualizations. Provides diminutive 
#' distribution charts that effectively communicate statistical distribution 
#' characteristics with The Economist's distinctive visual style. Perfect for 
#' comparing distributions across categories, showing price variations, or 
#' visualizing any statistical distribution data in clinical research.
#' 
#'
#' @examples
#' \donttest{
#' # Example usage:
#' # 1. Select continuous variable for distribution analysis
#' # 2. Choose grouping variable for comparison
#' # 3. Customize Economist-style visual elements
#' # 4. Add statistical annotations and interpretations
#' library(ggeconodist)
#' ggplot(data, aes(x = group, y = value)) +
#'   geom_econodist() +
#'   theme_econodist()
#'}
#' @param data The data as a data frame.
#' @param y_var Continuous variable whose distribution will be visualized.
#' @param x_var Categorical variable for grouping distributions.
#' @param facet_var Optional variable for creating multiple panels.
#' @param color_var Optional variable for coloring distribution elements.
#' @param plot_orientation Orientation of the distribution plots.
#' @param economist_theme Whether to apply the full Economist visual theme.
#' @param show_legend Whether to display the Economist-style legend.
#' @param percentile_colors Whether to use custom colors for different
#'   percentiles.
#' @param tenth_color Color for the 10th percentile in the distribution.
#' @param ninetieth_color Color for the 90th percentile in the distribution.
#' @param median_color Color for the median line in the distribution.
#' @param distribution_fill Fill color for the main distribution area.
#' @param alpha_level Transparency level for distribution elements.
#' @param bandwidth_adjust Adjustment factor for distribution bandwidth
#'   smoothing.
#' @param show_points Whether to overlay individual data points.
#' @param point_jitter Amount of horizontal jittering for overlaid points.
#' @param add_statistics Whether to include statistical summaries and tests.
#' @param stat_method Statistical test to perform for group comparisons.
#' @param effect_size Whether to calculate and display effect sizes.
#' @param plot_title Custom title for the plot.
#' @param x_title Custom label for x-axis.
#' @param y_title Custom label for y-axis.
#' @param caption_text Custom caption text for the plot.
#' @param plot_width Width of the plot in inches.
#' @param plot_height Height of the plot in inches.
#' @param left_align_title Whether to left-align title and caption elements.
#' @param custom_breaks Comma-separated values for custom y-axis breaks.
#' @param show_quartiles Whether to highlight quartile boundaries.
#' @param distribution_style Overall visual style for the distribution plots.
#' @param comparison_annotations Whether to add pairwise comparison
#'   annotations.
#' @param outlier_treatment How to handle outliers in the visualization.
#' @param summary_statistics Whether to display comprehensive summary
#'   statistics.
#' @param export_economist_code Whether to generate reproducible R code using
#'   ggeconodist.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$main_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistical_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary_statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$economist_legend_info} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$comparison_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$distribution_diagnostics} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$r_code_output} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation_guide} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
economistplots <- function(
    data,
    y_var,
    x_var,
    facet_var,
    color_var,
    plot_orientation = "vertical",
    economist_theme = TRUE,
    show_legend = TRUE,
    percentile_colors = FALSE,
    tenth_color = "#c7254e",
    ninetieth_color = "#18bc9c",
    median_color = "#2c3e50",
    distribution_fill = "#95a5a6",
    alpha_level = 0.7,
    bandwidth_adjust = 1,
    show_points = FALSE,
    point_jitter = 0.1,
    add_statistics = TRUE,
    stat_method = "anova",
    effect_size = TRUE,
    plot_title = "",
    x_title = "",
    y_title = "",
    caption_text = "",
    plot_width = 10,
    plot_height = 6,
    left_align_title = TRUE,
    custom_breaks = "",
    show_quartiles = TRUE,
    distribution_style = "classic",
    comparison_annotations = FALSE,
    outlier_treatment = "all",
    summary_statistics = TRUE,
    export_economist_code = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("economistplots requires jmvcore to be installed (restart may be required)")

    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if ( ! missing(color_var)) color_var <- jmvcore::resolveQuo(jmvcore::enquo(color_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL),
            `if`( ! missing(color_var), color_var, NULL))

    for (v in x_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in color_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- economistplotsOptions$new(
        y_var = y_var,
        x_var = x_var,
        facet_var = facet_var,
        color_var = color_var,
        plot_orientation = plot_orientation,
        economist_theme = economist_theme,
        show_legend = show_legend,
        percentile_colors = percentile_colors,
        tenth_color = tenth_color,
        ninetieth_color = ninetieth_color,
        median_color = median_color,
        distribution_fill = distribution_fill,
        alpha_level = alpha_level,
        bandwidth_adjust = bandwidth_adjust,
        show_points = show_points,
        point_jitter = point_jitter,
        add_statistics = add_statistics,
        stat_method = stat_method,
        effect_size = effect_size,
        plot_title = plot_title,
        x_title = x_title,
        y_title = y_title,
        caption_text = caption_text,
        plot_width = plot_width,
        plot_height = plot_height,
        left_align_title = left_align_title,
        custom_breaks = custom_breaks,
        show_quartiles = show_quartiles,
        distribution_style = distribution_style,
        comparison_annotations = comparison_annotations,
        outlier_treatment = outlier_treatment,
        summary_statistics = summary_statistics,
        export_economist_code = export_economist_code)

    analysis <- economistplotsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

