
# This file is automatically generated, you probably don't want to edit this

advancedbarplotOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedbarplotOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            fill_var = NULL,
            facet_var = NULL,
            chart_approach = "polished",
            bar_position = "dodge",
            stat_type = "mean",
            error_bars = "se",
            color_palette = "clinical",
            show_values = TRUE,
            value_format = "auto",
            add_statistics = FALSE,
            stat_method = "anova",
            orientation = "vertical",
            plot_title = "",
            x_title = "",
            y_title = "",
            legend_position = "right",
            theme_style = "clean",
            bar_width = 0.8,
            plot_width = 10,
            plot_height = 6,
            sort_bars = "none",
            add_trend_line = FALSE,
            highlight_bars = "",
            transparency = 0.9,
            export_options = TRUE,
            show_comparison = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="advancedbarplot",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..fill_var <- jmvcore::OptionVariable$new(
                "fill_var",
                fill_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..chart_approach <- jmvcore::OptionList$new(
                "chart_approach",
                chart_approach,
                options=list(
                    "basic",
                    "polished",
                    "statistical",
                    "interactive",
                    "publication",
                    "bbc_style",
                    "prism_style"),
                default="polished")
            private$..bar_position <- jmvcore::OptionList$new(
                "bar_position",
                bar_position,
                options=list(
                    "dodge",
                    "stack",
                    "fill",
                    "identity"),
                default="dodge")
            private$..stat_type <- jmvcore::OptionList$new(
                "stat_type",
                stat_type,
                options=list(
                    "mean",
                    "median",
                    "sum",
                    "count",
                    "prop"),
                default="mean")
            private$..error_bars <- jmvcore::OptionList$new(
                "error_bars",
                error_bars,
                options=list(
                    "none",
                    "se",
                    "sd",
                    "ci95",
                    "custom"),
                default="se")
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "default",
                    "bbc_blue",
                    "bbc_orange",
                    "bbc_multi",
                    "viridis",
                    "set1",
                    "dark2",
                    "clinical",
                    "nature",
                    "science",
                    "colorblind",
                    "separator1",
                    "prism_floral",
                    "prism_candy_bright",
                    "prism_office",
                    "prism_pastels",
                    "prism_colorblind_safe",
                    "prism_blueprint",
                    "prism_neon",
                    "prism_ocean",
                    "prism_spring",
                    "prism_dark",
                    "prism_light"),
                default="clinical")
            private$..show_values <- jmvcore::OptionBool$new(
                "show_values",
                show_values,
                default=TRUE)
            private$..value_format <- jmvcore::OptionList$new(
                "value_format",
                value_format,
                options=list(
                    "auto",
                    "integer",
                    "decimal1",
                    "decimal2",
                    "percentage",
                    "scientific"),
                default="auto")
            private$..add_statistics <- jmvcore::OptionBool$new(
                "add_statistics",
                add_statistics,
                default=FALSE)
            private$..stat_method <- jmvcore::OptionList$new(
                "stat_method",
                stat_method,
                options=list(
                    "anova",
                    "ttest",
                    "wilcox",
                    "chisq",
                    "kruskal"),
                default="anova")
            private$..orientation <- jmvcore::OptionList$new(
                "orientation",
                orientation,
                options=list(
                    "vertical",
                    "horizontal"),
                default="vertical")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..x_title <- jmvcore::OptionString$new(
                "x_title",
                x_title,
                default="")
            private$..y_title <- jmvcore::OptionString$new(
                "y_title",
                y_title,
                default="")
            private$..legend_position <- jmvcore::OptionList$new(
                "legend_position",
                legend_position,
                options=list(
                    "right",
                    "left",
                    "top",
                    "bottom",
                    "none"),
                default="right")
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "clean",
                    "classic",
                    "minimal",
                    "publication",
                    "presentation",
                    "separator2",
                    "prism_default",
                    "prism_white",
                    "prism_minimal",
                    "prism_publication"),
                default="clean")
            private$..bar_width <- jmvcore::OptionNumber$new(
                "bar_width",
                bar_width,
                min=0.1,
                max=1,
                default=0.8)
            private$..plot_width <- jmvcore::OptionNumber$new(
                "plot_width",
                plot_width,
                min=4,
                max=16,
                default=10)
            private$..plot_height <- jmvcore::OptionNumber$new(
                "plot_height",
                plot_height,
                min=3,
                max=12,
                default=6)
            private$..sort_bars <- jmvcore::OptionList$new(
                "sort_bars",
                sort_bars,
                options=list(
                    "none",
                    "asc",
                    "desc",
                    "alpha"),
                default="none")
            private$..add_trend_line <- jmvcore::OptionBool$new(
                "add_trend_line",
                add_trend_line,
                default=FALSE)
            private$..highlight_bars <- jmvcore::OptionString$new(
                "highlight_bars",
                highlight_bars,
                default="")
            private$..transparency <- jmvcore::OptionNumber$new(
                "transparency",
                transparency,
                min=0.1,
                max=1,
                default=0.9)
            private$..export_options <- jmvcore::OptionBool$new(
                "export_options",
                export_options,
                default=TRUE)
            private$..show_comparison <- jmvcore::OptionBool$new(
                "show_comparison",
                show_comparison,
                default=FALSE)

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..fill_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..chart_approach)
            self$.addOption(private$..bar_position)
            self$.addOption(private$..stat_type)
            self$.addOption(private$..error_bars)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..show_values)
            self$.addOption(private$..value_format)
            self$.addOption(private$..add_statistics)
            self$.addOption(private$..stat_method)
            self$.addOption(private$..orientation)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_title)
            self$.addOption(private$..y_title)
            self$.addOption(private$..legend_position)
            self$.addOption(private$..theme_style)
            self$.addOption(private$..bar_width)
            self$.addOption(private$..plot_width)
            self$.addOption(private$..plot_height)
            self$.addOption(private$..sort_bars)
            self$.addOption(private$..add_trend_line)
            self$.addOption(private$..highlight_bars)
            self$.addOption(private$..transparency)
            self$.addOption(private$..export_options)
            self$.addOption(private$..show_comparison)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        fill_var = function() private$..fill_var$value,
        facet_var = function() private$..facet_var$value,
        chart_approach = function() private$..chart_approach$value,
        bar_position = function() private$..bar_position$value,
        stat_type = function() private$..stat_type$value,
        error_bars = function() private$..error_bars$value,
        color_palette = function() private$..color_palette$value,
        show_values = function() private$..show_values$value,
        value_format = function() private$..value_format$value,
        add_statistics = function() private$..add_statistics$value,
        stat_method = function() private$..stat_method$value,
        orientation = function() private$..orientation$value,
        plot_title = function() private$..plot_title$value,
        x_title = function() private$..x_title$value,
        y_title = function() private$..y_title$value,
        legend_position = function() private$..legend_position$value,
        theme_style = function() private$..theme_style$value,
        bar_width = function() private$..bar_width$value,
        plot_width = function() private$..plot_width$value,
        plot_height = function() private$..plot_height$value,
        sort_bars = function() private$..sort_bars$value,
        add_trend_line = function() private$..add_trend_line$value,
        highlight_bars = function() private$..highlight_bars$value,
        transparency = function() private$..transparency$value,
        export_options = function() private$..export_options$value,
        show_comparison = function() private$..show_comparison$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..fill_var = NA,
        ..facet_var = NA,
        ..chart_approach = NA,
        ..bar_position = NA,
        ..stat_type = NA,
        ..error_bars = NA,
        ..color_palette = NA,
        ..show_values = NA,
        ..value_format = NA,
        ..add_statistics = NA,
        ..stat_method = NA,
        ..orientation = NA,
        ..plot_title = NA,
        ..x_title = NA,
        ..y_title = NA,
        ..legend_position = NA,
        ..theme_style = NA,
        ..bar_width = NA,
        ..plot_width = NA,
        ..plot_height = NA,
        ..sort_bars = NA,
        ..add_trend_line = NA,
        ..highlight_bars = NA,
        ..transparency = NA,
        ..export_options = NA,
        ..show_comparison = NA)
)

advancedbarplotResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedbarplotResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        approach_description = function() private$.items[["approach_description"]],
        main_plot = function() private$.items[["main_plot"]],
        statistical_results = function() private$.items[["statistical_results"]],
        summary_stats = function() private$.items[["summary_stats"]],
        interactive_plot = function() private$.items[["interactive_plot"]],
        comparison_grid = function() private$.items[["comparison_grid"]],
        code_example = function() private$.items[["code_example"]],
        interpretation_guide = function() private$.items[["interpretation_guide"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Bar Charts - 5 Ways",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "ggplot2",
                    "plotly",
                    "RColorBrewer",
                    "viridis"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="approach_description",
                title="Current Approach Description",
                visible=TRUE,
                clearWith=list(
                    "chart_approach")))
            self$add(jmvcore::Image$new(
                options=options,
                name="main_plot",
                title="Advanced Bar Chart",
                width=800,
                height=600,
                renderFun=".plot_main",
                visible=TRUE,
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "chart_approach",
                    "bar_position",
                    "stat_type",
                    "color_palette",
                    "orientation")))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistical_results",
                title="Statistical Test Results",
                visible="add_statistics",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "stat_method",
                    "add_statistics")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary_stats",
                title="Summary Statistics",
                visible="(x_var)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "stat_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interactive_plot",
                title="Interactive Version",
                visible="(chart_approach:interactive)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "chart_approach")))
            self$add(jmvcore::Image$new(
                options=options,
                name="comparison_grid",
                title="5 Approaches Comparison",
                width=1200,
                height=900,
                renderFun=".plot_comparison",
                visible="(show_comparison)",
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "show_comparison")))
            self$add(jmvcore::Html$new(
                options=options,
                name="code_example",
                title="R Code Example",
                visible=TRUE,
                clearWith=list(
                    "chart_approach",
                    "x_var",
                    "y_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation_guide",
                title="Interpretation Guide",
                visible=TRUE,
                clearWith=list(
                    "chart_approach",
                    "stat_type")))}))

advancedbarplotBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedbarplotBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "advancedbarplot",
                version = c(0,0,3),
                options = options,
                results = advancedbarplotResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Advanced Bar Charts - 5 Ways
#'
#' Advanced bar chart visualization module implementing 5 different approaches 
#' for creating professional bar charts. Choose from ggplot2 basics, polished 
#' presentations, statistical annotations, interactive plots, and 
#' publication-ready 
#' designs. Each approach optimized for different use cases in clinical 
#' research.
#' 
#'
#' @examples
#' \donttest{
#' # Example usage - 5 different bar chart approaches:
#' # 1. Basic ggplot2 approach
#' # 2. Polished presentation style
#' # 3. Statistical annotation style
#' # 4. Interactive plotly style
#' # 5. Publication-ready style
#'}
#' @param data The data as a data frame.
#' @param x_var Categorical variable for x-axis categories.
#' @param y_var Numeric variable for bar heights.
#' @param fill_var Optional variable for bar fill colors (grouped/stacked
#'   bars).
#' @param facet_var Optional variable for creating multiple panels.
#' @param chart_approach Choose the bar chart approach and styling.
#' @param bar_position Position adjustment for grouped bars.
#' @param stat_type Type of statistical summary for y-axis values.
#' @param error_bars Type of error bars to display.
#' @param color_palette Color palette for bar fills including GraphPad Prism
#'   palettes.
#' @param show_values Whether to display values on top of bars.
#' @param value_format Format for displayed values.
#' @param add_statistics Whether to perform and display statistical tests.
#' @param stat_method Type of statistical test to perform.
#' @param orientation Orientation of the bars.
#' @param plot_title Main title for the plot.
#' @param x_title Title for x-axis.
#' @param y_title Title for y-axis.
#' @param legend_position Position of the legend.
#' @param theme_style Overall theme style for the plot including GraphPad
#'   Prism themes.
#' @param bar_width Width of the bars (0.1 to 1.0).
#' @param plot_width Width of the plot in inches.
#' @param plot_height Height of the plot in inches.
#' @param sort_bars How to sort the bars.
#' @param add_trend_line Whether to add a trend line for numeric x-axis.
#' @param highlight_bars Comma-separated list of categories to highlight.
#' @param transparency Transparency level for bars (alpha value).
#' @param export_options Whether to optimize plot for high-quality export.
#' @param show_comparison Whether to show comparison grid of all 5
#'   visualization approaches.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$approach_description} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$main_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistical_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary_stats} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interactive_plot} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$comparison_grid} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$code_example} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation_guide} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
advancedbarplot <- function(
    data,
    x_var,
    y_var,
    fill_var = NULL,
    facet_var = NULL,
    chart_approach = "polished",
    bar_position = "dodge",
    stat_type = "mean",
    error_bars = "se",
    color_palette = "clinical",
    show_values = TRUE,
    value_format = "auto",
    add_statistics = FALSE,
    stat_method = "anova",
    orientation = "vertical",
    plot_title = "",
    x_title = "",
    y_title = "",
    legend_position = "right",
    theme_style = "clean",
    bar_width = 0.8,
    plot_width = 10,
    plot_height = 6,
    sort_bars = "none",
    add_trend_line = FALSE,
    highlight_bars = "",
    transparency = 0.9,
    export_options = TRUE,
    show_comparison = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("advancedbarplot requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(fill_var)) fill_var <- jmvcore::resolveQuo(jmvcore::enquo(fill_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(fill_var), fill_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))

    for (v in x_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in fill_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- advancedbarplotOptions$new(
        x_var = x_var,
        y_var = y_var,
        fill_var = fill_var,
        facet_var = facet_var,
        chart_approach = chart_approach,
        bar_position = bar_position,
        stat_type = stat_type,
        error_bars = error_bars,
        color_palette = color_palette,
        show_values = show_values,
        value_format = value_format,
        add_statistics = add_statistics,
        stat_method = stat_method,
        orientation = orientation,
        plot_title = plot_title,
        x_title = x_title,
        y_title = y_title,
        legend_position = legend_position,
        theme_style = theme_style,
        bar_width = bar_width,
        plot_width = plot_width,
        plot_height = plot_height,
        sort_bars = sort_bars,
        add_trend_line = add_trend_line,
        highlight_bars = highlight_bars,
        transparency = transparency,
        export_options = export_options,
        show_comparison = show_comparison)

    analysis <- advancedbarplotClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

