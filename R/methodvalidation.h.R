
# This file is automatically generated, you probably don't want to edit this

methodvalidationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodvalidationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            measurement = NULL,
            reference_value = NULL,
            replicate = NULL,
            concentration_level = NULL,
            operator = NULL,
            instrument = NULL,
            validation_type = "full_validation",
            precision_design = "ep15a3",
            replicates_per_run = 3,
            number_of_runs = 20,
            confidence_level = 0.95,
            acceptance_criteria = "biological_variation",
            custom_cv_limit = 10,
            custom_bias_limit = 5,
            linearity_points = 7,
            outlier_detection = TRUE,
            precision_analysis = TRUE,
            accuracy_analysis = TRUE,
            linearity_analysis = TRUE,
            limit_of_detection = FALSE,
            limit_of_quantitation = FALSE,
            interference_testing = FALSE,
            carryover_assessment = FALSE,
            reference_interval = FALSE,
            uncertainty_budget = TRUE,
            validation_plots = TRUE,
            method_comparison_plot = TRUE,
            export_report = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="methodvalidation",
                requiresData=TRUE,
                ...)

            private$..measurement <- jmvcore::OptionVariable$new(
                "measurement",
                measurement,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..reference_value <- jmvcore::OptionVariable$new(
                "reference_value",
                reference_value,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..replicate <- jmvcore::OptionVariable$new(
                "replicate",
                replicate,
                suggested=list(
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..concentration_level <- jmvcore::OptionVariable$new(
                "concentration_level",
                concentration_level,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..operator <- jmvcore::OptionVariable$new(
                "operator",
                operator,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..instrument <- jmvcore::OptionVariable$new(
                "instrument",
                instrument,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..validation_type <- jmvcore::OptionList$new(
                "validation_type",
                validation_type,
                options=list(
                    "full_validation",
                    "precision_only",
                    "accuracy_only",
                    "linearity_only",
                    "method_comparison",
                    "verification"),
                default="full_validation")
            private$..precision_design <- jmvcore::OptionList$new(
                "precision_design",
                precision_design,
                options=list(
                    "ep15a3",
                    "ep05a3",
                    "nested_anova",
                    "custom"),
                default="ep15a3")
            private$..replicates_per_run <- jmvcore::OptionInteger$new(
                "replicates_per_run",
                replicates_per_run,
                min=2,
                max=10,
                default=3)
            private$..number_of_runs <- jmvcore::OptionInteger$new(
                "number_of_runs",
                number_of_runs,
                min=5,
                max=30,
                default=20)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.9,
                max=0.99,
                default=0.95)
            private$..acceptance_criteria <- jmvcore::OptionList$new(
                "acceptance_criteria",
                acceptance_criteria,
                options=list(
                    "clia",
                    "biological_variation",
                    "state_of_art",
                    "custom"),
                default="biological_variation")
            private$..custom_cv_limit <- jmvcore::OptionNumber$new(
                "custom_cv_limit",
                custom_cv_limit,
                min=1,
                max=50,
                default=10)
            private$..custom_bias_limit <- jmvcore::OptionNumber$new(
                "custom_bias_limit",
                custom_bias_limit,
                min=1,
                max=50,
                default=5)
            private$..linearity_points <- jmvcore::OptionInteger$new(
                "linearity_points",
                linearity_points,
                min=5,
                max=15,
                default=7)
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=TRUE)
            private$..precision_analysis <- jmvcore::OptionBool$new(
                "precision_analysis",
                precision_analysis,
                default=TRUE)
            private$..accuracy_analysis <- jmvcore::OptionBool$new(
                "accuracy_analysis",
                accuracy_analysis,
                default=TRUE)
            private$..linearity_analysis <- jmvcore::OptionBool$new(
                "linearity_analysis",
                linearity_analysis,
                default=TRUE)
            private$..limit_of_detection <- jmvcore::OptionBool$new(
                "limit_of_detection",
                limit_of_detection,
                default=FALSE)
            private$..limit_of_quantitation <- jmvcore::OptionBool$new(
                "limit_of_quantitation",
                limit_of_quantitation,
                default=FALSE)
            private$..interference_testing <- jmvcore::OptionBool$new(
                "interference_testing",
                interference_testing,
                default=FALSE)
            private$..carryover_assessment <- jmvcore::OptionBool$new(
                "carryover_assessment",
                carryover_assessment,
                default=FALSE)
            private$..reference_interval <- jmvcore::OptionBool$new(
                "reference_interval",
                reference_interval,
                default=FALSE)
            private$..uncertainty_budget <- jmvcore::OptionBool$new(
                "uncertainty_budget",
                uncertainty_budget,
                default=TRUE)
            private$..validation_plots <- jmvcore::OptionBool$new(
                "validation_plots",
                validation_plots,
                default=TRUE)
            private$..method_comparison_plot <- jmvcore::OptionBool$new(
                "method_comparison_plot",
                method_comparison_plot,
                default=TRUE)
            private$..export_report <- jmvcore::OptionBool$new(
                "export_report",
                export_report,
                default=FALSE)

            self$.addOption(private$..measurement)
            self$.addOption(private$..reference_value)
            self$.addOption(private$..replicate)
            self$.addOption(private$..concentration_level)
            self$.addOption(private$..operator)
            self$.addOption(private$..instrument)
            self$.addOption(private$..validation_type)
            self$.addOption(private$..precision_design)
            self$.addOption(private$..replicates_per_run)
            self$.addOption(private$..number_of_runs)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..acceptance_criteria)
            self$.addOption(private$..custom_cv_limit)
            self$.addOption(private$..custom_bias_limit)
            self$.addOption(private$..linearity_points)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..precision_analysis)
            self$.addOption(private$..accuracy_analysis)
            self$.addOption(private$..linearity_analysis)
            self$.addOption(private$..limit_of_detection)
            self$.addOption(private$..limit_of_quantitation)
            self$.addOption(private$..interference_testing)
            self$.addOption(private$..carryover_assessment)
            self$.addOption(private$..reference_interval)
            self$.addOption(private$..uncertainty_budget)
            self$.addOption(private$..validation_plots)
            self$.addOption(private$..method_comparison_plot)
            self$.addOption(private$..export_report)
        }),
    active = list(
        measurement = function() private$..measurement$value,
        reference_value = function() private$..reference_value$value,
        replicate = function() private$..replicate$value,
        concentration_level = function() private$..concentration_level$value,
        operator = function() private$..operator$value,
        instrument = function() private$..instrument$value,
        validation_type = function() private$..validation_type$value,
        precision_design = function() private$..precision_design$value,
        replicates_per_run = function() private$..replicates_per_run$value,
        number_of_runs = function() private$..number_of_runs$value,
        confidence_level = function() private$..confidence_level$value,
        acceptance_criteria = function() private$..acceptance_criteria$value,
        custom_cv_limit = function() private$..custom_cv_limit$value,
        custom_bias_limit = function() private$..custom_bias_limit$value,
        linearity_points = function() private$..linearity_points$value,
        outlier_detection = function() private$..outlier_detection$value,
        precision_analysis = function() private$..precision_analysis$value,
        accuracy_analysis = function() private$..accuracy_analysis$value,
        linearity_analysis = function() private$..linearity_analysis$value,
        limit_of_detection = function() private$..limit_of_detection$value,
        limit_of_quantitation = function() private$..limit_of_quantitation$value,
        interference_testing = function() private$..interference_testing$value,
        carryover_assessment = function() private$..carryover_assessment$value,
        reference_interval = function() private$..reference_interval$value,
        uncertainty_budget = function() private$..uncertainty_budget$value,
        validation_plots = function() private$..validation_plots$value,
        method_comparison_plot = function() private$..method_comparison_plot$value,
        export_report = function() private$..export_report$value),
    private = list(
        ..measurement = NA,
        ..reference_value = NA,
        ..replicate = NA,
        ..concentration_level = NA,
        ..operator = NA,
        ..instrument = NA,
        ..validation_type = NA,
        ..precision_design = NA,
        ..replicates_per_run = NA,
        ..number_of_runs = NA,
        ..confidence_level = NA,
        ..acceptance_criteria = NA,
        ..custom_cv_limit = NA,
        ..custom_bias_limit = NA,
        ..linearity_points = NA,
        ..outlier_detection = NA,
        ..precision_analysis = NA,
        ..accuracy_analysis = NA,
        ..linearity_analysis = NA,
        ..limit_of_detection = NA,
        ..limit_of_quantitation = NA,
        ..interference_testing = NA,
        ..carryover_assessment = NA,
        ..reference_interval = NA,
        ..uncertainty_budget = NA,
        ..validation_plots = NA,
        ..method_comparison_plot = NA,
        ..export_report = NA)
)

methodvalidationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodvalidationResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        studyDesign = function() private$.items[["studyDesign"]],
        precisionResults = function() private$.items[["precisionResults"]],
        accuracyResults = function() private$.items[["accuracyResults"]],
        linearityResults = function() private$.items[["linearityResults"]],
        linearityData = function() private$.items[["linearityData"]],
        detectionLimits = function() private$.items[["detectionLimits"]],
        uncertaintyBudget = function() private$.items[["uncertaintyBudget"]],
        uncertaintySummary = function() private$.items[["uncertaintySummary"]],
        validationSummary = function() private$.items[["validationSummary"]],
        interferenceResults = function() private$.items[["interferenceResults"]],
        carryoverResults = function() private$.items[["carryoverResults"]],
        precisionPlot = function() private$.items[["precisionPlot"]],
        accuracyPlot = function() private$.items[["accuracyPlot"]],
        linearityPlot = function() private$.items[["linearityPlot"]],
        methodComparisonPlot = function() private$.items[["methodComparisonPlot"]],
        uncertaintyPlot = function() private$.items[["uncertaintyPlot"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Laboratory Method Validation Protocols")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="studyDesign",
                title="Study Design Summary",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "validation_type",
                    "precision_design"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="precisionResults",
                title="Precision Evaluation Results",
                visible="(precision_analysis)",
                rows=1,
                clearWith=list(
                    "precision_analysis",
                    "measurement",
                    "concentration_level"),
                columns=list(
                    list(
                        `name`="concentration_level", 
                        `title`="Concentration Level", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="repeatability_sd", 
                        `title`="Repeatability SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="repeatability_cv", 
                        `title`="Repeatability CV (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="intermediate_precision_sd", 
                        `title`="Intermediate Precision SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="intermediate_precision_cv", 
                        `title`="Intermediate Precision CV (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="acceptance_status", 
                        `title`="Acceptance Status", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="accuracyResults",
                title="Accuracy and Bias Assessment",
                visible="(accuracy_analysis)",
                rows=1,
                clearWith=list(
                    "accuracy_analysis",
                    "measurement",
                    "reference_value"),
                columns=list(
                    list(
                        `name`="concentration_level", 
                        `title`="Concentration Level", 
                        `type`="text"),
                    list(
                        `name`="target_value", 
                        `title`="Target Value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="observed_mean", 
                        `title`="Observed Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="bias", 
                        `title`="Bias", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="bias_percent", 
                        `title`="Bias (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="bias_ci_lower", 
                        `title`="Bias CI Lower", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="bias_ci_upper", 
                        `title`="Bias CI Upper", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="recovery_percent", 
                        `title`="Recovery (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="acceptance_status", 
                        `title`="Acceptance Status", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="linearityResults",
                title="Linearity Analysis Results",
                visible="(linearity_analysis)",
                rows=1,
                clearWith=list(
                    "linearity_analysis",
                    "measurement",
                    "reference_value"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="statistical_significance", 
                        `title`="Statistical Significance", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="linearityData",
                title="Linearity Data Points",
                visible="(linearity_analysis)",
                rows=1,
                clearWith=list(
                    "linearity_analysis",
                    "measurement"),
                columns=list(
                    list(
                        `name`="expected_value", 
                        `title`="Expected Value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="observed_mean", 
                        `title`="Observed Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="difference", 
                        `title`="Difference", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="percent_difference", 
                        `title`="Difference (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="within_limits", 
                        `title`="Within Limits", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="detectionLimits",
                title="Detection and Quantitation Limits",
                visible="(limit_of_detection || limit_of_quantitation)",
                rows=1,
                clearWith=list(
                    "limit_of_detection",
                    "limit_of_quantitation"),
                columns=list(
                    list(
                        `name`="limit_type", 
                        `title`="Limit Type", 
                        `type`="text"),
                    list(
                        `name`="estimated_value", 
                        `title`="Estimated Value", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="method_used", 
                        `title`="Method Used", 
                        `type`="text"),
                    list(
                        `name`="confidence_interval", 
                        `title`="Confidence Interval", 
                        `type`="text"),
                    list(
                        `name`="verification_status", 
                        `title`="Verification Status", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="uncertaintyBudget",
                title="Measurement Uncertainty Budget",
                visible="(uncertainty_budget)",
                rows=1,
                clearWith=list(
                    "uncertainty_budget",
                    "measurement"),
                columns=list(
                    list(
                        `name`="uncertainty_component", 
                        `title`="Uncertainty Component", 
                        `type`="text"),
                    list(
                        `name`="standard_uncertainty", 
                        `title`="Standard Uncertainty", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="relative_uncertainty", 
                        `title`="Relative Uncertainty (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="degrees_of_freedom", 
                        `title`="Degrees of Freedom", 
                        `type`="integer"),
                    list(
                        `name`="contribution_percent", 
                        `title`="Contribution (%)", 
                        `type`="number", 
                        `format`="zto:1"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="uncertaintySummary",
                title="Combined Uncertainty Summary",
                visible="(uncertainty_budget)",
                rows=1,
                clearWith=list(
                    "uncertainty_budget"),
                columns=list(
                    list(
                        `name`="uncertainty_type", 
                        `title`="Uncertainty Type", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="relative_value", 
                        `title`="Relative Value (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="coverage_factor", 
                        `title`="Coverage Factor", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="expanded_uncertainty", 
                        `title`="Expanded Uncertainty", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="validationSummary",
                title="Method Validation Summary",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "validation_type",
                    "measurement"),
                columns=list(
                    list(
                        `name`="validation_parameter", 
                        `title`="Validation Parameter", 
                        `type`="text"),
                    list(
                        `name`="acceptance_criterion", 
                        `title`="Acceptance Criterion", 
                        `type`="text"),
                    list(
                        `name`="observed_result", 
                        `title`="Observed Result", 
                        `type`="text"),
                    list(
                        `name`="status", 
                        `title`="Status", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="interferenceResults",
                title="Interference Testing Results",
                visible="(interference_testing)",
                rows=1,
                clearWith=list(
                    "interference_testing"),
                columns=list(
                    list(
                        `name`="interfering_substance", 
                        `title`="Interfering Substance", 
                        `type`="text"),
                    list(
                        `name`="concentration_tested", 
                        `title`="Concentration Tested", 
                        `type`="text"),
                    list(
                        `name`="baseline_result", 
                        `title`="Baseline Result", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interference_result", 
                        `title`="Interference Result", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="percent_interference", 
                        `title`="Interference (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="carryoverResults",
                title="Carryover Assessment Results",
                visible="(carryover_assessment)",
                rows=1,
                clearWith=list(
                    "carryover_assessment"),
                columns=list(
                    list(
                        `name`="test_sequence", 
                        `title`="Test Sequence", 
                        `type`="text"),
                    list(
                        `name`="expected_result", 
                        `title`="Expected Result", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="observed_result", 
                        `title`="Observed Result", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="carryover_percent", 
                        `title`="Carryover (%)", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="acceptance_status", 
                        `title`="Acceptance Status", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="precisionPlot",
                title="Precision Study Visualization",
                visible="(validation_plots && precision_analysis)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotPrecision",
                clearWith=list(
                    "validation_plots",
                    "measurement",
                    "concentration_level")))
            self$add(jmvcore::Image$new(
                options=options,
                name="accuracyPlot",
                title="Accuracy and Bias Visualization",
                visible="(validation_plots && accuracy_analysis)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotAccuracy",
                clearWith=list(
                    "validation_plots",
                    "measurement",
                    "reference_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="linearityPlot",
                title="Linearity Assessment Plot",
                visible="(validation_plots && linearity_analysis)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotLinearity",
                clearWith=list(
                    "validation_plots",
                    "measurement",
                    "reference_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="methodComparisonPlot",
                title="Method Comparison Analysis",
                visible="(method_comparison_plot && validation_type == \"method_comparison\")",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotMethodComparison",
                clearWith=list(
                    "method_comparison_plot",
                    "measurement",
                    "reference_value")))
            self$add(jmvcore::Image$new(
                options=options,
                name="uncertaintyPlot",
                title="Uncertainty Budget Visualization",
                visible="(validation_plots && uncertainty_budget)",
                requiresData=TRUE,
                width=700,
                height=500,
                renderFun=".plotUncertaintyBudget",
                clearWith=list(
                    "validation_plots",
                    "uncertainty_budget")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Regulatory Context",
                visible=TRUE))}))

methodvalidationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodvalidationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "methodvalidation",
                version = c(1,0,0),
                options = options,
                results = methodvalidationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Laboratory Method Validation Protocols
#'
#' Comprehensive analytical method validation following CLSI EP15-A3, EP05-A3, 
#' and ISO 15189 guidelines. Validates precision, accuracy, linearity, 
#' measuring interval, and analytical measurement range for clinical 
#' laboratory methods. Supports regulatory submissions and laboratory 
#' accreditation. Essential for establishing method performance 
#' characteristics.
#' 
#'
#' @examples
#' data \%>\%
#' methodvalidation(
#'     measurement = "glucose_result",
#'     reference_value = "reference_glucose",
#'     replicate = "replicate_number",
#'     concentration_level = "control_level"
#' )
#'
#' @param data the data as a data frame
#' @param measurement Test method measurement values
#' @param reference_value Reference method or target concentration values
#' @param replicate Replicate measurement identifier
#' @param concentration_level Concentration level identifier (e.g., Low,
#'   Medium, High)
#' @param operator Operator or analyst identifier for intermediate precision
#' @param instrument Instrument identifier for ruggedness testing
#' @param validation_type Type of validation study to perform
#' @param precision_design Experimental design for precision evaluation
#' @param replicates_per_run Number of replicates per run for precision study
#' @param number_of_runs Number of runs for precision study
#' @param confidence_level Confidence level for statistical calculations
#' @param acceptance_criteria Source for method acceptance criteria
#' @param custom_cv_limit Custom coefficient of variation acceptance limit
#' @param custom_bias_limit Custom bias acceptance limit
#' @param linearity_points Number of concentration points for linearity study
#' @param outlier_detection Apply statistical outlier detection methods
#' @param precision_analysis Perform comprehensive precision evaluation
#' @param accuracy_analysis Perform bias and accuracy assessment
#' @param linearity_analysis Perform linearity and measuring interval
#'   evaluation
#' @param limit_of_detection Estimate analytical limit of detection
#' @param limit_of_quantitation Estimate analytical limit of quantitation
#' @param interference_testing Evaluate potential analytical interferences
#' @param carryover_assessment Assess sample carryover effects
#' @param reference_interval Verify established reference intervals
#' @param uncertainty_budget Calculate comprehensive uncertainty budget
#' @param validation_plots Generate validation study visualizations
#' @param method_comparison_plot Create method comparison visualizations
#' @param export_report Generate comprehensive validation report
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$studyDesign} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$precisionResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$accuracyResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$linearityResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$linearityData} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$detectionLimits} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$uncertaintyBudget} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$uncertaintySummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$validationSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interferenceResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$carryoverResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$precisionPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$accuracyPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$linearityPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodComparisonPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$uncertaintyPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$studyDesign$asDF}
#'
#' \code{as.data.frame(results$studyDesign)}
#'
#' @export
methodvalidation <- function(
    data,
    measurement,
    reference_value,
    replicate,
    concentration_level,
    operator,
    instrument,
    validation_type = "full_validation",
    precision_design = "ep15a3",
    replicates_per_run = 3,
    number_of_runs = 20,
    confidence_level = 0.95,
    acceptance_criteria = "biological_variation",
    custom_cv_limit = 10,
    custom_bias_limit = 5,
    linearity_points = 7,
    outlier_detection = TRUE,
    precision_analysis = TRUE,
    accuracy_analysis = TRUE,
    linearity_analysis = TRUE,
    limit_of_detection = FALSE,
    limit_of_quantitation = FALSE,
    interference_testing = FALSE,
    carryover_assessment = FALSE,
    reference_interval = FALSE,
    uncertainty_budget = TRUE,
    validation_plots = TRUE,
    method_comparison_plot = TRUE,
    export_report = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("methodvalidation requires jmvcore to be installed (restart may be required)")

    if ( ! missing(measurement)) measurement <- jmvcore::resolveQuo(jmvcore::enquo(measurement))
    if ( ! missing(reference_value)) reference_value <- jmvcore::resolveQuo(jmvcore::enquo(reference_value))
    if ( ! missing(replicate)) replicate <- jmvcore::resolveQuo(jmvcore::enquo(replicate))
    if ( ! missing(concentration_level)) concentration_level <- jmvcore::resolveQuo(jmvcore::enquo(concentration_level))
    if ( ! missing(operator)) operator <- jmvcore::resolveQuo(jmvcore::enquo(operator))
    if ( ! missing(instrument)) instrument <- jmvcore::resolveQuo(jmvcore::enquo(instrument))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(measurement), measurement, NULL),
            `if`( ! missing(reference_value), reference_value, NULL),
            `if`( ! missing(replicate), replicate, NULL),
            `if`( ! missing(concentration_level), concentration_level, NULL),
            `if`( ! missing(operator), operator, NULL),
            `if`( ! missing(instrument), instrument, NULL))

    for (v in operator) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in instrument) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- methodvalidationOptions$new(
        measurement = measurement,
        reference_value = reference_value,
        replicate = replicate,
        concentration_level = concentration_level,
        operator = operator,
        instrument = instrument,
        validation_type = validation_type,
        precision_design = precision_design,
        replicates_per_run = replicates_per_run,
        number_of_runs = number_of_runs,
        confidence_level = confidence_level,
        acceptance_criteria = acceptance_criteria,
        custom_cv_limit = custom_cv_limit,
        custom_bias_limit = custom_bias_limit,
        linearity_points = linearity_points,
        outlier_detection = outlier_detection,
        precision_analysis = precision_analysis,
        accuracy_analysis = accuracy_analysis,
        linearity_analysis = linearity_analysis,
        limit_of_detection = limit_of_detection,
        limit_of_quantitation = limit_of_quantitation,
        interference_testing = interference_testing,
        carryover_assessment = carryover_assessment,
        reference_interval = reference_interval,
        uncertainty_budget = uncertainty_budget,
        validation_plots = validation_plots,
        method_comparison_plot = method_comparison_plot,
        export_report = export_report)

    analysis <- methodvalidationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

