
# This file is automatically generated, you probably don't want to edit this

ordinalrocOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ordinalrocOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            predictor = NULL,
            ordinal_outcome = NULL,
            outcome_order = NULL,
            roc_method = "empirical",
            cumulative_direction = "geq",
            calculate_auc = TRUE,
            auc_ci_method = "delong",
            bootstrap_samples = 1000,
            confidence_level = 0.95,
            category_specific_auc = TRUE,
            test_proportional_odds = TRUE,
            show_coefficients = TRUE,
            partial_proportional_odds = FALSE,
            optimal_thresholds = TRUE,
            threshold_method = "youden",
            sensitivity_target = 0.8,
            specificity_target = 0.8,
            plot_ordinal_roc = TRUE,
            plot_all_cumulative = TRUE,
            plot_category_distributions = TRUE,
            plot_cumulative_probabilities = FALSE,
            plot_confusion_matrix = FALSE,
            clinical_context = "general",
            show_interpretation = TRUE,
            stratified_analysis = FALSE,
            stratify_by = NULL,
            covariate_adjustment = FALSE,
            covariates = NULL,
            compare_predictors = FALSE,
            additional_predictors = NULL,
            auc_comparison_test = TRUE,
            missing_handling = "complete",
            random_seed = 123, ...) {

            super$initialize(
                package="ClinicoPath",
                name="ordinalroc",
                requiresData=TRUE,
                ...)

            private$..predictor <- jmvcore::OptionVariable$new(
                "predictor",
                predictor,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..ordinal_outcome <- jmvcore::OptionVariable$new(
                "ordinal_outcome",
                ordinal_outcome,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..outcome_order <- jmvcore::OptionVariables$new(
                "outcome_order",
                outcome_order)
            private$..roc_method <- jmvcore::OptionList$new(
                "roc_method",
                roc_method,
                options=list(
                    "empirical",
                    "binormal",
                    "proportional_odds"),
                default="empirical")
            private$..cumulative_direction <- jmvcore::OptionList$new(
                "cumulative_direction",
                cumulative_direction,
                options=list(
                    "geq",
                    "leq"),
                default="geq")
            private$..calculate_auc <- jmvcore::OptionBool$new(
                "calculate_auc",
                calculate_auc,
                default=TRUE)
            private$..auc_ci_method <- jmvcore::OptionList$new(
                "auc_ci_method",
                auc_ci_method,
                options=list(
                    "delong",
                    "bootstrap"),
                default="delong")
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=1000,
                min=100,
                max=10000)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..category_specific_auc <- jmvcore::OptionBool$new(
                "category_specific_auc",
                category_specific_auc,
                default=TRUE)
            private$..test_proportional_odds <- jmvcore::OptionBool$new(
                "test_proportional_odds",
                test_proportional_odds,
                default=TRUE)
            private$..show_coefficients <- jmvcore::OptionBool$new(
                "show_coefficients",
                show_coefficients,
                default=TRUE)
            private$..partial_proportional_odds <- jmvcore::OptionBool$new(
                "partial_proportional_odds",
                partial_proportional_odds,
                default=FALSE)
            private$..optimal_thresholds <- jmvcore::OptionBool$new(
                "optimal_thresholds",
                optimal_thresholds,
                default=TRUE)
            private$..threshold_method <- jmvcore::OptionList$new(
                "threshold_method",
                threshold_method,
                options=list(
                    "youden",
                    "equal",
                    "topleft",
                    "cost"),
                default="youden")
            private$..sensitivity_target <- jmvcore::OptionNumber$new(
                "sensitivity_target",
                sensitivity_target,
                default=0.8,
                min=0.5,
                max=0.99)
            private$..specificity_target <- jmvcore::OptionNumber$new(
                "specificity_target",
                specificity_target,
                default=0.8,
                min=0.5,
                max=0.99)
            private$..plot_ordinal_roc <- jmvcore::OptionBool$new(
                "plot_ordinal_roc",
                plot_ordinal_roc,
                default=TRUE)
            private$..plot_all_cumulative <- jmvcore::OptionBool$new(
                "plot_all_cumulative",
                plot_all_cumulative,
                default=TRUE)
            private$..plot_category_distributions <- jmvcore::OptionBool$new(
                "plot_category_distributions",
                plot_category_distributions,
                default=TRUE)
            private$..plot_cumulative_probabilities <- jmvcore::OptionBool$new(
                "plot_cumulative_probabilities",
                plot_cumulative_probabilities,
                default=FALSE)
            private$..plot_confusion_matrix <- jmvcore::OptionBool$new(
                "plot_confusion_matrix",
                plot_confusion_matrix,
                default=FALSE)
            private$..clinical_context <- jmvcore::OptionList$new(
                "clinical_context",
                clinical_context,
                options=list(
                    "general",
                    "differentiation",
                    "fibrosis",
                    "stage",
                    "gleason",
                    "inflammation"),
                default="general")
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)
            private$..stratified_analysis <- jmvcore::OptionBool$new(
                "stratified_analysis",
                stratified_analysis,
                default=FALSE)
            private$..stratify_by <- jmvcore::OptionVariable$new(
                "stratify_by",
                stratify_by,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..covariate_adjustment <- jmvcore::OptionBool$new(
                "covariate_adjustment",
                covariate_adjustment,
                default=FALSE)
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..compare_predictors <- jmvcore::OptionBool$new(
                "compare_predictors",
                compare_predictors,
                default=FALSE)
            private$..additional_predictors <- jmvcore::OptionVariables$new(
                "additional_predictors",
                additional_predictors,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..auc_comparison_test <- jmvcore::OptionBool$new(
                "auc_comparison_test",
                auc_comparison_test,
                default=TRUE)
            private$..missing_handling <- jmvcore::OptionList$new(
                "missing_handling",
                missing_handling,
                options=list(
                    "complete",
                    "imputation"),
                default="complete")
            private$..random_seed <- jmvcore::OptionInteger$new(
                "random_seed",
                random_seed,
                default=123,
                min=1,
                max=999999)

            self$.addOption(private$..predictor)
            self$.addOption(private$..ordinal_outcome)
            self$.addOption(private$..outcome_order)
            self$.addOption(private$..roc_method)
            self$.addOption(private$..cumulative_direction)
            self$.addOption(private$..calculate_auc)
            self$.addOption(private$..auc_ci_method)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..category_specific_auc)
            self$.addOption(private$..test_proportional_odds)
            self$.addOption(private$..show_coefficients)
            self$.addOption(private$..partial_proportional_odds)
            self$.addOption(private$..optimal_thresholds)
            self$.addOption(private$..threshold_method)
            self$.addOption(private$..sensitivity_target)
            self$.addOption(private$..specificity_target)
            self$.addOption(private$..plot_ordinal_roc)
            self$.addOption(private$..plot_all_cumulative)
            self$.addOption(private$..plot_category_distributions)
            self$.addOption(private$..plot_cumulative_probabilities)
            self$.addOption(private$..plot_confusion_matrix)
            self$.addOption(private$..clinical_context)
            self$.addOption(private$..show_interpretation)
            self$.addOption(private$..stratified_analysis)
            self$.addOption(private$..stratify_by)
            self$.addOption(private$..covariate_adjustment)
            self$.addOption(private$..covariates)
            self$.addOption(private$..compare_predictors)
            self$.addOption(private$..additional_predictors)
            self$.addOption(private$..auc_comparison_test)
            self$.addOption(private$..missing_handling)
            self$.addOption(private$..random_seed)
        }),
    active = list(
        predictor = function() private$..predictor$value,
        ordinal_outcome = function() private$..ordinal_outcome$value,
        outcome_order = function() private$..outcome_order$value,
        roc_method = function() private$..roc_method$value,
        cumulative_direction = function() private$..cumulative_direction$value,
        calculate_auc = function() private$..calculate_auc$value,
        auc_ci_method = function() private$..auc_ci_method$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        confidence_level = function() private$..confidence_level$value,
        category_specific_auc = function() private$..category_specific_auc$value,
        test_proportional_odds = function() private$..test_proportional_odds$value,
        show_coefficients = function() private$..show_coefficients$value,
        partial_proportional_odds = function() private$..partial_proportional_odds$value,
        optimal_thresholds = function() private$..optimal_thresholds$value,
        threshold_method = function() private$..threshold_method$value,
        sensitivity_target = function() private$..sensitivity_target$value,
        specificity_target = function() private$..specificity_target$value,
        plot_ordinal_roc = function() private$..plot_ordinal_roc$value,
        plot_all_cumulative = function() private$..plot_all_cumulative$value,
        plot_category_distributions = function() private$..plot_category_distributions$value,
        plot_cumulative_probabilities = function() private$..plot_cumulative_probabilities$value,
        plot_confusion_matrix = function() private$..plot_confusion_matrix$value,
        clinical_context = function() private$..clinical_context$value,
        show_interpretation = function() private$..show_interpretation$value,
        stratified_analysis = function() private$..stratified_analysis$value,
        stratify_by = function() private$..stratify_by$value,
        covariate_adjustment = function() private$..covariate_adjustment$value,
        covariates = function() private$..covariates$value,
        compare_predictors = function() private$..compare_predictors$value,
        additional_predictors = function() private$..additional_predictors$value,
        auc_comparison_test = function() private$..auc_comparison_test$value,
        missing_handling = function() private$..missing_handling$value,
        random_seed = function() private$..random_seed$value),
    private = list(
        ..predictor = NA,
        ..ordinal_outcome = NA,
        ..outcome_order = NA,
        ..roc_method = NA,
        ..cumulative_direction = NA,
        ..calculate_auc = NA,
        ..auc_ci_method = NA,
        ..bootstrap_samples = NA,
        ..confidence_level = NA,
        ..category_specific_auc = NA,
        ..test_proportional_odds = NA,
        ..show_coefficients = NA,
        ..partial_proportional_odds = NA,
        ..optimal_thresholds = NA,
        ..threshold_method = NA,
        ..sensitivity_target = NA,
        ..specificity_target = NA,
        ..plot_ordinal_roc = NA,
        ..plot_all_cumulative = NA,
        ..plot_category_distributions = NA,
        ..plot_cumulative_probabilities = NA,
        ..plot_confusion_matrix = NA,
        ..clinical_context = NA,
        ..show_interpretation = NA,
        ..stratified_analysis = NA,
        ..stratify_by = NA,
        ..covariate_adjustment = NA,
        ..covariates = NA,
        ..compare_predictors = NA,
        ..additional_predictors = NA,
        ..auc_comparison_test = NA,
        ..missing_handling = NA,
        ..random_seed = NA)
)

ordinalrocResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ordinalrocResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        overallSummary = function() private$.items[["overallSummary"]],
        cumulativeAUC = function() private$.items[["cumulativeAUC"]],
        proportionalOddsTest = function() private$.items[["proportionalOddsTest"]],
        modelCoefficients = function() private$.items[["modelCoefficients"]],
        optimalThresholds = function() private$.items[["optimalThresholds"]],
        predictorComparison = function() private$.items[["predictorComparison"]],
        aucComparisonTests = function() private$.items[["aucComparisonTests"]],
        stratifiedResults = function() private$.items[["stratifiedResults"]],
        confusionMatrix = function() private$.items[["confusionMatrix"]],
        ordinalROCPlot = function() private$.items[["ordinalROCPlot"]],
        cumulativeROCPlot = function() private$.items[["cumulativeROCPlot"]],
        categoryDistPlot = function() private$.items[["categoryDistPlot"]],
        cumulativeProbPlot = function() private$.items[["cumulativeProbPlot"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Ordinal ROC Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="overallSummary",
                title="Overall ROC Summary",
                visible="(calculate_auc)",
                rows=1,
                columns=list(
                    list(
                        `name`="predictor", 
                        `title`="Predictor", 
                        `type`="text"),
                    list(
                        `name`="outcome", 
                        `title`="Ordinal Outcome", 
                        `type`="text"),
                    list(
                        `name`="n_categories", 
                        `title`="Number of Categories", 
                        `type`="integer"),
                    list(
                        `name`="n_obs", 
                        `title`="N Observations", 
                        `type`="integer"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_se", 
                        `title`="AUC SE", 
                        `type`="number"),
                    list(
                        `name`="auc_ci_lower", 
                        `title`="AUC 95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_ci_upper", 
                        `title`="AUC 95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="P-value (AUC > 0.5)", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="cumulativeAUC",
                title="Category-Specific AUC (Cumulative Dichotomizations)",
                visible="(category_specific_auc)",
                columns=list(
                    list(
                        `name`="dichotomization", 
                        `title`="Dichotomization", 
                        `type`="text"),
                    list(
                        `name`="n_low", 
                        `title`="N Low", 
                        `type`="integer"),
                    list(
                        `name`="n_high", 
                        `title`="N High", 
                        `type`="integer"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="auc_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="optimal_threshold", 
                        `title`="Optimal Threshold", 
                        `type`="number"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="youden_j", 
                        `title`="Youden J", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="proportionalOddsTest",
                title="Proportional Odds Assumption Test",
                visible="(test_proportional_odds && roc_method:proportional_odds)",
                rows=1,
                columns=list(
                    list(
                        `name`="test_statistic", 
                        `title`="Test Statistic", 
                        `type`="number"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="conclusion", 
                        `title`="Conclusion", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelCoefficients",
                title="Proportional Odds Model Coefficients",
                visible="(show_coefficients && roc_method:proportional_odds)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="z_value", 
                        `title`="Z", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="or", 
                        `title`="Odds Ratio", 
                        `type`="number"),
                    list(
                        `name`="or_ci_lower", 
                        `title`="OR 95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="or_ci_upper", 
                        `title`="OR 95% CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="optimalThresholds",
                title="Optimal Threshold Summary",
                visible="(optimal_thresholds)",
                columns=list(
                    list(
                        `name`="dichotomization", 
                        `title`="Dichotomization", 
                        `type`="text"),
                    list(
                        `name`="optimal_threshold", 
                        `title`="Optimal Threshold", 
                        `type`="number"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ppv", 
                        `title`="PPV", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="npv", 
                        `title`="NPV", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="accuracy", 
                        `title`="Accuracy", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="youden_j", 
                        `title`="Youden J", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="predictorComparison",
                title="Multiple Predictor Comparison",
                visible="(compare_predictors)",
                columns=list(
                    list(
                        `name`="predictor", 
                        `title`="Predictor", 
                        `type`="text"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="auc_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="rank", 
                        `title`="Rank", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="aucComparisonTests",
                title="Pairwise AUC Comparison Tests",
                visible="(compare_predictors && auc_comparison_test)",
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="auc_diff", 
                        `title`="AUC Difference", 
                        `type`="number"),
                    list(
                        `name`="se_diff", 
                        `title`="SE Difference", 
                        `type`="number"),
                    list(
                        `name`="z_statistic", 
                        `title`="Z Statistic", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="conclusion", 
                        `title`="Conclusion", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stratifiedResults",
                title="Stratified Analysis Results",
                visible="(stratified_analysis)",
                columns=list(
                    list(
                        `name`="stratum", 
                        `title`="Stratum", 
                        `type`="text"),
                    list(
                        `name`="n_obs", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="auc", 
                        `title`="AUC", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="auc_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="confusionMatrix",
                title="Confusion Matrix (Ordinal Classification)",
                visible="(plot_confusion_matrix)",
                columns=list(
                    list(
                        `name`="true_category", 
                        `title`="True Category", 
                        `type`="text"),
                    list(
                        `name`="pred_cat_1", 
                        `title`="Predicted Category 1", 
                        `type`="integer"),
                    list(
                        `name`="pred_cat_2", 
                        `title`="Predicted Category 2", 
                        `type`="integer"),
                    list(
                        `name`="pred_cat_3", 
                        `title`="Predicted Category 3", 
                        `type`="integer"),
                    list(
                        `name`="pred_cat_4", 
                        `title`="Predicted Category 4", 
                        `type`="integer", 
                        `visible`=FALSE),
                    list(
                        `name`="pred_cat_5", 
                        `title`="Predicted Category 5", 
                        `type`="integer", 
                        `visible`=FALSE))))
            self$add(jmvcore::Image$new(
                options=options,
                name="ordinalROCPlot",
                title="Ordinal ROC Curve(s)",
                width=600,
                height=500,
                renderFun=".plotOrdinalROC",
                visible="(plot_ordinal_roc)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="cumulativeROCPlot",
                title="Cumulative ROC Curves",
                width=600,
                height=500,
                renderFun=".plotCumulativeROC",
                visible="(plot_all_cumulative)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="categoryDistPlot",
                title="Predictor Distribution by Category",
                width=600,
                height=500,
                renderFun=".plotCategoryDistributions",
                visible="(plot_category_distributions)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="cumulativeProbPlot",
                title="Cumulative Probability Curves",
                width=600,
                height=500,
                renderFun=".plotCumulativeProbabilities",
                visible="(plot_cumulative_probabilities)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Clinical Interpretation",
                visible="(show_interpretation)"))}))

ordinalrocBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "ordinalrocBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "ordinalroc",
                version = c(0,0,32),
                options = options,
                results = ordinalrocResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Ordinal ROC Analysis
#'
#' Ordinal ROC analysis for diagnostic tests predicting ordered categorical 
#' outcomes such as tumor differentiation grade (well/moderate/poor), fibrosis 
#' stage (F0-F4), inflammation severity (none/mild/moderate/severe), or cancer 
#' stage (I/II/III/IV). Unlike binary ROC which dichotomizes outcomes, ordinal 
#' ROC preserves the natural ordering of categories and accounts for the 
#' severity/progression inherent in ordinal scales. The analysis uses 
#' cumulative probability models and proportional odds assumptions to generate 
#' ROC curves that reflect the ordinal nature of the outcome. Provides 
#' cumulative AUC across all thresholds, partial proportional odds models, and 
#' ordinal-specific performance metrics. Essential for biomarker validation in 
#' grading systems, staging algorithms, and any scenario where the outcome has 
#' more than 2 ordered levels. Particularly valuable in pathology where 
#' grading and staging are fundamental to diagnosis and prognosis (Gleason 
#' score, Nottingham grade, FIGO stage, etc.).
#' 
#'
#' @examples
#' result <- ordinalroc(
#'     data = grading_data,
#'     predictor = "biomarker_score",
#'     ordinal_outcome = "tumor_grade",
#'     outcome_order = c("well", "moderate", "poor")
#' )
#'
#' @param data The data as a data frame.
#' @param predictor Continuous predictor variable (biomarker level, risk
#'   score, imaging feature) used to predict the ordinal outcome. Should
#'   increase or decrease monotonically with outcome severity.
#' @param ordinal_outcome Ordered categorical outcome variable with 3 or more
#'   levels representing increasing severity or progression (e.g.,
#'   well/moderate/poor differentiation, stage I/II/III/IV, FIGO stage, fibrosis
#'   score F0-F4).
#' @param outcome_order Specify the correct ordering of outcome levels from
#'   lowest to highest severity. This ensures proper cumulative probability
#'   calculation. For example, for tumor differentiation, order should be: well,
#'   moderate, poor.
#' @param roc_method Method for constructing ordinal ROC curves. Empirical
#'   uses observed cumulative distributions (non-parametric), binormal assumes
#'   normal distributions within categories, proportional odds uses logistic
#'   regression framework.
#' @param cumulative_direction Direction for cumulative probabilities. Use ≥
#'   if higher predictor values indicate higher severity (e.g., higher biomarker
#'   = worse grade). Use ≤ if lower predictor values indicate higher severity.
#' @param calculate_auc Calculate area under the ordinal ROC curve. For
#'   ordinal outcomes, this is often called the concordance probability or
#'   generalized AUC. Values >0.5 indicate discriminatory ability.
#' @param auc_ci_method Method for calculating confidence intervals around
#'   AUC. DeLong is faster, bootstrap is more accurate for small samples.
#' @param bootstrap_samples Number of bootstrap samples for confidence
#'   interval estimation when using bootstrap method.
#' @param confidence_level Confidence level for interval estimation around AUC
#'   and other metrics.
#' @param category_specific_auc Calculate AUC for each cumulative
#'   dichotomization (e.g., for grades 1/2/3, calculate AUC for 1 vs 2+3, 1+2 vs
#'   3). Shows discriminatory ability at each threshold.
#' @param test_proportional_odds Test whether the proportional odds assumption
#'   holds. This assumption states that the effect of the predictor is the same
#'   across all category thresholds. Violation suggests non-proportional odds
#'   model may be needed.
#' @param show_coefficients Display coefficients from the proportional odds
#'   logistic regression model. Shows the log-odds ratio for predictor and
#'   threshold intercepts.
#' @param partial_proportional_odds If proportional odds assumption is
#'   violated, fit partial proportional odds model where predictor effects can
#'   vary across thresholds.
#' @param optimal_thresholds Identify optimal predictor thresholds for each
#'   cumulative dichotomization using Youden index or other criteria.
#' @param threshold_method Method for selecting optimal threshold at each
#'   cumulative split.
#' @param sensitivity_target Target sensitivity for threshold selection if
#'   using sensitivity-constrained approach.
#' @param specificity_target Target specificity for threshold selection if
#'   using specificity-constrained approach.
#' @param plot_ordinal_roc Display ordinal ROC curve(s). For empirical method,
#'   shows cumulative ROC for each dichotomization. For proportional odds, shows
#'   model-based curve.
#' @param plot_all_cumulative Display separate ROC curves for each cumulative
#'   dichotomization on the same plot. Helps visualize how discrimination varies
#'   across severity levels.
#' @param plot_category_distributions Show distribution of predictor values
#'   stratified by outcome category. Visualizes separation between ordinal
#'   levels.
#' @param plot_cumulative_probabilities Display cumulative probability curves
#'   as a function of predictor value. Shows how predicted probabilities change
#'   with predictor level.
#' @param plot_confusion_matrix Show confusion matrix using optimal thresholds
#'   to classify observations into ordinal categories.
#' @param clinical_context Clinical context for interpretation guidance.
#'   Provides context-specific recommendations for threshold selection and
#'   clinical application.
#' @param show_interpretation Provide clinical interpretation of results
#'   including guidance on biomarker utility for distinguishing between ordinal
#'   categories.
#' @param stratified_analysis Perform stratified ordinal ROC analysis by
#'   important subgroups to assess consistency of biomarker performance across
#'   populations.
#' @param stratify_by Variable defining strata for stratified analysis (e.g.,
#'   age group, sex, institution). Each level receives separate ordinal ROC
#'   analysis.
#' @param covariate_adjustment Adjust ordinal ROC analysis for covariates
#'   (confounders) using regression framework. Useful for scanner effects, batch
#'   effects, or demographic variables.
#' @param covariates Variables to adjust for in covariate-adjusted ordinal ROC
#'   analysis.
#' @param compare_predictors Compare multiple predictor variables on the same
#'   ordinal outcome to determine which biomarker has superior discrimination
#'   across ordinal categories.
#' @param additional_predictors Additional continuous predictors to compare
#'   with the primary predictor. Each will receive ordinal ROC analysis and AUC
#'   comparison tests.
#' @param auc_comparison_test When comparing multiple predictors, perform
#'   statistical test for differences in AUC values (DeLong test or bootstrap
#'   comparison).
#' @param missing_handling Method for handling missing data in predictor or
#'   outcome variables.
#' @param random_seed Random seed for bootstrap sampling and other stochastic
#'   procedures. Ensures reproducible results.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$overallSummary} \tab \tab \tab \tab \tab Summary of ordinal ROC analysis with AUC and confidence intervals \cr
#'   \code{results$cumulativeAUC} \tab \tab \tab \tab \tab AUC for each cumulative split of ordinal categories \cr
#'   \code{results$proportionalOddsTest} \tab \tab \tab \tab \tab Test of proportional odds assumption \cr
#'   \code{results$modelCoefficients} \tab \tab \tab \tab \tab Coefficients from proportional odds logistic regression \cr
#'   \code{results$optimalThresholds} \tab \tab \tab \tab \tab Optimal predictor thresholds for each cumulative split \cr
#'   \code{results$predictorComparison} \tab \tab \tab \tab \tab Comparison of AUC across multiple predictors \cr
#'   \code{results$aucComparisonTests} \tab \tab \tab \tab \tab Statistical tests comparing AUC between predictors \cr
#'   \code{results$stratifiedResults} \tab \tab \tab \tab \tab Ordinal ROC results stratified by subgroup \cr
#'   \code{results$confusionMatrix} \tab \tab \tab \tab \tab Confusion matrix using optimal thresholds to classify into ordinal categories \cr
#'   \code{results$ordinalROCPlot} \tab \tab \tab \tab \tab Ordinal ROC curve showing discrimination across ordinal categories \cr
#'   \code{results$cumulativeROCPlot} \tab \tab \tab \tab \tab Separate ROC curves for each cumulative dichotomization \cr
#'   \code{results$categoryDistPlot} \tab \tab \tab \tab \tab Distribution of predictor values stratified by ordinal outcome category \cr
#'   \code{results$cumulativeProbPlot} \tab \tab \tab \tab \tab Cumulative probabilities as a function of predictor value \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$overallSummary$asDF}
#'
#' \code{as.data.frame(results$overallSummary)}
#'
#' @export
ordinalroc <- function(
    data,
    predictor,
    ordinal_outcome,
    outcome_order,
    roc_method = "empirical",
    cumulative_direction = "geq",
    calculate_auc = TRUE,
    auc_ci_method = "delong",
    bootstrap_samples = 1000,
    confidence_level = 0.95,
    category_specific_auc = TRUE,
    test_proportional_odds = TRUE,
    show_coefficients = TRUE,
    partial_proportional_odds = FALSE,
    optimal_thresholds = TRUE,
    threshold_method = "youden",
    sensitivity_target = 0.8,
    specificity_target = 0.8,
    plot_ordinal_roc = TRUE,
    plot_all_cumulative = TRUE,
    plot_category_distributions = TRUE,
    plot_cumulative_probabilities = FALSE,
    plot_confusion_matrix = FALSE,
    clinical_context = "general",
    show_interpretation = TRUE,
    stratified_analysis = FALSE,
    stratify_by,
    covariate_adjustment = FALSE,
    covariates,
    compare_predictors = FALSE,
    additional_predictors,
    auc_comparison_test = TRUE,
    missing_handling = "complete",
    random_seed = 123) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("ordinalroc requires jmvcore to be installed (restart may be required)")

    if ( ! missing(predictor)) predictor <- jmvcore::resolveQuo(jmvcore::enquo(predictor))
    if ( ! missing(ordinal_outcome)) ordinal_outcome <- jmvcore::resolveQuo(jmvcore::enquo(ordinal_outcome))
    if ( ! missing(outcome_order)) outcome_order <- jmvcore::resolveQuo(jmvcore::enquo(outcome_order))
    if ( ! missing(stratify_by)) stratify_by <- jmvcore::resolveQuo(jmvcore::enquo(stratify_by))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))
    if ( ! missing(additional_predictors)) additional_predictors <- jmvcore::resolveQuo(jmvcore::enquo(additional_predictors))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(predictor), predictor, NULL),
            `if`( ! missing(ordinal_outcome), ordinal_outcome, NULL),
            `if`( ! missing(outcome_order), outcome_order, NULL),
            `if`( ! missing(stratify_by), stratify_by, NULL),
            `if`( ! missing(covariates), covariates, NULL),
            `if`( ! missing(additional_predictors), additional_predictors, NULL))

    for (v in ordinal_outcome) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in stratify_by) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- ordinalrocOptions$new(
        predictor = predictor,
        ordinal_outcome = ordinal_outcome,
        outcome_order = outcome_order,
        roc_method = roc_method,
        cumulative_direction = cumulative_direction,
        calculate_auc = calculate_auc,
        auc_ci_method = auc_ci_method,
        bootstrap_samples = bootstrap_samples,
        confidence_level = confidence_level,
        category_specific_auc = category_specific_auc,
        test_proportional_odds = test_proportional_odds,
        show_coefficients = show_coefficients,
        partial_proportional_odds = partial_proportional_odds,
        optimal_thresholds = optimal_thresholds,
        threshold_method = threshold_method,
        sensitivity_target = sensitivity_target,
        specificity_target = specificity_target,
        plot_ordinal_roc = plot_ordinal_roc,
        plot_all_cumulative = plot_all_cumulative,
        plot_category_distributions = plot_category_distributions,
        plot_cumulative_probabilities = plot_cumulative_probabilities,
        plot_confusion_matrix = plot_confusion_matrix,
        clinical_context = clinical_context,
        show_interpretation = show_interpretation,
        stratified_analysis = stratified_analysis,
        stratify_by = stratify_by,
        covariate_adjustment = covariate_adjustment,
        covariates = covariates,
        compare_predictors = compare_predictors,
        additional_predictors = additional_predictors,
        auc_comparison_test = auc_comparison_test,
        missing_handling = missing_handling,
        random_seed = random_seed)

    analysis <- ordinalrocClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

