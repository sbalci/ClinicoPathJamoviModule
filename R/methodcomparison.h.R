
# This file is automatically generated, you probably don't want to edit this

methodcomparisonOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodcomparisonOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            method1 = NULL,
            method2 = NULL,
            grouping = NULL,
            comparison_method = "bland_altman",
            confidence_level = 0.95,
            bland_altman_options = TRUE,
            limits_method = "standard",
            proportional_bias = TRUE,
            outlier_detection = TRUE,
            passing_bablok_options = FALSE,
            pb_alpha = 0.05,
            deming_options = FALSE,
            error_ratio = 1,
            correlation_analysis = TRUE,
            concordance_correlation = TRUE,
            regression_comparison = TRUE,
            clinical_limits = FALSE,
            clinical_lower = -10,
            clinical_upper = 10,
            transformation = "none",
            plots_options = TRUE,
            bland_altman_plot = TRUE,
            scatter_plot = TRUE,
            residual_plots = FALSE,
            mountain_plot = FALSE,
            missing_treatment = "complete",
            bootstrap_samples = 1000, ...) {

            super$initialize(
                package="ClinicoPath",
                name="methodcomparison",
                requiresData=TRUE,
                ...)

            private$..method1 <- jmvcore::OptionVariable$new(
                "method1",
                method1,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..method2 <- jmvcore::OptionVariable$new(
                "method2",
                method2,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..grouping <- jmvcore::OptionVariable$new(
                "grouping",
                grouping,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..comparison_method <- jmvcore::OptionList$new(
                "comparison_method",
                comparison_method,
                options=list(
                    "bland_altman",
                    "passing_bablok",
                    "deming",
                    "all"),
                default="bland_altman")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..bland_altman_options <- jmvcore::OptionBool$new(
                "bland_altman_options",
                bland_altman_options,
                default=TRUE)
            private$..limits_method <- jmvcore::OptionList$new(
                "limits_method",
                limits_method,
                options=list(
                    "standard",
                    "exact",
                    "bootstrap"),
                default="standard")
            private$..proportional_bias <- jmvcore::OptionBool$new(
                "proportional_bias",
                proportional_bias,
                default=TRUE)
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=TRUE)
            private$..passing_bablok_options <- jmvcore::OptionBool$new(
                "passing_bablok_options",
                passing_bablok_options,
                default=FALSE)
            private$..pb_alpha <- jmvcore::OptionNumber$new(
                "pb_alpha",
                pb_alpha,
                default=0.05,
                min=0.01,
                max=0.1)
            private$..deming_options <- jmvcore::OptionBool$new(
                "deming_options",
                deming_options,
                default=FALSE)
            private$..error_ratio <- jmvcore::OptionNumber$new(
                "error_ratio",
                error_ratio,
                default=1,
                min=0.1,
                max=10)
            private$..correlation_analysis <- jmvcore::OptionBool$new(
                "correlation_analysis",
                correlation_analysis,
                default=TRUE)
            private$..concordance_correlation <- jmvcore::OptionBool$new(
                "concordance_correlation",
                concordance_correlation,
                default=TRUE)
            private$..regression_comparison <- jmvcore::OptionBool$new(
                "regression_comparison",
                regression_comparison,
                default=TRUE)
            private$..clinical_limits <- jmvcore::OptionBool$new(
                "clinical_limits",
                clinical_limits,
                default=FALSE)
            private$..clinical_lower <- jmvcore::OptionNumber$new(
                "clinical_lower",
                clinical_lower,
                default=-10)
            private$..clinical_upper <- jmvcore::OptionNumber$new(
                "clinical_upper",
                clinical_upper,
                default=10)
            private$..transformation <- jmvcore::OptionList$new(
                "transformation",
                transformation,
                options=list(
                    "none",
                    "log",
                    "sqrt",
                    "boxcox"),
                default="none")
            private$..plots_options <- jmvcore::OptionBool$new(
                "plots_options",
                plots_options,
                default=TRUE)
            private$..bland_altman_plot <- jmvcore::OptionBool$new(
                "bland_altman_plot",
                bland_altman_plot,
                default=TRUE)
            private$..scatter_plot <- jmvcore::OptionBool$new(
                "scatter_plot",
                scatter_plot,
                default=TRUE)
            private$..residual_plots <- jmvcore::OptionBool$new(
                "residual_plots",
                residual_plots,
                default=FALSE)
            private$..mountain_plot <- jmvcore::OptionBool$new(
                "mountain_plot",
                mountain_plot,
                default=FALSE)
            private$..missing_treatment <- jmvcore::OptionList$new(
                "missing_treatment",
                missing_treatment,
                options=list(
                    "complete",
                    "pairwise"),
                default="complete")
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=1000,
                min=100,
                max=10000)

            self$.addOption(private$..method1)
            self$.addOption(private$..method2)
            self$.addOption(private$..grouping)
            self$.addOption(private$..comparison_method)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..bland_altman_options)
            self$.addOption(private$..limits_method)
            self$.addOption(private$..proportional_bias)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..passing_bablok_options)
            self$.addOption(private$..pb_alpha)
            self$.addOption(private$..deming_options)
            self$.addOption(private$..error_ratio)
            self$.addOption(private$..correlation_analysis)
            self$.addOption(private$..concordance_correlation)
            self$.addOption(private$..regression_comparison)
            self$.addOption(private$..clinical_limits)
            self$.addOption(private$..clinical_lower)
            self$.addOption(private$..clinical_upper)
            self$.addOption(private$..transformation)
            self$.addOption(private$..plots_options)
            self$.addOption(private$..bland_altman_plot)
            self$.addOption(private$..scatter_plot)
            self$.addOption(private$..residual_plots)
            self$.addOption(private$..mountain_plot)
            self$.addOption(private$..missing_treatment)
            self$.addOption(private$..bootstrap_samples)
        }),
    active = list(
        method1 = function() private$..method1$value,
        method2 = function() private$..method2$value,
        grouping = function() private$..grouping$value,
        comparison_method = function() private$..comparison_method$value,
        confidence_level = function() private$..confidence_level$value,
        bland_altman_options = function() private$..bland_altman_options$value,
        limits_method = function() private$..limits_method$value,
        proportional_bias = function() private$..proportional_bias$value,
        outlier_detection = function() private$..outlier_detection$value,
        passing_bablok_options = function() private$..passing_bablok_options$value,
        pb_alpha = function() private$..pb_alpha$value,
        deming_options = function() private$..deming_options$value,
        error_ratio = function() private$..error_ratio$value,
        correlation_analysis = function() private$..correlation_analysis$value,
        concordance_correlation = function() private$..concordance_correlation$value,
        regression_comparison = function() private$..regression_comparison$value,
        clinical_limits = function() private$..clinical_limits$value,
        clinical_lower = function() private$..clinical_lower$value,
        clinical_upper = function() private$..clinical_upper$value,
        transformation = function() private$..transformation$value,
        plots_options = function() private$..plots_options$value,
        bland_altman_plot = function() private$..bland_altman_plot$value,
        scatter_plot = function() private$..scatter_plot$value,
        residual_plots = function() private$..residual_plots$value,
        mountain_plot = function() private$..mountain_plot$value,
        missing_treatment = function() private$..missing_treatment$value,
        bootstrap_samples = function() private$..bootstrap_samples$value),
    private = list(
        ..method1 = NA,
        ..method2 = NA,
        ..grouping = NA,
        ..comparison_method = NA,
        ..confidence_level = NA,
        ..bland_altman_options = NA,
        ..limits_method = NA,
        ..proportional_bias = NA,
        ..outlier_detection = NA,
        ..passing_bablok_options = NA,
        ..pb_alpha = NA,
        ..deming_options = NA,
        ..error_ratio = NA,
        ..correlation_analysis = NA,
        ..concordance_correlation = NA,
        ..regression_comparison = NA,
        ..clinical_limits = NA,
        ..clinical_lower = NA,
        ..clinical_upper = NA,
        ..transformation = NA,
        ..plots_options = NA,
        ..bland_altman_plot = NA,
        ..scatter_plot = NA,
        ..residual_plots = NA,
        ..mountain_plot = NA,
        ..missing_treatment = NA,
        ..bootstrap_samples = NA)
)

methodcomparisonResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodcomparisonResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        summary = function() private$.items[["summary"]],
        descriptiveStats = function() private$.items[["descriptiveStats"]],
        correlationTable = function() private$.items[["correlationTable"]],
        concordanceTable = function() private$.items[["concordanceTable"]],
        blandAltmanStats = function() private$.items[["blandAltmanStats"]],
        passingBablokResults = function() private$.items[["passingBablokResults"]],
        demingResults = function() private$.items[["demingResults"]],
        regressionComparison = function() private$.items[["regressionComparison"]],
        biasAnalysis = function() private$.items[["biasAnalysis"]],
        outlierAnalysis = function() private$.items[["outlierAnalysis"]],
        clinicalAssessment = function() private$.items[["clinicalAssessment"]],
        blandAltmanPlot = function() private$.items[["blandAltmanPlot"]],
        scatterPlot = function() private$.items[["scatterPlot"]],
        residualPlots = function() private$.items[["residualPlots"]],
        mountainPlot = function() private$.items[["mountainPlot"]],
        methodGuidance = function() private$.items[["methodGuidance"]],
        technicalNotes = function() private$.items[["technicalNotes"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Method Comparison Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                clearWith=list(
                    "method1",
                    "method2")))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Analysis Summary",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="descriptiveStats",
                title="Descriptive Statistics",
                visible=TRUE,
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number"),
                    list(
                        `name`="sd", 
                        `title`="SD", 
                        `type`="number"),
                    list(
                        `name`="median", 
                        `title`="Median", 
                        `type`="number"),
                    list(
                        `name`="min", 
                        `title`="Minimum", 
                        `type`="number"),
                    list(
                        `name`="max", 
                        `title`="Maximum", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="correlationTable",
                title="Correlation Analysis",
                visible="(correlation_analysis)",
                columns=list(
                    list(
                        `name`="correlation_type", 
                        `title`="Correlation", 
                        `type`="text"),
                    list(
                        `name`="r", 
                        `title`="r", 
                        `type`="number"),
                    list(
                        `name`="r_squared", 
                        `title`="R\u00B2", 
                        `type`="number"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="concordanceTable",
                title="Concordance Correlation Coefficient",
                visible="(concordance_correlation)",
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="blandAltmanStats",
                title="Bland-Altman Analysis",
                visible="(comparison_method:bland_altman || comparison_method:all)",
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="passingBablokResults",
                title="Passing-Bablok Regression",
                visible="(comparison_method:passing_bablok || comparison_method:all)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number"),
                    list(
                        `name`="test_result", 
                        `title`="Test Result", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="demingResults",
                title="Deming Regression",
                visible="(comparison_method:deming || comparison_method:all)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="Standard Error", 
                        `type`="number"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="regressionComparison",
                title="Regression Method Comparison",
                visible="(regression_comparison)",
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="intercept", 
                        `title`="Intercept", 
                        `type`="number"),
                    list(
                        `name`="slope", 
                        `title`="Slope", 
                        `type`="number"),
                    list(
                        `name`="r_squared", 
                        `title`="R\u00B2", 
                        `type`="number"),
                    list(
                        `name`="rmse", 
                        `title`="RMSE", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="biasAnalysis",
                title="Bias Analysis",
                visible="(proportional_bias)",
                columns=list(
                    list(
                        `name`="bias_type", 
                        `title`="Bias Type", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="outlierAnalysis",
                title="Outlier Analysis",
                visible="(outlier_detection)",
                columns=list(
                    list(
                        `name`="observation", 
                        `title`="Observation", 
                        `type`="integer"),
                    list(
                        `name`="method1_value", 
                        `title`="Method 1", 
                        `type`="number"),
                    list(
                        `name`="method2_value", 
                        `title`="Method 2", 
                        `type`="number"),
                    list(
                        `name`="difference", 
                        `title`="Difference", 
                        `type`="number"),
                    list(
                        `name`="standardized_residual", 
                        `title`="Std. Residual", 
                        `type`="number"),
                    list(
                        `name`="outlier_flag", 
                        `title`="Outlier", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="clinicalAssessment",
                title="Clinical Acceptability Assessment",
                visible="(clinical_limits)",
                columns=list(
                    list(
                        `name`="criterion", 
                        `title`="Criterion", 
                        `type`="text"),
                    list(
                        `name`="result", 
                        `title`="Result", 
                        `type`="text"),
                    list(
                        `name`="percentage_within", 
                        `title`="Percent Within Limits", 
                        `type`="number"),
                    list(
                        `name`="clinical_interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="blandAltmanPlot",
                title="Bland-Altman Plot",
                width=800,
                height=600,
                renderFun=".plotBlandAltman",
                visible="(bland_altman_plot)",
                clearWith=list(
                    "method1",
                    "method2",
                    "limits_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="scatterPlot",
                title="Method Comparison Scatter Plot",
                width=800,
                height=600,
                renderFun=".plotScatter",
                visible="(scatter_plot)",
                clearWith=list(
                    "method1",
                    "method2",
                    "comparison_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualPlots",
                title="Residual Analysis",
                width=800,
                height=600,
                renderFun=".plotResiduals",
                visible="(residual_plots)",
                clearWith=list(
                    "method1",
                    "method2",
                    "comparison_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="mountainPlot",
                title="Mountain Plot",
                width=800,
                height=500,
                renderFun=".plotMountain",
                visible="(mountain_plot)",
                clearWith=list(
                    "method1",
                    "method2")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodGuidance",
                title="Method Comparison Guidelines",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="technicalNotes",
                title="Technical Notes and Assumptions",
                visible=TRUE))}))

methodcomparisonBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "methodcomparisonBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "methodcomparison",
                version = c(0,0,31),
                options = options,
                results = methodcomparisonResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Method Comparison Analysis
#'
#' Comprehensive method comparison analysis including Bland-Altman plots,
#' Passing-Bablok regression, and Deming regression. Essential for validating
#' new laboratory methods, diagnostic tests, and measurement techniques.
#' 
#' @param data The data as a data frame.
#' @param method1 .
#' @param method2 .
#' @param grouping .
#' @param comparison_method Primary method comparison approach
#' @param confidence_level Confidence level for limits of agreement and
#'   regression
#' @param bland_altman_options Enable Bland-Altman specific analysis options
#' @param limits_method Method for calculating limits of agreement
#' @param proportional_bias Test if bias changes with measurement magnitude
#' @param outlier_detection Identify potential outliers in method comparison
#' @param passing_bablok_options Enable Passing-Bablok specific analysis
#'   options
#' @param pb_alpha Significance level for Passing-Bablok regression
#' @param deming_options Enable Deming regression specific options
#' @param error_ratio Ratio of error variances (σ²y/σ²x) for Deming regression
#' @param correlation_analysis Include Pearson and Spearman correlation
#'   analysis
#' @param concordance_correlation Calculate Lin concordance correlation
#'   coefficient for agreement assessment
#' @param regression_comparison Compare ordinary least squares vs method
#'   comparison regressions
#' @param clinical_limits Specify clinical acceptability criteria
#' @param clinical_lower Lower bound for clinically acceptable difference
#' @param clinical_upper Upper bound for clinically acceptable difference
#' @param transformation Apply transformation to improve normality
#' @param plots_options Control plot generation and formatting
#' @param bland_altman_plot Generate Bland-Altman plot with limits of
#'   agreement
#' @param scatter_plot Scatter plot with regression lines
#' @param residual_plots Generate residual plots for regression diagnostics
#' @param mountain_plot Generate mountain plot (percentile-based differences)
#' @param missing_treatment How to handle missing data
#' @param bootstrap_samples Number of bootstrap samples for confidence
#'   intervals
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$descriptiveStats} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$correlationTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$concordanceTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$blandAltmanStats} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$passingBablokResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$demingResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$regressionComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$biasAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$outlierAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalAssessment} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$blandAltmanPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$scatterPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$mountainPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodGuidance} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$technicalNotes} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$descriptiveStats$asDF}
#'
#' \code{as.data.frame(results$descriptiveStats)}
#'
#' @export
methodcomparison <- function(
    data,
    method1,
    method2,
    grouping,
    comparison_method = "bland_altman",
    confidence_level = 0.95,
    bland_altman_options = TRUE,
    limits_method = "standard",
    proportional_bias = TRUE,
    outlier_detection = TRUE,
    passing_bablok_options = FALSE,
    pb_alpha = 0.05,
    deming_options = FALSE,
    error_ratio = 1,
    correlation_analysis = TRUE,
    concordance_correlation = TRUE,
    regression_comparison = TRUE,
    clinical_limits = FALSE,
    clinical_lower = -10,
    clinical_upper = 10,
    transformation = "none",
    plots_options = TRUE,
    bland_altman_plot = TRUE,
    scatter_plot = TRUE,
    residual_plots = FALSE,
    mountain_plot = FALSE,
    missing_treatment = "complete",
    bootstrap_samples = 1000) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("methodcomparison requires jmvcore to be installed (restart may be required)")

    if ( ! missing(method1)) method1 <- jmvcore::resolveQuo(jmvcore::enquo(method1))
    if ( ! missing(method2)) method2 <- jmvcore::resolveQuo(jmvcore::enquo(method2))
    if ( ! missing(grouping)) grouping <- jmvcore::resolveQuo(jmvcore::enquo(grouping))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(method1), method1, NULL),
            `if`( ! missing(method2), method2, NULL),
            `if`( ! missing(grouping), grouping, NULL))

    for (v in grouping) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- methodcomparisonOptions$new(
        method1 = method1,
        method2 = method2,
        grouping = grouping,
        comparison_method = comparison_method,
        confidence_level = confidence_level,
        bland_altman_options = bland_altman_options,
        limits_method = limits_method,
        proportional_bias = proportional_bias,
        outlier_detection = outlier_detection,
        passing_bablok_options = passing_bablok_options,
        pb_alpha = pb_alpha,
        deming_options = deming_options,
        error_ratio = error_ratio,
        correlation_analysis = correlation_analysis,
        concordance_correlation = concordance_correlation,
        regression_comparison = regression_comparison,
        clinical_limits = clinical_limits,
        clinical_lower = clinical_lower,
        clinical_upper = clinical_upper,
        transformation = transformation,
        plots_options = plots_options,
        bland_altman_plot = bland_altman_plot,
        scatter_plot = scatter_plot,
        residual_plots = residual_plots,
        mountain_plot = mountain_plot,
        missing_treatment = missing_treatment,
        bootstrap_samples = bootstrap_samples)

    analysis <- methodcomparisonClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

