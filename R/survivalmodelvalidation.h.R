
# This file is automatically generated, you probably don't want to edit this

survivalmodelvalidationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalmodelvalidationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_var = NULL,
            status_var = NULL,
            risk_score = NULL,
            covariates = NULL,
            stratification_var = NULL,
            validation_type = "internal_bootstrap",
            model_type = "cox_ph",
            performance_metrics = "all_metrics",
            calibration_assessment = TRUE,
            calibration_method = "decile_based",
            bootstrap_samples = 1000,
            cv_folds = 10,
            prediction_times = "1,3,5,10",
            confidence_level = 0.95,
            optimism_correction = TRUE,
            shrinkage_estimation = TRUE,
            discrimination_plots = TRUE,
            calibration_plots = TRUE,
            roc_curves = TRUE,
            prediction_error_plots = TRUE,
            risk_distribution_plots = TRUE,
            model_comparison = FALSE,
            decision_curve_analysis = TRUE,
            net_benefit_range = "0.01,0.99",
            external_data_source = "",
            transportability_analysis = FALSE,
            subgroup_validation = TRUE,
            temporal_trends = FALSE,
            missing_data_sensitivity = FALSE,
            clinical_impact_metrics = TRUE,
            reporting_guidelines = "tripod",
            export_validation_report = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="survivalmodelvalidation",
                requiresData=TRUE,
                ...)

            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..status_var <- jmvcore::OptionVariable$new(
                "status_var",
                status_var,
                suggested=list(
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..risk_score <- jmvcore::OptionVariable$new(
                "risk_score",
                risk_score,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..stratification_var <- jmvcore::OptionVariable$new(
                "stratification_var",
                stratification_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..validation_type <- jmvcore::OptionList$new(
                "validation_type",
                validation_type,
                options=list(
                    "internal_bootstrap",
                    "cross_validation",
                    "temporal_validation",
                    "external_validation",
                    "geographic_validation"),
                default="internal_bootstrap")
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "cox_ph",
                    "aft_model",
                    "parametric_surv",
                    "machine_learning",
                    "ensemble_model"),
                default="cox_ph")
            private$..performance_metrics <- jmvcore::OptionList$new(
                "performance_metrics",
                performance_metrics,
                options=list(
                    "concordance_index",
                    "time_dependent_auc",
                    "prediction_error",
                    "integrated_brier",
                    "net_reclassification",
                    "all_metrics"),
                default="all_metrics")
            private$..calibration_assessment <- jmvcore::OptionBool$new(
                "calibration_assessment",
                calibration_assessment,
                default=TRUE)
            private$..calibration_method <- jmvcore::OptionList$new(
                "calibration_method",
                calibration_method,
                options=list(
                    "decile_based",
                    "smooth_calibration",
                    "hosmer_lemeshow",
                    "greenwood_nam"),
                default="decile_based")
            private$..bootstrap_samples <- jmvcore::OptionNumber$new(
                "bootstrap_samples",
                bootstrap_samples,
                min=100,
                max=10000,
                default=1000)
            private$..cv_folds <- jmvcore::OptionNumber$new(
                "cv_folds",
                cv_folds,
                min=3,
                max=20,
                default=10)
            private$..prediction_times <- jmvcore::OptionString$new(
                "prediction_times",
                prediction_times,
                default="1,3,5,10")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..optimism_correction <- jmvcore::OptionBool$new(
                "optimism_correction",
                optimism_correction,
                default=TRUE)
            private$..shrinkage_estimation <- jmvcore::OptionBool$new(
                "shrinkage_estimation",
                shrinkage_estimation,
                default=TRUE)
            private$..discrimination_plots <- jmvcore::OptionBool$new(
                "discrimination_plots",
                discrimination_plots,
                default=TRUE)
            private$..calibration_plots <- jmvcore::OptionBool$new(
                "calibration_plots",
                calibration_plots,
                default=TRUE)
            private$..roc_curves <- jmvcore::OptionBool$new(
                "roc_curves",
                roc_curves,
                default=TRUE)
            private$..prediction_error_plots <- jmvcore::OptionBool$new(
                "prediction_error_plots",
                prediction_error_plots,
                default=TRUE)
            private$..risk_distribution_plots <- jmvcore::OptionBool$new(
                "risk_distribution_plots",
                risk_distribution_plots,
                default=TRUE)
            private$..model_comparison <- jmvcore::OptionBool$new(
                "model_comparison",
                model_comparison,
                default=FALSE)
            private$..decision_curve_analysis <- jmvcore::OptionBool$new(
                "decision_curve_analysis",
                decision_curve_analysis,
                default=TRUE)
            private$..net_benefit_range <- jmvcore::OptionString$new(
                "net_benefit_range",
                net_benefit_range,
                default="0.01,0.99")
            private$..external_data_source <- jmvcore::OptionString$new(
                "external_data_source",
                external_data_source,
                default="")
            private$..transportability_analysis <- jmvcore::OptionBool$new(
                "transportability_analysis",
                transportability_analysis,
                default=FALSE)
            private$..subgroup_validation <- jmvcore::OptionBool$new(
                "subgroup_validation",
                subgroup_validation,
                default=TRUE)
            private$..temporal_trends <- jmvcore::OptionBool$new(
                "temporal_trends",
                temporal_trends,
                default=FALSE)
            private$..missing_data_sensitivity <- jmvcore::OptionBool$new(
                "missing_data_sensitivity",
                missing_data_sensitivity,
                default=FALSE)
            private$..clinical_impact_metrics <- jmvcore::OptionBool$new(
                "clinical_impact_metrics",
                clinical_impact_metrics,
                default=TRUE)
            private$..reporting_guidelines <- jmvcore::OptionList$new(
                "reporting_guidelines",
                reporting_guidelines,
                options=list(
                    "tripod",
                    "remark",
                    "stard",
                    "custom"),
                default="tripod")
            private$..export_validation_report <- jmvcore::OptionBool$new(
                "export_validation_report",
                export_validation_report,
                default=FALSE)

            self$.addOption(private$..time_var)
            self$.addOption(private$..status_var)
            self$.addOption(private$..risk_score)
            self$.addOption(private$..covariates)
            self$.addOption(private$..stratification_var)
            self$.addOption(private$..validation_type)
            self$.addOption(private$..model_type)
            self$.addOption(private$..performance_metrics)
            self$.addOption(private$..calibration_assessment)
            self$.addOption(private$..calibration_method)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..cv_folds)
            self$.addOption(private$..prediction_times)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..optimism_correction)
            self$.addOption(private$..shrinkage_estimation)
            self$.addOption(private$..discrimination_plots)
            self$.addOption(private$..calibration_plots)
            self$.addOption(private$..roc_curves)
            self$.addOption(private$..prediction_error_plots)
            self$.addOption(private$..risk_distribution_plots)
            self$.addOption(private$..model_comparison)
            self$.addOption(private$..decision_curve_analysis)
            self$.addOption(private$..net_benefit_range)
            self$.addOption(private$..external_data_source)
            self$.addOption(private$..transportability_analysis)
            self$.addOption(private$..subgroup_validation)
            self$.addOption(private$..temporal_trends)
            self$.addOption(private$..missing_data_sensitivity)
            self$.addOption(private$..clinical_impact_metrics)
            self$.addOption(private$..reporting_guidelines)
            self$.addOption(private$..export_validation_report)
        }),
    active = list(
        time_var = function() private$..time_var$value,
        status_var = function() private$..status_var$value,
        risk_score = function() private$..risk_score$value,
        covariates = function() private$..covariates$value,
        stratification_var = function() private$..stratification_var$value,
        validation_type = function() private$..validation_type$value,
        model_type = function() private$..model_type$value,
        performance_metrics = function() private$..performance_metrics$value,
        calibration_assessment = function() private$..calibration_assessment$value,
        calibration_method = function() private$..calibration_method$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        cv_folds = function() private$..cv_folds$value,
        prediction_times = function() private$..prediction_times$value,
        confidence_level = function() private$..confidence_level$value,
        optimism_correction = function() private$..optimism_correction$value,
        shrinkage_estimation = function() private$..shrinkage_estimation$value,
        discrimination_plots = function() private$..discrimination_plots$value,
        calibration_plots = function() private$..calibration_plots$value,
        roc_curves = function() private$..roc_curves$value,
        prediction_error_plots = function() private$..prediction_error_plots$value,
        risk_distribution_plots = function() private$..risk_distribution_plots$value,
        model_comparison = function() private$..model_comparison$value,
        decision_curve_analysis = function() private$..decision_curve_analysis$value,
        net_benefit_range = function() private$..net_benefit_range$value,
        external_data_source = function() private$..external_data_source$value,
        transportability_analysis = function() private$..transportability_analysis$value,
        subgroup_validation = function() private$..subgroup_validation$value,
        temporal_trends = function() private$..temporal_trends$value,
        missing_data_sensitivity = function() private$..missing_data_sensitivity$value,
        clinical_impact_metrics = function() private$..clinical_impact_metrics$value,
        reporting_guidelines = function() private$..reporting_guidelines$value,
        export_validation_report = function() private$..export_validation_report$value),
    private = list(
        ..time_var = NA,
        ..status_var = NA,
        ..risk_score = NA,
        ..covariates = NA,
        ..stratification_var = NA,
        ..validation_type = NA,
        ..model_type = NA,
        ..performance_metrics = NA,
        ..calibration_assessment = NA,
        ..calibration_method = NA,
        ..bootstrap_samples = NA,
        ..cv_folds = NA,
        ..prediction_times = NA,
        ..confidence_level = NA,
        ..optimism_correction = NA,
        ..shrinkage_estimation = NA,
        ..discrimination_plots = NA,
        ..calibration_plots = NA,
        ..roc_curves = NA,
        ..prediction_error_plots = NA,
        ..risk_distribution_plots = NA,
        ..model_comparison = NA,
        ..decision_curve_analysis = NA,
        ..net_benefit_range = NA,
        ..external_data_source = NA,
        ..transportability_analysis = NA,
        ..subgroup_validation = NA,
        ..temporal_trends = NA,
        ..missing_data_sensitivity = NA,
        ..clinical_impact_metrics = NA,
        ..reporting_guidelines = NA,
        ..export_validation_report = NA)
)

survivalmodelvalidationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalmodelvalidationResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        modelSummary = function() private$.items[["modelSummary"]],
        performanceMetrics = function() private$.items[["performanceMetrics"]],
        calibrationMetrics = function() private$.items[["calibrationMetrics"]],
        validationResults = function() private$.items[["validationResults"]],
        discriminationAnalysis = function() private$.items[["discriminationAnalysis"]],
        calibrationAnalysis = function() private$.items[["calibrationAnalysis"]],
        subgroupAnalysis = function() private$.items[["subgroupAnalysis"]],
        decisionCurveResults = function() private$.items[["decisionCurveResults"]],
        clinicalImpact = function() private$.items[["clinicalImpact"]],
        discriminationPlot = function() private$.items[["discriminationPlot"]],
        calibrationPlot = function() private$.items[["calibrationPlot"]],
        rocCurvePlot = function() private$.items[["rocCurvePlot"]],
        predictionErrorPlot = function() private$.items[["predictionErrorPlot"]],
        riskDistributionPlot = function() private$.items[["riskDistributionPlot"]],
        decisionCurvePlot = function() private$.items[["decisionCurvePlot"]],
        validationReport = function() private$.items[["validationReport"]],
        methodologicalNotes = function() private$.items[["methodologicalNotes"]],
        recommendations = function() private$.items[["recommendations"]],
        diagnostics = function() private$.items[["diagnostics"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Survival Model Validation",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="modelSummary",
                title="Model Summary",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="performanceMetrics",
                title="Performance Metrics",
                visible=TRUE,
                refs=list(
                    "riskRegression",
                    "survival",
                    "timeROC"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "validation_type",
                    "performance_metrics"),
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="calibrationMetrics",
                title="Calibration Assessment",
                visible="(calibration_assessment)",
                refs=list(
                    "rms",
                    "pec"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "calibration_method"),
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Calibration Method", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="conclusion", 
                        `title`="Conclusion", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="validationResults",
                title="Validation Results",
                visible=TRUE,
                refs=list(
                    "rms",
                    "boot"),
                clearWith=list(
                    "validation_type",
                    "bootstrap_samples",
                    "cv_folds"),
                columns=list(
                    list(
                        `name`="validation_method", 
                        `title`="Validation Method", 
                        `type`="text"),
                    list(
                        `name`="apparent_performance", 
                        `title`="Apparent Performance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="validated_performance", 
                        `title`="Validated Performance", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="optimism", 
                        `title`="Optimism", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="corrected_performance", 
                        `title`="Bias-Corrected Performance", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="discriminationAnalysis",
                title="Discrimination Analysis",
                visible=TRUE,
                refs=list(
                    "survival",
                    "timeROC"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "prediction_times")))
            self$add(jmvcore::Html$new(
                options=options,
                name="calibrationAnalysis",
                title="Calibration Analysis",
                visible="(calibration_assessment)",
                refs=list(
                    "rms",
                    "survival"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "calibration_method")))
            self$add(jmvcore::Table$new(
                options=options,
                name="subgroupAnalysis",
                title="Subgroup Validation",
                visible="(subgroup_validation)",
                refs=list(
                    "survival"),
                clearWith=list(
                    "stratification_var",
                    "time_var",
                    "status_var"),
                columns=list(
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="n_patients", 
                        `title`="N Patients", 
                        `type`="integer"),
                    list(
                        `name`="n_events", 
                        `title`="N Events", 
                        `type`="integer"),
                    list(
                        `name`="c_index", 
                        `title`="C-index", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="c_index_ci", 
                        `title`="95% CI", 
                        `type`="text"),
                    list(
                        `name`="calibration_slope", 
                        `title`="Calibration Slope", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="decisionCurveResults",
                title="Decision Curve Analysis",
                visible="(decision_curve_analysis)",
                refs=list(
                    "dcurves",
                    "rmda"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "net_benefit_range"),
                columns=list(
                    list(
                        `name`="threshold", 
                        `title`="Risk Threshold", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="net_benefit", 
                        `title`="Net Benefit", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="net_benefit_all", 
                        `title`="Net Benefit (Treat All)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="net_benefit_none", 
                        `title`="Net Benefit (Treat None)", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalImpact",
                title="Clinical Impact Assessment",
                visible="(clinical_impact_metrics)",
                refs=list(
                    "rmda",
                    "dcurves"),
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score")))
            self$add(jmvcore::Image$new(
                options=options,
                name="discriminationPlot",
                title="Discrimination Assessment Plot",
                visible="(discrimination_plots)",
                refs=list(
                    "ggplot2",
                    "survminer"),
                width=600,
                height=400,
                renderFun=".plotDiscrimination",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "prediction_times")))
            self$add(jmvcore::Image$new(
                options=options,
                name="calibrationPlot",
                title="Calibration Plot",
                visible="(calibration_plots)",
                refs=list(
                    "ggplot2",
                    "rms"),
                width=600,
                height=400,
                renderFun=".plotCalibration",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "calibration_method")))
            self$add(jmvcore::Image$new(
                options=options,
                name="rocCurvePlot",
                title="Time-Dependent ROC Curves",
                visible="(roc_curves)",
                refs=list(
                    "timeROC",
                    "ggplot2"),
                width=600,
                height=400,
                renderFun=".plotROCCurves",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "prediction_times")))
            self$add(jmvcore::Image$new(
                options=options,
                name="predictionErrorPlot",
                title="Prediction Error Curves",
                visible="(prediction_error_plots)",
                refs=list(
                    "pec",
                    "ggplot2"),
                width=600,
                height=400,
                renderFun=".plotPredictionError",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "prediction_times")))
            self$add(jmvcore::Image$new(
                options=options,
                name="riskDistributionPlot",
                title="Risk Score Distribution",
                visible="(risk_distribution_plots)",
                refs=list(
                    "ggplot2",
                    "survival"),
                width=600,
                height=400,
                renderFun=".plotRiskDistribution",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score")))
            self$add(jmvcore::Image$new(
                options=options,
                name="decisionCurvePlot",
                title="Decision Curve Analysis Plot",
                visible="(decision_curve_analysis)",
                refs=list(
                    "dcurves",
                    "ggplot2"),
                width=600,
                height=400,
                renderFun=".plotDecisionCurve",
                clearWith=list(
                    "time_var",
                    "status_var",
                    "risk_score",
                    "net_benefit_range")))
            self$add(jmvcore::Html$new(
                options=options,
                name="validationReport",
                title="Comprehensive Validation Report",
                visible=TRUE,
                refs=list(
                    "knitr",
                    "rmarkdown"),
                clearWith=list(
                    "validation_type",
                    "performance_metrics",
                    "reporting_guidelines")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodologicalNotes",
                title="Methodological Notes",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="recommendations",
                title="Recommendations",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="diagnostics",
                title="Validation Diagnostics",
                visible=TRUE))}))

survivalmodelvalidationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "survivalmodelvalidationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "survivalmodelvalidation",
                version = c(1,0,0),
                options = options,
                results = survivalmodelvalidationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Survival Model Validation
#'
#' Comprehensive validation toolkit for survival models including calibration 
#' assessment, 
#' prediction performance metrics, bootstrap validation, and external 
#' validation frameworks.
#' Essential for developing reliable prognostic models.
#' 
#'
#' @examples
#' \donttest{
#' # Example: Cox model validation
#' survivalmodelvalidation(
#'     data = clinical_data,
#'     time = followup_months,
#'     status = death_event,
#'     risk_score = predicted_risk,
#'     validation_type = "internal_bootstrap"
#' )
#'}
#' @param data The data as a data frame.
#' @param time_var Time to event or censoring
#' @param status_var Event indicator variable
#' @param risk_score Model predictions to validate
#' @param covariates Covariates for model fitting/validation
#' @param stratification_var Stratification factor
#' @param validation_type Validation methodology
#' @param model_type Model class specification
#' @param performance_metrics Metrics for model assessment
#' @param calibration_assessment Enable calibration evaluation
#' @param calibration_method Calibration evaluation approach
#' @param bootstrap_samples Bootstrap iteration count
#' @param cv_folds CV fold specification
#' @param prediction_times Times for time-dependent metrics
#' @param confidence_level CI level
#' @param optimism_correction Correct for overfitting bias
#' @param shrinkage_estimation Calculate shrinkage coefficient
#' @param discrimination_plots Generate discrimination visualizations
#' @param calibration_plots Generate calibration visualizations
#' @param roc_curves Generate ROC visualizations
#' @param prediction_error_plots Generate error curve plots
#' @param risk_distribution_plots Generate risk distribution plots
#' @param model_comparison Enable model comparison analysis
#' @param decision_curve_analysis Evaluate clinical decision-making utility
#' @param net_benefit_range Threshold range for net benefit
#' @param external_data_source External validation data source
#' @param transportability_analysis Evaluate population transportability
#' @param subgroup_validation Enable subgroup-specific validation
#' @param temporal_trends Assess time-based performance changes
#' @param missing_data_sensitivity Evaluate missing data impact
#' @param clinical_impact_metrics Assess clinical decision impact
#' @param reporting_guidelines Structured reporting format
#' @param export_validation_report Generate exportable report
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab Analysis instructions and overview \cr
#'   \code{results$modelSummary} \tab \tab \tab \tab \tab Summary of the survival model being validated \cr
#'   \code{results$performanceMetrics} \tab \tab \tab \tab \tab Comprehensive model performance metrics \cr
#'   \code{results$calibrationMetrics} \tab \tab \tab \tab \tab Model calibration metrics and tests \cr
#'   \code{results$validationResults} \tab \tab \tab \tab \tab Detailed validation results by method \cr
#'   \code{results$discriminationAnalysis} \tab \tab \tab \tab \tab Model discrimination assessment \cr
#'   \code{results$calibrationAnalysis} \tab \tab \tab \tab \tab Detailed calibration assessment \cr
#'   \code{results$subgroupAnalysis} \tab \tab \tab \tab \tab Performance across subgroups \cr
#'   \code{results$decisionCurveResults} \tab \tab \tab \tab \tab Clinical decision-making utility assessment \cr
#'   \code{results$clinicalImpact} \tab \tab \tab \tab \tab Clinical relevance and impact metrics \cr
#'   \code{results$discriminationPlot} \tab \tab \tab \tab \tab Discrimination visualization \cr
#'   \code{results$calibrationPlot} \tab \tab \tab \tab \tab Calibration assessment visualization \cr
#'   \code{results$rocCurvePlot} \tab \tab \tab \tab \tab Time-dependent ROC curve visualization \cr
#'   \code{results$predictionErrorPlot} \tab \tab \tab \tab \tab Prediction error assessment \cr
#'   \code{results$riskDistributionPlot} \tab \tab \tab \tab \tab Risk score distribution by outcome \cr
#'   \code{results$decisionCurvePlot} \tab \tab \tab \tab \tab Decision curve visualization \cr
#'   \code{results$validationReport} \tab \tab \tab \tab \tab Structured validation report \cr
#'   \code{results$methodologicalNotes} \tab \tab \tab \tab \tab Detailed methodology and interpretation guidance \cr
#'   \code{results$recommendations} \tab \tab \tab \tab \tab Clinical and methodological recommendations \cr
#'   \code{results$diagnostics} \tab \tab \tab \tab \tab Diagnostic information and warnings \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$performanceMetrics$asDF}
#'
#' \code{as.data.frame(results$performanceMetrics)}
#'
#' @export
survivalmodelvalidation <- function(
    data,
    time_var,
    status_var,
    risk_score,
    covariates,
    stratification_var,
    validation_type = "internal_bootstrap",
    model_type = "cox_ph",
    performance_metrics = "all_metrics",
    calibration_assessment = TRUE,
    calibration_method = "decile_based",
    bootstrap_samples = 1000,
    cv_folds = 10,
    prediction_times = "1,3,5,10",
    confidence_level = 0.95,
    optimism_correction = TRUE,
    shrinkage_estimation = TRUE,
    discrimination_plots = TRUE,
    calibration_plots = TRUE,
    roc_curves = TRUE,
    prediction_error_plots = TRUE,
    risk_distribution_plots = TRUE,
    model_comparison = FALSE,
    decision_curve_analysis = TRUE,
    net_benefit_range = "0.01,0.99",
    external_data_source = "",
    transportability_analysis = FALSE,
    subgroup_validation = TRUE,
    temporal_trends = FALSE,
    missing_data_sensitivity = FALSE,
    clinical_impact_metrics = TRUE,
    reporting_guidelines = "tripod",
    export_validation_report = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("survivalmodelvalidation requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(status_var)) status_var <- jmvcore::resolveQuo(jmvcore::enquo(status_var))
    if ( ! missing(risk_score)) risk_score <- jmvcore::resolveQuo(jmvcore::enquo(risk_score))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))
    if ( ! missing(stratification_var)) stratification_var <- jmvcore::resolveQuo(jmvcore::enquo(stratification_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(status_var), status_var, NULL),
            `if`( ! missing(risk_score), risk_score, NULL),
            `if`( ! missing(covariates), covariates, NULL),
            `if`( ! missing(stratification_var), stratification_var, NULL))

    for (v in stratification_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- survivalmodelvalidationOptions$new(
        time_var = time_var,
        status_var = status_var,
        risk_score = risk_score,
        covariates = covariates,
        stratification_var = stratification_var,
        validation_type = validation_type,
        model_type = model_type,
        performance_metrics = performance_metrics,
        calibration_assessment = calibration_assessment,
        calibration_method = calibration_method,
        bootstrap_samples = bootstrap_samples,
        cv_folds = cv_folds,
        prediction_times = prediction_times,
        confidence_level = confidence_level,
        optimism_correction = optimism_correction,
        shrinkage_estimation = shrinkage_estimation,
        discrimination_plots = discrimination_plots,
        calibration_plots = calibration_plots,
        roc_curves = roc_curves,
        prediction_error_plots = prediction_error_plots,
        risk_distribution_plots = risk_distribution_plots,
        model_comparison = model_comparison,
        decision_curve_analysis = decision_curve_analysis,
        net_benefit_range = net_benefit_range,
        external_data_source = external_data_source,
        transportability_analysis = transportability_analysis,
        subgroup_validation = subgroup_validation,
        temporal_trends = temporal_trends,
        missing_data_sensitivity = missing_data_sensitivity,
        clinical_impact_metrics = clinical_impact_metrics,
        reporting_guidelines = reporting_guidelines,
        export_validation_report = export_validation_report)

    analysis <- survivalmodelvalidationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

