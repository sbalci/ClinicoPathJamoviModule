
# This file is automatically generated, you probably don't want to edit this

likelihoodratioOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "likelihoodratioOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            testVariable = NULL,
            referenceStandard = NULL,
            groupVariable = NULL,
            analysisType = "binary",
            testDirection = "higher",
            cutpointMethod = "youden",
            manualCutpoint = NULL,
            costRatio = 1,
            confidenceLevel = 0.95,
            ciMethod = "log",
            bootstrapSamples = 2000,
            calculatePostTest = TRUE,
            prevalenceRange = "clinical",
            customPrevalenceMin = 5,
            customPrevalenceMax = 50,
            specificPrevalences = "10, 25, 50",
            calculateDOR = TRUE,
            calculateNRI = FALSE,
            compareVariable = NULL,
            predictiveValueCurves = TRUE,
            clinicalThresholds = "0.15, 0.85",
            performStratified = FALSE,
            testHomogeneity = FALSE,
            showSummaryTable = TRUE,
            showCrosstabulation = TRUE,
            showLikelihoodRatios = TRUE,
            showPostTestProbs = TRUE,
            showOptimalCutpoint = TRUE,
            showDiagnosticOdds = TRUE,
            showClinicalInterpretation = TRUE,
            plotROC = TRUE,
            plotPredictiveValues = TRUE,
            plotLikelihoodRatios = TRUE,
            plotPostTestProbabilities = TRUE,
            plotDistributions = FALSE,
            correctContinuity = TRUE,
            exactTests = FALSE,
            smoothROC = FALSE,
            randomSeed = 42, ...) {

            super$initialize(
                package="ClinicoPath",
                name="likelihoodratio",
                requiresData=TRUE,
                ...)

            private$..testVariable <- jmvcore::OptionVariable$new(
                "testVariable",
                testVariable,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..referenceStandard <- jmvcore::OptionVariable$new(
                "referenceStandard",
                referenceStandard,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..groupVariable <- jmvcore::OptionVariable$new(
                "groupVariable",
                groupVariable,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..analysisType <- jmvcore::OptionList$new(
                "analysisType",
                analysisType,
                options=list(
                    "binary",
                    "continuous",
                    "multilevel"),
                default="binary")
            private$..testDirection <- jmvcore::OptionList$new(
                "testDirection",
                testDirection,
                options=list(
                    "higher",
                    "lower",
                    "auto"),
                default="higher")
            private$..cutpointMethod <- jmvcore::OptionList$new(
                "cutpointMethod",
                cutpointMethod,
                options=list(
                    "manual",
                    "youden",
                    "cost",
                    "roc01",
                    "concordance"),
                default="youden")
            private$..manualCutpoint <- jmvcore::OptionNumber$new(
                "manualCutpoint",
                manualCutpoint)
            private$..costRatio <- jmvcore::OptionNumber$new(
                "costRatio",
                costRatio,
                min=0.1,
                max=10,
                default=1)
            private$..confidenceLevel <- jmvcore::OptionNumber$new(
                "confidenceLevel",
                confidenceLevel,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..ciMethod <- jmvcore::OptionList$new(
                "ciMethod",
                ciMethod,
                options=list(
                    "log",
                    "bootstrap",
                    "exact"),
                default="log")
            private$..bootstrapSamples <- jmvcore::OptionInteger$new(
                "bootstrapSamples",
                bootstrapSamples,
                min=1000,
                max=10000,
                default=2000)
            private$..calculatePostTest <- jmvcore::OptionBool$new(
                "calculatePostTest",
                calculatePostTest,
                default=TRUE)
            private$..prevalenceRange <- jmvcore::OptionList$new(
                "prevalenceRange",
                prevalenceRange,
                options=list(
                    "full",
                    "clinical",
                    "low",
                    "high",
                    "custom"),
                default="clinical")
            private$..customPrevalenceMin <- jmvcore::OptionNumber$new(
                "customPrevalenceMin",
                customPrevalenceMin,
                min=0.1,
                max=99,
                default=5)
            private$..customPrevalenceMax <- jmvcore::OptionNumber$new(
                "customPrevalenceMax",
                customPrevalenceMax,
                min=1,
                max=99.9,
                default=50)
            private$..specificPrevalences <- jmvcore::OptionString$new(
                "specificPrevalences",
                specificPrevalences,
                default="10, 25, 50")
            private$..calculateDOR <- jmvcore::OptionBool$new(
                "calculateDOR",
                calculateDOR,
                default=TRUE)
            private$..calculateNRI <- jmvcore::OptionBool$new(
                "calculateNRI",
                calculateNRI,
                default=FALSE)
            private$..compareVariable <- jmvcore::OptionVariable$new(
                "compareVariable",
                compareVariable,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..predictiveValueCurves <- jmvcore::OptionBool$new(
                "predictiveValueCurves",
                predictiveValueCurves,
                default=TRUE)
            private$..clinicalThresholds <- jmvcore::OptionString$new(
                "clinicalThresholds",
                clinicalThresholds,
                default="0.15, 0.85")
            private$..performStratified <- jmvcore::OptionBool$new(
                "performStratified",
                performStratified,
                default=FALSE)
            private$..testHomogeneity <- jmvcore::OptionBool$new(
                "testHomogeneity",
                testHomogeneity,
                default=FALSE)
            private$..showSummaryTable <- jmvcore::OptionBool$new(
                "showSummaryTable",
                showSummaryTable,
                default=TRUE)
            private$..showCrosstabulation <- jmvcore::OptionBool$new(
                "showCrosstabulation",
                showCrosstabulation,
                default=TRUE)
            private$..showLikelihoodRatios <- jmvcore::OptionBool$new(
                "showLikelihoodRatios",
                showLikelihoodRatios,
                default=TRUE)
            private$..showPostTestProbs <- jmvcore::OptionBool$new(
                "showPostTestProbs",
                showPostTestProbs,
                default=TRUE)
            private$..showOptimalCutpoint <- jmvcore::OptionBool$new(
                "showOptimalCutpoint",
                showOptimalCutpoint,
                default=TRUE)
            private$..showDiagnosticOdds <- jmvcore::OptionBool$new(
                "showDiagnosticOdds",
                showDiagnosticOdds,
                default=TRUE)
            private$..showClinicalInterpretation <- jmvcore::OptionBool$new(
                "showClinicalInterpretation",
                showClinicalInterpretation,
                default=TRUE)
            private$..plotROC <- jmvcore::OptionBool$new(
                "plotROC",
                plotROC,
                default=TRUE)
            private$..plotPredictiveValues <- jmvcore::OptionBool$new(
                "plotPredictiveValues",
                plotPredictiveValues,
                default=TRUE)
            private$..plotLikelihoodRatios <- jmvcore::OptionBool$new(
                "plotLikelihoodRatios",
                plotLikelihoodRatios,
                default=TRUE)
            private$..plotPostTestProbabilities <- jmvcore::OptionBool$new(
                "plotPostTestProbabilities",
                plotPostTestProbabilities,
                default=TRUE)
            private$..plotDistributions <- jmvcore::OptionBool$new(
                "plotDistributions",
                plotDistributions,
                default=FALSE)
            private$..correctContinuity <- jmvcore::OptionBool$new(
                "correctContinuity",
                correctContinuity,
                default=TRUE)
            private$..exactTests <- jmvcore::OptionBool$new(
                "exactTests",
                exactTests,
                default=FALSE)
            private$..smoothROC <- jmvcore::OptionBool$new(
                "smoothROC",
                smoothROC,
                default=FALSE)
            private$..randomSeed <- jmvcore::OptionInteger$new(
                "randomSeed",
                randomSeed,
                default=42)

            self$.addOption(private$..testVariable)
            self$.addOption(private$..referenceStandard)
            self$.addOption(private$..groupVariable)
            self$.addOption(private$..analysisType)
            self$.addOption(private$..testDirection)
            self$.addOption(private$..cutpointMethod)
            self$.addOption(private$..manualCutpoint)
            self$.addOption(private$..costRatio)
            self$.addOption(private$..confidenceLevel)
            self$.addOption(private$..ciMethod)
            self$.addOption(private$..bootstrapSamples)
            self$.addOption(private$..calculatePostTest)
            self$.addOption(private$..prevalenceRange)
            self$.addOption(private$..customPrevalenceMin)
            self$.addOption(private$..customPrevalenceMax)
            self$.addOption(private$..specificPrevalences)
            self$.addOption(private$..calculateDOR)
            self$.addOption(private$..calculateNRI)
            self$.addOption(private$..compareVariable)
            self$.addOption(private$..predictiveValueCurves)
            self$.addOption(private$..clinicalThresholds)
            self$.addOption(private$..performStratified)
            self$.addOption(private$..testHomogeneity)
            self$.addOption(private$..showSummaryTable)
            self$.addOption(private$..showCrosstabulation)
            self$.addOption(private$..showLikelihoodRatios)
            self$.addOption(private$..showPostTestProbs)
            self$.addOption(private$..showOptimalCutpoint)
            self$.addOption(private$..showDiagnosticOdds)
            self$.addOption(private$..showClinicalInterpretation)
            self$.addOption(private$..plotROC)
            self$.addOption(private$..plotPredictiveValues)
            self$.addOption(private$..plotLikelihoodRatios)
            self$.addOption(private$..plotPostTestProbabilities)
            self$.addOption(private$..plotDistributions)
            self$.addOption(private$..correctContinuity)
            self$.addOption(private$..exactTests)
            self$.addOption(private$..smoothROC)
            self$.addOption(private$..randomSeed)
        }),
    active = list(
        testVariable = function() private$..testVariable$value,
        referenceStandard = function() private$..referenceStandard$value,
        groupVariable = function() private$..groupVariable$value,
        analysisType = function() private$..analysisType$value,
        testDirection = function() private$..testDirection$value,
        cutpointMethod = function() private$..cutpointMethod$value,
        manualCutpoint = function() private$..manualCutpoint$value,
        costRatio = function() private$..costRatio$value,
        confidenceLevel = function() private$..confidenceLevel$value,
        ciMethod = function() private$..ciMethod$value,
        bootstrapSamples = function() private$..bootstrapSamples$value,
        calculatePostTest = function() private$..calculatePostTest$value,
        prevalenceRange = function() private$..prevalenceRange$value,
        customPrevalenceMin = function() private$..customPrevalenceMin$value,
        customPrevalenceMax = function() private$..customPrevalenceMax$value,
        specificPrevalences = function() private$..specificPrevalences$value,
        calculateDOR = function() private$..calculateDOR$value,
        calculateNRI = function() private$..calculateNRI$value,
        compareVariable = function() private$..compareVariable$value,
        predictiveValueCurves = function() private$..predictiveValueCurves$value,
        clinicalThresholds = function() private$..clinicalThresholds$value,
        performStratified = function() private$..performStratified$value,
        testHomogeneity = function() private$..testHomogeneity$value,
        showSummaryTable = function() private$..showSummaryTable$value,
        showCrosstabulation = function() private$..showCrosstabulation$value,
        showLikelihoodRatios = function() private$..showLikelihoodRatios$value,
        showPostTestProbs = function() private$..showPostTestProbs$value,
        showOptimalCutpoint = function() private$..showOptimalCutpoint$value,
        showDiagnosticOdds = function() private$..showDiagnosticOdds$value,
        showClinicalInterpretation = function() private$..showClinicalInterpretation$value,
        plotROC = function() private$..plotROC$value,
        plotPredictiveValues = function() private$..plotPredictiveValues$value,
        plotLikelihoodRatios = function() private$..plotLikelihoodRatios$value,
        plotPostTestProbabilities = function() private$..plotPostTestProbabilities$value,
        plotDistributions = function() private$..plotDistributions$value,
        correctContinuity = function() private$..correctContinuity$value,
        exactTests = function() private$..exactTests$value,
        smoothROC = function() private$..smoothROC$value,
        randomSeed = function() private$..randomSeed$value),
    private = list(
        ..testVariable = NA,
        ..referenceStandard = NA,
        ..groupVariable = NA,
        ..analysisType = NA,
        ..testDirection = NA,
        ..cutpointMethod = NA,
        ..manualCutpoint = NA,
        ..costRatio = NA,
        ..confidenceLevel = NA,
        ..ciMethod = NA,
        ..bootstrapSamples = NA,
        ..calculatePostTest = NA,
        ..prevalenceRange = NA,
        ..customPrevalenceMin = NA,
        ..customPrevalenceMax = NA,
        ..specificPrevalences = NA,
        ..calculateDOR = NA,
        ..calculateNRI = NA,
        ..compareVariable = NA,
        ..predictiveValueCurves = NA,
        ..clinicalThresholds = NA,
        ..performStratified = NA,
        ..testHomogeneity = NA,
        ..showSummaryTable = NA,
        ..showCrosstabulation = NA,
        ..showLikelihoodRatios = NA,
        ..showPostTestProbs = NA,
        ..showOptimalCutpoint = NA,
        ..showDiagnosticOdds = NA,
        ..showClinicalInterpretation = NA,
        ..plotROC = NA,
        ..plotPredictiveValues = NA,
        ..plotLikelihoodRatios = NA,
        ..plotPostTestProbabilities = NA,
        ..plotDistributions = NA,
        ..correctContinuity = NA,
        ..exactTests = NA,
        ..smoothROC = NA,
        ..randomSeed = NA)
)

likelihoodratioResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "likelihoodratioResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        summaryTable = function() private$.items[["summaryTable"]],
        crosstabulation = function() private$.items[["crosstabulation"]],
        likelihoodRatios = function() private$.items[["likelihoodRatios"]],
        optimalCutpoint = function() private$.items[["optimalCutpoint"]],
        postTestProbabilities = function() private$.items[["postTestProbabilities"]],
        diagnosticOddsRatio = function() private$.items[["diagnosticOddsRatio"]],
        stratifiedAnalysis = function() private$.items[["stratifiedAnalysis"]],
        homogeneityTest = function() private$.items[["homogeneityTest"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        rocCurve = function() private$.items[["rocCurve"]],
        predictiveValueCurves = function() private$.items[["predictiveValueCurves"]],
        likelihoodNomogram = function() private$.items[["likelihoodNomogram"]],
        postTestPlot = function() private$.items[["postTestPlot"]],
        distributionPlot = function() private$.items[["distributionPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Likelihood Ratio Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                clearWith=list(
                    "testVariable",
                    "referenceStandard")))
            self$add(jmvcore::Table$new(
                options=options,
                name="summaryTable",
                title="Diagnostic Performance Summary",
                visible="(showSummaryTable)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "cutpointMethod",
                    "manualCutpoint"),
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto,pc:2"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto,pc:2"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto,pc:2"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="crosstabulation",
                title="2\u00D72 Contingency Table",
                visible="(showCrosstabulation)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "cutpointMethod"),
                columns=list(
                    list(
                        `name`="test_result", 
                        `title`="Test Result", 
                        `type`="text"),
                    list(
                        `name`="disease_positive", 
                        `title`="Disease Positive", 
                        `type`="integer"),
                    list(
                        `name`="disease_negative", 
                        `title`="Disease Negative", 
                        `type`="integer"),
                    list(
                        `name`="total", 
                        `title`="Total", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="likelihoodRatios",
                title="Likelihood Ratios",
                visible="(showLikelihoodRatios)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "confidenceLevel",
                    "ciMethod"),
                columns=list(
                    list(
                        `name`="ratio_type", 
                        `title`="Likelihood Ratio", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="optimalCutpoint",
                title="Optimal Cutpoint Analysis",
                visible="(showOptimalCutpoint && analysisType:continuous)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "cutpointMethod",
                    "costRatio"),
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Selection Method", 
                        `type`="text"),
                    list(
                        `name`="cutpoint", 
                        `title`="Optimal Cutpoint", 
                        `type`="number"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="zto,pc:2"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="zto,pc:2"),
                    list(
                        `name`="youden_index", 
                        `title`="Youden Index", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="criterion_value", 
                        `title`="Criterion Value", 
                        `type`="number", 
                        `format`="zto:3"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="postTestProbabilities",
                title="Post-test Probabilities",
                visible="(showPostTestProbs)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "specificPrevalences"),
                columns=list(
                    list(
                        `name`="prevalence", 
                        `title`="Prior Probability (%)", 
                        `type`="number", 
                        `format`="zto,pc:1"),
                    list(
                        `name`="positive_test_post", 
                        `title`="Post-test if Positive (%)", 
                        `type`="number", 
                        `format`="zto,pc:1"),
                    list(
                        `name`="negative_test_post", 
                        `title`="Post-test if Negative (%)", 
                        `type`="number", 
                        `format`="zto,pc:1"),
                    list(
                        `name`="clinical_utility", 
                        `title`="Clinical Utility", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="diagnosticOddsRatio",
                title="Diagnostic Odds Ratio",
                visible="(showDiagnosticOdds)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard"),
                columns=list(
                    list(
                        `name`="measure", 
                        `title`="Measure", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stratifiedAnalysis",
                title="Stratified Analysis",
                visible="(performStratified)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "groupVariable"),
                columns=list(
                    list(
                        `name`="stratum", 
                        `title`="Stratum", 
                        `type`="text"),
                    list(
                        `name`="lr_positive", 
                        `title`="LR+", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="lr_negative", 
                        `title`="LR-", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="dor", 
                        `title`="DOR", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="sample_size", 
                        `title`="N", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="homogeneityTest",
                title="Test for Homogeneity Across Strata",
                visible="(testHomogeneity && performStratified)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "groupVariable"),
                columns=list(
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation & Usage Guidelines",
                visible="(showClinicalInterpretation)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="rocCurve",
                title="ROC Curve",
                width=600,
                height=400,
                renderFun=".plotROC",
                visible="(plotROC)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "cutpointMethod")))
            self$add(jmvcore::Image$new(
                options=options,
                name="predictiveValueCurves",
                title="Predictive Value Curves",
                width=700,
                height=500,
                renderFun=".plotPredictiveValues",
                visible="(plotPredictiveValues)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard",
                    "prevalenceRange")))
            self$add(jmvcore::Image$new(
                options=options,
                name="likelihoodNomogram",
                title="Likelihood Ratio Nomogram",
                width=800,
                height=600,
                renderFun=".plotNomogram",
                visible="(plotLikelihoodRatios)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard")))
            self$add(jmvcore::Image$new(
                options=options,
                name="postTestPlot",
                title="Post-test Probability vs Prevalence",
                width=600,
                height=400,
                renderFun=".plotPostTest",
                visible="(plotPostTestProbabilities)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard")))
            self$add(jmvcore::Image$new(
                options=options,
                name="distributionPlot",
                title="Test Result Distributions by Disease Status",
                width=600,
                height=400,
                renderFun=".plotDistributions",
                visible="(plotDistributions && analysisType:continuous)",
                clearWith=list(
                    "testVariable",
                    "referenceStandard")))}))

likelihoodratioBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "likelihoodratioBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "likelihoodratio",
                version = c(0,0,31),
                options = options,
                results = likelihoodratioResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Likelihood Ratio Analysis
#'
#' Comprehensive likelihood ratio analysis for diagnostic test evaluation.
#' 
#' **Key Features:**
#' - Positive and negative likelihood ratios with confidence intervals
#' - Diagnostic odds ratios and clinical utility measures
#' - Youden Index for optimal cutpoint determination
#' - Post-test probability calculations across prevalence ranges
#' - Predictive value curves and clinical interpretation guides
#' 
#' **Applications:**
#' - Laboratory test validation and comparison
#' - Biomarker evaluation and cutpoint optimization
#' - Diagnostic accuracy assessment in pathology
#' - Clinical decision support tool evaluation
#' - Method comparison and diagnostic performance studies
#' 
#' @param data The data as a data frame containing test results and reference
#'   standard.
#' @param testVariable Diagnostic test results (continuous or categorical)
#' @param referenceStandard True disease status (binary: positive/negative)
#' @param groupVariable Variable for stratified analysis (e.g., subgroups,
#'   centers)
#' @param analysisType Type of diagnostic test data
#' @param testDirection Direction of test values relative to disease presence
#' @param cutpointMethod Method for determining optimal cutpoint
#' @param manualCutpoint User-specified cutpoint value
#' @param costRatio Relative cost of false positive vs false negative
#' @param confidenceLevel Confidence level for likelihood ratio confidence
#'   intervals
#' @param ciMethod Method for calculating confidence intervals
#' @param bootstrapSamples Number of bootstrap samples for CI calculation
#' @param calculatePostTest Calculate post-test probabilities for different
#'   prevalences
#' @param prevalenceRange Range of disease prevalence for post-test
#'   probability analysis
#' @param customPrevalenceMin Minimum prevalence for custom range
#' @param customPrevalenceMax Maximum prevalence for custom range
#' @param specificPrevalences Specific prevalence values for detailed analysis
#' @param calculateDOR Calculate diagnostic odds ratio and confidence interval
#' @param calculateNRI Calculate NRI for comparing diagnostic tests
#' @param compareVariable Second test for comparison (NRI calculation)
#' @param predictiveValueCurves Generate PPV and NPV curves across prevalence
#'   range
#' @param clinicalThresholds Clinical probability thresholds for decision
#'   making (comma-separated)
#' @param performStratified Analyze likelihood ratios within subgroups
#' @param testHomogeneity Test for homogeneity of likelihood ratios across
#'   strata
#' @param showSummaryTable Show summary of diagnostic performance measures
#' @param showCrosstabulation Show detailed crosstabulation with cell counts
#' @param showLikelihoodRatios Show positive and negative likelihood ratios
#'   with CI
#' @param showPostTestProbs Show post-test probabilities at different
#'   prevalences
#' @param showOptimalCutpoint Show optimal cutpoint determination results
#' @param showDiagnosticOdds Show diagnostic odds ratio with confidence
#'   interval
#' @param showClinicalInterpretation Show clinical interpretation and usage
#'   guidelines
#' @param plotROC Generate ROC curve with optimal cutpoint marked
#' @param plotPredictiveValues Plot PPV and NPV across prevalence range
#' @param plotLikelihoodRatios Generate likelihood ratio nomogram for clinical
#'   use
#' @param plotPostTestProbabilities Visualize post-test probabilities vs
#'   prevalence
#' @param plotDistributions Show distributions of test results by disease
#'   status
#' @param correctContinuity Apply continuity correction for zero cells in 2Ã—2
#'   table
#' @param exactTests Use exact tests instead of asymptotic approximations
#' @param smoothROC Apply smoothing to ROC curve estimation
#' @param randomSeed Random seed for reproducible bootstrap results
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summaryTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crosstabulation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$likelihoodRatios} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$optimalCutpoint} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$postTestProbabilities} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$diagnosticOddsRatio} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$stratifiedAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$homogeneityTest} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$rocCurve} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$predictiveValueCurves} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$likelihoodNomogram} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$postTestPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$distributionPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$summaryTable$asDF}
#'
#' \code{as.data.frame(results$summaryTable)}
#'
#' @export
likelihoodratio <- function(
    data,
    testVariable,
    referenceStandard,
    groupVariable,
    analysisType = "binary",
    testDirection = "higher",
    cutpointMethod = "youden",
    manualCutpoint,
    costRatio = 1,
    confidenceLevel = 0.95,
    ciMethod = "log",
    bootstrapSamples = 2000,
    calculatePostTest = TRUE,
    prevalenceRange = "clinical",
    customPrevalenceMin = 5,
    customPrevalenceMax = 50,
    specificPrevalences = "10, 25, 50",
    calculateDOR = TRUE,
    calculateNRI = FALSE,
    compareVariable,
    predictiveValueCurves = TRUE,
    clinicalThresholds = "0.15, 0.85",
    performStratified = FALSE,
    testHomogeneity = FALSE,
    showSummaryTable = TRUE,
    showCrosstabulation = TRUE,
    showLikelihoodRatios = TRUE,
    showPostTestProbs = TRUE,
    showOptimalCutpoint = TRUE,
    showDiagnosticOdds = TRUE,
    showClinicalInterpretation = TRUE,
    plotROC = TRUE,
    plotPredictiveValues = TRUE,
    plotLikelihoodRatios = TRUE,
    plotPostTestProbabilities = TRUE,
    plotDistributions = FALSE,
    correctContinuity = TRUE,
    exactTests = FALSE,
    smoothROC = FALSE,
    randomSeed = 42) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("likelihoodratio requires jmvcore to be installed (restart may be required)")

    if ( ! missing(testVariable)) testVariable <- jmvcore::resolveQuo(jmvcore::enquo(testVariable))
    if ( ! missing(referenceStandard)) referenceStandard <- jmvcore::resolveQuo(jmvcore::enquo(referenceStandard))
    if ( ! missing(groupVariable)) groupVariable <- jmvcore::resolveQuo(jmvcore::enquo(groupVariable))
    if ( ! missing(compareVariable)) compareVariable <- jmvcore::resolveQuo(jmvcore::enquo(compareVariable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(testVariable), testVariable, NULL),
            `if`( ! missing(referenceStandard), referenceStandard, NULL),
            `if`( ! missing(groupVariable), groupVariable, NULL),
            `if`( ! missing(compareVariable), compareVariable, NULL))

    for (v in referenceStandard) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in groupVariable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- likelihoodratioOptions$new(
        testVariable = testVariable,
        referenceStandard = referenceStandard,
        groupVariable = groupVariable,
        analysisType = analysisType,
        testDirection = testDirection,
        cutpointMethod = cutpointMethod,
        manualCutpoint = manualCutpoint,
        costRatio = costRatio,
        confidenceLevel = confidenceLevel,
        ciMethod = ciMethod,
        bootstrapSamples = bootstrapSamples,
        calculatePostTest = calculatePostTest,
        prevalenceRange = prevalenceRange,
        customPrevalenceMin = customPrevalenceMin,
        customPrevalenceMax = customPrevalenceMax,
        specificPrevalences = specificPrevalences,
        calculateDOR = calculateDOR,
        calculateNRI = calculateNRI,
        compareVariable = compareVariable,
        predictiveValueCurves = predictiveValueCurves,
        clinicalThresholds = clinicalThresholds,
        performStratified = performStratified,
        testHomogeneity = testHomogeneity,
        showSummaryTable = showSummaryTable,
        showCrosstabulation = showCrosstabulation,
        showLikelihoodRatios = showLikelihoodRatios,
        showPostTestProbs = showPostTestProbs,
        showOptimalCutpoint = showOptimalCutpoint,
        showDiagnosticOdds = showDiagnosticOdds,
        showClinicalInterpretation = showClinicalInterpretation,
        plotROC = plotROC,
        plotPredictiveValues = plotPredictiveValues,
        plotLikelihoodRatios = plotLikelihoodRatios,
        plotPostTestProbabilities = plotPostTestProbabilities,
        plotDistributions = plotDistributions,
        correctContinuity = correctContinuity,
        exactTests = exactTests,
        smoothROC = smoothROC,
        randomSeed = randomSeed)

    analysis <- likelihoodratioClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

