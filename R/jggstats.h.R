
# This file is automatically generated, you probably don't want to edit this

jggstatsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggstatsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            analysis_type = "ggcoef_model",
            dependent_var = NULL,
            independent_vars = NULL,
            grouping_var = NULL,
            weight_var = NULL,
            model_formula = "",
            model_type = "lm",
            family = "gaussian",
            confidence_level = 0.95,
            likert_levels = 5,
            show_intercept = FALSE,
            sort_coefficients = TRUE,
            standardized = FALSE,
            show_statistics = TRUE,
            show_significance = TRUE,
            color_palette = "default",
            theme_style = "default",
            plot_title = "",
            plot_subtitle = "",
            x_label = "",
            y_label = "",
            facet_var = NULL,
            facet_type = "wrap",
            show_model_summary = TRUE,
            show_interpretation = TRUE,
            output_format = "plot_only", ...) {

            super$initialize(
                package="ClinicoPath",
                name="jggstats",
                requiresData=TRUE,
                ...)

            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "ggcoef_model",
                    "ggcoef_compare",
                    "gglikert",
                    "ggsurvey",
                    "stat_prop",
                    "stat_cross",
                    "stat_weighted_mean",
                    "ggcascade"),
                default="ggcoef_model")
            private$..dependent_var <- jmvcore::OptionVariable$new(
                "dependent_var",
                dependent_var)
            private$..independent_vars <- jmvcore::OptionVariables$new(
                "independent_vars",
                independent_vars)
            private$..grouping_var <- jmvcore::OptionVariable$new(
                "grouping_var",
                grouping_var)
            private$..weight_var <- jmvcore::OptionVariable$new(
                "weight_var",
                weight_var)
            private$..model_formula <- jmvcore::OptionString$new(
                "model_formula",
                model_formula,
                default="")
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "lm",
                    "glm",
                    "coxph",
                    "lmer",
                    "glmer"),
                default="lm")
            private$..family <- jmvcore::OptionList$new(
                "family",
                family,
                options=list(
                    "gaussian",
                    "binomial",
                    "poisson",
                    "gamma"),
                default="gaussian")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..likert_levels <- jmvcore::OptionInteger$new(
                "likert_levels",
                likert_levels,
                min=3,
                max=10,
                default=5)
            private$..show_intercept <- jmvcore::OptionBool$new(
                "show_intercept",
                show_intercept,
                default=FALSE)
            private$..sort_coefficients <- jmvcore::OptionBool$new(
                "sort_coefficients",
                sort_coefficients,
                default=TRUE)
            private$..standardized <- jmvcore::OptionBool$new(
                "standardized",
                standardized,
                default=FALSE)
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..show_significance <- jmvcore::OptionBool$new(
                "show_significance",
                show_significance,
                default=TRUE)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "default",
                    "viridis",
                    "set1",
                    "dark2",
                    "paired"),
                default="default")
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "default",
                    "minimal",
                    "classic",
                    "light",
                    "dark"),
                default="default")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..plot_subtitle <- jmvcore::OptionString$new(
                "plot_subtitle",
                plot_subtitle,
                default="")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var)
            private$..facet_type <- jmvcore::OptionList$new(
                "facet_type",
                facet_type,
                options=list(
                    "wrap",
                    "grid"),
                default="wrap")
            private$..show_model_summary <- jmvcore::OptionBool$new(
                "show_model_summary",
                show_model_summary,
                default=TRUE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)
            private$..output_format <- jmvcore::OptionList$new(
                "output_format",
                output_format,
                options=list(
                    "plot_only",
                    "model_table",
                    "both"),
                default="plot_only")

            self$.addOption(private$..analysis_type)
            self$.addOption(private$..dependent_var)
            self$.addOption(private$..independent_vars)
            self$.addOption(private$..grouping_var)
            self$.addOption(private$..weight_var)
            self$.addOption(private$..model_formula)
            self$.addOption(private$..model_type)
            self$.addOption(private$..family)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..likert_levels)
            self$.addOption(private$..show_intercept)
            self$.addOption(private$..sort_coefficients)
            self$.addOption(private$..standardized)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..show_significance)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..theme_style)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..plot_subtitle)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..facet_type)
            self$.addOption(private$..show_model_summary)
            self$.addOption(private$..show_interpretation)
            self$.addOption(private$..output_format)
        }),
    active = list(
        analysis_type = function() private$..analysis_type$value,
        dependent_var = function() private$..dependent_var$value,
        independent_vars = function() private$..independent_vars$value,
        grouping_var = function() private$..grouping_var$value,
        weight_var = function() private$..weight_var$value,
        model_formula = function() private$..model_formula$value,
        model_type = function() private$..model_type$value,
        family = function() private$..family$value,
        confidence_level = function() private$..confidence_level$value,
        likert_levels = function() private$..likert_levels$value,
        show_intercept = function() private$..show_intercept$value,
        sort_coefficients = function() private$..sort_coefficients$value,
        standardized = function() private$..standardized$value,
        show_statistics = function() private$..show_statistics$value,
        show_significance = function() private$..show_significance$value,
        color_palette = function() private$..color_palette$value,
        theme_style = function() private$..theme_style$value,
        plot_title = function() private$..plot_title$value,
        plot_subtitle = function() private$..plot_subtitle$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        facet_var = function() private$..facet_var$value,
        facet_type = function() private$..facet_type$value,
        show_model_summary = function() private$..show_model_summary$value,
        show_interpretation = function() private$..show_interpretation$value,
        output_format = function() private$..output_format$value),
    private = list(
        ..analysis_type = NA,
        ..dependent_var = NA,
        ..independent_vars = NA,
        ..grouping_var = NA,
        ..weight_var = NA,
        ..model_formula = NA,
        ..model_type = NA,
        ..family = NA,
        ..confidence_level = NA,
        ..likert_levels = NA,
        ..show_intercept = NA,
        ..sort_coefficients = NA,
        ..standardized = NA,
        ..show_statistics = NA,
        ..show_significance = NA,
        ..color_palette = NA,
        ..theme_style = NA,
        ..plot_title = NA,
        ..plot_subtitle = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..facet_var = NA,
        ..facet_type = NA,
        ..show_model_summary = NA,
        ..show_interpretation = NA,
        ..output_format = NA)
)

jggstatsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggstatsResults",
    inherit = jmvcore::Group,
    active = list(
        plot = function() private$.items[["plot"]],
        modeltab = function() private$.items[["modeltab"]],
        summary = function() private$.items[["summary"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Statistical Visualization",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Statistical Plot",
                width=650,
                height=450,
                renderFun=".plot"))
            self$add(jmvcore::Table$new(
                options=options,
                name="modeltab",
                title="Model Results",
                rows=0,
                visible="(output_format:model_table || output_format:both)",
                columns=list(
                    list(
                        `name`="term", 
                        `title`="Term", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="std_error", 
                        `title`="Std. Error", 
                        `type`="number"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="conf_low", 
                        `title`="CI Lower", 
                        `type`="number"),
                    list(
                        `name`="conf_high", 
                        `title`="CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="summary",
                title="Model Summary",
                rows=0,
                visible="(show_model_summary)",
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Statistical Interpretation",
                visible="(show_interpretation)"))}))

jggstatsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggstatsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jggstats",
                version = c(1,0,0),
                options = options,
                results = jggstatsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Statistical Visualization
#'
#' 
#' @param data .
#' @param analysis_type .
#' @param dependent_var Main outcome variable for analysis
#' @param independent_vars Predictor variables for model
#' @param grouping_var Variable for grouping/stratification
#' @param weight_var Variable containing survey weights
#' @param model_formula Custom model formula (optional)
#' @param model_type .
#' @param family .
#' @param confidence_level Confidence level for intervals
#' @param likert_levels Number of levels in Likert scale
#' @param show_intercept Include intercept in coefficient plots
#' @param sort_coefficients Sort coefficients by magnitude
#' @param standardized Display standardized coefficients
#' @param show_statistics Display statistical values
#' @param show_significance Add significance stars to plot
#' @param color_palette .
#' @param theme_style .
#' @param plot_title .
#' @param plot_subtitle .
#' @param x_label .
#' @param y_label .
#' @param facet_var Variable for creating plot facets
#' @param facet_type .
#' @param show_model_summary Display model fit statistics
#' @param show_interpretation Generate interpretation text
#' @param output_format .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$modeltab} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modeltab$asDF}
#'
#' \code{as.data.frame(results$modeltab)}
#'
#' @export
jggstats <- function(
    data,
    analysis_type = "ggcoef_model",
    dependent_var,
    independent_vars,
    grouping_var,
    weight_var,
    model_formula = "",
    model_type = "lm",
    family = "gaussian",
    confidence_level = 0.95,
    likert_levels = 5,
    show_intercept = FALSE,
    sort_coefficients = TRUE,
    standardized = FALSE,
    show_statistics = TRUE,
    show_significance = TRUE,
    color_palette = "default",
    theme_style = "default",
    plot_title = "",
    plot_subtitle = "",
    x_label = "",
    y_label = "",
    facet_var,
    facet_type = "wrap",
    show_model_summary = TRUE,
    show_interpretation = TRUE,
    output_format = "plot_only") {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jggstats requires jmvcore to be installed (restart may be required)")

    if ( ! missing(dependent_var)) dependent_var <- jmvcore::resolveQuo(jmvcore::enquo(dependent_var))
    if ( ! missing(independent_vars)) independent_vars <- jmvcore::resolveQuo(jmvcore::enquo(independent_vars))
    if ( ! missing(grouping_var)) grouping_var <- jmvcore::resolveQuo(jmvcore::enquo(grouping_var))
    if ( ! missing(weight_var)) weight_var <- jmvcore::resolveQuo(jmvcore::enquo(weight_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dependent_var), dependent_var, NULL),
            `if`( ! missing(independent_vars), independent_vars, NULL),
            `if`( ! missing(grouping_var), grouping_var, NULL),
            `if`( ! missing(weight_var), weight_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))


    options <- jggstatsOptions$new(
        analysis_type = analysis_type,
        dependent_var = dependent_var,
        independent_vars = independent_vars,
        grouping_var = grouping_var,
        weight_var = weight_var,
        model_formula = model_formula,
        model_type = model_type,
        family = family,
        confidence_level = confidence_level,
        likert_levels = likert_levels,
        show_intercept = show_intercept,
        sort_coefficients = sort_coefficients,
        standardized = standardized,
        show_statistics = show_statistics,
        show_significance = show_significance,
        color_palette = color_palette,
        theme_style = theme_style,
        plot_title = plot_title,
        plot_subtitle = plot_subtitle,
        x_label = x_label,
        y_label = y_label,
        facet_var = facet_var,
        facet_type = facet_type,
        show_model_summary = show_model_summary,
        show_interpretation = show_interpretation,
        output_format = output_format)

    analysis <- jggstatsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

