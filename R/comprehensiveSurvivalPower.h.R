
# This file is automatically generated, you probably don't want to edit this

comprehensiveSurvivalPowerOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "comprehensiveSurvivalPowerOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            method_category = "standard",
            calculation_type = "sample_size",
            statistical_method = "log_rank_schoenfeld",
            study_design = "simple",
            alpha = 0.05,
            power = 0.8,
            sample_size = 200,
            allocation_ratio = 1,
            hazard_ratio = 0.75,
            median_survival_control = 12,
            median_survival_treatment = 16,
            accrual_period = 24,
            follow_up_period = 36,
            dropout_rate = 0.05,
            event_rate = 0.6,
            competing_event_rate = 0.2,
            cumulative_incidence_control = 0.4,
            cumulative_incidence_treatment = 0.3,
            rmst_timepoint = 24,
            non_inferiority_margin = 1.25,
            superiority_test = FALSE,
            snp_maf = 0.2,
            genetic_model = "additive",
            number_of_looks = 1,
            spending_function = "lan_demets_obf",
            show_detailed_output = TRUE,
            show_sensitivity_analysis = FALSE,
            show_power_curves = FALSE,
            export_study_design = FALSE,
            genetic_effect_size = 1.5,
            cure_rate_control = 0,
            cure_rate_treatment = 0,
            survival_distribution = "exponential",
            accrual_distribution = "uniform",
            interim_futility_boundary = 0.2,
            binding_futility = FALSE,
            number_of_covariates = 2,
            covariate_correlation = 0,
            interaction_effect_size = 1,
            covariate_distribution = "normal",
            adjust_for_confounders = TRUE,
            show_method_comparison = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="comprehensiveSurvivalPower",
                requiresData=TRUE,
                ...)

            private$..method_category <- jmvcore::OptionList$new(
                "method_category",
                method_category,
                options=list(
                    "standard",
                    "competing_risks",
                    "advanced",
                    "genetic",
                    "cure_models",
                    "sequential",
                    "epidemiological"),
                default="standard")
            private$..calculation_type <- jmvcore::OptionList$new(
                "calculation_type",
                calculation_type,
                options=list(
                    "sample_size",
                    "power",
                    "effect_size",
                    "duration",
                    "events"),
                default="sample_size")
            private$..statistical_method <- jmvcore::OptionList$new(
                "statistical_method",
                statistical_method,
                options=list(
                    "log_rank_schoenfeld",
                    "log_rank_lachin",
                    "cox_regression",
                    "weighted_logrank",
                    "grays_test",
                    "subdist_hazards",
                    "cause_specific",
                    "rmst",
                    "non_inferiority",
                    "bayesian",
                    "snp_survival_additive",
                    "snp_survival_dominant",
                    "snp_survival_recessive",
                    "mixture_cure",
                    "non_mixture_cure",
                    "promotion_time_cure",
                    "obrien_fleming",
                    "pocock",
                    "lan_demets",
                    "wang_tsiatis",
                    "multi_covariates",
                    "interaction_effects",
                    "continuous_exposure"),
                default="log_rank_schoenfeld")
            private$..study_design <- jmvcore::OptionList$new(
                "study_design",
                study_design,
                options=list(
                    "simple",
                    "complex",
                    "sequential"),
                default="simple")
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                min=0.001,
                max=0.2,
                default=0.05)
            private$..power <- jmvcore::OptionNumber$new(
                "power",
                power,
                min=0.5,
                max=0.99,
                default=0.8)
            private$..sample_size <- jmvcore::OptionInteger$new(
                "sample_size",
                sample_size,
                min=10,
                max=100000,
                default=200)
            private$..allocation_ratio <- jmvcore::OptionNumber$new(
                "allocation_ratio",
                allocation_ratio,
                min=0.1,
                max=10,
                default=1)
            private$..hazard_ratio <- jmvcore::OptionNumber$new(
                "hazard_ratio",
                hazard_ratio,
                min=0.1,
                max=10,
                default=0.75)
            private$..median_survival_control <- jmvcore::OptionNumber$new(
                "median_survival_control",
                median_survival_control,
                min=0.1,
                max=1000,
                default=12)
            private$..median_survival_treatment <- jmvcore::OptionNumber$new(
                "median_survival_treatment",
                median_survival_treatment,
                min=0.1,
                max=1000,
                default=16)
            private$..accrual_period <- jmvcore::OptionNumber$new(
                "accrual_period",
                accrual_period,
                min=0.1,
                max=100,
                default=24)
            private$..follow_up_period <- jmvcore::OptionNumber$new(
                "follow_up_period",
                follow_up_period,
                min=0.1,
                max=100,
                default=36)
            private$..dropout_rate <- jmvcore::OptionNumber$new(
                "dropout_rate",
                dropout_rate,
                min=0,
                max=0.5,
                default=0.05)
            private$..event_rate <- jmvcore::OptionNumber$new(
                "event_rate",
                event_rate,
                min=0.01,
                max=0.99,
                default=0.6)
            private$..competing_event_rate <- jmvcore::OptionNumber$new(
                "competing_event_rate",
                competing_event_rate,
                min=0,
                max=0.8,
                default=0.2)
            private$..cumulative_incidence_control <- jmvcore::OptionNumber$new(
                "cumulative_incidence_control",
                cumulative_incidence_control,
                min=0.01,
                max=0.99,
                default=0.4)
            private$..cumulative_incidence_treatment <- jmvcore::OptionNumber$new(
                "cumulative_incidence_treatment",
                cumulative_incidence_treatment,
                min=0.01,
                max=0.99,
                default=0.3)
            private$..rmst_timepoint <- jmvcore::OptionNumber$new(
                "rmst_timepoint",
                rmst_timepoint,
                min=1,
                max=1000,
                default=24)
            private$..non_inferiority_margin <- jmvcore::OptionNumber$new(
                "non_inferiority_margin",
                non_inferiority_margin,
                min=0.01,
                max=2,
                default=1.25)
            private$..superiority_test <- jmvcore::OptionBool$new(
                "superiority_test",
                superiority_test,
                default=FALSE)
            private$..snp_maf <- jmvcore::OptionNumber$new(
                "snp_maf",
                snp_maf,
                min=0.01,
                max=0.5,
                default=0.2)
            private$..genetic_model <- jmvcore::OptionList$new(
                "genetic_model",
                genetic_model,
                options=list(
                    "additive",
                    "dominant",
                    "recessive"),
                default="additive")
            private$..number_of_looks <- jmvcore::OptionInteger$new(
                "number_of_looks",
                number_of_looks,
                min=1,
                max=10,
                default=1)
            private$..spending_function <- jmvcore::OptionList$new(
                "spending_function",
                spending_function,
                options=list(
                    "obf",
                    "pocock",
                    "lan_demets_obf",
                    "lan_demets_pocock"),
                default="lan_demets_obf")
            private$..show_detailed_output <- jmvcore::OptionBool$new(
                "show_detailed_output",
                show_detailed_output,
                default=TRUE)
            private$..show_sensitivity_analysis <- jmvcore::OptionBool$new(
                "show_sensitivity_analysis",
                show_sensitivity_analysis,
                default=FALSE)
            private$..show_power_curves <- jmvcore::OptionBool$new(
                "show_power_curves",
                show_power_curves,
                default=FALSE)
            private$..export_study_design <- jmvcore::OptionBool$new(
                "export_study_design",
                export_study_design,
                default=FALSE)
            private$..genetic_effect_size <- jmvcore::OptionNumber$new(
                "genetic_effect_size",
                genetic_effect_size,
                min=1,
                max=5,
                default=1.5)
            private$..cure_rate_control <- jmvcore::OptionNumber$new(
                "cure_rate_control",
                cure_rate_control,
                min=0,
                max=1,
                default=0)
            private$..cure_rate_treatment <- jmvcore::OptionNumber$new(
                "cure_rate_treatment",
                cure_rate_treatment,
                min=0,
                max=1,
                default=0)
            private$..survival_distribution <- jmvcore::OptionList$new(
                "survival_distribution",
                survival_distribution,
                options=list(
                    "exponential",
                    "weibull",
                    "lognormal",
                    "piecewise_exponential"),
                default="exponential")
            private$..accrual_distribution <- jmvcore::OptionList$new(
                "accrual_distribution",
                accrual_distribution,
                options=list(
                    "uniform",
                    "increasing",
                    "decreasing",
                    "truncated_exponential"),
                default="uniform")
            private$..interim_futility_boundary <- jmvcore::OptionNumber$new(
                "interim_futility_boundary",
                interim_futility_boundary,
                min=0,
                max=1,
                default=0.2)
            private$..binding_futility <- jmvcore::OptionBool$new(
                "binding_futility",
                binding_futility,
                default=FALSE)
            private$..number_of_covariates <- jmvcore::OptionInteger$new(
                "number_of_covariates",
                number_of_covariates,
                min=1,
                max=20,
                default=2)
            private$..covariate_correlation <- jmvcore::OptionNumber$new(
                "covariate_correlation",
                covariate_correlation,
                min=0,
                max=0.9,
                default=0)
            private$..interaction_effect_size <- jmvcore::OptionNumber$new(
                "interaction_effect_size",
                interaction_effect_size,
                min=0.1,
                max=5,
                default=1)
            private$..covariate_distribution <- jmvcore::OptionList$new(
                "covariate_distribution",
                covariate_distribution,
                options=list(
                    "normal",
                    "binary",
                    "uniform",
                    "mixed"),
                default="normal")
            private$..adjust_for_confounders <- jmvcore::OptionBool$new(
                "adjust_for_confounders",
                adjust_for_confounders,
                default=TRUE)
            private$..show_method_comparison <- jmvcore::OptionBool$new(
                "show_method_comparison",
                show_method_comparison,
                default=FALSE)

            self$.addOption(private$..method_category)
            self$.addOption(private$..calculation_type)
            self$.addOption(private$..statistical_method)
            self$.addOption(private$..study_design)
            self$.addOption(private$..alpha)
            self$.addOption(private$..power)
            self$.addOption(private$..sample_size)
            self$.addOption(private$..allocation_ratio)
            self$.addOption(private$..hazard_ratio)
            self$.addOption(private$..median_survival_control)
            self$.addOption(private$..median_survival_treatment)
            self$.addOption(private$..accrual_period)
            self$.addOption(private$..follow_up_period)
            self$.addOption(private$..dropout_rate)
            self$.addOption(private$..event_rate)
            self$.addOption(private$..competing_event_rate)
            self$.addOption(private$..cumulative_incidence_control)
            self$.addOption(private$..cumulative_incidence_treatment)
            self$.addOption(private$..rmst_timepoint)
            self$.addOption(private$..non_inferiority_margin)
            self$.addOption(private$..superiority_test)
            self$.addOption(private$..snp_maf)
            self$.addOption(private$..genetic_model)
            self$.addOption(private$..number_of_looks)
            self$.addOption(private$..spending_function)
            self$.addOption(private$..show_detailed_output)
            self$.addOption(private$..show_sensitivity_analysis)
            self$.addOption(private$..show_power_curves)
            self$.addOption(private$..export_study_design)
            self$.addOption(private$..genetic_effect_size)
            self$.addOption(private$..cure_rate_control)
            self$.addOption(private$..cure_rate_treatment)
            self$.addOption(private$..survival_distribution)
            self$.addOption(private$..accrual_distribution)
            self$.addOption(private$..interim_futility_boundary)
            self$.addOption(private$..binding_futility)
            self$.addOption(private$..number_of_covariates)
            self$.addOption(private$..covariate_correlation)
            self$.addOption(private$..interaction_effect_size)
            self$.addOption(private$..covariate_distribution)
            self$.addOption(private$..adjust_for_confounders)
            self$.addOption(private$..show_method_comparison)
        }),
    active = list(
        method_category = function() private$..method_category$value,
        calculation_type = function() private$..calculation_type$value,
        statistical_method = function() private$..statistical_method$value,
        study_design = function() private$..study_design$value,
        alpha = function() private$..alpha$value,
        power = function() private$..power$value,
        sample_size = function() private$..sample_size$value,
        allocation_ratio = function() private$..allocation_ratio$value,
        hazard_ratio = function() private$..hazard_ratio$value,
        median_survival_control = function() private$..median_survival_control$value,
        median_survival_treatment = function() private$..median_survival_treatment$value,
        accrual_period = function() private$..accrual_period$value,
        follow_up_period = function() private$..follow_up_period$value,
        dropout_rate = function() private$..dropout_rate$value,
        event_rate = function() private$..event_rate$value,
        competing_event_rate = function() private$..competing_event_rate$value,
        cumulative_incidence_control = function() private$..cumulative_incidence_control$value,
        cumulative_incidence_treatment = function() private$..cumulative_incidence_treatment$value,
        rmst_timepoint = function() private$..rmst_timepoint$value,
        non_inferiority_margin = function() private$..non_inferiority_margin$value,
        superiority_test = function() private$..superiority_test$value,
        snp_maf = function() private$..snp_maf$value,
        genetic_model = function() private$..genetic_model$value,
        number_of_looks = function() private$..number_of_looks$value,
        spending_function = function() private$..spending_function$value,
        show_detailed_output = function() private$..show_detailed_output$value,
        show_sensitivity_analysis = function() private$..show_sensitivity_analysis$value,
        show_power_curves = function() private$..show_power_curves$value,
        export_study_design = function() private$..export_study_design$value,
        genetic_effect_size = function() private$..genetic_effect_size$value,
        cure_rate_control = function() private$..cure_rate_control$value,
        cure_rate_treatment = function() private$..cure_rate_treatment$value,
        survival_distribution = function() private$..survival_distribution$value,
        accrual_distribution = function() private$..accrual_distribution$value,
        interim_futility_boundary = function() private$..interim_futility_boundary$value,
        binding_futility = function() private$..binding_futility$value,
        number_of_covariates = function() private$..number_of_covariates$value,
        covariate_correlation = function() private$..covariate_correlation$value,
        interaction_effect_size = function() private$..interaction_effect_size$value,
        covariate_distribution = function() private$..covariate_distribution$value,
        adjust_for_confounders = function() private$..adjust_for_confounders$value,
        show_method_comparison = function() private$..show_method_comparison$value),
    private = list(
        ..method_category = NA,
        ..calculation_type = NA,
        ..statistical_method = NA,
        ..study_design = NA,
        ..alpha = NA,
        ..power = NA,
        ..sample_size = NA,
        ..allocation_ratio = NA,
        ..hazard_ratio = NA,
        ..median_survival_control = NA,
        ..median_survival_treatment = NA,
        ..accrual_period = NA,
        ..follow_up_period = NA,
        ..dropout_rate = NA,
        ..event_rate = NA,
        ..competing_event_rate = NA,
        ..cumulative_incidence_control = NA,
        ..cumulative_incidence_treatment = NA,
        ..rmst_timepoint = NA,
        ..non_inferiority_margin = NA,
        ..superiority_test = NA,
        ..snp_maf = NA,
        ..genetic_model = NA,
        ..number_of_looks = NA,
        ..spending_function = NA,
        ..show_detailed_output = NA,
        ..show_sensitivity_analysis = NA,
        ..show_power_curves = NA,
        ..export_study_design = NA,
        ..genetic_effect_size = NA,
        ..cure_rate_control = NA,
        ..cure_rate_treatment = NA,
        ..survival_distribution = NA,
        ..accrual_distribution = NA,
        ..interim_futility_boundary = NA,
        ..binding_futility = NA,
        ..number_of_covariates = NA,
        ..covariate_correlation = NA,
        ..interaction_effect_size = NA,
        ..covariate_distribution = NA,
        ..adjust_for_confounders = NA,
        ..show_method_comparison = NA)
)

comprehensiveSurvivalPowerResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "comprehensiveSurvivalPowerResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        powerResults = function() private$.items[["powerResults"]],
        methodDetails = function() private$.items[["methodDetails"]],
        studyDesign = function() private$.items[["studyDesign"]],
        assumptions = function() private$.items[["assumptions"]],
        sensitivityTable = function() private$.items[["sensitivityTable"]],
        powerCurvePlot = function() private$.items[["powerCurvePlot"]],
        effectSizePlot = function() private$.items[["effectSizePlot"]],
        methodComparison = function() private$.items[["methodComparison"]],
        competingRisksDetails = function() private$.items[["competingRisksDetails"]],
        sequentialDesign = function() private$.items[["sequentialDesign"]],
        clinicalInterpretation = function() private$.items[["clinicalInterpretation"]],
        protocolSummary = function() private$.items[["protocolSummary"]],
        regulatoryNotes = function() private$.items[["regulatoryNotes"]],
        technicalDetails = function() private$.items[["technicalDetails"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Comprehensive Survival Power Analysis",
                refs=list(
                    "gsDesign",
                    "powerSurvEpi",
                    "survival",
                    "CompRisk",
                    "survRM2",
                    "ClinicoPathJamoviModule",
                    "survivalPowerAnalysis",
                    "clinicalTrialDesign",
                    "NPHMC",
                    "survSNP",
                    "survivalpwr",
                    "rpact",
                    "tools",
                    "scales"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Power Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="powerResults",
                title="Power Analysis Results",
                rows=0,
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text")),
                clearWith=list(
                    "method_category",
                    "calculation_type",
                    "statistical_method",
                    "study_design",
                    "alpha",
                    "power",
                    "sample_size",
                    "hazard_ratio")))
            self$add(jmvcore::Table$new(
                options=options,
                name="methodDetails",
                title="Method-Specific Details",
                rows=0,
                columns=list(
                    list(
                        `name`="aspect", 
                        `title`="Analysis Aspect", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="text"),
                    list(
                        `name`="interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text")),
                clearWith=list(
                    "method_category",
                    "statistical_method",
                    "study_design")))
            self$add(jmvcore::Html$new(
                options=options,
                name="studyDesign",
                title="Study Design Summary",
                visible="(show_detailed_output)",
                clearWith=list(
                    "method_category",
                    "study_design",
                    "accrual_period",
                    "follow_up_period",
                    "allocation_ratio")))
            self$add(jmvcore::Table$new(
                options=options,
                name="assumptions",
                title="Key Assumptions",
                visible="(show_detailed_output)",
                rows=0,
                columns=list(
                    list(
                        `name`="assumption", 
                        `title`="Assumption", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value Used", 
                        `type`="text"),
                    list(
                        `name`="impact", 
                        `title`="Impact on Results", 
                        `type`="text")),
                clearWith=list(
                    "method_category",
                    "statistical_method",
                    "hazard_ratio",
                    "event_rate",
                    "dropout_rate")))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityTable",
                title="Sensitivity Analysis",
                visible="(show_sensitivity_analysis)",
                rows=0,
                columns=list(
                    list(
                        `name`="parameter_varied", 
                        `title`="Parameter Varied", 
                        `type`="text"),
                    list(
                        `name`="variation", 
                        `title`="Variation", 
                        `type`="text"),
                    list(
                        `name`="result_change", 
                        `title`="Result Change", 
                        `type`="text"),
                    list(
                        `name`="percent_change", 
                        `title`="% Change", 
                        `type`="number", 
                        `format`="pc")),
                clearWith=list(
                    "method_category",
                    "calculation_type",
                    "show_sensitivity_analysis")))
            self$add(jmvcore::Image$new(
                options=options,
                name="powerCurvePlot",
                title="Power Curve Analysis",
                width=800,
                height=600,
                renderFun=".powerCurvePlot",
                visible="(show_power_curves)",
                requiresData=FALSE,
                clearWith=list(
                    "method_category",
                    "calculation_type",
                    "statistical_method",
                    "alpha",
                    "hazard_ratio")))
            self$add(jmvcore::Image$new(
                options=options,
                name="effectSizePlot",
                title="Detectable Effect Size vs Sample Size",
                width=800,
                height=600,
                renderFun=".effectSizePlot",
                visible="(show_power_curves && calculation_type:effect_size)",
                requiresData=FALSE,
                clearWith=list(
                    "method_category",
                    "statistical_method",
                    "alpha",
                    "power")))
            self$add(jmvcore::Table$new(
                options=options,
                name="methodComparison",
                title="Method Comparison",
                visible="(method_category:standard && show_detailed_output)",
                rows=0,
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="sample_size_est", 
                        `title`="Sample Size", 
                        `type`="integer"),
                    list(
                        `name`="power_est", 
                        `title`="Power", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="assumptions", 
                        `title`="Key Assumptions", 
                        `type`="text")),
                clearWith=list(
                    "method_category",
                    "calculation_type",
                    "hazard_ratio",
                    "alpha",
                    "power")))
            self$add(jmvcore::Table$new(
                options=options,
                name="competingRisksDetails",
                title="Competing Risks Analysis Details",
                visible="(method_category:competing_risks)",
                rows=0,
                columns=list(
                    list(
                        `name`="event_type", 
                        `title`="Event Type", 
                        `type`="text"),
                    list(
                        `name`="expected_incidence", 
                        `title`="Expected Cumulative Incidence", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="contribution_to_power", 
                        `title`="Contribution to Power", 
                        `type`="text")),
                clearWith=list(
                    "method_category",
                    "statistical_method",
                    "cumulative_incidence_control",
                    "cumulative_incidence_treatment",
                    "competing_event_rate")))
            self$add(jmvcore::Table$new(
                options=options,
                name="sequentialDesign",
                title="Sequential Design Analysis",
                visible="(study_design:sequential)",
                rows=0,
                columns=list(
                    list(
                        `name`="analysis_number", 
                        `title`="Analysis", 
                        `type`="integer"),
                    list(
                        `name`="timing", 
                        `title`="Timing", 
                        `type`="text"),
                    list(
                        `name`="alpha_spent", 
                        `title`="Alpha Spent", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="critical_value", 
                        `title`="Critical Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="conditional_power", 
                        `title`="Conditional Power", 
                        `type`="number", 
                        `format`="pc")),
                clearWith=list(
                    "study_design",
                    "number_of_looks",
                    "spending_function",
                    "alpha")))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalInterpretation",
                title="Clinical Interpretation",
                visible=TRUE,
                clearWith=list(
                    "method_category",
                    "calculation_type",
                    "statistical_method",
                    "hazard_ratio",
                    "sample_size",
                    "power")))
            self$add(jmvcore::Html$new(
                options=options,
                name="protocolSummary",
                title="Study Protocol Summary",
                visible="(export_study_design)",
                clearWith=list(
                    "method_category",
                    "study_design",
                    "sample_size",
                    "accrual_period",
                    "follow_up_period",
                    "allocation_ratio")))
            self$add(jmvcore::Html$new(
                options=options,
                name="regulatoryNotes",
                title="Regulatory Considerations",
                visible="(show_detailed_output)",
                clearWith=list(
                    "method_category",
                    "statistical_method",
                    "alpha",
                    "non_inferiority_margin")))
            self$add(jmvcore::Html$new(
                options=options,
                name="technicalDetails",
                title="Technical Details & References",
                visible="(show_detailed_output)",
                clearWith=list(
                    "method_category",
                    "statistical_method")))}))

comprehensiveSurvivalPowerBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "comprehensiveSurvivalPowerBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "comprehensiveSurvivalPower",
                version = c(1,0,0),
                options = options,
                results = comprehensiveSurvivalPowerResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Comprehensive Survival Power Analysis (Expert)
#'
#' Comprehensive power analysis and sample size calculation for survival 
#' studies and clinical trials. Unifies all survival power methods: standard 
#' log-rank tests, Cox regression, competing risks, RMST-based analyses, 
#' non-inferiority trials, and specialized methods. Supports both simple and 
#' complex study designs with accrual periods, variable follow-up, and dropout 
#' considerations. Essential for study planning, grant applications, and 
#' regulatory submissions.
#'
#' @examples
#' # Standard log-rank test power calculation
#' comprehensiveSurvivalPower(
#'     method_category = "standard",
#'     calculation_type = "sample_size",
#'     statistical_method = "log_rank",
#'     hazard_ratio = 0.75,
#'     power = 0.80,
#'     alpha = 0.05,
#'     allocation_ratio = 1
#' )
#'
#' # Competing risks power analysis
#' comprehensiveSurvivalPower(
#'     method_category = "competing_risks",
#'     calculation_type = "power",
#'     statistical_method = "grays_test",
#'     sample_size = 300,
#'     effect_size = 0.15,
#'     alpha = 0.05
#' )
#'
#' # Advanced RMST-based analysis
#' comprehensiveSurvivalPower(
#'     method_category = "advanced",
#'     calculation_type = "effect_size",
#'     statistical_method = "rmst",
#'     sample_size = 400,
#'     power = 0.90,
#'     alpha = 0.05,
#'     rmst_timepoint = 24
#' )
#'
#' @param data The data as a data frame (optional for power calculations).
#' @param method_category Choose the category of survival analysis method.
#'   Standard methods include log-rank tests and Cox regression. Competing risks
#'   methods analyze multiple event types. Advanced methods include RMST,
#'   non-inferiority, and specialized approaches.
#' @param calculation_type Select what parameter to calculate. Most commonly
#'   used are sample size (given desired power) and power (given available
#'   sample size).
#' @param statistical_method Choose the specific statistical method. Available
#'   options depend on the selected method category. Schoenfeld method is most
#'   common for log-rank tests.
#' @param study_design Simple design assumes fixed follow-up time. Complex
#'   design includes accrual period and variable follow-up. Sequential designs
#'   allow interim analyses.
#' @param alpha Type I error rate. Standard values: 0.05 (two-sided) or 0.025
#'   (one-sided). For non-inferiority trials, consider 0.025.
#' @param power Statistical power (probability of detecting true effect).
#'   Standard values: 0.80 (80\%) or 0.90 (90\%). Higher power requires larger
#'   sample sizes.
#' @param sample_size Total number of subjects in the study. Used when
#'   calculating power or detectable effect size from a fixed sample size.
#' @param allocation_ratio Ratio of control to treatment group sizes. 1.0 =
#'   equal allocation (1:1), 2.0 = twice as many controls (2:1). Equal
#'   allocation is most efficient.
#' @param hazard_ratio Expected hazard ratio. Values < 1 indicate treatment
#'   benefit. Common values: 0.75 (25\% reduction), 0.67 (33\% reduction), 0.50
#'   (50\% reduction).
#' @param median_survival_control Expected median survival time in control
#'   group. Units should match your study timeline (months, years, etc.).
#' @param median_survival_treatment Expected median survival time in treatment
#'   group. Should be longer than control group for beneficial treatments.
#' @param accrual_period Time period for patient recruitment (months/years).
#'   Longer accrual periods allow for smaller sample sizes but extend study
#'   duration.
#' @param follow_up_period Additional follow-up time after accrual completion.
#'   Total study duration = accrual period + follow-up period.
#' @param dropout_rate Annual rate of loss to follow-up (0.05 = 5\% per year).
#'   Higher dropout rates require larger sample sizes to maintain power.
#' @param event_rate Proportion of subjects expected to experience the event
#'   during study period. Used for simple design calculations.
#' @param competing_event_rate Proportion experiencing competing events (for
#'   competing risks analysis). Should be less than primary event rate.
#' @param cumulative_incidence_control Expected cumulative incidence of
#'   primary event in control group (for competing risks analysis).
#' @param cumulative_incidence_treatment Expected cumulative incidence of
#'   primary event in treatment group (for competing risks analysis).
#' @param rmst_timepoint Time point for restricted mean survival time
#'   analysis. Should be clinically meaningful and within study follow-up
#'   period.
#' @param non_inferiority_margin Non-inferiority margin for hazard ratio. 1.25
#'   means treatment is non-inferior if HR < 1.25 (25\% increase in hazard is
#'   acceptable).
#' @param superiority_test After establishing non-inferiority, test for
#'   superiority. Requires hierarchical testing approach to control Type I
#'   error.
#' @param snp_maf Minor allele frequency for SNP-based survival analysis.
#'   Common range: 0.05-0.45.
#' @param genetic_model Genetic inheritance model for SNP analysis. Additive
#'   model is most common.
#' @param number_of_looks Number of planned interim analyses for sequential
#'   designs. More looks require larger sample sizes to maintain overall Type I
#'   error.
#' @param spending_function Method for spending Type I error across interim
#'   analyses. O'Brien-Fleming type preserves most alpha for final analysis.
#' @param show_detailed_output Display detailed calculation steps and
#'   intermediate results.
#' @param show_sensitivity_analysis Perform sensitivity analysis varying key
#'   parameters around their specified values (+/- 10\%, 20\%).
#' @param show_power_curves Generate plots showing power vs sample size,
#'   effect size, or other parameters.
#' @param export_study_design Generate a comprehensive study design document
#'   suitable for protocols and grant applications.
#' @param genetic_effect_size Genetic effect size for SNP-based survival
#'   analysis. Represents the hazard ratio per copy of the risk allele.
#' @param cure_rate_control Proportion of subjects in control group who will
#'   never experience the event (cure fraction). 0 = no cure, standard survival
#'   model.
#' @param cure_rate_treatment Proportion of subjects in treatment group who
#'   will never experience the event (cure fraction). Usually higher than
#'   control group in effective treatments.
#' @param survival_distribution Assumed underlying survival distribution.
#'   Exponential assumes constant hazard; Weibull allows increasing/decreasing
#'   hazard; Piecewise allows complex patterns.
#' @param accrual_distribution Pattern of patient enrollment over time.
#'   Uniform = constant rate; Increasing/Decreasing = linear change; Exponential
#'   = curved pattern.
#' @param interim_futility_boundary Futility boundary for interim analyses in
#'   sequential designs. Probability threshold below which study may be stopped
#'   for futility.
#' @param binding_futility Whether futility boundaries are binding (must stop
#'   if crossed) or non-binding (advisory only).
#' @param number_of_covariates Number of covariates to include in the Cox
#'   regression model. More covariates generally require larger sample sizes.
#' @param covariate_correlation Correlation between covariates in the model.
#'   Higher correlation reduces effective sample size and increases required
#'   sample size.
#' @param interaction_effect_size Effect size for interaction between main
#'   exposure and other covariates. Used when testing interaction effects.
#' @param covariate_distribution Distribution type for covariates in the
#'   model. Affects power calculations for epidemiological studies.
#' @param adjust_for_confounders Whether to account for confounding variables
#'   in power calculations. Generally recommended for epidemiological studies.
#' @param show_method_comparison Compare results across multiple power
#'   calculation methods to assess robustness of sample size estimates.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$powerResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$methodDetails} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$studyDesign} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$assumptions} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivityTable} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$powerCurvePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$effectSizePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$competingRisksDetails} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sequentialDesign} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalInterpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$protocolSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$regulatoryNotes} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$technicalDetails} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$powerResults$asDF}
#'
#' \code{as.data.frame(results$powerResults)}
#'
#' @export
comprehensiveSurvivalPower <- function(
    data,
    method_category = "standard",
    calculation_type = "sample_size",
    statistical_method = "log_rank_schoenfeld",
    study_design = "simple",
    alpha = 0.05,
    power = 0.8,
    sample_size = 200,
    allocation_ratio = 1,
    hazard_ratio = 0.75,
    median_survival_control = 12,
    median_survival_treatment = 16,
    accrual_period = 24,
    follow_up_period = 36,
    dropout_rate = 0.05,
    event_rate = 0.6,
    competing_event_rate = 0.2,
    cumulative_incidence_control = 0.4,
    cumulative_incidence_treatment = 0.3,
    rmst_timepoint = 24,
    non_inferiority_margin = 1.25,
    superiority_test = FALSE,
    snp_maf = 0.2,
    genetic_model = "additive",
    number_of_looks = 1,
    spending_function = "lan_demets_obf",
    show_detailed_output = TRUE,
    show_sensitivity_analysis = FALSE,
    show_power_curves = FALSE,
    export_study_design = FALSE,
    genetic_effect_size = 1.5,
    cure_rate_control = 0,
    cure_rate_treatment = 0,
    survival_distribution = "exponential",
    accrual_distribution = "uniform",
    interim_futility_boundary = 0.2,
    binding_futility = FALSE,
    number_of_covariates = 2,
    covariate_correlation = 0,
    interaction_effect_size = 1,
    covariate_distribution = "normal",
    adjust_for_confounders = TRUE,
    show_method_comparison = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("comprehensiveSurvivalPower requires jmvcore to be installed (restart may be required)")

    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame())


    options <- comprehensiveSurvivalPowerOptions$new(
        method_category = method_category,
        calculation_type = calculation_type,
        statistical_method = statistical_method,
        study_design = study_design,
        alpha = alpha,
        power = power,
        sample_size = sample_size,
        allocation_ratio = allocation_ratio,
        hazard_ratio = hazard_ratio,
        median_survival_control = median_survival_control,
        median_survival_treatment = median_survival_treatment,
        accrual_period = accrual_period,
        follow_up_period = follow_up_period,
        dropout_rate = dropout_rate,
        event_rate = event_rate,
        competing_event_rate = competing_event_rate,
        cumulative_incidence_control = cumulative_incidence_control,
        cumulative_incidence_treatment = cumulative_incidence_treatment,
        rmst_timepoint = rmst_timepoint,
        non_inferiority_margin = non_inferiority_margin,
        superiority_test = superiority_test,
        snp_maf = snp_maf,
        genetic_model = genetic_model,
        number_of_looks = number_of_looks,
        spending_function = spending_function,
        show_detailed_output = show_detailed_output,
        show_sensitivity_analysis = show_sensitivity_analysis,
        show_power_curves = show_power_curves,
        export_study_design = export_study_design,
        genetic_effect_size = genetic_effect_size,
        cure_rate_control = cure_rate_control,
        cure_rate_treatment = cure_rate_treatment,
        survival_distribution = survival_distribution,
        accrual_distribution = accrual_distribution,
        interim_futility_boundary = interim_futility_boundary,
        binding_futility = binding_futility,
        number_of_covariates = number_of_covariates,
        covariate_correlation = covariate_correlation,
        interaction_effect_size = interaction_effect_size,
        covariate_distribution = covariate_distribution,
        adjust_for_confounders = adjust_for_confounders,
        show_method_comparison = show_method_comparison)

    analysis <- comprehensiveSurvivalPowerClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

