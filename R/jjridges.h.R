
# This file is automatically generated, you probably don't want to edit this

jjridgesOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjridgesOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            fill_var = NULL,
            facet_var = NULL,
            plot_type = "density_ridges",
            scale = 1,
            bandwidth = "nrd0",
            bandwidth_value = 1,
            binwidth = 1,
            add_boxplot = FALSE,
            add_points = FALSE,
            point_alpha = 0.3,
            add_quantiles = FALSE,
            quantiles = "0.25, 0.5, 0.75",
            add_mean = FALSE,
            add_median = FALSE,
            show_stats = FALSE,
            test_type = "parametric",
            p_adjust_method = "none",
            effsize_type = "d",
            alpha = 0.8,
            color_palette = "clinical_colorblind",
            custom_colors = "#3498db,#e74c3c,#2ecc71,#f39c12",
            gradient_low = "#0000FF",
            gradient_high = "#FF0000",
            fill_ridges = TRUE,
            reverse_order = FALSE,
            show_fill_legend = TRUE,
            show_facet_legend = TRUE,
            theme_style = "theme_ridges",
            grid_lines = FALSE,
            expand_panels = TRUE,
            legend_position = "none",
            plot_title = "",
            plot_subtitle = "",
            plot_caption = "",
            x_label = "",
            y_label = "",
            add_sample_size = FALSE,
            add_density_values = FALSE,
            custom_annotations = "",
            width = 800,
            height = 600,
            dpi = 300, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jjridges",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..fill_var <- jmvcore::OptionVariable$new(
                "fill_var",
                fill_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "ridgeline",
                    "density_ridges",
                    "density_ridges_gradient",
                    "histogram_ridges",
                    "violin_ridges",
                    "double_ridges"),
                default="density_ridges")
            private$..scale <- jmvcore::OptionNumber$new(
                "scale",
                scale,
                min=0.1,
                max=5,
                default=1)
            private$..bandwidth <- jmvcore::OptionList$new(
                "bandwidth",
                bandwidth,
                options=list(
                    "nrd0",
                    "nrd",
                    "SJ",
                    "custom"),
                default="nrd0")
            private$..bandwidth_value <- jmvcore::OptionNumber$new(
                "bandwidth_value",
                bandwidth_value,
                min=0.01,
                max=10,
                default=1)
            private$..binwidth <- jmvcore::OptionNumber$new(
                "binwidth",
                binwidth,
                min=0.1,
                default=1)
            private$..add_boxplot <- jmvcore::OptionBool$new(
                "add_boxplot",
                add_boxplot,
                default=FALSE)
            private$..add_points <- jmvcore::OptionBool$new(
                "add_points",
                add_points,
                default=FALSE)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                min=0,
                max=1,
                default=0.3)
            private$..add_quantiles <- jmvcore::OptionBool$new(
                "add_quantiles",
                add_quantiles,
                default=FALSE)
            private$..quantiles <- jmvcore::OptionString$new(
                "quantiles",
                quantiles,
                default="0.25, 0.5, 0.75")
            private$..add_mean <- jmvcore::OptionBool$new(
                "add_mean",
                add_mean,
                default=FALSE)
            private$..add_median <- jmvcore::OptionBool$new(
                "add_median",
                add_median,
                default=FALSE)
            private$..show_stats <- jmvcore::OptionBool$new(
                "show_stats",
                show_stats,
                default=FALSE)
            private$..test_type <- jmvcore::OptionList$new(
                "test_type",
                test_type,
                options=list(
                    "parametric",
                    "nonparametric",
                    "robust",
                    "bayes"),
                default="parametric")
            private$..p_adjust_method <- jmvcore::OptionList$new(
                "p_adjust_method",
                p_adjust_method,
                options=list(
                    "none",
                    "bonferroni",
                    "holm",
                    "fdr"),
                default="none")
            private$..effsize_type <- jmvcore::OptionList$new(
                "effsize_type",
                effsize_type,
                options=list(
                    "d",
                    "g",
                    "eta",
                    "omega",
                    "cliff_delta",
                    "hodges_lehmann"),
                default="d")
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                min=0,
                max=1,
                default=0.8)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "clinical_colorblind",
                    "viridis",
                    "plasma",
                    "inferno",
                    "magma",
                    "Set1",
                    "Set2",
                    "Dark2",
                    "Paired",
                    "custom"),
                default="clinical_colorblind")
            private$..custom_colors <- jmvcore::OptionString$new(
                "custom_colors",
                custom_colors,
                default="#3498db,#e74c3c,#2ecc71,#f39c12")
            private$..gradient_low <- jmvcore::OptionString$new(
                "gradient_low",
                gradient_low,
                default="#0000FF")
            private$..gradient_high <- jmvcore::OptionString$new(
                "gradient_high",
                gradient_high,
                default="#FF0000")
            private$..fill_ridges <- jmvcore::OptionBool$new(
                "fill_ridges",
                fill_ridges,
                default=TRUE)
            private$..reverse_order <- jmvcore::OptionBool$new(
                "reverse_order",
                reverse_order,
                default=FALSE)
            private$..show_fill_legend <- jmvcore::OptionBool$new(
                "show_fill_legend",
                show_fill_legend,
                default=TRUE)
            private$..show_facet_legend <- jmvcore::OptionBool$new(
                "show_facet_legend",
                show_facet_legend,
                default=TRUE)
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "theme_ridges",
                    "theme_minimal",
                    "theme_classic",
                    "theme_dark",
                    "theme_pubr"),
                default="theme_ridges")
            private$..grid_lines <- jmvcore::OptionBool$new(
                "grid_lines",
                grid_lines,
                default=FALSE)
            private$..expand_panels <- jmvcore::OptionBool$new(
                "expand_panels",
                expand_panels,
                default=TRUE)
            private$..legend_position <- jmvcore::OptionList$new(
                "legend_position",
                legend_position,
                options=list(
                    "none",
                    "right",
                    "bottom",
                    "top"),
                default="none")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..plot_subtitle <- jmvcore::OptionString$new(
                "plot_subtitle",
                plot_subtitle,
                default="")
            private$..plot_caption <- jmvcore::OptionString$new(
                "plot_caption",
                plot_caption,
                default="")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..add_sample_size <- jmvcore::OptionBool$new(
                "add_sample_size",
                add_sample_size,
                default=FALSE)
            private$..add_density_values <- jmvcore::OptionBool$new(
                "add_density_values",
                add_density_values,
                default=FALSE)
            private$..custom_annotations <- jmvcore::OptionString$new(
                "custom_annotations",
                custom_annotations,
                default="")
            private$..width <- jmvcore::OptionNumber$new(
                "width",
                width,
                min=400,
                max=1200,
                default=800)
            private$..height <- jmvcore::OptionNumber$new(
                "height",
                height,
                min=400,
                max=1200,
                default=600)
            private$..dpi <- jmvcore::OptionNumber$new(
                "dpi",
                dpi,
                min=72,
                max=600,
                default=300)

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..fill_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..scale)
            self$.addOption(private$..bandwidth)
            self$.addOption(private$..bandwidth_value)
            self$.addOption(private$..binwidth)
            self$.addOption(private$..add_boxplot)
            self$.addOption(private$..add_points)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..add_quantiles)
            self$.addOption(private$..quantiles)
            self$.addOption(private$..add_mean)
            self$.addOption(private$..add_median)
            self$.addOption(private$..show_stats)
            self$.addOption(private$..test_type)
            self$.addOption(private$..p_adjust_method)
            self$.addOption(private$..effsize_type)
            self$.addOption(private$..alpha)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..custom_colors)
            self$.addOption(private$..gradient_low)
            self$.addOption(private$..gradient_high)
            self$.addOption(private$..fill_ridges)
            self$.addOption(private$..reverse_order)
            self$.addOption(private$..show_fill_legend)
            self$.addOption(private$..show_facet_legend)
            self$.addOption(private$..theme_style)
            self$.addOption(private$..grid_lines)
            self$.addOption(private$..expand_panels)
            self$.addOption(private$..legend_position)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..plot_subtitle)
            self$.addOption(private$..plot_caption)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..add_sample_size)
            self$.addOption(private$..add_density_values)
            self$.addOption(private$..custom_annotations)
            self$.addOption(private$..width)
            self$.addOption(private$..height)
            self$.addOption(private$..dpi)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        fill_var = function() private$..fill_var$value,
        facet_var = function() private$..facet_var$value,
        plot_type = function() private$..plot_type$value,
        scale = function() private$..scale$value,
        bandwidth = function() private$..bandwidth$value,
        bandwidth_value = function() private$..bandwidth_value$value,
        binwidth = function() private$..binwidth$value,
        add_boxplot = function() private$..add_boxplot$value,
        add_points = function() private$..add_points$value,
        point_alpha = function() private$..point_alpha$value,
        add_quantiles = function() private$..add_quantiles$value,
        quantiles = function() private$..quantiles$value,
        add_mean = function() private$..add_mean$value,
        add_median = function() private$..add_median$value,
        show_stats = function() private$..show_stats$value,
        test_type = function() private$..test_type$value,
        p_adjust_method = function() private$..p_adjust_method$value,
        effsize_type = function() private$..effsize_type$value,
        alpha = function() private$..alpha$value,
        color_palette = function() private$..color_palette$value,
        custom_colors = function() private$..custom_colors$value,
        gradient_low = function() private$..gradient_low$value,
        gradient_high = function() private$..gradient_high$value,
        fill_ridges = function() private$..fill_ridges$value,
        reverse_order = function() private$..reverse_order$value,
        show_fill_legend = function() private$..show_fill_legend$value,
        show_facet_legend = function() private$..show_facet_legend$value,
        theme_style = function() private$..theme_style$value,
        grid_lines = function() private$..grid_lines$value,
        expand_panels = function() private$..expand_panels$value,
        legend_position = function() private$..legend_position$value,
        plot_title = function() private$..plot_title$value,
        plot_subtitle = function() private$..plot_subtitle$value,
        plot_caption = function() private$..plot_caption$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        add_sample_size = function() private$..add_sample_size$value,
        add_density_values = function() private$..add_density_values$value,
        custom_annotations = function() private$..custom_annotations$value,
        width = function() private$..width$value,
        height = function() private$..height$value,
        dpi = function() private$..dpi$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..fill_var = NA,
        ..facet_var = NA,
        ..plot_type = NA,
        ..scale = NA,
        ..bandwidth = NA,
        ..bandwidth_value = NA,
        ..binwidth = NA,
        ..add_boxplot = NA,
        ..add_points = NA,
        ..point_alpha = NA,
        ..add_quantiles = NA,
        ..quantiles = NA,
        ..add_mean = NA,
        ..add_median = NA,
        ..show_stats = NA,
        ..test_type = NA,
        ..p_adjust_method = NA,
        ..effsize_type = NA,
        ..alpha = NA,
        ..color_palette = NA,
        ..custom_colors = NA,
        ..gradient_low = NA,
        ..gradient_high = NA,
        ..fill_ridges = NA,
        ..reverse_order = NA,
        ..show_fill_legend = NA,
        ..show_facet_legend = NA,
        ..theme_style = NA,
        ..grid_lines = NA,
        ..expand_panels = NA,
        ..legend_position = NA,
        ..plot_title = NA,
        ..plot_subtitle = NA,
        ..plot_caption = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..add_sample_size = NA,
        ..add_density_values = NA,
        ..custom_annotations = NA,
        ..width = NA,
        ..height = NA,
        ..dpi = NA)
)

jjridgesResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjridgesResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        warnings = function() private$.items[["warnings"]],
        clinicalSummary = function() private$.items[["clinicalSummary"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        tests = function() private$.items[["tests"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Ridge Plot",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "ggridges",
                    "ggstatsplot",
                    "RGraphGallery"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=FALSE,
                clearWith=list(
                    "x_var",
                    "y_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="warnings",
                title="Data Quality Warnings",
                visible=FALSE,
                clearWith=list(
                    "x_var",
                    "y_var")))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalSummary",
                title="Clinical Summary",
                visible=FALSE,
                clearWith=list(
                    "x_var",
                    "y_var",
                    "show_stats")))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Ridge Plot",
                renderFun=".plot",
                requiresData=TRUE,
                clearWith=list(
                    "x_var",
                    "y_var",
                    "fill_var",
                    "facet_var",
                    "plot_type",
                    "scale",
                    "bandwidth",
                    "bandwidth_value",
                    "binwidth",
                    "add_boxplot",
                    "add_points",
                    "point_alpha",
                    "add_quantiles",
                    "quantiles",
                    "add_mean",
                    "add_median",
                    "alpha",
                    "color_palette",
                    "custom_colors",
                    "gradient_low",
                    "gradient_high",
                    "fill_ridges",
                    "reverse_order",
                    "theme_style",
                    "grid_lines",
                    "expand_panels",
                    "legend_position",
                    "plot_title",
                    "plot_subtitle",
                    "plot_caption",
                    "x_label",
                    "y_label")))
            self$add(jmvcore::Table$new(
                options=options,
                name="statistics",
                title="Statistical Summary",
                rows=0,
                visible=FALSE,
                columns=list(
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="sd", 
                        `title`="SD", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="median", 
                        `title`="Median", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="q1", 
                        `title`="Q1", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="q3", 
                        `title`="Q3", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="min", 
                        `title`="Min", 
                        `type`="number", 
                        `format`="zto,dp:2"),
                    list(
                        `name`="max", 
                        `title`="Max", 
                        `type`="number", 
                        `format`="zto,dp:2")),
                clearWith=list(
                    "x_var",
                    "y_var")))
            self$add(jmvcore::Table$new(
                options=options,
                name="tests",
                title="Statistical Tests",
                rows=0,
                visible=FALSE,
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number", 
                        `format`="zto,dp:3"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number", 
                        `format`="zto,dp:4,p"),
                    list(
                        `name`="p_adjusted", 
                        `title`="P-adj", 
                        `type`="number", 
                        `format`="zto,dp:4,p"),
                    list(
                        `name`="effect_size", 
                        `title`="Effect Size", 
                        `type`="number", 
                        `format`="zto,dp:3"),
                    list(
                        `name`="ci_lower", 
                        `title`="CI Lower", 
                        `type`="number", 
                        `format`="zto,dp:3"),
                    list(
                        `name`="ci_upper", 
                        `title`="CI Upper", 
                        `type`="number", 
                        `format`="zto,dp:3")),
                clearWith=list(
                    "x_var",
                    "y_var",
                    "test_type",
                    "p_adjust_method",
                    "effsize_type")))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Interpretation",
                visible=FALSE,
                clearWith=list(
                    "x_var",
                    "y_var",
                    "plot_type")))}))

jjridgesBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjridgesBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jjridges",
                version = c(0,0,31),
                options = options,
                results = jjridgesResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Ridge Plot
#'
#' 'Create advanced ridgeline plots.
#' Visualize distributions across groups with multiple style options, 
#' annotations,
#' statistical overlays, and publication-ready formatting. Supports both basic 
#' and
#' complex ridge plots with inside plots, double ridgelines, and color 
#' gradients.'
#' 
#'
#' @examples
#' \donttest{
#' # Basic ridgeline plot
#' jjridges(
#'   data = iris,
#'   x_var = "Sepal.Length",
#'   y_var = "Species"
#' )
#'
#' # Advanced with statistics
#' jjridges(
#'   data = mtcars,
#'   x_var = "mpg",
#'   y_var = "cyl",
#'   plot_type = "density_ridges_gradient",
#'   show_stats = TRUE,
#'   add_boxplot = TRUE
#' )
#'}
#' @param data The data as a data frame.
#' @param x_var The continuous variable to display as distributions (e.g.,
#'   biomarker values, age, tumor size). Each group will show the distribution
#'   pattern of this variable.
#' @param y_var The grouping variable for comparison (e.g., disease stage,
#'   treatment group, pathology grade). Each group creates a separate ridge for
#'   visual comparison.
#' @param fill_var Optional variable for color/fill mapping within ridges.
#'   Creates color-coded segments within each ridge.
#' @param facet_var Optional variable for creating separate panels. Useful for
#'   comparing ridge plots across another dimension.
#' @param plot_type Type of ridge plot. 'density_ridges' for smooth curves,
#'   'density_ridges_gradient' adds color gradients, 'histogram_ridges' for
#'   discrete bins, 'violin_ridges' for violin-style plots, 'double_ridges' for
#'   comparing two distributions.
#' @param scale Controls ridge height and overlap. Values > 1 create
#'   overlapping ridges, < 1 creates more separation between ridges.
#' @param bandwidth Bandwidth selection for density estimation. Controls
#'   smoothness of curves.
#' @param bandwidth_value Custom bandwidth value when bandwidth method is
#'   'custom'.
#' @param binwidth Width of bins for histogram-style ridges.
#' @param add_boxplot Add boxplot elements inside each ridge for enhanced
#'   visualization of quartiles and outliers.
#' @param add_points Show individual data points below ridges as jittered
#'   points.
#' @param point_alpha Transparency of data points when shown.
#' @param add_quantiles Add vertical lines at specified quantiles within each
#'   ridge.
#' @param quantiles Comma-separated quantile values to display as vertical
#'   lines.
#' @param add_mean Add vertical line at the mean of each distribution.
#' @param add_median Add vertical line at the median of each distribution.
#' @param show_stats Display statistical annotations including p-values and
#'   effect sizes using ggstatsplot functionality.
#' @param test_type Type of statistical test for group comparisons when
#'   show_stats is TRUE.
#' @param p_adjust_method Method for adjusting p-values in multiple
#'   comparisons.
#' @param effsize_type Type of effect size to calculate and display. For
#'   skewed data (like lymph node counts),  consider using nonparametric effect
#'   sizes: Cliff's Delta shows probability that one group  has higher values,
#'   Hodges-Lehmann shift shows typical difference in units.
#' @param alpha Transparency level for ridge fills.
#' @param color_palette Color palette for ridges. 'Clinical' is optimized for
#'   accessibility and medical publications. Viridis family are also
#'   colorblind-friendly.
#' @param custom_colors Comma-separated list of custom colors when palette is
#'   'custom'.
#' @param gradient_low Low value color for gradient plots.
#' @param gradient_high High value color for gradient plots.
#' @param fill_ridges Whether to fill ridges with color or show only outlines.
#' @param reverse_order Reverse the vertical order of groups.
#' @param show_fill_legend Show legend for fill variable when a fill variable
#'   is specified.
#' @param show_facet_legend Show facet labels when faceting is used.
#' @param theme_style Overall plot theme style.
#' @param grid_lines Whether to show grid lines in the plot.
#' @param expand_panels Remove space around plot area for cleaner look.
#' @param legend_position Position of color legend.
#' @param plot_title Main plot title.
#' @param plot_subtitle Plot subtitle for additional context.
#' @param plot_caption Caption for data source or notes.
#' @param x_label Custom label for X axis.
#' @param y_label Custom label for Y axis.
#' @param add_sample_size Display sample size (n) for each group.
#' @param add_density_values Display density values at peaks.
#' @param custom_annotations Custom text annotations in format
#'   'x,y,text;x2,y2,text2'.
#' @param width Width of the plot in pixels.
#' @param height Height of the plot in pixels.
#' @param dpi Resolution for plot export.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$warnings} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinicalSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$tests} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$statistics$asDF}
#'
#' \code{as.data.frame(results$statistics)}
#'
#' @export
jjridges <- function(
    data,
    x_var,
    y_var,
    fill_var = NULL,
    facet_var = NULL,
    plot_type = "density_ridges",
    scale = 1,
    bandwidth = "nrd0",
    bandwidth_value = 1,
    binwidth = 1,
    add_boxplot = FALSE,
    add_points = FALSE,
    point_alpha = 0.3,
    add_quantiles = FALSE,
    quantiles = "0.25, 0.5, 0.75",
    add_mean = FALSE,
    add_median = FALSE,
    show_stats = FALSE,
    test_type = "parametric",
    p_adjust_method = "none",
    effsize_type = "d",
    alpha = 0.8,
    color_palette = "clinical_colorblind",
    custom_colors = "#3498db,#e74c3c,#2ecc71,#f39c12",
    gradient_low = "#0000FF",
    gradient_high = "#FF0000",
    fill_ridges = TRUE,
    reverse_order = FALSE,
    show_fill_legend = TRUE,
    show_facet_legend = TRUE,
    theme_style = "theme_ridges",
    grid_lines = FALSE,
    expand_panels = TRUE,
    legend_position = "none",
    plot_title = "",
    plot_subtitle = "",
    plot_caption = "",
    x_label = "",
    y_label = "",
    add_sample_size = FALSE,
    add_density_values = FALSE,
    custom_annotations = "",
    width = 800,
    height = 600,
    dpi = 300) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jjridges requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(fill_var)) fill_var <- jmvcore::resolveQuo(jmvcore::enquo(fill_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(fill_var), fill_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))

    for (v in y_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in fill_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jjridgesOptions$new(
        x_var = x_var,
        y_var = y_var,
        fill_var = fill_var,
        facet_var = facet_var,
        plot_type = plot_type,
        scale = scale,
        bandwidth = bandwidth,
        bandwidth_value = bandwidth_value,
        binwidth = binwidth,
        add_boxplot = add_boxplot,
        add_points = add_points,
        point_alpha = point_alpha,
        add_quantiles = add_quantiles,
        quantiles = quantiles,
        add_mean = add_mean,
        add_median = add_median,
        show_stats = show_stats,
        test_type = test_type,
        p_adjust_method = p_adjust_method,
        effsize_type = effsize_type,
        alpha = alpha,
        color_palette = color_palette,
        custom_colors = custom_colors,
        gradient_low = gradient_low,
        gradient_high = gradient_high,
        fill_ridges = fill_ridges,
        reverse_order = reverse_order,
        show_fill_legend = show_fill_legend,
        show_facet_legend = show_facet_legend,
        theme_style = theme_style,
        grid_lines = grid_lines,
        expand_panels = expand_panels,
        legend_position = legend_position,
        plot_title = plot_title,
        plot_subtitle = plot_subtitle,
        plot_caption = plot_caption,
        x_label = x_label,
        y_label = y_label,
        add_sample_size = add_sample_size,
        add_density_values = add_density_values,
        custom_annotations = custom_annotations,
        width = width,
        height = height,
        dpi = dpi)

    analysis <- jjridgesClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

