
# This file is automatically generated, you probably don't want to edit this

rqaCROptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "rqaCROptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            y1 = NULL,
            y2 = NULL,
            standardise = "none",
            emLag = 1,
            emDim = 1,
            fixRR = 0.05,
            fixRAD = 0,
            fixed = "RAD",
            DLmin = 2,
            DLmax = 0,
            VLmin = 2,
            VLmax = 0,
            HLmin = 2,
            HLmax = 0,
            theiler = 0,
            norm = "euclidean",
            plotDP = FALSE,
            diagWin = 10, ...) {

            super$initialize(
                package='ClinicoPath',
                name='rqaCR',
                requiresData=TRUE,
                ...)

            private$..y1 <- jmvcore::OptionVariable$new(
                "y1",
                y1)
            private$..y2 <- jmvcore::OptionVariable$new(
                "y2",
                y2)
            private$..standardise <- jmvcore::OptionList$new(
                "standardise",
                standardise,
                options=list(
                    "none",
                    "meanSD",
                    "medianMAD",
                    "unitScale",
                    "symbolicScale"),
                default="none")
            private$..emLag <- jmvcore::OptionNumber$new(
                "emLag",
                emLag,
                default=1)
            private$..emDim <- jmvcore::OptionNumber$new(
                "emDim",
                emDim,
                default=1)
            private$..fixRR <- jmvcore::OptionNumber$new(
                "fixRR",
                fixRR,
                default=0.05)
            private$..fixRAD <- jmvcore::OptionNumber$new(
                "fixRAD",
                fixRAD,
                default=0)
            private$..fixed <- jmvcore::OptionList$new(
                "fixed",
                fixed,
                default="RAD",
                options=list(
                    "RAD",
                    "RR",
                    "NO"))
            private$..DLmin <- jmvcore::OptionNumber$new(
                "DLmin",
                DLmin,
                default=2)
            private$..DLmax <- jmvcore::OptionNumber$new(
                "DLmax",
                DLmax,
                default=0)
            private$..VLmin <- jmvcore::OptionNumber$new(
                "VLmin",
                VLmin,
                default=2)
            private$..VLmax <- jmvcore::OptionNumber$new(
                "VLmax",
                VLmax,
                default=0)
            private$..HLmin <- jmvcore::OptionNumber$new(
                "HLmin",
                HLmin,
                default=2)
            private$..HLmax <- jmvcore::OptionNumber$new(
                "HLmax",
                HLmax,
                default=0)
            private$..theiler <- jmvcore::OptionNumber$new(
                "theiler",
                theiler,
                default=0)
            private$..norm <- jmvcore::OptionList$new(
                "norm",
                norm,
                options=list(
                    "euclidean",
                    "maximum",
                    "manhattan",
                    "canberra",
                    "binary",
                    "minkowski"),
                default="euclidean")
            private$..plotDP <- jmvcore::OptionBool$new(
                "plotDP",
                plotDP,
                default=FALSE)
            private$..diagWin <- jmvcore::OptionNumber$new(
                "diagWin",
                diagWin,
                default=10)

            self$.addOption(private$..y1)
            self$.addOption(private$..y2)
            self$.addOption(private$..standardise)
            self$.addOption(private$..emLag)
            self$.addOption(private$..emDim)
            self$.addOption(private$..fixRR)
            self$.addOption(private$..fixRAD)
            self$.addOption(private$..fixed)
            self$.addOption(private$..DLmin)
            self$.addOption(private$..DLmax)
            self$.addOption(private$..VLmin)
            self$.addOption(private$..VLmax)
            self$.addOption(private$..HLmin)
            self$.addOption(private$..HLmax)
            self$.addOption(private$..theiler)
            self$.addOption(private$..norm)
            self$.addOption(private$..plotDP)
            self$.addOption(private$..diagWin)
        }),
    active = list(
        y1 = function() private$..y1$value,
        y2 = function() private$..y2$value,
        standardise = function() private$..standardise$value,
        emLag = function() private$..emLag$value,
        emDim = function() private$..emDim$value,
        fixRR = function() private$..fixRR$value,
        fixRAD = function() private$..fixRAD$value,
        fixed = function() private$..fixed$value,
        DLmin = function() private$..DLmin$value,
        DLmax = function() private$..DLmax$value,
        VLmin = function() private$..VLmin$value,
        VLmax = function() private$..VLmax$value,
        HLmin = function() private$..HLmin$value,
        HLmax = function() private$..HLmax$value,
        theiler = function() private$..theiler$value,
        norm = function() private$..norm$value,
        plotDP = function() private$..plotDP$value,
        diagWin = function() private$..diagWin$value),
    private = list(
        ..y1 = NA,
        ..y2 = NA,
        ..standardise = NA,
        ..emLag = NA,
        ..emDim = NA,
        ..fixRR = NA,
        ..fixRAD = NA,
        ..fixed = NA,
        ..DLmin = NA,
        ..DLmax = NA,
        ..VLmin = NA,
        ..VLmax = NA,
        ..HLmin = NA,
        ..HLmax = NA,
        ..theiler = NA,
        ..norm = NA,
        ..plotDP = NA,
        ..diagWin = NA)
)

rqaCRResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        tblTS = function() private$.items[["tblTS"]],
        crpplot = function() private$.items[["crpplot"]],
        tblRP = function() private$.items[["tblRP"]],
        tblCRQA = function() private$.items[["tblCRQA"]],
        DPplot = function() private$.items[["DPplot"]],
        warnings = function() private$.items[["warnings"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Cross RQA")
            self$add(jmvcore::Table$new(
                options=options,
                name="tblTS",
                title="Time series descriptives",
                rows=2,
                columns=list(
                    list(
                        `name`="var", 
                        `title`="", 
                        `type`="text"),
                    list(
                        `name`="vlevel", 
                        `title`="type", 
                        `type`="text"),
                    list(
                        `name`="N", 
                        `type`="integer", 
                        `title`="valid N"),
                    list(
                        `name`="na", 
                        `type`="integer", 
                        `title`="NA values"),
                    list(
                        `name`="transformed", 
                        `title`="transformation", 
                        `type`="text"),
                    list(
                        `name`="uni_obs", 
                        `title`="# of unique values", 
                        `type`="integer"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="crpplot",
                title="Cross Recurrence Plot",
                width=600,
                height=600,
                renderFun=".crpplot",
                clearWith=list(
                    "y1",
                    "y2",
                    "emRad",
                    "emLag",
                    "emDim",
                    "VLmin",
                    "DLmin",
                    "HLmin",
                    "VLmax",
                    "DLmax",
                    "HLmax",
                    "fixRR",
                    "fixRAD",
                    "fixed",
                    "theiler",
                    "norm",
                    "standardise")))
            self$add(jmvcore::Table$new(
                options=options,
                name="tblRP",
                title="Global CRQA measures",
                rows=1,
                clearWith=list(
                    "y1",
                    "y2",
                    "emRad",
                    "emLag",
                    "emDim",
                    "VLmin",
                    "DLmin",
                    "HLmin",
                    "VLmax",
                    "DLmax",
                    "HLmax",
                    "fixRR",
                    "fixRAD",
                    "fixed",
                    "theiler",
                    "norm",
                    "standardise"),
                columns=list(
                    list(
                        `name`="RP", 
                        `title`="# recurrences", 
                        `type`="number"),
                    list(
                        `name`="RN", 
                        `title`="Max recurrences", 
                        `type`="number"),
                    list(
                        `name`="RR", 
                        `title`="Recurrence Rate", 
                        `type`="number"),
                    list(
                        `name`="SING", 
                        `title`="Singular points", 
                        `type`="number"),
                    list(
                        `name`="DIV", 
                        `title`="Divergence", 
                        `type`="number"),
                    list(
                        `name`="REP", 
                        `title`="Repetitiveness", 
                        `type`="number"),
                    list(
                        `name`="ANI", 
                        `title`="Anisotropy", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="tblCRQA",
                title="CRQA measures based on line structures",
                rows=3,
                clearWith=list(
                    "y1",
                    "y2",
                    "emRad",
                    "emLag",
                    "emDim",
                    "VLmin",
                    "DLmin",
                    "HLmin",
                    "VLmax",
                    "DLmax",
                    "HLmax",
                    "fixRR",
                    "fixRAD",
                    "fixed",
                    "theiler",
                    "norm",
                    "standardise"),
                columns=list(
                    list(
                        `name`="LineType", 
                        `title`="Line type"),
                    list(
                        `name`="NLines", 
                        `title`="# Lines", 
                        `type`="number"),
                    list(
                        `name`="Npoints", 
                        `title`="# Points on lines", 
                        `type`="number"),
                    list(
                        `name`="Measure", 
                        `title`=""),
                    list(
                        `name`="PoL", 
                        `title`="Rate", 
                        `type`="number"),
                    list(
                        `name`="MEAN", 
                        `title`="Mean length", 
                        `type`="number"),
                    list(
                        `name`="MAX", 
                        `title`="Max length", 
                        `type`="number"),
                    list(
                        `name`="ENT", 
                        `title`="Entropy of lengths", 
                        `type`="number"),
                    list(
                        `name`="relENT", 
                        `title`="Relative entropy", 
                        `type`="number"),
                    list(
                        `name`="CoV", 
                        `title`="CoV of lengths", 
                        `type`="number"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="DPplot",
                title="Diagonal Recurrence Profile",
                width=600,
                height=600,
                visible=FALSE,
                renderFun=".DPplot",
                clearWith=list(
                    "y1",
                    "y2",
                    "emRad",
                    "emLag",
                    "emDim",
                    "VLmin",
                    "DLmin",
                    "HLmin",
                    "VLmax",
                    "DLmax",
                    "HLmax",
                    "fixRR",
                    "fixRAD",
                    "fixed",
                    "theiler",
                    "norm",
                    "plotDP",
                    "diagWin",
                    "standardise")))
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="warnings",
                title="Notes"))}))

rqaCRBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "rqaCRBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'ClinicoPath',
                name = 'rqaCR',
                version = c(1,0,0),
                options = options,
                results = rqaCRResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Cross RQA
#'
#' 
#' @param data .
#' @param y1 .
#' @param y2 .
#' @param standardise .
#' @param emLag .
#' @param emDim .
#' @param fixRR .
#' @param fixRAD .
#' @param fixed .
#' @param DLmin .
#' @param DLmax .
#' @param VLmin .
#' @param VLmax .
#' @param HLmin .
#' @param HLmax .
#' @param theiler .
#' @param norm .
#' @param plotDP .
#' @param diagWin .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$tblTS} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crpplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$tblRP} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$tblCRQA} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$DPplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$warnings} \tab \tab \tab \tab \tab a preformatted \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$tblTS$asDF}
#'
#' \code{as.data.frame(results$tblTS)}
#'
#' @export
rqaCR <- function(
    data,
    y1,
    y2,
    standardise = "none",
    emLag = 1,
    emDim = 1,
    fixRR = 0.05,
    fixRAD = 0,
    fixed = "RAD",
    DLmin = 2,
    DLmax = 0,
    VLmin = 2,
    VLmax = 0,
    HLmin = 2,
    HLmax = 0,
    theiler = 0,
    norm = "euclidean",
    plotDP = FALSE,
    diagWin = 10) {

    if ( ! requireNamespace('jmvcore'))
        stop('rqaCR requires jmvcore to be installed (restart may be required)')

    if ( ! missing(y1)) y1 <- jmvcore::resolveQuo(jmvcore::enquo(y1))
    if ( ! missing(y2)) y2 <- jmvcore::resolveQuo(jmvcore::enquo(y2))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(y1), y1, NULL),
            `if`( ! missing(y2), y2, NULL))


    options <- rqaCROptions$new(
        y1 = y1,
        y2 = y2,
        standardise = standardise,
        emLag = emLag,
        emDim = emDim,
        fixRR = fixRR,
        fixRAD = fixRAD,
        fixed = fixed,
        DLmin = DLmin,
        DLmax = DLmax,
        VLmin = VLmin,
        VLmax = VLmax,
        HLmin = HLmin,
        HLmax = HLmax,
        theiler = theiler,
        norm = norm,
        plotDP = plotDP,
        diagWin = diagWin)

    analysis <- rqaCRClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
