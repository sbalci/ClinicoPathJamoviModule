
# This file is automatically generated, you probably don't want to edit this

jjpubrOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjpubrOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            plotType = "boxplot",
            xvar = NULL,
            yvar = NULL,
            groupvar = NULL,
            facetvar = NULL,
            addStats = FALSE,
            statMethod = "auto",
            pairwiseComparisons = FALSE,
            addCorr = FALSE,
            corrMethod = "pearson",
            addSmoothLine = TRUE,
            addMarginal = FALSE,
            addDensity = FALSE,
            bins = 30,
            addMean = FALSE,
            addMedian = FALSE,
            addPoints = FALSE,
            pointAlpha = 0.6,
            addMeanSD = FALSE,
            palette = "jco",
            fillColor = "#0073C2FF",
            title = "",
            xlab = "",
            ylab = "",
            legendPosition = "right",
            theme = "pubr",
            plotWidth = 600,
            plotHeight = 500, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jjpubr",
                requiresData=TRUE,
                ...)

            private$..plotType <- jmvcore::OptionList$new(
                "plotType",
                plotType,
                options=list(
                    "boxplot",
                    "violin",
                    "scatter",
                    "histogram",
                    "density",
                    "barplot",
                    "dotplot",
                    "line",
                    "errorplot"),
                default="boxplot")
            private$..xvar <- jmvcore::OptionVariable$new(
                "xvar",
                xvar,
                suggested=list(
                    "nominal",
                    "ordinal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..yvar <- jmvcore::OptionVariable$new(
                "yvar",
                yvar,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..groupvar <- jmvcore::OptionVariable$new(
                "groupvar",
                groupvar,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..facetvar <- jmvcore::OptionVariable$new(
                "facetvar",
                facetvar,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..addStats <- jmvcore::OptionBool$new(
                "addStats",
                addStats,
                default=FALSE)
            private$..statMethod <- jmvcore::OptionList$new(
                "statMethod",
                statMethod,
                options=list(
                    "auto",
                    "t.test",
                    "wilcox.test",
                    "anova",
                    "kruskal.test"),
                default="auto")
            private$..pairwiseComparisons <- jmvcore::OptionBool$new(
                "pairwiseComparisons",
                pairwiseComparisons,
                default=FALSE)
            private$..addCorr <- jmvcore::OptionBool$new(
                "addCorr",
                addCorr,
                default=FALSE)
            private$..corrMethod <- jmvcore::OptionList$new(
                "corrMethod",
                corrMethod,
                options=list(
                    "pearson",
                    "spearman",
                    "kendall"),
                default="pearson")
            private$..addSmoothLine <- jmvcore::OptionBool$new(
                "addSmoothLine",
                addSmoothLine,
                default=TRUE)
            private$..addMarginal <- jmvcore::OptionBool$new(
                "addMarginal",
                addMarginal,
                default=FALSE)
            private$..addDensity <- jmvcore::OptionBool$new(
                "addDensity",
                addDensity,
                default=FALSE)
            private$..bins <- jmvcore::OptionInteger$new(
                "bins",
                bins,
                min=5,
                max=100,
                default=30)
            private$..addMean <- jmvcore::OptionBool$new(
                "addMean",
                addMean,
                default=FALSE)
            private$..addMedian <- jmvcore::OptionBool$new(
                "addMedian",
                addMedian,
                default=FALSE)
            private$..addPoints <- jmvcore::OptionBool$new(
                "addPoints",
                addPoints,
                default=FALSE)
            private$..pointAlpha <- jmvcore::OptionNumber$new(
                "pointAlpha",
                pointAlpha,
                min=0,
                max=1,
                default=0.6)
            private$..addMeanSD <- jmvcore::OptionBool$new(
                "addMeanSD",
                addMeanSD,
                default=FALSE)
            private$..palette <- jmvcore::OptionList$new(
                "palette",
                palette,
                options=list(
                    "jco",
                    "npg",
                    "aaas",
                    "lancet",
                    "jama",
                    "nejm",
                    "grey",
                    "default"),
                default="jco")
            private$..fillColor <- jmvcore::OptionString$new(
                "fillColor",
                fillColor,
                default="#0073C2FF")
            private$..title <- jmvcore::OptionString$new(
                "title",
                title,
                default="")
            private$..xlab <- jmvcore::OptionString$new(
                "xlab",
                xlab,
                default="")
            private$..ylab <- jmvcore::OptionString$new(
                "ylab",
                ylab,
                default="")
            private$..legendPosition <- jmvcore::OptionList$new(
                "legendPosition",
                legendPosition,
                options=list(
                    "right",
                    "left",
                    "top",
                    "bottom",
                    "none"),
                default="right")
            private$..theme <- jmvcore::OptionList$new(
                "theme",
                theme,
                options=list(
                    "pubr",
                    "classic",
                    "minimal",
                    "light",
                    "dark"),
                default="pubr")
            private$..plotWidth <- jmvcore::OptionInteger$new(
                "plotWidth",
                plotWidth,
                min=300,
                max=2000,
                default=600)
            private$..plotHeight <- jmvcore::OptionInteger$new(
                "plotHeight",
                plotHeight,
                min=300,
                max=2000,
                default=500)

            self$.addOption(private$..plotType)
            self$.addOption(private$..xvar)
            self$.addOption(private$..yvar)
            self$.addOption(private$..groupvar)
            self$.addOption(private$..facetvar)
            self$.addOption(private$..addStats)
            self$.addOption(private$..statMethod)
            self$.addOption(private$..pairwiseComparisons)
            self$.addOption(private$..addCorr)
            self$.addOption(private$..corrMethod)
            self$.addOption(private$..addSmoothLine)
            self$.addOption(private$..addMarginal)
            self$.addOption(private$..addDensity)
            self$.addOption(private$..bins)
            self$.addOption(private$..addMean)
            self$.addOption(private$..addMedian)
            self$.addOption(private$..addPoints)
            self$.addOption(private$..pointAlpha)
            self$.addOption(private$..addMeanSD)
            self$.addOption(private$..palette)
            self$.addOption(private$..fillColor)
            self$.addOption(private$..title)
            self$.addOption(private$..xlab)
            self$.addOption(private$..ylab)
            self$.addOption(private$..legendPosition)
            self$.addOption(private$..theme)
            self$.addOption(private$..plotWidth)
            self$.addOption(private$..plotHeight)
        }),
    active = list(
        plotType = function() private$..plotType$value,
        xvar = function() private$..xvar$value,
        yvar = function() private$..yvar$value,
        groupvar = function() private$..groupvar$value,
        facetvar = function() private$..facetvar$value,
        addStats = function() private$..addStats$value,
        statMethod = function() private$..statMethod$value,
        pairwiseComparisons = function() private$..pairwiseComparisons$value,
        addCorr = function() private$..addCorr$value,
        corrMethod = function() private$..corrMethod$value,
        addSmoothLine = function() private$..addSmoothLine$value,
        addMarginal = function() private$..addMarginal$value,
        addDensity = function() private$..addDensity$value,
        bins = function() private$..bins$value,
        addMean = function() private$..addMean$value,
        addMedian = function() private$..addMedian$value,
        addPoints = function() private$..addPoints$value,
        pointAlpha = function() private$..pointAlpha$value,
        addMeanSD = function() private$..addMeanSD$value,
        palette = function() private$..palette$value,
        fillColor = function() private$..fillColor$value,
        title = function() private$..title$value,
        xlab = function() private$..xlab$value,
        ylab = function() private$..ylab$value,
        legendPosition = function() private$..legendPosition$value,
        theme = function() private$..theme$value,
        plotWidth = function() private$..plotWidth$value,
        plotHeight = function() private$..plotHeight$value),
    private = list(
        ..plotType = NA,
        ..xvar = NA,
        ..yvar = NA,
        ..groupvar = NA,
        ..facetvar = NA,
        ..addStats = NA,
        ..statMethod = NA,
        ..pairwiseComparisons = NA,
        ..addCorr = NA,
        ..corrMethod = NA,
        ..addSmoothLine = NA,
        ..addMarginal = NA,
        ..addDensity = NA,
        ..bins = NA,
        ..addMean = NA,
        ..addMedian = NA,
        ..addPoints = NA,
        ..pointAlpha = NA,
        ..addMeanSD = NA,
        ..palette = NA,
        ..fillColor = NA,
        ..title = NA,
        ..xlab = NA,
        ..ylab = NA,
        ..legendPosition = NA,
        ..theme = NA,
        ..plotWidth = NA,
        ..plotHeight = NA)
)

jjpubrResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjpubrResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        correlation = function() private$.items[["correlation"]],
        descriptives = function() private$.items[["descriptives"]],
        plotInfo = function() private$.items[["plotInfo"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Publication-Ready Plots (ggpubr)",
                refs=list(
                    "ggpubr",
                    "ggplot2",
                    "ClinicoPathJamoviModule",
                    "tools"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Welcome",
                visible="(!xvar)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="ggpubr Plot",
                width=600,
                height=500,
                renderFun=".plot",
                requiresData=TRUE,
                clearWith=list(
                    "plotType",
                    "xvar",
                    "yvar",
                    "groupvar",
                    "facetvar",
                    "addStats",
                    "statMethod",
                    "pairwiseComparisons",
                    "addCorr",
                    "corrMethod",
                    "addSmoothLine",
                    "addMarginal",
                    "addDensity",
                    "bins",
                    "addMean",
                    "addMedian",
                    "addPoints",
                    "pointAlpha",
                    "addMeanSD",
                    "palette",
                    "fillColor",
                    "title",
                    "xlab",
                    "ylab",
                    "legendPosition",
                    "theme"),
                refs=list(
                    "ggpubr",
                    "ggplot2")))
            self$add(jmvcore::Table$new(
                options=options,
                name="statistics",
                title="Statistical Summary",
                visible="(addStats)",
                rows=0,
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number"),
                    list(
                        `name`="pvalue", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="significance", 
                        `title`="Significance", 
                        `type`="text")),
                clearWith=list(
                    "plotType",
                    "xvar",
                    "yvar",
                    "groupvar",
                    "statMethod",
                    "pairwiseComparisons")))
            self$add(jmvcore::Table$new(
                options=options,
                name="correlation",
                title="Correlation Statistics",
                visible="(plotType:scatter && addCorr)",
                rows=1,
                columns=list(
                    list(
                        `name`="method", 
                        `title`="Method", 
                        `type`="text"),
                    list(
                        `name`="coefficient", 
                        `title`="Correlation", 
                        `type`="number"),
                    list(
                        `name`="pvalue", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="ci_lower", 
                        `title`="CI Lower", 
                        `type`="number"),
                    list(
                        `name`="ci_upper", 
                        `title`="CI Upper", 
                        `type`="number")),
                clearWith=list(
                    "xvar",
                    "yvar",
                    "corrMethod")))
            self$add(jmvcore::Table$new(
                options=options,
                name="descriptives",
                title="Descriptive Statistics",
                visible="(plotType:boxplot || plotType:violin || plotType:histogram || plotType:density)",
                rows=0,
                columns=list(
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="mean", 
                        `title`="Mean", 
                        `type`="number"),
                    list(
                        `name`="sd", 
                        `title`="SD", 
                        `type`="number"),
                    list(
                        `name`="median", 
                        `title`="Median", 
                        `type`="number"),
                    list(
                        `name`="min", 
                        `title`="Min", 
                        `type`="number"),
                    list(
                        `name`="max", 
                        `title`="Max", 
                        `type`="number")),
                clearWith=list(
                    "xvar",
                    "yvar",
                    "groupvar")))
            self$add(jmvcore::Html$new(
                options=options,
                name="plotInfo",
                title="Plot Information"))}))

jjpubrBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jjpubrBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jjpubr",
                version = c(0,0,32),
                options = options,
                results = jjpubrResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Publication-Ready Plots (ggpubr)
#'
#' Create publication-ready plots using the ggpubr package.
#' Provides easy-to-use functions for creating customized plots with
#' statistical annotations for scientific publications.
#' 
#' Available plot types:
#' - Box plots with statistical comparisons
#' - Violin plots with distribution visualization
#' - Scatter plots with correlation analysis
#' - Histograms with density overlays
#' - Density plots for distribution analysis
#' - Bar plots for categorical data
#' 
#' Each plot type supports:
#' - Automatic statistical testing and p-value annotations
#' - Publication-ready themes
#' - Customizable color palettes
#' - Grouping and faceting options
#' 
#'
#' @examples
#' # Box plot with statistical comparison
#' jjpubr(
#'     data = mtcars,
#'     plotType = "boxplot",
#'     xvar = "cyl",
#'     yvar = "mpg",
#'     addStats = TRUE,
#'     palette = "jco"
#' )
#'
#' # Scatter plot with correlation
#' jjpubr(
#'     data = mtcars,
#'     plotType = "scatter",
#'     xvar = "wt",
#'     yvar = "mpg",
#'     addCorr = TRUE,
#'     addMarginal = TRUE
#' )
#'
#' # Histogram with density overlay
#' jjpubr(
#'     data = mtcars,
#'     plotType = "histogram",
#'     xvar = "mpg",
#'     addDensity = TRUE,
#'     fillColor = "#0073C2FF"
#' )
#'
#' @param data the data as a data frame
#' @param plotType Type of plot: boxplot, violin, scatter, histogram, density,
#'   barplot, dotplot, line, errorplot
#' @param xvar X-axis variable
#' @param yvar Y-axis variable (continuous)
#' @param groupvar Grouping variable for coloring points/boxes
#' @param facetvar Variable for faceting plots into panels
#' @param addStats Whether to add statistical comparison p-values
#' @param statMethod Method for statistical comparison
#' @param pairwiseComparisons Whether to show all pairwise comparisons
#' @param addCorr Whether to add correlation statistics
#' @param corrMethod Correlation method
#' @param addSmoothLine Whether to add smooth trend line
#' @param addMarginal Whether to add marginal histograms
#' @param addDensity Whether to add density curve overlay
#' @param bins Number of histogram bins
#' @param addMean Whether to add mean line
#' @param addMedian Whether to add median line
#' @param addPoints Whether to add jittered points
#' @param pointAlpha Alpha transparency for points
#' @param addMeanSD Whether to show mean ± SD
#' @param palette Color palette name
#' @param fillColor Fill color for single-variable plots
#' @param title Plot title
#' @param xlab X-axis label
#' @param ylab Y-axis label
#' @param legendPosition Legend position
#' @param theme Theme name
#' @param plotWidth Plot width in pixels
#' @param plotHeight Plot height in pixels
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$correlation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$descriptives} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$plotInfo} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$statistics$asDF}
#'
#' \code{as.data.frame(results$statistics)}
#'
#' @export
jjpubr <- function(
    data,
    plotType = "boxplot",
    xvar,
    yvar,
    groupvar = NULL,
    facetvar = NULL,
    addStats = FALSE,
    statMethod = "auto",
    pairwiseComparisons = FALSE,
    addCorr = FALSE,
    corrMethod = "pearson",
    addSmoothLine = TRUE,
    addMarginal = FALSE,
    addDensity = FALSE,
    bins = 30,
    addMean = FALSE,
    addMedian = FALSE,
    addPoints = FALSE,
    pointAlpha = 0.6,
    addMeanSD = FALSE,
    palette = "jco",
    fillColor = "#0073C2FF",
    title = "",
    xlab = "",
    ylab = "",
    legendPosition = "right",
    theme = "pubr",
    plotWidth = 600,
    plotHeight = 500) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jjpubr requires jmvcore to be installed (restart may be required)")

    if ( ! missing(xvar)) xvar <- jmvcore::resolveQuo(jmvcore::enquo(xvar))
    if ( ! missing(yvar)) yvar <- jmvcore::resolveQuo(jmvcore::enquo(yvar))
    if ( ! missing(groupvar)) groupvar <- jmvcore::resolveQuo(jmvcore::enquo(groupvar))
    if ( ! missing(facetvar)) facetvar <- jmvcore::resolveQuo(jmvcore::enquo(facetvar))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(xvar), xvar, NULL),
            `if`( ! missing(yvar), yvar, NULL),
            `if`( ! missing(groupvar), groupvar, NULL),
            `if`( ! missing(facetvar), facetvar, NULL))

    for (v in groupvar) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facetvar) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jjpubrOptions$new(
        plotType = plotType,
        xvar = xvar,
        yvar = yvar,
        groupvar = groupvar,
        facetvar = facetvar,
        addStats = addStats,
        statMethod = statMethod,
        pairwiseComparisons = pairwiseComparisons,
        addCorr = addCorr,
        corrMethod = corrMethod,
        addSmoothLine = addSmoothLine,
        addMarginal = addMarginal,
        addDensity = addDensity,
        bins = bins,
        addMean = addMean,
        addMedian = addMedian,
        addPoints = addPoints,
        pointAlpha = pointAlpha,
        addMeanSD = addMeanSD,
        palette = palette,
        fillColor = fillColor,
        title = title,
        xlab = xlab,
        ylab = ylab,
        legendPosition = legendPosition,
        theme = theme,
        plotWidth = plotWidth,
        plotHeight = plotHeight)

    analysis <- jjpubrClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

