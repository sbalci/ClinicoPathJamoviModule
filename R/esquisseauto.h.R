
# This file is automatically generated, you probably don't want to edit this

esquisseautoOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "esquisseautoOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            xvar = NULL,
            yvar = NULL,
            colorvar = NULL,
            fillvar = NULL,
            sizevar = NULL,
            groupvar = NULL,
            facetvar = NULL,
            autoGeom = TRUE,
            manualGeom = "auto",
            plotTheme = "minimal",
            plotTitle = "",
            plotSubtitle = "",
            plotCaption = "",
            xLabel = "",
            yLabel = "",
            legendTitle = "",
            legendPosition = "right",
            xAxisAngle = 0,
            yAxisAngle = 0,
            showCode = FALSE,
            addSmoother = FALSE,
            flipAxes = FALSE,
            showInstructions = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="esquisseauto",
                requiresData=TRUE,
                ...)

            private$..xvar <- jmvcore::OptionVariable$new(
                "xvar",
                xvar)
            private$..yvar <- jmvcore::OptionVariable$new(
                "yvar",
                yvar)
            private$..colorvar <- jmvcore::OptionVariable$new(
                "colorvar",
                colorvar)
            private$..fillvar <- jmvcore::OptionVariable$new(
                "fillvar",
                fillvar)
            private$..sizevar <- jmvcore::OptionVariable$new(
                "sizevar",
                sizevar)
            private$..groupvar <- jmvcore::OptionVariable$new(
                "groupvar",
                groupvar)
            private$..facetvar <- jmvcore::OptionVariable$new(
                "facetvar",
                facetvar)
            private$..autoGeom <- jmvcore::OptionBool$new(
                "autoGeom",
                autoGeom,
                default=TRUE)
            private$..manualGeom <- jmvcore::OptionList$new(
                "manualGeom",
                manualGeom,
                options=list(
                    "auto",
                    "point",
                    "jitter",
                    "line",
                    "bar",
                    "col",
                    "boxplot",
                    "violin",
                    "histogram",
                    "density",
                    "tile",
                    "smooth",
                    "area"),
                default="auto")
            private$..plotTheme <- jmvcore::OptionList$new(
                "plotTheme",
                plotTheme,
                options=list(
                    "minimal",
                    "classic",
                    "gray",
                    "bw",
                    "light",
                    "dark",
                    "void"),
                default="minimal")
            private$..plotTitle <- jmvcore::OptionString$new(
                "plotTitle",
                plotTitle,
                default="")
            private$..plotSubtitle <- jmvcore::OptionString$new(
                "plotSubtitle",
                plotSubtitle,
                default="")
            private$..plotCaption <- jmvcore::OptionString$new(
                "plotCaption",
                plotCaption,
                default="")
            private$..xLabel <- jmvcore::OptionString$new(
                "xLabel",
                xLabel,
                default="")
            private$..yLabel <- jmvcore::OptionString$new(
                "yLabel",
                yLabel,
                default="")
            private$..legendTitle <- jmvcore::OptionString$new(
                "legendTitle",
                legendTitle,
                default="")
            private$..legendPosition <- jmvcore::OptionList$new(
                "legendPosition",
                legendPosition,
                options=list(
                    "right",
                    "left",
                    "top",
                    "bottom",
                    "none"),
                default="right")
            private$..xAxisAngle <- jmvcore::OptionNumber$new(
                "xAxisAngle",
                xAxisAngle,
                min=0,
                max=90,
                default=0)
            private$..yAxisAngle <- jmvcore::OptionNumber$new(
                "yAxisAngle",
                yAxisAngle,
                min=0,
                max=90,
                default=0)
            private$..showCode <- jmvcore::OptionBool$new(
                "showCode",
                showCode,
                default=FALSE)
            private$..addSmoother <- jmvcore::OptionBool$new(
                "addSmoother",
                addSmoother,
                default=FALSE)
            private$..flipAxes <- jmvcore::OptionBool$new(
                "flipAxes",
                flipAxes,
                default=FALSE)
            private$..showInstructions <- jmvcore::OptionBool$new(
                "showInstructions",
                showInstructions,
                default=TRUE)

            self$.addOption(private$..xvar)
            self$.addOption(private$..yvar)
            self$.addOption(private$..colorvar)
            self$.addOption(private$..fillvar)
            self$.addOption(private$..sizevar)
            self$.addOption(private$..groupvar)
            self$.addOption(private$..facetvar)
            self$.addOption(private$..autoGeom)
            self$.addOption(private$..manualGeom)
            self$.addOption(private$..plotTheme)
            self$.addOption(private$..plotTitle)
            self$.addOption(private$..plotSubtitle)
            self$.addOption(private$..plotCaption)
            self$.addOption(private$..xLabel)
            self$.addOption(private$..yLabel)
            self$.addOption(private$..legendTitle)
            self$.addOption(private$..legendPosition)
            self$.addOption(private$..xAxisAngle)
            self$.addOption(private$..yAxisAngle)
            self$.addOption(private$..showCode)
            self$.addOption(private$..addSmoother)
            self$.addOption(private$..flipAxes)
            self$.addOption(private$..showInstructions)
        }),
    active = list(
        xvar = function() private$..xvar$value,
        yvar = function() private$..yvar$value,
        colorvar = function() private$..colorvar$value,
        fillvar = function() private$..fillvar$value,
        sizevar = function() private$..sizevar$value,
        groupvar = function() private$..groupvar$value,
        facetvar = function() private$..facetvar$value,
        autoGeom = function() private$..autoGeom$value,
        manualGeom = function() private$..manualGeom$value,
        plotTheme = function() private$..plotTheme$value,
        plotTitle = function() private$..plotTitle$value,
        plotSubtitle = function() private$..plotSubtitle$value,
        plotCaption = function() private$..plotCaption$value,
        xLabel = function() private$..xLabel$value,
        yLabel = function() private$..yLabel$value,
        legendTitle = function() private$..legendTitle$value,
        legendPosition = function() private$..legendPosition$value,
        xAxisAngle = function() private$..xAxisAngle$value,
        yAxisAngle = function() private$..yAxisAngle$value,
        showCode = function() private$..showCode$value,
        addSmoother = function() private$..addSmoother$value,
        flipAxes = function() private$..flipAxes$value,
        showInstructions = function() private$..showInstructions$value),
    private = list(
        ..xvar = NA,
        ..yvar = NA,
        ..colorvar = NA,
        ..fillvar = NA,
        ..sizevar = NA,
        ..groupvar = NA,
        ..facetvar = NA,
        ..autoGeom = NA,
        ..manualGeom = NA,
        ..plotTheme = NA,
        ..plotTitle = NA,
        ..plotSubtitle = NA,
        ..plotCaption = NA,
        ..xLabel = NA,
        ..yLabel = NA,
        ..legendTitle = NA,
        ..legendPosition = NA,
        ..xAxisAngle = NA,
        ..yAxisAngle = NA,
        ..showCode = NA,
        ..addSmoother = NA,
        ..flipAxes = NA,
        ..showInstructions = NA)
)

esquisseautoResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "esquisseautoResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        plotinfo = function() private$.items[["plotinfo"]],
        plot = function() private$.items[["plot"]],
        generatedCode = function() private$.items[["generatedCode"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Auto-Plot (esquisse)",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "esquisse",
                    "ggplot2",
                    "dplyr",
                    "jmvcore",
                    "R6",
                    "glue"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="How to Use Auto-Plot",
                visible="(showInstructions)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="plotinfo",
                title="Plot Information"))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Plot",
                renderFun=".plot",
                requiresData=TRUE,
                clearWith=list(
                    "xvar",
                    "yvar",
                    "colorvar",
                    "fillvar",
                    "sizevar",
                    "groupvar",
                    "facetvar",
                    "autoGeom",
                    "manualGeom",
                    "plotTheme",
                    "plotTitle",
                    "plotSubtitle",
                    "plotCaption",
                    "xLabel",
                    "yLabel",
                    "legendTitle",
                    "legendPosition",
                    "xAxisAngle",
                    "yAxisAngle",
                    "addSmoother",
                    "flipAxes")))
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="generatedCode",
                title="Generated R Code",
                visible="(showCode)"))}))

esquisseautoBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "esquisseautoBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "esquisseauto",
                version = c(0,0,31),
                options = options,
                results = esquisseautoResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Auto-Plot (esquisse)
#'
#' Automatically selects and generates the most appropriate plot type based on 
#' variable data types using the esquisse package. Supports 40+ plot type 
#' combinations including histograms, scatter plots, box plots, violin plots, 
#' bar charts, line plots, and more. Perfect for quick data visualization with 
#' intelligent defaults.
#'
#' @examples
#' # Auto-select plot type based on variables
#' esquisseauto(
#'     data = mtcars,
#'     xvar = "cyl",
#'     yvar = "mpg"
#' )
#'
#' # With color grouping
#' esquisseauto(
#'     data = iris,
#'     xvar = "Species",
#'     yvar = "Sepal.Length",
#'     colorvar = "Species"
#' )
#'
#' @param data The data as a data frame.
#' @param xvar Variable for x-axis. Can be continuous, discrete, or
#'   time-based.
#' @param yvar Variable for y-axis. Leave empty for univariate plots
#'   (histograms, bar charts). Can be continuous, discrete, or time-based.
#' @param colorvar Variable to use for coloring points/bars/lines. Creates
#'   grouped visualizations.
#' @param fillvar Variable to use for filling bars/areas. Different from color
#'   (outline).
#' @param sizevar Variable to use for sizing points/lines. Typically
#'   continuous variables.
#' @param groupvar Variable to use for grouping (useful for line plots to
#'   connect points).
#' @param facetvar Variable to use for creating faceted (small multiple)
#'   plots.
#' @param autoGeom Automatically select the most appropriate plot type based
#'   on variable types. Disable to manually choose from available geoms.
#' @param manualGeom Manually select plot type. Only used when Auto-Select is
#'   disabled.
#' @param plotTheme Visual theme for the plot.
#' @param plotTitle Custom title for the plot. Leave empty for automatic
#'   title.
#' @param plotSubtitle Subtitle text displayed below the title. Leave empty
#'   for no subtitle.
#' @param plotCaption Caption text displayed at bottom-right of plot (e.g.,
#'   data source, notes).
#' @param xLabel Custom label for x-axis. Leave empty to use variable name.
#' @param yLabel Custom label for y-axis. Leave empty to use variable name.
#' @param legendTitle Custom title for the legend. Leave empty to use variable
#'   name.
#' @param legendPosition Position of the legend or hide it completely.
#' @param xAxisAngle Rotation angle for x-axis labels (0-90 degrees). Useful
#'   for long labels.
#' @param yAxisAngle Rotation angle for y-axis labels (0-90 degrees).
#' @param showCode Display the R code generated by esquisse for reproducing
#'   this plot.
#' @param addSmoother Add a smoothed trend line to scatter plots.
#' @param flipAxes Swap x and y axes (useful for horizontal bar charts).
#' @param showInstructions Display helpful instructions about how to use this
#'   module.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plotinfo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$generatedCode} \tab \tab \tab \tab \tab a preformatted \cr
#' }
#'
#' @export
esquisseauto <- function(
    data,
    xvar,
    yvar,
    colorvar,
    fillvar,
    sizevar,
    groupvar,
    facetvar,
    autoGeom = TRUE,
    manualGeom = "auto",
    plotTheme = "minimal",
    plotTitle = "",
    plotSubtitle = "",
    plotCaption = "",
    xLabel = "",
    yLabel = "",
    legendTitle = "",
    legendPosition = "right",
    xAxisAngle = 0,
    yAxisAngle = 0,
    showCode = FALSE,
    addSmoother = FALSE,
    flipAxes = FALSE,
    showInstructions = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("esquisseauto requires jmvcore to be installed (restart may be required)")

    if ( ! missing(xvar)) xvar <- jmvcore::resolveQuo(jmvcore::enquo(xvar))
    if ( ! missing(yvar)) yvar <- jmvcore::resolveQuo(jmvcore::enquo(yvar))
    if ( ! missing(colorvar)) colorvar <- jmvcore::resolveQuo(jmvcore::enquo(colorvar))
    if ( ! missing(fillvar)) fillvar <- jmvcore::resolveQuo(jmvcore::enquo(fillvar))
    if ( ! missing(sizevar)) sizevar <- jmvcore::resolveQuo(jmvcore::enquo(sizevar))
    if ( ! missing(groupvar)) groupvar <- jmvcore::resolveQuo(jmvcore::enquo(groupvar))
    if ( ! missing(facetvar)) facetvar <- jmvcore::resolveQuo(jmvcore::enquo(facetvar))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(xvar), xvar, NULL),
            `if`( ! missing(yvar), yvar, NULL),
            `if`( ! missing(colorvar), colorvar, NULL),
            `if`( ! missing(fillvar), fillvar, NULL),
            `if`( ! missing(sizevar), sizevar, NULL),
            `if`( ! missing(groupvar), groupvar, NULL),
            `if`( ! missing(facetvar), facetvar, NULL))


    options <- esquisseautoOptions$new(
        xvar = xvar,
        yvar = yvar,
        colorvar = colorvar,
        fillvar = fillvar,
        sizevar = sizevar,
        groupvar = groupvar,
        facetvar = facetvar,
        autoGeom = autoGeom,
        manualGeom = manualGeom,
        plotTheme = plotTheme,
        plotTitle = plotTitle,
        plotSubtitle = plotSubtitle,
        plotCaption = plotCaption,
        xLabel = xLabel,
        yLabel = yLabel,
        legendTitle = legendTitle,
        legendPosition = legendPosition,
        xAxisAngle = xAxisAngle,
        yAxisAngle = yAxisAngle,
        showCode = showCode,
        addSmoother = addSmoother,
        flipAxes = flipAxes,
        showInstructions = showInstructions)

    analysis <- esquisseautoClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

