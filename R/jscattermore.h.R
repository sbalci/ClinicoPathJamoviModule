
# This file is automatically generated, you probably don't want to edit this

jscattermoreOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jscattermoreOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            color_var = NULL,
            size_var = NULL,
            plot_type = "ggplot2",
            point_size = 0.5,
            alpha = 0.8,
            pixels = 512,
            pointsize = 0,
            interpolate = TRUE,
            color_palette = "viridis",
            show_smooth = FALSE,
            smooth_method = "loess",
            show_density = FALSE,
            facet_var = NULL,
            log_transform_x = FALSE,
            log_transform_y = FALSE,
            x_label = "",
            y_label = "",
            plot_title = "",
            show_correlation = TRUE,
            show_performance = FALSE,
            theme_style = "default", ...) {

            super$initialize(
                package="ClinicoPath",
                name="jscattermore",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..color_var <- jmvcore::OptionVariable$new(
                "color_var",
                color_var,
                suggested=list(
                    "nominal",
                    "ordinal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..size_var <- jmvcore::OptionVariable$new(
                "size_var",
                size_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"),
                default=NULL)
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "base_r",
                    "ggplot2",
                    "ggplot2_opt"),
                default="ggplot2")
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                default=0.5,
                min=0.1,
                max=5)
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                default=0.8,
                min=0.1,
                max=1)
            private$..pixels <- jmvcore::OptionInteger$new(
                "pixels",
                pixels,
                default=512,
                min=64,
                max=2048)
            private$..pointsize <- jmvcore::OptionNumber$new(
                "pointsize",
                pointsize,
                default=0,
                min=0,
                max=10)
            private$..interpolate <- jmvcore::OptionBool$new(
                "interpolate",
                interpolate,
                default=TRUE)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "viridis",
                    "plasma",
                    "inferno",
                    "magma",
                    "cividis",
                    "rainbow",
                    "heat",
                    "terrain"),
                default="viridis")
            private$..show_smooth <- jmvcore::OptionBool$new(
                "show_smooth",
                show_smooth,
                default=FALSE)
            private$..smooth_method <- jmvcore::OptionList$new(
                "smooth_method",
                smooth_method,
                options=list(
                    "lm",
                    "loess",
                    "gam"),
                default="loess")
            private$..show_density <- jmvcore::OptionBool$new(
                "show_density",
                show_density,
                default=FALSE)
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..log_transform_x <- jmvcore::OptionBool$new(
                "log_transform_x",
                log_transform_x,
                default=FALSE)
            private$..log_transform_y <- jmvcore::OptionBool$new(
                "log_transform_y",
                log_transform_y,
                default=FALSE)
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..show_correlation <- jmvcore::OptionBool$new(
                "show_correlation",
                show_correlation,
                default=TRUE)
            private$..show_performance <- jmvcore::OptionBool$new(
                "show_performance",
                show_performance,
                default=FALSE)
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "default",
                    "minimal",
                    "classic",
                    "dark",
                    "clean"),
                default="default")

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..color_var)
            self$.addOption(private$..size_var)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..point_size)
            self$.addOption(private$..alpha)
            self$.addOption(private$..pixels)
            self$.addOption(private$..pointsize)
            self$.addOption(private$..interpolate)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..show_smooth)
            self$.addOption(private$..smooth_method)
            self$.addOption(private$..show_density)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..log_transform_x)
            self$.addOption(private$..log_transform_y)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..show_correlation)
            self$.addOption(private$..show_performance)
            self$.addOption(private$..theme_style)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        color_var = function() private$..color_var$value,
        size_var = function() private$..size_var$value,
        plot_type = function() private$..plot_type$value,
        point_size = function() private$..point_size$value,
        alpha = function() private$..alpha$value,
        pixels = function() private$..pixels$value,
        pointsize = function() private$..pointsize$value,
        interpolate = function() private$..interpolate$value,
        color_palette = function() private$..color_palette$value,
        show_smooth = function() private$..show_smooth$value,
        smooth_method = function() private$..smooth_method$value,
        show_density = function() private$..show_density$value,
        facet_var = function() private$..facet_var$value,
        log_transform_x = function() private$..log_transform_x$value,
        log_transform_y = function() private$..log_transform_y$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        plot_title = function() private$..plot_title$value,
        show_correlation = function() private$..show_correlation$value,
        show_performance = function() private$..show_performance$value,
        theme_style = function() private$..theme_style$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..color_var = NA,
        ..size_var = NA,
        ..plot_type = NA,
        ..point_size = NA,
        ..alpha = NA,
        ..pixels = NA,
        ..pointsize = NA,
        ..interpolate = NA,
        ..color_palette = NA,
        ..show_smooth = NA,
        ..smooth_method = NA,
        ..show_density = NA,
        ..facet_var = NA,
        ..log_transform_x = NA,
        ..log_transform_y = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..plot_title = NA,
        ..show_correlation = NA,
        ..show_performance = NA,
        ..theme_style = NA)
)

jscattermoreResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jscattermoreResults",
    inherit = jmvcore::Group,
    active = list(
        plot = function() private$.items[["plot"]],
        summary = function() private$.items[["summary"]],
        performance = function() private$.items[["performance"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="High-Performance Scatter Plots",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="High-Performance Scatter Plot",
                width=800,
                height=600,
                renderFun=".plot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Plot Summary & Statistics",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="performance",
                title="Performance Analysis",
                visible=FALSE))}))

jscattermoreBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jscattermoreBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jscattermore",
                version = c(0,0,3),
                options = options,
                results = jscattermoreResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' High-Performance Scatter Plots
#'
#' High-performance scatter plots using the scattermore package for plotting 
#' millions of points efficiently with advanced customization options.
#'
#' @examples
#' \donttest{
#' # Example usage:
#' library(scattermore)
#' # Fast scatter plot
#' scattermoreplot(x, y)
#' # ggplot2 integration
#' ggplot(data) + geom_scattermore(aes(x = x, y = y))
#'}
#' @param data The data as a data frame.
#' @param x_var Variable for the X-axis.
#' @param y_var Variable for the Y-axis.
#' @param color_var Variable for color mapping.
#' @param size_var Variable for size mapping.
#' @param plot_type Type of scatter plot to generate.
#' @param point_size Size of the points in the scatter plot.
#' @param alpha Transparency level of points (0 = fully transparent, 1 =
#'   opaque).
#' @param pixels Resolution of the raster graphics in pixels.
#' @param pointsize Point size for raster graphics (0 = automatic).
#' @param interpolate Whether to interpolate the raster graphics.
#' @param color_palette Color palette for continuous color mapping.
#' @param show_smooth Whether to add a smooth regression line.
#' @param smooth_method Method for smooth line fitting.
#' @param show_density Whether to overlay density contours.
#' @param facet_var Variable for creating multiple panels.
#' @param log_transform_x Whether to apply log transformation to X variable.
#' @param log_transform_y Whether to apply log transformation to Y variable.
#' @param x_label Custom label for X-axis.
#' @param y_label Custom label for Y-axis.
#' @param plot_title Title for the plot.
#' @param show_correlation Whether to display correlation coefficient.
#' @param show_performance Whether to display rendering performance
#'   information.
#' @param theme_style Visual theme for the plot.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$plot} \tab \tab \tab \tab \tab Fast scatter plot using scattermore package \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab Summary statistics and performance information \cr
#'   \code{results$performance} \tab \tab \tab \tab \tab Detailed performance metrics and comparisons \cr
#' }
#'
#' @export
jscattermore <- function(
    data,
    x_var,
    y_var,
    color_var = NULL,
    size_var = NULL,
    plot_type = "ggplot2",
    point_size = 0.5,
    alpha = 0.8,
    pixels = 512,
    pointsize = 0,
    interpolate = TRUE,
    color_palette = "viridis",
    show_smooth = FALSE,
    smooth_method = "loess",
    show_density = FALSE,
    facet_var = NULL,
    log_transform_x = FALSE,
    log_transform_y = FALSE,
    x_label = "",
    y_label = "",
    plot_title = "",
    show_correlation = TRUE,
    show_performance = FALSE,
    theme_style = "default") {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jscattermore requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(color_var)) color_var <- jmvcore::resolveQuo(jmvcore::enquo(color_var))
    if ( ! missing(size_var)) size_var <- jmvcore::resolveQuo(jmvcore::enquo(size_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(color_var), color_var, NULL),
            `if`( ! missing(size_var), size_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))

    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jscattermoreOptions$new(
        x_var = x_var,
        y_var = y_var,
        color_var = color_var,
        size_var = size_var,
        plot_type = plot_type,
        point_size = point_size,
        alpha = alpha,
        pixels = pixels,
        pointsize = pointsize,
        interpolate = interpolate,
        color_palette = color_palette,
        show_smooth = show_smooth,
        smooth_method = smooth_method,
        show_density = show_density,
        facet_var = facet_var,
        log_transform_x = log_transform_x,
        log_transform_y = log_transform_y,
        x_label = x_label,
        y_label = y_label,
        plot_title = plot_title,
        show_correlation = show_correlation,
        show_performance = show_performance,
        theme_style = theme_style)

    analysis <- jscattermoreClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

