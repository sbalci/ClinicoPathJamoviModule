
# This file is automatically generated, you probably don't want to edit this

clinicalalertsOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalalertsOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            clinicalVars = NULL,
            patientId = NULL,
            timeVar = NULL,
            alert_summary = TRUE,
            detailed_alerts = TRUE,
            clinical_recommendations = TRUE,
            patient_analysis = FALSE,
            trend_analysis = FALSE,
            use_clinical_defaults = TRUE,
            custom_thresholds = FALSE,
            include_medium_priority = TRUE,
            include_low_priority = FALSE,
            confidence_level = 0.95,
            alert_dashboard = TRUE,
            threshold_plots = FALSE,
            trend_plots = FALSE,
            interpretation_guide = TRUE,
            evidence_references = FALSE,
            quality_metrics = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="clinicalalerts",
                requiresData=TRUE,
                ...)

            private$..clinicalVars <- jmvcore::OptionVariables$new(
                "clinicalVars",
                clinicalVars,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..patientId <- jmvcore::OptionVariable$new(
                "patientId",
                patientId,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..timeVar <- jmvcore::OptionVariable$new(
                "timeVar",
                timeVar,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..alert_summary <- jmvcore::OptionBool$new(
                "alert_summary",
                alert_summary,
                default=TRUE)
            private$..detailed_alerts <- jmvcore::OptionBool$new(
                "detailed_alerts",
                detailed_alerts,
                default=TRUE)
            private$..clinical_recommendations <- jmvcore::OptionBool$new(
                "clinical_recommendations",
                clinical_recommendations,
                default=TRUE)
            private$..patient_analysis <- jmvcore::OptionBool$new(
                "patient_analysis",
                patient_analysis,
                default=FALSE)
            private$..trend_analysis <- jmvcore::OptionBool$new(
                "trend_analysis",
                trend_analysis,
                default=FALSE)
            private$..use_clinical_defaults <- jmvcore::OptionBool$new(
                "use_clinical_defaults",
                use_clinical_defaults,
                default=TRUE)
            private$..custom_thresholds <- jmvcore::OptionBool$new(
                "custom_thresholds",
                custom_thresholds,
                default=FALSE)
            private$..include_medium_priority <- jmvcore::OptionBool$new(
                "include_medium_priority",
                include_medium_priority,
                default=TRUE)
            private$..include_low_priority <- jmvcore::OptionBool$new(
                "include_low_priority",
                include_low_priority,
                default=FALSE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                min=0.5,
                max=0.99,
                default=0.95)
            private$..alert_dashboard <- jmvcore::OptionBool$new(
                "alert_dashboard",
                alert_dashboard,
                default=TRUE)
            private$..threshold_plots <- jmvcore::OptionBool$new(
                "threshold_plots",
                threshold_plots,
                default=FALSE)
            private$..trend_plots <- jmvcore::OptionBool$new(
                "trend_plots",
                trend_plots,
                default=FALSE)
            private$..interpretation_guide <- jmvcore::OptionBool$new(
                "interpretation_guide",
                interpretation_guide,
                default=TRUE)
            private$..evidence_references <- jmvcore::OptionBool$new(
                "evidence_references",
                evidence_references,
                default=FALSE)
            private$..quality_metrics <- jmvcore::OptionBool$new(
                "quality_metrics",
                quality_metrics,
                default=FALSE)

            self$.addOption(private$..clinicalVars)
            self$.addOption(private$..patientId)
            self$.addOption(private$..timeVar)
            self$.addOption(private$..alert_summary)
            self$.addOption(private$..detailed_alerts)
            self$.addOption(private$..clinical_recommendations)
            self$.addOption(private$..patient_analysis)
            self$.addOption(private$..trend_analysis)
            self$.addOption(private$..use_clinical_defaults)
            self$.addOption(private$..custom_thresholds)
            self$.addOption(private$..include_medium_priority)
            self$.addOption(private$..include_low_priority)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..alert_dashboard)
            self$.addOption(private$..threshold_plots)
            self$.addOption(private$..trend_plots)
            self$.addOption(private$..interpretation_guide)
            self$.addOption(private$..evidence_references)
            self$.addOption(private$..quality_metrics)
        }),
    active = list(
        clinicalVars = function() private$..clinicalVars$value,
        patientId = function() private$..patientId$value,
        timeVar = function() private$..timeVar$value,
        alert_summary = function() private$..alert_summary$value,
        detailed_alerts = function() private$..detailed_alerts$value,
        clinical_recommendations = function() private$..clinical_recommendations$value,
        patient_analysis = function() private$..patient_analysis$value,
        trend_analysis = function() private$..trend_analysis$value,
        use_clinical_defaults = function() private$..use_clinical_defaults$value,
        custom_thresholds = function() private$..custom_thresholds$value,
        include_medium_priority = function() private$..include_medium_priority$value,
        include_low_priority = function() private$..include_low_priority$value,
        confidence_level = function() private$..confidence_level$value,
        alert_dashboard = function() private$..alert_dashboard$value,
        threshold_plots = function() private$..threshold_plots$value,
        trend_plots = function() private$..trend_plots$value,
        interpretation_guide = function() private$..interpretation_guide$value,
        evidence_references = function() private$..evidence_references$value,
        quality_metrics = function() private$..quality_metrics$value),
    private = list(
        ..clinicalVars = NA,
        ..patientId = NA,
        ..timeVar = NA,
        ..alert_summary = NA,
        ..detailed_alerts = NA,
        ..clinical_recommendations = NA,
        ..patient_analysis = NA,
        ..trend_analysis = NA,
        ..use_clinical_defaults = NA,
        ..custom_thresholds = NA,
        ..include_medium_priority = NA,
        ..include_low_priority = NA,
        ..confidence_level = NA,
        ..alert_dashboard = NA,
        ..threshold_plots = NA,
        ..trend_plots = NA,
        ..interpretation_guide = NA,
        ..evidence_references = NA,
        ..quality_metrics = NA)
)

clinicalalertsResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalalertsResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        summary = function() private$.items[["summary"]],
        alertSummary = function() private$.items[["alertSummary"]],
        detailedAlerts = function() private$.items[["detailedAlerts"]],
        clinicalRecommendations = function() private$.items[["clinicalRecommendations"]],
        patientAnalysis = function() private$.items[["patientAnalysis"]],
        trendAnalysis = function() private$.items[["trendAnalysis"]],
        alertDashboard = function() private$.items[["alertDashboard"]],
        thresholdPlots = function() private$.items[["thresholdPlots"]],
        trendPlots = function() private$.items[["trendPlots"]],
        interpretationGuide = function() private$.items[["interpretationGuide"]],
        evidenceReferences = function() private$.items[["evidenceReferences"]],
        qualityMetrics = function() private$.items[["qualityMetrics"]],
        technicalNotes = function() private$.items[["technicalNotes"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Clinical Alert & Threshold Monitoring")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Analysis Summary",
                visible="(alert_summary || detailed_alerts)"))
            self$add(jmvcore::Table$new(
                options=options,
                name="alertSummary",
                title="Alert Summary by Priority",
                visible="(alert_summary)",
                columns=list(
                    list(
                        `name`="priority_level", 
                        `title`="Priority Level", 
                        `type`="text"),
                    list(
                        `name`="alert_count", 
                        `title`="Alert Count", 
                        `type`="integer"),
                    list(
                        `name`="percentage", 
                        `title`="Percentage", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="response_time", 
                        `title`="Required Response Time", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="detailedAlerts",
                title="Detailed Alert Analysis",
                visible="(detailed_alerts)",
                columns=list(
                    list(
                        `name`="variable", 
                        `title`="Clinical Variable", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Measured Value", 
                        `type`="number"),
                    list(
                        `name`="priority", 
                        `title`="Alert Priority", 
                        `type`="text"),
                    list(
                        `name`="threshold_type", 
                        `title`="Threshold Type", 
                        `type`="text"),
                    list(
                        `name`="patient_id", 
                        `title`="Patient ID", 
                        `type`="text"),
                    list(
                        `name`="time_point", 
                        `title`="Time Point", 
                        `type`="text"),
                    list(
                        `name`="alert_message", 
                        `title`="Alert Message", 
                        `type`="text"),
                    list(
                        `name`="clinical_action", 
                        `title`="Recommended Action", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="clinicalRecommendations",
                title="Evidence-Based Clinical Recommendations",
                visible="(clinical_recommendations)",
                columns=list(
                    list(
                        `name`="category", 
                        `title`="Category", 
                        `type`="text"),
                    list(
                        `name`="recommendation", 
                        `title`="Clinical Recommendation", 
                        `type`="text"),
                    list(
                        `name`="priority", 
                        `title`="Priority", 
                        `type`="text"),
                    list(
                        `name`="timeframe", 
                        `title`="Timeframe", 
                        `type`="text"),
                    list(
                        `name`="evidence_level", 
                        `title`="Evidence Level", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="patientAnalysis",
                title="Patient-Specific Alert Analysis",
                visible="(patient_analysis)",
                columns=list(
                    list(
                        `name`="patient_id", 
                        `title`="Patient ID", 
                        `type`="text"),
                    list(
                        `name`="total_alerts", 
                        `title`="Total Alerts", 
                        `type`="integer"),
                    list(
                        `name`="critical_alerts", 
                        `title`="Critical Alerts", 
                        `type`="integer"),
                    list(
                        `name`="high_alerts", 
                        `title`="High Priority Alerts", 
                        `type`="integer"),
                    list(
                        `name`="risk_level", 
                        `title`="Risk Level", 
                        `type`="text"),
                    list(
                        `name`="recommended_action", 
                        `title`="Recommended Action", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="trendAnalysis",
                title="Temporal Trend Analysis",
                visible="(trend_analysis)",
                columns=list(
                    list(
                        `name`="analysis_type", 
                        `title`="Analysis Type", 
                        `type`="text"),
                    list(
                        `name`="finding", 
                        `title`="Finding", 
                        `type`="text"),
                    list(
                        `name`="clinical_significance", 
                        `title`="Clinical Significance", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="alertDashboard",
                title="Clinical Alert Dashboard",
                width=600,
                height=400,
                requiresData=TRUE,
                visible="(alert_dashboard)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="thresholdPlots",
                title="Threshold Violation Plots",
                width=800,
                height=500,
                requiresData=TRUE,
                visible="(threshold_plots)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="trendPlots",
                title="Temporal Trend Plots",
                width=800,
                height=400,
                requiresData=TRUE,
                visible="(trend_plots)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretationGuide",
                title="Clinical Interpretation Guidelines",
                visible="(interpretation_guide)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="evidenceReferences",
                title="Evidence & References",
                visible="(evidence_references)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="qualityMetrics",
                title="Quality Assurance Metrics",
                visible="(quality_metrics)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="technicalNotes",
                title="Technical Notes & Methodology",
                visible=FALSE))}))

clinicalalertsBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "clinicalalertsBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "clinicalalerts",
                version = c(1,0,0),
                options = options,
                results = clinicalalertsResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = TRUE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Clinical Alert & Threshold Monitoring
#'
#' Clinical Alert and Threshold Monitoring System provides real-time 
#' monitoring 
#' of clinical parameters with customizable alert thresholds and 
#' priority-based 
#' warnings for evidence-based clinical decision support.
#' 
#'
#' @examples
#' data('histopathology', package='ClinicoPath')
#'
#' # Basic clinical alert monitoring
#' clinicalalerts(histopathology,
#'              clinicalVars = 'Age',
#'              alert_summary = TRUE,
#'              detailed_alerts = TRUE)
#'
#' @param data .
#' @param clinicalVars Clinical variables to monitor (laboratory values, vital
#'   signs, etc.)
#' @param patientId Patient identifier for patient-specific monitoring
#'   (optional)
#' @param timeVar Time variable for longitudinal monitoring (optional)
#' @param alert_summary Show summary of alerts by priority level
#' @param detailed_alerts Show detailed table of all threshold violations
#' @param clinical_recommendations Show evidence-based clinical
#'   recommendations
#' @param patient_analysis Show per-patient alert analysis (requires Patient
#'   ID)
#' @param trend_analysis Show temporal patterns in alerts (requires Time
#'   Variable)
#' @param use_clinical_defaults Use evidence-based clinical default thresholds
#' @param custom_thresholds Enable custom threshold configuration
#' @param include_medium_priority Include medium priority threshold violations
#' @param include_low_priority Include low priority threshold violations
#' @param confidence_level Confidence level for statistical calculations
#' @param alert_dashboard Create visual dashboard of alert status
#' @param threshold_plots Create plots showing threshold violations
#' @param trend_plots Create trend plots over time (requires Time Variable)
#' @param interpretation_guide Show clinical interpretation guidelines
#' @param evidence_references Show references for threshold recommendations
#' @param quality_metrics Show quality assurance and safety metrics
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$alertSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$detailedAlerts} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinicalRecommendations} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$patientAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$trendAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$alertDashboard} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$thresholdPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$trendPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$interpretationGuide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$evidenceReferences} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$qualityMetrics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$technicalNotes} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$alertSummary$asDF}
#'
#' \code{as.data.frame(results$alertSummary)}
#'
#' @export
clinicalalerts <- function(
    data,
    clinicalVars,
    patientId,
    timeVar,
    alert_summary = TRUE,
    detailed_alerts = TRUE,
    clinical_recommendations = TRUE,
    patient_analysis = FALSE,
    trend_analysis = FALSE,
    use_clinical_defaults = TRUE,
    custom_thresholds = FALSE,
    include_medium_priority = TRUE,
    include_low_priority = FALSE,
    confidence_level = 0.95,
    alert_dashboard = TRUE,
    threshold_plots = FALSE,
    trend_plots = FALSE,
    interpretation_guide = TRUE,
    evidence_references = FALSE,
    quality_metrics = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("clinicalalerts requires jmvcore to be installed (restart may be required)")

    if ( ! missing(clinicalVars)) clinicalVars <- jmvcore::resolveQuo(jmvcore::enquo(clinicalVars))
    if ( ! missing(patientId)) patientId <- jmvcore::resolveQuo(jmvcore::enquo(patientId))
    if ( ! missing(timeVar)) timeVar <- jmvcore::resolveQuo(jmvcore::enquo(timeVar))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(clinicalVars), clinicalVars, NULL),
            `if`( ! missing(patientId), patientId, NULL),
            `if`( ! missing(timeVar), timeVar, NULL))

    for (v in patientId) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- clinicalalertsOptions$new(
        clinicalVars = clinicalVars,
        patientId = patientId,
        timeVar = timeVar,
        alert_summary = alert_summary,
        detailed_alerts = detailed_alerts,
        clinical_recommendations = clinical_recommendations,
        patient_analysis = patient_analysis,
        trend_analysis = trend_analysis,
        use_clinical_defaults = use_clinical_defaults,
        custom_thresholds = custom_thresholds,
        include_medium_priority = include_medium_priority,
        include_low_priority = include_low_priority,
        confidence_level = confidence_level,
        alert_dashboard = alert_dashboard,
        threshold_plots = threshold_plots,
        trend_plots = trend_plots,
        interpretation_guide = interpretation_guide,
        evidence_references = evidence_references,
        quality_metrics = quality_metrics)

    analysis <- clinicalalertsClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

