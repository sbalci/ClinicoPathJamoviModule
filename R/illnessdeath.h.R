
# This file is automatically generated, you probably don't want to edit this

illnessdeathOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "illnessdeathOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_entry = NULL,
            time_exit = NULL,
            state_from = NULL,
            state_to = NULL,
            subject_id = NULL,
            covariates = NULL,
            model_structure = "standard",
            transition_specific = FALSE,
            baseline_hazard = "nonparametric",
            common_baseline = FALSE,
            time_varying_covariates = NULL,
            time_varying_effects = FALSE,
            interaction_terms = "",
            estimation_method = "partial",
            tie_method = "breslow",
            prediction_times = "1, 2, 5, 10",
            prediction_horizon = 10,
            transition_probabilities = TRUE,
            sojourn_times = TRUE,
            bootstrap_ci = FALSE,
            bootstrap_samples = 500,
            confidence_level = 0.95,
            goodness_of_fit = FALSE,
            residual_analysis = FALSE,
            cross_validation = FALSE,
            show_transition_summary = TRUE,
            show_hazard_ratios = TRUE,
            show_state_probabilities = TRUE,
            show_sojourn_analysis = TRUE,
            plot_transition_diagram = TRUE,
            plot_state_probabilities = TRUE,
            plot_transition_hazards = TRUE,
            plot_cumulative_incidence = FALSE,
            plot_sojourn_distributions = FALSE,
            plot_residuals = FALSE,
            left_truncation = FALSE,
            interval_censoring = FALSE,
            competing_mortality = FALSE,
            stratification_variable = NULL,
            frailty_model = FALSE,
            penalization_parameter = 0,
            random_seed = 123, ...) {

            super$initialize(
                package="ClinicoPath",
                name="illnessdeath",
                requiresData=TRUE,
                ...)

            private$..time_entry <- jmvcore::OptionVariable$new(
                "time_entry",
                time_entry,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..time_exit <- jmvcore::OptionVariable$new(
                "time_exit",
                time_exit,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..state_from <- jmvcore::OptionVariable$new(
                "state_from",
                state_from,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..state_to <- jmvcore::OptionVariable$new(
                "state_to",
                state_to,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..subject_id <- jmvcore::OptionVariable$new(
                "subject_id",
                subject_id,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..model_structure <- jmvcore::OptionList$new(
                "model_structure",
                model_structure,
                options=list(
                    "standard",
                    "reversible",
                    "progressive",
                    "competing"),
                default="standard")
            private$..transition_specific <- jmvcore::OptionBool$new(
                "transition_specific",
                transition_specific,
                default=FALSE)
            private$..baseline_hazard <- jmvcore::OptionList$new(
                "baseline_hazard",
                baseline_hazard,
                options=list(
                    "nonparametric",
                    "weibull",
                    "exponential",
                    "piecewise",
                    "spline"),
                default="nonparametric")
            private$..common_baseline <- jmvcore::OptionBool$new(
                "common_baseline",
                common_baseline,
                default=FALSE)
            private$..time_varying_covariates <- jmvcore::OptionVariables$new(
                "time_varying_covariates",
                time_varying_covariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..time_varying_effects <- jmvcore::OptionBool$new(
                "time_varying_effects",
                time_varying_effects,
                default=FALSE)
            private$..interaction_terms <- jmvcore::OptionString$new(
                "interaction_terms",
                interaction_terms,
                default="")
            private$..estimation_method <- jmvcore::OptionList$new(
                "estimation_method",
                estimation_method,
                options=list(
                    "ml",
                    "partial",
                    "bayesian",
                    "penalized"),
                default="partial")
            private$..tie_method <- jmvcore::OptionList$new(
                "tie_method",
                tie_method,
                options=list(
                    "breslow",
                    "efron",
                    "exact"),
                default="breslow")
            private$..prediction_times <- jmvcore::OptionString$new(
                "prediction_times",
                prediction_times,
                default="1, 2, 5, 10")
            private$..prediction_horizon <- jmvcore::OptionNumber$new(
                "prediction_horizon",
                prediction_horizon,
                default=10,
                min=0.1)
            private$..transition_probabilities <- jmvcore::OptionBool$new(
                "transition_probabilities",
                transition_probabilities,
                default=TRUE)
            private$..sojourn_times <- jmvcore::OptionBool$new(
                "sojourn_times",
                sojourn_times,
                default=TRUE)
            private$..bootstrap_ci <- jmvcore::OptionBool$new(
                "bootstrap_ci",
                bootstrap_ci,
                default=FALSE)
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=500,
                min=100,
                max=5000)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..goodness_of_fit <- jmvcore::OptionBool$new(
                "goodness_of_fit",
                goodness_of_fit,
                default=FALSE)
            private$..residual_analysis <- jmvcore::OptionBool$new(
                "residual_analysis",
                residual_analysis,
                default=FALSE)
            private$..cross_validation <- jmvcore::OptionBool$new(
                "cross_validation",
                cross_validation,
                default=FALSE)
            private$..show_transition_summary <- jmvcore::OptionBool$new(
                "show_transition_summary",
                show_transition_summary,
                default=TRUE)
            private$..show_hazard_ratios <- jmvcore::OptionBool$new(
                "show_hazard_ratios",
                show_hazard_ratios,
                default=TRUE)
            private$..show_state_probabilities <- jmvcore::OptionBool$new(
                "show_state_probabilities",
                show_state_probabilities,
                default=TRUE)
            private$..show_sojourn_analysis <- jmvcore::OptionBool$new(
                "show_sojourn_analysis",
                show_sojourn_analysis,
                default=TRUE)
            private$..plot_transition_diagram <- jmvcore::OptionBool$new(
                "plot_transition_diagram",
                plot_transition_diagram,
                default=TRUE)
            private$..plot_state_probabilities <- jmvcore::OptionBool$new(
                "plot_state_probabilities",
                plot_state_probabilities,
                default=TRUE)
            private$..plot_transition_hazards <- jmvcore::OptionBool$new(
                "plot_transition_hazards",
                plot_transition_hazards,
                default=TRUE)
            private$..plot_cumulative_incidence <- jmvcore::OptionBool$new(
                "plot_cumulative_incidence",
                plot_cumulative_incidence,
                default=FALSE)
            private$..plot_sojourn_distributions <- jmvcore::OptionBool$new(
                "plot_sojourn_distributions",
                plot_sojourn_distributions,
                default=FALSE)
            private$..plot_residuals <- jmvcore::OptionBool$new(
                "plot_residuals",
                plot_residuals,
                default=FALSE)
            private$..left_truncation <- jmvcore::OptionBool$new(
                "left_truncation",
                left_truncation,
                default=FALSE)
            private$..interval_censoring <- jmvcore::OptionBool$new(
                "interval_censoring",
                interval_censoring,
                default=FALSE)
            private$..competing_mortality <- jmvcore::OptionBool$new(
                "competing_mortality",
                competing_mortality,
                default=FALSE)
            private$..stratification_variable <- jmvcore::OptionVariable$new(
                "stratification_variable",
                stratification_variable,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..frailty_model <- jmvcore::OptionBool$new(
                "frailty_model",
                frailty_model,
                default=FALSE)
            private$..penalization_parameter <- jmvcore::OptionNumber$new(
                "penalization_parameter",
                penalization_parameter,
                default=0,
                min=0,
                max=10)
            private$..random_seed <- jmvcore::OptionInteger$new(
                "random_seed",
                random_seed,
                default=123,
                min=1,
                max=999999)

            self$.addOption(private$..time_entry)
            self$.addOption(private$..time_exit)
            self$.addOption(private$..state_from)
            self$.addOption(private$..state_to)
            self$.addOption(private$..subject_id)
            self$.addOption(private$..covariates)
            self$.addOption(private$..model_structure)
            self$.addOption(private$..transition_specific)
            self$.addOption(private$..baseline_hazard)
            self$.addOption(private$..common_baseline)
            self$.addOption(private$..time_varying_covariates)
            self$.addOption(private$..time_varying_effects)
            self$.addOption(private$..interaction_terms)
            self$.addOption(private$..estimation_method)
            self$.addOption(private$..tie_method)
            self$.addOption(private$..prediction_times)
            self$.addOption(private$..prediction_horizon)
            self$.addOption(private$..transition_probabilities)
            self$.addOption(private$..sojourn_times)
            self$.addOption(private$..bootstrap_ci)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..goodness_of_fit)
            self$.addOption(private$..residual_analysis)
            self$.addOption(private$..cross_validation)
            self$.addOption(private$..show_transition_summary)
            self$.addOption(private$..show_hazard_ratios)
            self$.addOption(private$..show_state_probabilities)
            self$.addOption(private$..show_sojourn_analysis)
            self$.addOption(private$..plot_transition_diagram)
            self$.addOption(private$..plot_state_probabilities)
            self$.addOption(private$..plot_transition_hazards)
            self$.addOption(private$..plot_cumulative_incidence)
            self$.addOption(private$..plot_sojourn_distributions)
            self$.addOption(private$..plot_residuals)
            self$.addOption(private$..left_truncation)
            self$.addOption(private$..interval_censoring)
            self$.addOption(private$..competing_mortality)
            self$.addOption(private$..stratification_variable)
            self$.addOption(private$..frailty_model)
            self$.addOption(private$..penalization_parameter)
            self$.addOption(private$..random_seed)
        }),
    active = list(
        time_entry = function() private$..time_entry$value,
        time_exit = function() private$..time_exit$value,
        state_from = function() private$..state_from$value,
        state_to = function() private$..state_to$value,
        subject_id = function() private$..subject_id$value,
        covariates = function() private$..covariates$value,
        model_structure = function() private$..model_structure$value,
        transition_specific = function() private$..transition_specific$value,
        baseline_hazard = function() private$..baseline_hazard$value,
        common_baseline = function() private$..common_baseline$value,
        time_varying_covariates = function() private$..time_varying_covariates$value,
        time_varying_effects = function() private$..time_varying_effects$value,
        interaction_terms = function() private$..interaction_terms$value,
        estimation_method = function() private$..estimation_method$value,
        tie_method = function() private$..tie_method$value,
        prediction_times = function() private$..prediction_times$value,
        prediction_horizon = function() private$..prediction_horizon$value,
        transition_probabilities = function() private$..transition_probabilities$value,
        sojourn_times = function() private$..sojourn_times$value,
        bootstrap_ci = function() private$..bootstrap_ci$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        confidence_level = function() private$..confidence_level$value,
        goodness_of_fit = function() private$..goodness_of_fit$value,
        residual_analysis = function() private$..residual_analysis$value,
        cross_validation = function() private$..cross_validation$value,
        show_transition_summary = function() private$..show_transition_summary$value,
        show_hazard_ratios = function() private$..show_hazard_ratios$value,
        show_state_probabilities = function() private$..show_state_probabilities$value,
        show_sojourn_analysis = function() private$..show_sojourn_analysis$value,
        plot_transition_diagram = function() private$..plot_transition_diagram$value,
        plot_state_probabilities = function() private$..plot_state_probabilities$value,
        plot_transition_hazards = function() private$..plot_transition_hazards$value,
        plot_cumulative_incidence = function() private$..plot_cumulative_incidence$value,
        plot_sojourn_distributions = function() private$..plot_sojourn_distributions$value,
        plot_residuals = function() private$..plot_residuals$value,
        left_truncation = function() private$..left_truncation$value,
        interval_censoring = function() private$..interval_censoring$value,
        competing_mortality = function() private$..competing_mortality$value,
        stratification_variable = function() private$..stratification_variable$value,
        frailty_model = function() private$..frailty_model$value,
        penalization_parameter = function() private$..penalization_parameter$value,
        random_seed = function() private$..random_seed$value),
    private = list(
        ..time_entry = NA,
        ..time_exit = NA,
        ..state_from = NA,
        ..state_to = NA,
        ..subject_id = NA,
        ..covariates = NA,
        ..model_structure = NA,
        ..transition_specific = NA,
        ..baseline_hazard = NA,
        ..common_baseline = NA,
        ..time_varying_covariates = NA,
        ..time_varying_effects = NA,
        ..interaction_terms = NA,
        ..estimation_method = NA,
        ..tie_method = NA,
        ..prediction_times = NA,
        ..prediction_horizon = NA,
        ..transition_probabilities = NA,
        ..sojourn_times = NA,
        ..bootstrap_ci = NA,
        ..bootstrap_samples = NA,
        ..confidence_level = NA,
        ..goodness_of_fit = NA,
        ..residual_analysis = NA,
        ..cross_validation = NA,
        ..show_transition_summary = NA,
        ..show_hazard_ratios = NA,
        ..show_state_probabilities = NA,
        ..show_sojourn_analysis = NA,
        ..plot_transition_diagram = NA,
        ..plot_state_probabilities = NA,
        ..plot_transition_hazards = NA,
        ..plot_cumulative_incidence = NA,
        ..plot_sojourn_distributions = NA,
        ..plot_residuals = NA,
        ..left_truncation = NA,
        ..interval_censoring = NA,
        ..competing_mortality = NA,
        ..stratification_variable = NA,
        ..frailty_model = NA,
        ..penalization_parameter = NA,
        ..random_seed = NA)
)

illnessdeathResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "illnessdeathResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        todo = function() private$.items[["todo"]],
        transitionSummary = function() private$.items[["transitionSummary"]],
        hazardRatios = function() private$.items[["hazardRatios"]],
        stateProbabilities = function() private$.items[["stateProbabilities"]],
        sojournAnalysis = function() private$.items[["sojournAnalysis"]],
        transitionMatrix = function() private$.items[["transitionMatrix"]],
        goodnessOfFit = function() private$.items[["goodnessOfFit"]],
        modelComparison = function() private$.items[["modelComparison"]],
        crossValidationResults = function() private$.items[["crossValidationResults"]],
        residualAnalysis = function() private$.items[["residualAnalysis"]],
        transitionDiagram = function() private$.items[["transitionDiagram"]],
        stateProbabilitiesPlot = function() private$.items[["stateProbabilitiesPlot"]],
        transitionHazardsPlot = function() private$.items[["transitionHazardsPlot"]],
        cumulativeIncidencePlot = function() private$.items[["cumulativeIncidencePlot"]],
        sojournDistributionsPlot = function() private$.items[["sojournDistributionsPlot"]],
        residualsPlot = function() private$.items[["residualsPlot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Analysis Results",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis Todo",
                visible=FALSE))
            self$add(jmvcore::Table$new(
                options=options,
                name="transitionSummary",
                title="Transition Summary",
                visible="(show_transition_summary)",
                clearWith=list(
                    "time_entry",
                    "time_exit",
                    "state_from",
                    "state_to",
                    "model_structure"),
                columns=list(
                    list(
                        `name`="transition", 
                        `title`="Transition", 
                        `type`="text"),
                    list(
                        `name`="n_transitions", 
                        `title`="N Transitions", 
                        `type`="integer"),
                    list(
                        `name`="n_censored", 
                        `title`="N Censored", 
                        `type`="integer"),
                    list(
                        `name`="total_time", 
                        `title`="Total Time at Risk", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="transition_rate", 
                        `title`="Rate (per unit time)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="median_time", 
                        `title`="Median Time", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hazardRatios",
                title="Transition-Specific Hazard Ratios",
                visible="(show_hazard_ratios)",
                clearWith=list(
                    "covariates",
                    "transition_specific",
                    "estimation_method"),
                columns=list(
                    list(
                        `name`="transition", 
                        `title`="Transition", 
                        `type`="text"),
                    list(
                        `name`="covariate", 
                        `title`="Covariate", 
                        `type`="text"),
                    list(
                        `name`="hazard_ratio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="significance", 
                        `title`="Significance", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="stateProbabilities",
                title="State Occupation Probabilities",
                visible="(show_state_probabilities)",
                clearWith=list(
                    "prediction_times",
                    "transition_probabilities"),
                columns=list(
                    list(
                        `name`="time_point", 
                        `title`="Time", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="initial_state", 
                        `title`="Initial State", 
                        `type`="text"),
                    list(
                        `name`="prob_healthy", 
                        `title`="P(Healthy)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="prob_ill", 
                        `title`="P(Ill)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="prob_dead", 
                        `title`="P(Dead)", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="prob_healthy_ci", 
                        `title`="Healthy CI", 
                        `type`="text"),
                    list(
                        `name`="prob_ill_ci", 
                        `title`="Ill CI", 
                        `type`="text"),
                    list(
                        `name`="prob_dead_ci", 
                        `title`="Dead CI", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sojournAnalysis",
                title="Expected Sojourn Times",
                visible="(show_sojourn_analysis)",
                clearWith=list(
                    "sojourn_times",
                    "bootstrap_ci"),
                columns=list(
                    list(
                        `name`="state", 
                        `title`="State", 
                        `type`="text"),
                    list(
                        `name`="mean_sojourn", 
                        `title`="Mean Sojourn Time", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="median_sojourn", 
                        `title`="Median Sojourn Time", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sojourn_lower_ci", 
                        `title`="Lower CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sojourn_upper_ci", 
                        `title`="Upper CI", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sojourn_variance", 
                        `title`="Variance", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="transitionMatrix",
                title="Transition Probability Matrix",
                visible="(transition_probabilities)",
                clearWith=list(
                    "prediction_times",
                    "model_structure"),
                columns=list(
                    list(
                        `name`="time_horizon", 
                        `title`="Time Horizon", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="from_state", 
                        `title`="From State", 
                        `type`="text"),
                    list(
                        `name`="to_healthy", 
                        `title`="\u2192 Healthy", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="to_ill", 
                        `title`="\u2192 Ill", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="to_dead", 
                        `title`="\u2192 Dead", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="goodnessOfFit",
                title="Goodness of Fit Tests",
                visible="(goodness_of_fit)",
                clearWith=list(
                    "goodness_of_fit",
                    "model_structure"),
                columns=list(
                    list(
                        `name`="test_type", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="degrees_freedom", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelComparison",
                title="Model Selection Criteria",
                clearWith=list(
                    "estimation_method",
                    "baseline_hazard"),
                columns=list(
                    list(
                        `name`="criterion", 
                        `title`="Criterion", 
                        `type`="text"),
                    list(
                        `name`="value", 
                        `title`="Value", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="crossValidationResults",
                title="Cross-Validation Results",
                visible="(cross_validation)",
                clearWith=list(
                    "cross_validation",
                    "prediction_times"),
                columns=list(
                    list(
                        `name`="fold", 
                        `title`="Fold", 
                        `type`="integer"),
                    list(
                        `name`="prediction_error", 
                        `title`="Prediction Error", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="log_likelihood", 
                        `title`="Log-Likelihood", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="c_index", 
                        `title`="C-Index", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="residualAnalysis",
                title="Residual Analysis",
                visible="(residual_analysis)",
                clearWith=list(
                    "residual_analysis",
                    "estimation_method"),
                columns=list(
                    list(
                        `name`="transition", 
                        `title`="Transition", 
                        `type`="text"),
                    list(
                        `name`="residual_type", 
                        `title`="Residual Type", 
                        `type`="text"),
                    list(
                        `name`="mean_residual", 
                        `title`="Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="sd_residual", 
                        `title`="SD", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="test_statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="transitionDiagram",
                title="Multi-State Transition Diagram",
                width=600,
                height=400,
                visible="(plot_transition_diagram)",
                requiresData=TRUE,
                clearWith=list(
                    "model_structure",
                    "show_hazard_ratios")))
            self$add(jmvcore::Image$new(
                options=options,
                name="stateProbabilitiesPlot",
                title="State Occupation Probabilities",
                width=600,
                height=500,
                visible="(plot_state_probabilities)",
                requiresData=TRUE,
                clearWith=list(
                    "prediction_times",
                    "transition_probabilities")))
            self$add(jmvcore::Image$new(
                options=options,
                name="transitionHazardsPlot",
                title="Transition-Specific Hazard Functions",
                width=600,
                height=500,
                visible="(plot_transition_hazards)",
                requiresData=TRUE,
                clearWith=list(
                    "baseline_hazard",
                    "covariates")))
            self$add(jmvcore::Image$new(
                options=options,
                name="cumulativeIncidencePlot",
                title="Cumulative Incidence Functions",
                width=500,
                height=400,
                visible="(plot_cumulative_incidence)",
                requiresData=TRUE,
                clearWith=list(
                    "model_structure",
                    "prediction_horizon")))
            self$add(jmvcore::Image$new(
                options=options,
                name="sojournDistributionsPlot",
                title="Sojourn Time Distributions",
                width=500,
                height=400,
                visible="(plot_sojourn_distributions)",
                requiresData=TRUE,
                clearWith=list(
                    "sojourn_times",
                    "baseline_hazard")))
            self$add(jmvcore::Image$new(
                options=options,
                name="residualsPlot",
                title="Model Diagnostic Residuals",
                width=600,
                height=500,
                visible="(plot_residuals)",
                requiresData=TRUE,
                clearWith=list(
                    "residual_analysis",
                    "estimation_method")))}))

illnessdeathBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "illnessdeathBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "illnessdeath",
                version = c(0,0,31),
                options = options,
                results = illnessdeathResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Illness-Death Multi-State Models
#'
#' Illness-death multi-state models for analyzing disease progression through 
#' three states: healthy (state 0), ill (state 1), and death (state 2). This 
#' framework models transitions between states with separate hazard functions, 
#' enabling analysis of disease onset, recovery rates, and differential 
#' mortality risks. The implementation supports both non-parametric and 
#' parametric approaches, competing risks formulation, reversible and 
#' irreversible illness states, time-dependent covariates, and comprehensive 
#' transition probability estimation. Particularly valuable for chronic 
#' disease studies, cancer progression analysis, hospital readmission studies, 
#' and any scenario involving intermediate health states with potential 
#' recovery. The model provides state occupancy probabilities, mean sojourn 
#' times, and transition-specific hazard ratios with clinical interpretation 
#' frameworks for evidence-based medicine.
#' 
#'
#' @examples
#' result <- illnessdeath(
#'     data = mydata,
#'     time_entry = "entry_time",
#'     time_exit = "exit_time",
#'     state_from = "from_state",
#'     state_to = "to_state",
#'     covariates = c("age", "treatment", "stage"),
#'     reversible_illness = FALSE
#' )
#'
#' @param data The data as a data frame.
#' @param time_entry Time of entry into the current state. For interval data,
#'   this is the start time of the observation interval.
#' @param time_exit Time of exit from the current state or censoring time.
#'   Must be greater than or equal to entry time.
#' @param state_from Starting state for each transition. Should be coded as 0
#'   = healthy, 1 = ill, 2 = death (absorbing state).
#' @param state_to Destination state for each transition. Should be coded as 0
#'   = healthy, 1 = ill, 2 = death. Use same value as from_state for censoring.
#' @param subject_id Unique identifier for each subject. Required for tracking
#'   individuals through multiple state transitions.
#' @param covariates Variables affecting transition hazards. Can be time-fixed
#'   or time-varying. Applied to all transitions unless specified otherwise.
#' @param model_structure Type of illness-death model. Standard allows 0→1,
#'   1→2, 0→2 transitions. Reversible adds 1→0. Progressive restricts to forward
#'   transitions. Competing treats illness and death as competing from healthy
#'   state.
#' @param transition_specific Allow different covariate effects for each
#'   transition type. When TRUE, provides separate hazard ratios for each
#'   transition.
#' @param baseline_hazard Specification for baseline hazard functions.
#'   Non-parametric provides flexibility, parametric options enable
#'   extrapolation and smooth estimates.
#' @param common_baseline Use same baseline hazard shape for all transitions
#'   (with different scales). Reduces parameters and increases precision when
#'   transitions are similar.
#' @param time_varying_covariates Subset of covariates that vary over time.
#'   Requires careful data structure with time-updated covariate values.
#' @param time_varying_effects Allow covariate effects to change over time
#'   using time-interaction terms or spline-based methods.
#' @param interaction_terms Specify interaction terms as comma-separated pairs
#'   (e.g., 'age:treatment, stage:age'). Interactions can be transition-specific
#'   or applied globally.
#' @param estimation_method Method for parameter estimation. Partial
#'   likelihood is standard for semi-parametric models, ML for parametric,
#'   Bayesian for uncertainty quantification, penalized for high-dimensional
#'   problems.
#' @param tie_method Method for handling tied transition times. Efron provides
#'   better approximation, exact is computationally intensive but most accurate.
#' @param prediction_times Comma-separated time points for state occupation
#'   probability predictions and transition probability matrices.
#' @param prediction_horizon Maximum time horizon for probability predictions
#'   and state occupation forecasts.
#' @param transition_probabilities Compute transition probability matrices
#'   P(s,t) giving probabilities of being in each state at time t given state at
#'   time s.
#' @param sojourn_times Calculate expected sojourn times (mean time spent) in
#'   each state before transition to another state or censoring.
#' @param bootstrap_ci Calculate bootstrap confidence intervals for transition
#'   probabilities and state occupation probabilities.
#' @param bootstrap_samples Number of bootstrap samples for confidence
#'   interval estimation. More samples provide more stable intervals but
#'   increase computation.
#' @param confidence_level Confidence level for all interval estimates
#'   including hazard ratios and transition probabilities.
#' @param goodness_of_fit Perform goodness of fit tests for multi-state model
#'   including Markov assumption testing and transition-specific model checks.
#' @param residual_analysis Calculate and analyze residuals for each
#'   transition including martingale, deviance, and Schoenfeld residuals.
#' @param cross_validation Perform cross-validation to assess prediction
#'   accuracy for state occupation probabilities.
#' @param show_transition_summary Display summary of observed transitions
#'   including counts, rates, and basic descriptive statistics.
#' @param show_hazard_ratios Display hazard ratios for each transition with
#'   confidence intervals and significance tests.
#' @param show_state_probabilities Display state occupation probabilities over
#'   time with confidence bands and clinical interpretation.
#' @param show_sojourn_analysis Display expected sojourn times in each state
#'   with bootstrap confidence intervals.
#' @param plot_transition_diagram Create visual diagram showing possible
#'   transitions between states with hazard ratios and confidence intervals.
#' @param plot_state_probabilities Plot state occupation probabilities over
#'   time showing evolution of population distribution across states.
#' @param plot_transition_hazards Plot hazard functions for each possible
#'   transition with baseline hazards and covariate effects.
#' @param plot_cumulative_incidence Plot cumulative incidence functions for
#'   each destination state starting from each initial state.
#' @param plot_sojourn_distributions Plot distributions of sojourn times in
#'   each state with empirical and model-based estimates.
#' @param plot_residuals Create residual plots for model diagnostics including
#'   transition-specific residual analysis.
#' @param left_truncation Account for left truncation when subjects enter
#'   study after disease onset or state transitions.
#' @param interval_censoring Handle interval-censored transition times when
#'   exact transition times are unknown but intervals are available.
#' @param competing_mortality Distinguish between disease-related and
#'   other-cause mortality in the death state for competing risks analysis.
#' @param stratification_variable Variable for stratified analysis allowing
#'   different baseline hazards for each stratum while maintaining same
#'   covariate effects.
#' @param frailty_model Include shared frailty term to account for unobserved
#'   heterogeneity affecting all transitions for each individual.
#' @param penalization_parameter Penalization parameter for regularized
#'   estimation with high-dimensional covariates. 0 = no penalization.
#' @param random_seed Random seed for bootstrap sampling and any stochastic
#'   procedures to ensure reproducible results.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$transitionSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hazardRatios} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$stateProbabilities} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sojournAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$transitionMatrix} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$goodnessOfFit} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$crossValidationResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$residualAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$transitionDiagram} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$stateProbabilitiesPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$transitionHazardsPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cumulativeIncidencePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$sojournDistributionsPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$residualsPlot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$transitionSummary$asDF}
#'
#' \code{as.data.frame(results$transitionSummary)}
#'
#' @export
illnessdeath <- function(
    data,
    time_entry,
    time_exit,
    state_from,
    state_to,
    subject_id,
    covariates,
    model_structure = "standard",
    transition_specific = FALSE,
    baseline_hazard = "nonparametric",
    common_baseline = FALSE,
    time_varying_covariates,
    time_varying_effects = FALSE,
    interaction_terms = "",
    estimation_method = "partial",
    tie_method = "breslow",
    prediction_times = "1, 2, 5, 10",
    prediction_horizon = 10,
    transition_probabilities = TRUE,
    sojourn_times = TRUE,
    bootstrap_ci = FALSE,
    bootstrap_samples = 500,
    confidence_level = 0.95,
    goodness_of_fit = FALSE,
    residual_analysis = FALSE,
    cross_validation = FALSE,
    show_transition_summary = TRUE,
    show_hazard_ratios = TRUE,
    show_state_probabilities = TRUE,
    show_sojourn_analysis = TRUE,
    plot_transition_diagram = TRUE,
    plot_state_probabilities = TRUE,
    plot_transition_hazards = TRUE,
    plot_cumulative_incidence = FALSE,
    plot_sojourn_distributions = FALSE,
    plot_residuals = FALSE,
    left_truncation = FALSE,
    interval_censoring = FALSE,
    competing_mortality = FALSE,
    stratification_variable,
    frailty_model = FALSE,
    penalization_parameter = 0,
    random_seed = 123) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("illnessdeath requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_entry)) time_entry <- jmvcore::resolveQuo(jmvcore::enquo(time_entry))
    if ( ! missing(time_exit)) time_exit <- jmvcore::resolveQuo(jmvcore::enquo(time_exit))
    if ( ! missing(state_from)) state_from <- jmvcore::resolveQuo(jmvcore::enquo(state_from))
    if ( ! missing(state_to)) state_to <- jmvcore::resolveQuo(jmvcore::enquo(state_to))
    if ( ! missing(subject_id)) subject_id <- jmvcore::resolveQuo(jmvcore::enquo(subject_id))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))
    if ( ! missing(time_varying_covariates)) time_varying_covariates <- jmvcore::resolveQuo(jmvcore::enquo(time_varying_covariates))
    if ( ! missing(stratification_variable)) stratification_variable <- jmvcore::resolveQuo(jmvcore::enquo(stratification_variable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_entry), time_entry, NULL),
            `if`( ! missing(time_exit), time_exit, NULL),
            `if`( ! missing(state_from), state_from, NULL),
            `if`( ! missing(state_to), state_to, NULL),
            `if`( ! missing(subject_id), subject_id, NULL),
            `if`( ! missing(covariates), covariates, NULL),
            `if`( ! missing(time_varying_covariates), time_varying_covariates, NULL),
            `if`( ! missing(stratification_variable), stratification_variable, NULL))

    for (v in stratification_variable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- illnessdeathOptions$new(
        time_entry = time_entry,
        time_exit = time_exit,
        state_from = state_from,
        state_to = state_to,
        subject_id = subject_id,
        covariates = covariates,
        model_structure = model_structure,
        transition_specific = transition_specific,
        baseline_hazard = baseline_hazard,
        common_baseline = common_baseline,
        time_varying_covariates = time_varying_covariates,
        time_varying_effects = time_varying_effects,
        interaction_terms = interaction_terms,
        estimation_method = estimation_method,
        tie_method = tie_method,
        prediction_times = prediction_times,
        prediction_horizon = prediction_horizon,
        transition_probabilities = transition_probabilities,
        sojourn_times = sojourn_times,
        bootstrap_ci = bootstrap_ci,
        bootstrap_samples = bootstrap_samples,
        confidence_level = confidence_level,
        goodness_of_fit = goodness_of_fit,
        residual_analysis = residual_analysis,
        cross_validation = cross_validation,
        show_transition_summary = show_transition_summary,
        show_hazard_ratios = show_hazard_ratios,
        show_state_probabilities = show_state_probabilities,
        show_sojourn_analysis = show_sojourn_analysis,
        plot_transition_diagram = plot_transition_diagram,
        plot_state_probabilities = plot_state_probabilities,
        plot_transition_hazards = plot_transition_hazards,
        plot_cumulative_incidence = plot_cumulative_incidence,
        plot_sojourn_distributions = plot_sojourn_distributions,
        plot_residuals = plot_residuals,
        left_truncation = left_truncation,
        interval_censoring = interval_censoring,
        competing_mortality = competing_mortality,
        stratification_variable = stratification_variable,
        frailty_model = frailty_model,
        penalization_parameter = penalization_parameter,
        random_seed = random_seed)

    analysis <- illnessdeathClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

