
# This file is automatically generated, you probably don't want to edit this

advancedraincloudOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            y_var = NULL,
            x_var = NULL,
            fill_var = NULL,
            id_var = NULL,
            cov_var = NULL,
            rain_side = "l",
            likert_mode = FALSE,
            show_longitudinal = FALSE,
            point_size = 1.5,
            point_alpha = 0.7,
            violin_alpha = 0.7,
            boxplot_width = 0.1,
            color_palette = "clinical",
            plot_title = "Advanced Raincloud Plot",
            x_label = "",
            y_label = "",
            show_statistics = TRUE,
            show_comparisons = FALSE,
            show_interpretation = TRUE,
            clinical_cutoff = NULL,
            reference_range_min = NULL,
            reference_range_max = NULL,
            show_mcid = FALSE,
            mcid_value = NULL,
            show_effect_size = FALSE,
            effect_size_type = "cohens_d",
            show_change_scores = FALSE,
            baseline_group = "",
            responder_threshold = 20,
            show_sample_size = TRUE,
            show_missing_info = FALSE,
            trial_arms = "",
            time_labels = "",
            population_type = "itt",
            log_transform = FALSE,
            outlier_method = "none",
            show_cv_bands = FALSE,
            p_value_position = "above",
            journal_style = "default",
            generate_report = FALSE,
            include_methods = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="advancedraincloud",
                requiresData=TRUE,
                ...)

            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..fill_var <- jmvcore::OptionVariable$new(
                "fill_var",
                fill_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..id_var <- jmvcore::OptionVariable$new(
                "id_var",
                id_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric",
                    "id"),
                default=NULL)
            private$..cov_var <- jmvcore::OptionVariable$new(
                "cov_var",
                cov_var,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"),
                default=NULL)
            private$..rain_side <- jmvcore::OptionList$new(
                "rain_side",
                rain_side,
                options=list(
                    "l",
                    "r",
                    "f"),
                default="l")
            private$..likert_mode <- jmvcore::OptionBool$new(
                "likert_mode",
                likert_mode,
                default=FALSE)
            private$..show_longitudinal <- jmvcore::OptionBool$new(
                "show_longitudinal",
                show_longitudinal,
                default=FALSE)
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                min=0.1,
                max=5,
                default=1.5)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                min=0,
                max=1,
                default=0.7)
            private$..violin_alpha <- jmvcore::OptionNumber$new(
                "violin_alpha",
                violin_alpha,
                min=0,
                max=1,
                default=0.7)
            private$..boxplot_width <- jmvcore::OptionNumber$new(
                "boxplot_width",
                boxplot_width,
                min=0.1,
                max=1,
                default=0.1)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "clinical",
                    "viridis",
                    "set1",
                    "set2",
                    "pastel",
                    "dark2"),
                default="clinical")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="Advanced Raincloud Plot")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..show_comparisons <- jmvcore::OptionBool$new(
                "show_comparisons",
                show_comparisons,
                default=FALSE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)
            private$..clinical_cutoff <- jmvcore::OptionNumber$new(
                "clinical_cutoff",
                clinical_cutoff)
            private$..reference_range_min <- jmvcore::OptionNumber$new(
                "reference_range_min",
                reference_range_min)
            private$..reference_range_max <- jmvcore::OptionNumber$new(
                "reference_range_max",
                reference_range_max)
            private$..show_mcid <- jmvcore::OptionBool$new(
                "show_mcid",
                show_mcid,
                default=FALSE)
            private$..mcid_value <- jmvcore::OptionNumber$new(
                "mcid_value",
                mcid_value)
            private$..show_effect_size <- jmvcore::OptionBool$new(
                "show_effect_size",
                show_effect_size,
                default=FALSE)
            private$..effect_size_type <- jmvcore::OptionList$new(
                "effect_size_type",
                effect_size_type,
                options=list(
                    "cohens_d",
                    "hedges_g",
                    "glass_delta"),
                default="cohens_d")
            private$..show_change_scores <- jmvcore::OptionBool$new(
                "show_change_scores",
                show_change_scores,
                default=FALSE)
            private$..baseline_group <- jmvcore::OptionString$new(
                "baseline_group",
                baseline_group,
                default="")
            private$..responder_threshold <- jmvcore::OptionNumber$new(
                "responder_threshold",
                responder_threshold,
                default=20)
            private$..show_sample_size <- jmvcore::OptionBool$new(
                "show_sample_size",
                show_sample_size,
                default=TRUE)
            private$..show_missing_info <- jmvcore::OptionBool$new(
                "show_missing_info",
                show_missing_info,
                default=FALSE)
            private$..trial_arms <- jmvcore::OptionString$new(
                "trial_arms",
                trial_arms,
                default="")
            private$..time_labels <- jmvcore::OptionString$new(
                "time_labels",
                time_labels,
                default="")
            private$..population_type <- jmvcore::OptionList$new(
                "population_type",
                population_type,
                options=list(
                    "itt",
                    "pp",
                    "mitt",
                    "at"),
                default="itt")
            private$..log_transform <- jmvcore::OptionBool$new(
                "log_transform",
                log_transform,
                default=FALSE)
            private$..outlier_method <- jmvcore::OptionList$new(
                "outlier_method",
                outlier_method,
                options=list(
                    "none",
                    "winsorize",
                    "trim",
                    "iqr"),
                default="none")
            private$..show_cv_bands <- jmvcore::OptionBool$new(
                "show_cv_bands",
                show_cv_bands,
                default=FALSE)
            private$..p_value_position <- jmvcore::OptionList$new(
                "p_value_position",
                p_value_position,
                options=list(
                    "above",
                    "legend",
                    "table",
                    "none"),
                default="above")
            private$..journal_style <- jmvcore::OptionList$new(
                "journal_style",
                journal_style,
                options=list(
                    "default",
                    "nature",
                    "nejm",
                    "lancet",
                    "jama"),
                default="default")
            private$..generate_report <- jmvcore::OptionBool$new(
                "generate_report",
                generate_report,
                default=FALSE)
            private$..include_methods <- jmvcore::OptionBool$new(
                "include_methods",
                include_methods,
                default=FALSE)

            self$.addOption(private$..y_var)
            self$.addOption(private$..x_var)
            self$.addOption(private$..fill_var)
            self$.addOption(private$..id_var)
            self$.addOption(private$..cov_var)
            self$.addOption(private$..rain_side)
            self$.addOption(private$..likert_mode)
            self$.addOption(private$..show_longitudinal)
            self$.addOption(private$..point_size)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..violin_alpha)
            self$.addOption(private$..boxplot_width)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..show_comparisons)
            self$.addOption(private$..show_interpretation)
            self$.addOption(private$..clinical_cutoff)
            self$.addOption(private$..reference_range_min)
            self$.addOption(private$..reference_range_max)
            self$.addOption(private$..show_mcid)
            self$.addOption(private$..mcid_value)
            self$.addOption(private$..show_effect_size)
            self$.addOption(private$..effect_size_type)
            self$.addOption(private$..show_change_scores)
            self$.addOption(private$..baseline_group)
            self$.addOption(private$..responder_threshold)
            self$.addOption(private$..show_sample_size)
            self$.addOption(private$..show_missing_info)
            self$.addOption(private$..trial_arms)
            self$.addOption(private$..time_labels)
            self$.addOption(private$..population_type)
            self$.addOption(private$..log_transform)
            self$.addOption(private$..outlier_method)
            self$.addOption(private$..show_cv_bands)
            self$.addOption(private$..p_value_position)
            self$.addOption(private$..journal_style)
            self$.addOption(private$..generate_report)
            self$.addOption(private$..include_methods)
        }),
    active = list(
        y_var = function() private$..y_var$value,
        x_var = function() private$..x_var$value,
        fill_var = function() private$..fill_var$value,
        id_var = function() private$..id_var$value,
        cov_var = function() private$..cov_var$value,
        rain_side = function() private$..rain_side$value,
        likert_mode = function() private$..likert_mode$value,
        show_longitudinal = function() private$..show_longitudinal$value,
        point_size = function() private$..point_size$value,
        point_alpha = function() private$..point_alpha$value,
        violin_alpha = function() private$..violin_alpha$value,
        boxplot_width = function() private$..boxplot_width$value,
        color_palette = function() private$..color_palette$value,
        plot_title = function() private$..plot_title$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        show_statistics = function() private$..show_statistics$value,
        show_comparisons = function() private$..show_comparisons$value,
        show_interpretation = function() private$..show_interpretation$value,
        clinical_cutoff = function() private$..clinical_cutoff$value,
        reference_range_min = function() private$..reference_range_min$value,
        reference_range_max = function() private$..reference_range_max$value,
        show_mcid = function() private$..show_mcid$value,
        mcid_value = function() private$..mcid_value$value,
        show_effect_size = function() private$..show_effect_size$value,
        effect_size_type = function() private$..effect_size_type$value,
        show_change_scores = function() private$..show_change_scores$value,
        baseline_group = function() private$..baseline_group$value,
        responder_threshold = function() private$..responder_threshold$value,
        show_sample_size = function() private$..show_sample_size$value,
        show_missing_info = function() private$..show_missing_info$value,
        trial_arms = function() private$..trial_arms$value,
        time_labels = function() private$..time_labels$value,
        population_type = function() private$..population_type$value,
        log_transform = function() private$..log_transform$value,
        outlier_method = function() private$..outlier_method$value,
        show_cv_bands = function() private$..show_cv_bands$value,
        p_value_position = function() private$..p_value_position$value,
        journal_style = function() private$..journal_style$value,
        generate_report = function() private$..generate_report$value,
        include_methods = function() private$..include_methods$value),
    private = list(
        ..y_var = NA,
        ..x_var = NA,
        ..fill_var = NA,
        ..id_var = NA,
        ..cov_var = NA,
        ..rain_side = NA,
        ..likert_mode = NA,
        ..show_longitudinal = NA,
        ..point_size = NA,
        ..point_alpha = NA,
        ..violin_alpha = NA,
        ..boxplot_width = NA,
        ..color_palette = NA,
        ..plot_title = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..show_statistics = NA,
        ..show_comparisons = NA,
        ..show_interpretation = NA,
        ..clinical_cutoff = NA,
        ..reference_range_min = NA,
        ..reference_range_max = NA,
        ..show_mcid = NA,
        ..mcid_value = NA,
        ..show_effect_size = NA,
        ..effect_size_type = NA,
        ..show_change_scores = NA,
        ..baseline_group = NA,
        ..responder_threshold = NA,
        ..show_sample_size = NA,
        ..show_missing_info = NA,
        ..trial_arms = NA,
        ..time_labels = NA,
        ..population_type = NA,
        ..log_transform = NA,
        ..outlier_method = NA,
        ..show_cv_bands = NA,
        ..p_value_position = NA,
        ..journal_style = NA,
        ..generate_report = NA,
        ..include_methods = NA)
)

advancedraincloudResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        comparisons = function() private$.items[["comparisons"]],
        interpretation = function() private$.items[["interpretation"]],
        effect_sizes = function() private$.items[["effect_sizes"]],
        change_analysis = function() private$.items[["change_analysis"]],
        clinical_report = function() private$.items[["clinical_report"]],
        methods_text = function() private$.items[["methods_text"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Advanced Raincloud Plot")
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=FALSE))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Advanced Raincloud Plot",
                width=800,
                height=600,
                renderFun=".plot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistics",
                title="Summary Statistics",
                visible="(show_statistics)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="comparisons",
                title="Group Comparisons",
                visible="(show_comparisons)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Feature Guide",
                visible="(show_interpretation)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="effect_sizes",
                title="Effect Size Analysis",
                visible="(show_effect_size)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="change_analysis",
                title="Change Score Analysis",
                visible="(show_change_scores)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinical_report",
                title="Clinical Analysis Report",
                visible="(generate_report)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methods_text",
                title="Methods Section",
                visible="(include_methods)"))}))

advancedraincloudBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "advancedraincloudBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "advancedraincloud",
                version = c(0,0,3),
                options = options,
                results = advancedraincloudResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Advanced Raincloud Plot
#'
#' Creates advanced raincloud plots with longitudinal connections using ggrain 
#' package.
#' This module complements the existing Raincloud Plot module by providing 
#' advanced 
#' features including longitudinal data connections, Likert scale support, and 
#' flexible
#' raincloud positioning. Perfect for repeated measures data, survey analysis, 
#' and 
#' complex distribution visualization in clinical research. Uses the ggrain 
#' package
#' for enhanced customization and connectivity features.
#' 
#'
#' @examples
#' \donttest{
#' # Example:
#' # 1. Select continuous variable for distribution analysis.
#' # 2. Choose grouping variable for comparisons.
#' # 3. Optionally add longitudinal ID variable for connections.
#' # 4. Configure advanced raincloud features and positioning.
#'}
#' @param data The data as a data frame.
#' @param y_var Continuous variable for distribution visualization on Y-axis.
#' @param x_var Grouping variable for X-axis categories.
#' @param fill_var Optional variable for color filling different groups.
#' @param id_var Optional ID variable for connecting longitudinal observations
#'   across groups.
#' @param cov_var Optional variable for remapping point colors based on
#'   covariate values.
#' @param rain_side Position of the raincloud relative to the data points.
#' @param likert_mode If TRUE, adds Y-axis jittering for Likert scale or
#'   ordinal data.
#' @param show_longitudinal If TRUE, connects repeated observations using the
#'   ID variable.
#' @param point_size Size of individual data points.
#' @param point_alpha Transparency level for data points.
#' @param violin_alpha Transparency level for violin plots.
#' @param boxplot_width Width of the boxplot component.
#' @param color_palette Color palette for different groups.
#' @param plot_title Title for the raincloud plot.
#' @param x_label Custom label for X-axis. If empty, uses variable name.
#' @param y_label Custom label for Y-axis. If empty, uses variable name.
#' @param show_statistics If TRUE, displays summary statistics table.
#' @param show_comparisons If TRUE, performs statistical tests between groups.
#' @param show_interpretation If TRUE, displays interpretation and feature
#'   guide.
#' @param clinical_cutoff Add horizontal line for clinical threshold or
#'   decision boundary.
#' @param reference_range_min Lower bound of normal reference range (shaded
#'   area).
#' @param reference_range_max Upper bound of normal reference range (shaded
#'   area).
#' @param show_mcid Display Minimal Clinically Important Difference band.
#' @param mcid_value Size of the Minimal Clinically Important Difference.
#' @param show_effect_size Show effect size calculations between groups.
#' @param effect_size_type Method for calculating effect size.
#' @param show_change_scores Display change from baseline analysis for
#'   longitudinal data.
#' @param baseline_group Name or level of the baseline/reference group.
#' @param responder_threshold Percentage change threshold for responder
#'   classification.
#' @param show_sample_size Show sample size (N) for each group on the plot.
#' @param show_missing_info Display information about missing data and
#'   exclusions.
#' @param trial_arms Custom labels for treatment arms (comma-separated).
#' @param time_labels Custom labels for time points (comma-separated).
#' @param population_type Type of analysis population for clinical trials.
#' @param log_transform Apply log transformation to Y-axis values.
#' @param outlier_method Method for handling outliers in the data.
#' @param show_cv_bands Display coefficient of variation bands for assay
#'   variability.
#' @param p_value_position Where to display p-values from group comparisons.
#' @param journal_style Apply journal-specific formatting guidelines.
#' @param generate_report Generate comprehensive clinical analysis report.
#' @param include_methods Include methods section text for publications.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$comparisons} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$effect_sizes} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$change_analysis} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinical_report} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methods_text} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
advancedraincloud <- function(
    data,
    y_var,
    x_var,
    fill_var = NULL,
    id_var = NULL,
    cov_var = NULL,
    rain_side = "l",
    likert_mode = FALSE,
    show_longitudinal = FALSE,
    point_size = 1.5,
    point_alpha = 0.7,
    violin_alpha = 0.7,
    boxplot_width = 0.1,
    color_palette = "clinical",
    plot_title = "Advanced Raincloud Plot",
    x_label = "",
    y_label = "",
    show_statistics = TRUE,
    show_comparisons = FALSE,
    show_interpretation = TRUE,
    clinical_cutoff,
    reference_range_min,
    reference_range_max,
    show_mcid = FALSE,
    mcid_value,
    show_effect_size = FALSE,
    effect_size_type = "cohens_d",
    show_change_scores = FALSE,
    baseline_group = "",
    responder_threshold = 20,
    show_sample_size = TRUE,
    show_missing_info = FALSE,
    trial_arms = "",
    time_labels = "",
    population_type = "itt",
    log_transform = FALSE,
    outlier_method = "none",
    show_cv_bands = FALSE,
    p_value_position = "above",
    journal_style = "default",
    generate_report = FALSE,
    include_methods = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("advancedraincloud requires jmvcore to be installed (restart may be required)")

    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(fill_var)) fill_var <- jmvcore::resolveQuo(jmvcore::enquo(fill_var))
    if ( ! missing(id_var)) id_var <- jmvcore::resolveQuo(jmvcore::enquo(id_var))
    if ( ! missing(cov_var)) cov_var <- jmvcore::resolveQuo(jmvcore::enquo(cov_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(fill_var), fill_var, NULL),
            `if`( ! missing(id_var), id_var, NULL),
            `if`( ! missing(cov_var), cov_var, NULL))


    options <- advancedraincloudOptions$new(
        y_var = y_var,
        x_var = x_var,
        fill_var = fill_var,
        id_var = id_var,
        cov_var = cov_var,
        rain_side = rain_side,
        likert_mode = likert_mode,
        show_longitudinal = show_longitudinal,
        point_size = point_size,
        point_alpha = point_alpha,
        violin_alpha = violin_alpha,
        boxplot_width = boxplot_width,
        color_palette = color_palette,
        plot_title = plot_title,
        x_label = x_label,
        y_label = y_label,
        show_statistics = show_statistics,
        show_comparisons = show_comparisons,
        show_interpretation = show_interpretation,
        clinical_cutoff = clinical_cutoff,
        reference_range_min = reference_range_min,
        reference_range_max = reference_range_max,
        show_mcid = show_mcid,
        mcid_value = mcid_value,
        show_effect_size = show_effect_size,
        effect_size_type = effect_size_type,
        show_change_scores = show_change_scores,
        baseline_group = baseline_group,
        responder_threshold = responder_threshold,
        show_sample_size = show_sample_size,
        show_missing_info = show_missing_info,
        trial_arms = trial_arms,
        time_labels = time_labels,
        population_type = population_type,
        log_transform = log_transform,
        outlier_method = outlier_method,
        show_cv_bands = show_cv_bands,
        p_value_position = p_value_position,
        journal_style = journal_style,
        generate_report = generate_report,
        include_methods = include_methods)

    analysis <- advancedraincloudClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

