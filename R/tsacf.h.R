
# This file is automatically generated, you probably don't want to edit this

tsACFOptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "tsACFOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            dv1 = NULL,
            dv2 = NULL,
            maxLAG = 20,
            doTest = TRUE,
            siglevel = 0.05,
            hypothesis = "both",
            rtLAG1 = 1,
            rtLAG2 = 1, ...) {

            super$initialize(
                package='ClinicoPath',
                name='tsACF',
                requiresData=TRUE,
                ...)

            private$..dv1 <- jmvcore::OptionVariable$new(
                "dv1",
                dv1)
            private$..dv2 <- jmvcore::OptionVariable$new(
                "dv2",
                dv2)
            private$..maxLAG <- jmvcore::OptionNumber$new(
                "maxLAG",
                maxLAG,
                default=20)
            private$..doTest <- jmvcore::OptionBool$new(
                "doTest",
                doTest,
                default=TRUE)
            private$..siglevel <- jmvcore::OptionNumber$new(
                "siglevel",
                siglevel,
                min=0,
                max=1,
                default=0.05)
            private$..hypothesis <- jmvcore::OptionList$new(
                "hypothesis",
                hypothesis,
                options=list(
                    "greater",
                    "less",
                    "both"),
                default="both")
            private$..rtLAG1 <- jmvcore::OptionNumber$new(
                "rtLAG1",
                rtLAG1,
                default=1)
            private$..rtLAG2 <- jmvcore::OptionNumber$new(
                "rtLAG2",
                rtLAG2,
                default=1)

            self$.addOption(private$..dv1)
            self$.addOption(private$..dv2)
            self$.addOption(private$..maxLAG)
            self$.addOption(private$..doTest)
            self$.addOption(private$..siglevel)
            self$.addOption(private$..hypothesis)
            self$.addOption(private$..rtLAG1)
            self$.addOption(private$..rtLAG2)
        }),
    active = list(
        dv1 = function() private$..dv1$value,
        dv2 = function() private$..dv2$value,
        maxLAG = function() private$..maxLAG$value,
        doTest = function() private$..doTest$value,
        siglevel = function() private$..siglevel$value,
        hypothesis = function() private$..hypothesis$value,
        rtLAG1 = function() private$..rtLAG1$value,
        rtLAG2 = function() private$..rtLAG2$value),
    private = list(
        ..dv1 = NA,
        ..dv2 = NA,
        ..maxLAG = NA,
        ..doTest = NA,
        ..siglevel = NA,
        ..hypothesis = NA,
        ..rtLAG1 = NA,
        ..rtLAG2 = NA)
)

tsACFResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        tsdesc = function() private$.items[["tsdesc"]],
        tsplot = function() private$.items[["tsplot"]],
        cfplot = function() private$.items[["cfplot"]],
        Xcfplot = function() private$.items[["Xcfplot"]],
        rtplot = function() private$.items[["rtplot"]],
        phdiagram = function() private$.items[["phdiagram"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Linear Temporal Correlations")
            self$add(jmvcore::Table$new(
                options=options,
                name="tsdesc",
                title="Time series Descriptives",
                rows=2,
                columns=list(
                    list(
                        `name`="var", 
                        `title`="", 
                        `type`="text"),
                    list(
                        `name`="N", 
                        `type`="integer", 
                        `title`="Valid N"),
                    list(
                        `name`="na", 
                        `type`="integer", 
                        `title`="NA values"),
                    list(
                        `name`="minimum", 
                        `type`="number"),
                    list(
                        `name`="maximum", 
                        `type`="number"),
                    list(
                        `name`="q1", 
                        `type`="number"),
                    list(
                        `name`="q3", 
                        `type`="number"),
                    list(
                        `name`="median", 
                        `type`="number"),
                    list(
                        `name`="mad", 
                        `type`="number"),
                    list(
                        `name`="mean", 
                        `type`="number"),
                    list(
                        `name`="sd", 
                        `type`="number"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="tsplot",
                title="Time Series Plot",
                width=600,
                height=200,
                renderFun=".tsplot"))
            self$add(jmvcore::Image$new(
                options=options,
                name="cfplot",
                title="Correlation Function Plots",
                width=600,
                height=300,
                renderFun=".cfplot"))
            self$add(jmvcore::Image$new(
                options=options,
                name="Xcfplot",
                title="Cross-Correlation Function Plot",
                width=600,
                height=300,
                renderFun=".Xcfplot"))
            self$add(jmvcore::Image$new(
                options=options,
                name="rtplot",
                title="Return Plot",
                width=600,
                height=300,
                renderFun=".rtplot"))
            self$add(jmvcore::Image$new(
                options=options,
                name="phdiagram",
                title="Phase Diagram",
                width=600,
                height=300,
                renderFun=".phdiagram"))}))

tsACFBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "tsACFBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'ClinicoPath',
                name = 'tsACF',
                version = c(0,0,0),
                options = options,
                results = tsACFResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Linear Temporal Correlations
#'
#' 
#' @param data .
#' @param dv1 .
#' @param dv2 .
#' @param maxLAG .
#' @param doTest .
#' @param siglevel .
#' @param hypothesis \code{'greater'}, \code{'less'}, or \code{'both'}
#'   (default).
#' @param rtLAG1 .
#' @param rtLAG2 .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$tsdesc} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$tsplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cfplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$Xcfplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$rtplot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$phdiagram} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$tsdesc$asDF}
#'
#' \code{as.data.frame(results$tsdesc)}
#'
#' @export
tsACF <- function(
    data,
    dv1,
    dv2,
    maxLAG = 20,
    doTest = TRUE,
    siglevel = 0.05,
    hypothesis = "both",
    rtLAG1 = 1,
    rtLAG2 = 1) {

    if ( ! requireNamespace('jmvcore'))
        stop('tsACF requires jmvcore to be installed (restart may be required)')

    if ( ! missing(dv1)) dv1 <- jmvcore::resolveQuo(jmvcore::enquo(dv1))
    if ( ! missing(dv2)) dv2 <- jmvcore::resolveQuo(jmvcore::enquo(dv2))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(dv1), dv1, NULL),
            `if`( ! missing(dv2), dv2, NULL))


    options <- tsACFOptions$new(
        dv1 = dv1,
        dv2 = dv2,
        maxLAG = maxLAG,
        doTest = doTest,
        siglevel = siglevel,
        hypothesis = hypothesis,
        rtLAG1 = rtLAG1,
        rtLAG2 = rtLAG2)

    analysis <- tsACFClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
