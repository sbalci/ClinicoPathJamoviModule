#' Jamovi tutorial builder static HTML
#'
#' Returns a responsive HTML fragment (no &lt;head&gt;/&lt;body&gt;) suitable for jamovi outputs.
#' @param layout Choose between the default two-column layout ("wide") or the narrower compact layout ("compact").
#' @return A length-one character vector containing HTML markup.
jamovi_tutorial_builder_static_app_html <- function(layout = c('wide', 'compact')) {
    layout <- match.arg(layout)
    root_class <- if (layout == 'compact') 'tb-app tb-app--compact' else 'tb-app'
    html <- c(
'<style>\n:root {\n  --tb-bg: #141c2b;\n  --tb-fg: #e8edf5;\n  --tb-muted: #a3adba;\n  --tb-card: #1a2335;\n  --tb-border: #2f3a4f;\n  --tb-accent: #7aa2ff;\n  --tb-shadow: 0 12px 32px rgba(4, 6, 12, .35);\n}\n\n.tb-shell {\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  background: transparent;\n}\n\n.tb-app {\n  width: min(1200px, 100%);\n  display: grid;\n  grid-template-columns: minmax(240px, 320px) minmax(0, 1fr);\n  gap: 16px;\n  padding: 12px;\n  box-sizing: border-box;\n  color: var(--tb-fg);\n  background: transparent;\n  font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Helvetica Neue, Arial, Noto Sans, Apple Color Emoji, Segoe UI Emoji;\n}\n\n.tb-app--compact {\n  grid-template-columns: minmax(210px, 260px) minmax(0, 1fr);\n}\n\n.tb-card {\n  background: var(--tb-card);\n  border: 1px solid var(--tb-border);\n  border-radius: 12px;\n  box-shadow: var(--tb-shadow);\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n}\n\n.tb-sidebar {\n  display: grid;\n  grid-template-rows: auto 1fr auto;\n  gap: 12px;\n}\n\n.tb-section {\n  padding: 12px 14px 10px;\n  border-bottom: 1px solid var(--tb-border);\n}\n\n.tb-section strong {\n  display: block;\n  margin-bottom: 6px;\n}\n\n.tb-hint {\n  color: var(--tb-muted);\n  font-size: 13px;\n}\n\n.tb-list {\n  padding: 10px;\n  overflow: auto;\n}\n\n.tb-grid {\n  display: grid;\n  gap: 10px;\n}\n\n.tb-grid.tb-cols-2 {\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 12px;\n}\n\n.tb-controls {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n  padding: 10px 12px;\n  border-top: 1px solid var(--tb-border);\n}\n\n.tb-button,\n.tb-badge,\n.tb-input,\n.tb-textarea,\n.tb-select {\n  font: inherit;\n}\n\n.tb-button,\n.tb-badge {\n  background: #152036;\n  color: var(--tb-fg);\n  border: 1px solid var(--tb-border);\n  padding: 8px 12px;\n  border-radius: 999px;\n  cursor: pointer;\n  transition: 0.2s;\n}\n\n.tb-button:hover,\n.tb-badge:hover {\n  background: #1c2a45;\n  border-color: #3a4b65;\n}\n\n.tb-button[disabled] {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.tb-badge {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.tb-visually-hidden {\n  position: absolute !important;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  border: 0;\n}\n\n.tb-input,\n.tb-textarea,\n.tb-select {\n  width: 100%;\n  background: #0e1320;\n  color: var(--tb-fg);\n  border: 1px solid var(--tb-border);\n  border-radius: 10px;\n  padding: 8px;\n  box-sizing: border-box;\n}\n\n.tb-textarea {\n  min-height: 64px;\n  resize: vertical;\n}\n\n.tb-stage {\n  position: relative;\n}\n\n.tb-stage-canvas {\n  position: relative;\n  max-width: 100%;\n  height: calc(100vh - 200px);\n  display: grid;\n  place-items: center;\n  padding: 16px;\n  box-sizing: border-box;\n}\n\n.tb-stage-canvas canvas {\n  max-width: 100%;\n  max-height: 100%;\n  border-radius: 12px;\n  border: 1px solid var(--tb-border);\n  background: radial-gradient(circle at 20% 20%, rgba(122, 162, 255, .08), transparent 55%), #101828;\n}\n\n.tb-toast {\n  position: fixed;\n  left: 50%;\n  transform: translateX(-50%);\n  bottom: 16px;\n  background: var(--tb-card);\n  border: 1px solid var(--tb-border);\n  border-radius: 10px;\n  padding: 8px 12px;\n  opacity: 0;\n  transition: 0.2s;\n  pointer-events: none;\n  color: var(--tb-fg);\n  box-shadow: var(--tb-shadow);\n}\n\n.tb-toast.tb-show {\n  opacity: 1;\n}\n\n.tb-small {\n  font-size: 12px;\n  color: var(--tb-muted);\n}\n\n@media (max-width: 1100px) {\n  .tb-app {\n    grid-template-columns: 1fr;\n    gap: 12px;\n  }\n  .tb-stage {\n    order: -1;\n  }\n  .tb-stage-canvas {\n    height: min(520px, 70vh);\n  }\n}\n\n@media (max-width: 720px) {\n  .tb-app {\n    padding: 8px;\n  }\n  .tb-controls {\n    padding: 8px 10px;\n  }\n  .tb-button,\n  .tb-badge {\n    padding: 6px 10px;\n  }\n}\n</style>',
'\n<div class="tb-shell">\n  <div class="tb-app" data-js-hook="tutorial-builder">\n    <div class="tb-card tb-sidebar">\n      <div class="tb-section">\n        <strong>Steps</strong>\n        <div class="tb-hint">Upload screenshots, crop if needed, then draw hotspots and set actions.</div>\n      </div>\n      <div class="tb-list" id="stepList"></div>\n      <div class="tb-controls">\n        <label class="tb-badge" for="fileInput">Add images</label>\n        <input id="fileInput" class="tb-visually-hidden" type="file" accept="image/*" multiple tabindex="-1" />\n        <button id="addBtn" class="tb-button">Upload</button>\n        <button id="dupStep" class="tb-button">Duplicate</button>\n        <button id="delStep" class="tb-button">Delete</button>\n        <button id="upBtn" class="tb-button">↑</button>\n        <button id="downBtn" class="tb-button">↓</button>\n      </div>\n      <div class="tb-section">\n        <strong>Step properties</strong>\n      </div>\n      <div class="tb-list" style="padding:12px">\n        <div class="tb-grid">\n          <label>Title<input id="titleInput" class="tb-input" type="text" placeholder="e.g., Enable ClinicoPath" /></label>\n          <label>Hint<textarea id="hintInput" class="tb-textarea" placeholder="Tip shown as toast"></textarea></label>\n          <label>Guidance<textarea id="guidanceInput" class="tb-textarea" placeholder="Longer directions shown with the image"></textarea></label>\n          <div class="tb-grid tb-cols-2">\n            <label>Action\n              <select id="actionSelect" class="tb-select">\n                <option value="next">Go to next step</option>\n                <option value="info">Show info popover</option>\n                <option value="goto">Go to step…</option>\n              </select>\n            </label>\n            <label>Go‑to index<input id="gotoInput" class="tb-input" type="number" min="1" value="1" /></label>\n          </div>\n          <label id="infoLabel" style="display:none">Info text (HTML allowed)\n            <textarea id="infoInput" class="tb-textarea" placeholder="What should appear when user clicks?&#10;You can use &lt;b&gt;bold&lt;/b&gt;, lists, etc."></textarea>\n          </label>\n        </div>\n      </div>\n      <div class="tb-section">\n        <strong>Tips</strong>\n        <div class="tb-hint">Crop an image by clicking <b>Start crop</b>, dragging over the area, then pressing <b>Apply Crop</b>.</div>\n        <div class="tb-hint">Click <b>New hotspot</b>, hold <b>Shift</b>, and drag to draw a clickable region on the screenshot.</div>\n      </div>\n      <div class="tb-controls">\n        <button id="newHotspot" class="tb-button">New hotspot</button>\n        <button id="clearHotspots" class="tb-button">Clear hotspots</button>\n        <span class="tb-badge" id="dimToggle">Dim: On</span>\n      </div>\n      <div class="tb-controls">\n        <button id="exportHtml" class="tb-button">Export tutorial.html</button>\n        <button id="exportJson" class="tb-button">Export project.json</button>\n        <button id="exportMarkdown" class="tb-button">Export timeline.md</button>\n        <label class="tb-badge">Import\n          <input id="importJson" type="file" accept="application/json" style="display:none" />\n        </label>\n      </div>\n    </div>\n\n    <div class="tb-card tb-stage">\n      <div class="tb-stage-canvas" id="canvasWrap">\n        <canvas id="canvas" width="1280" height="720" aria-label="Editor canvas"></canvas>\n      </div>\n      <div class="tb-section" style="width:100%">\n        <div class="tb-grid tb-cols-2" style="padding:10px">\n          <div>\n            <strong>Crop</strong>\n            <div class="tb-hint">Drag to select a region. Click <em>Apply Crop</em>.</div>\n            <div class="tb-controls" style="border:none; padding:8px 0 0; gap:6px;">\n              <button id="startCrop" class="tb-button">Start crop</button>\n              <button id="applyCrop" class="tb-button" disabled>Apply crop</button>\n              <button id="cancelCrop" class="tb-button" disabled>Cancel</button>\n            </div>\n          </div>\n          <div>\n            <strong>Keyboard</strong>\n            <div class="tb-small">Draw hotspot: hold <b>Shift</b> and drag • Delete hotspot: select + press <b>Backspace</b> • Move step: <b>Alt</b>+↑/↓</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="tb-toast" id="toast" aria-live="polite"></div>\n<!-- JS hookup handled via jamovi/js/jamovi_tutorial_builder.js -->\n'
    )
    # adjust root class depending on layout
    html <- sub('class="tb-app"', sprintf('class="%s"', root_class), html, fixed = TRUE)
    paste(html, collapse = '\n')
}
