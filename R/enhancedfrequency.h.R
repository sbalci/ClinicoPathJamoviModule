
# This file is automatically generated, you probably don't want to edit this

enhancedfrequencyOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfrequencyOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            vars = NULL,
            orderBy = "freq_desc",
            showDatasetOverview = TRUE,
            showVariableSummary = TRUE,
            showFrequencyTables = TRUE,
            showCombinedSummary = FALSE,
            showPercentages = TRUE,
            showValidPercentages = TRUE,
            showCumulative = TRUE,
            showValidCumulative = TRUE,
            includeMissing = TRUE,
            missingLabel = "<Missing>",
            percentageDecimals = 1,
            frequencyDecimals = 0,
            minFrequency = 0,
            maxCategories = 50,
            combineRareCategories = FALSE,
            rareCategoryLabel = "Other",
            bluesky_integration = TRUE,
            comprehensive_output = FALSE,
            clinical_interpretation = TRUE,
            dataQualityAssessment = TRUE,
            categoricalDiagnostics = FALSE,
            exportFormat = "standard",
            includeMethodology = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="enhancedfrequency",
                requiresData=TRUE,
                ...)

            private$..vars <- jmvcore::OptionVariables$new(
                "vars",
                vars,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..orderBy <- jmvcore::OptionList$new(
                "orderBy",
                orderBy,
                options=list(
                    "freq_desc",
                    "freq_asc",
                    "var_asc",
                    "var_desc",
                    "none"),
                default="freq_desc")
            private$..showDatasetOverview <- jmvcore::OptionBool$new(
                "showDatasetOverview",
                showDatasetOverview,
                default=TRUE)
            private$..showVariableSummary <- jmvcore::OptionBool$new(
                "showVariableSummary",
                showVariableSummary,
                default=TRUE)
            private$..showFrequencyTables <- jmvcore::OptionBool$new(
                "showFrequencyTables",
                showFrequencyTables,
                default=TRUE)
            private$..showCombinedSummary <- jmvcore::OptionBool$new(
                "showCombinedSummary",
                showCombinedSummary,
                default=FALSE)
            private$..showPercentages <- jmvcore::OptionBool$new(
                "showPercentages",
                showPercentages,
                default=TRUE)
            private$..showValidPercentages <- jmvcore::OptionBool$new(
                "showValidPercentages",
                showValidPercentages,
                default=TRUE)
            private$..showCumulative <- jmvcore::OptionBool$new(
                "showCumulative",
                showCumulative,
                default=TRUE)
            private$..showValidCumulative <- jmvcore::OptionBool$new(
                "showValidCumulative",
                showValidCumulative,
                default=TRUE)
            private$..includeMissing <- jmvcore::OptionBool$new(
                "includeMissing",
                includeMissing,
                default=TRUE)
            private$..missingLabel <- jmvcore::OptionString$new(
                "missingLabel",
                missingLabel,
                default="<Missing>")
            private$..percentageDecimals <- jmvcore::OptionInteger$new(
                "percentageDecimals",
                percentageDecimals,
                default=1,
                min=0,
                max=5)
            private$..frequencyDecimals <- jmvcore::OptionInteger$new(
                "frequencyDecimals",
                frequencyDecimals,
                default=0,
                min=0,
                max=3)
            private$..minFrequency <- jmvcore::OptionInteger$new(
                "minFrequency",
                minFrequency,
                default=0,
                min=0,
                max=1000)
            private$..maxCategories <- jmvcore::OptionInteger$new(
                "maxCategories",
                maxCategories,
                default=50,
                min=5,
                max=500)
            private$..combineRareCategories <- jmvcore::OptionBool$new(
                "combineRareCategories",
                combineRareCategories,
                default=FALSE)
            private$..rareCategoryLabel <- jmvcore::OptionString$new(
                "rareCategoryLabel",
                rareCategoryLabel,
                default="Other")
            private$..bluesky_integration <- jmvcore::OptionBool$new(
                "bluesky_integration",
                bluesky_integration,
                default=TRUE)
            private$..comprehensive_output <- jmvcore::OptionBool$new(
                "comprehensive_output",
                comprehensive_output,
                default=FALSE)
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)
            private$..dataQualityAssessment <- jmvcore::OptionBool$new(
                "dataQualityAssessment",
                dataQualityAssessment,
                default=TRUE)
            private$..categoricalDiagnostics <- jmvcore::OptionBool$new(
                "categoricalDiagnostics",
                categoricalDiagnostics,
                default=FALSE)
            private$..exportFormat <- jmvcore::OptionList$new(
                "exportFormat",
                exportFormat,
                options=list(
                    "standard",
                    "publication",
                    "clinical"),
                default="standard")
            private$..includeMethodology <- jmvcore::OptionBool$new(
                "includeMethodology",
                includeMethodology,
                default=FALSE)

            self$.addOption(private$..vars)
            self$.addOption(private$..orderBy)
            self$.addOption(private$..showDatasetOverview)
            self$.addOption(private$..showVariableSummary)
            self$.addOption(private$..showFrequencyTables)
            self$.addOption(private$..showCombinedSummary)
            self$.addOption(private$..showPercentages)
            self$.addOption(private$..showValidPercentages)
            self$.addOption(private$..showCumulative)
            self$.addOption(private$..showValidCumulative)
            self$.addOption(private$..includeMissing)
            self$.addOption(private$..missingLabel)
            self$.addOption(private$..percentageDecimals)
            self$.addOption(private$..frequencyDecimals)
            self$.addOption(private$..minFrequency)
            self$.addOption(private$..maxCategories)
            self$.addOption(private$..combineRareCategories)
            self$.addOption(private$..rareCategoryLabel)
            self$.addOption(private$..bluesky_integration)
            self$.addOption(private$..comprehensive_output)
            self$.addOption(private$..clinical_interpretation)
            self$.addOption(private$..dataQualityAssessment)
            self$.addOption(private$..categoricalDiagnostics)
            self$.addOption(private$..exportFormat)
            self$.addOption(private$..includeMethodology)
        }),
    active = list(
        vars = function() private$..vars$value,
        orderBy = function() private$..orderBy$value,
        showDatasetOverview = function() private$..showDatasetOverview$value,
        showVariableSummary = function() private$..showVariableSummary$value,
        showFrequencyTables = function() private$..showFrequencyTables$value,
        showCombinedSummary = function() private$..showCombinedSummary$value,
        showPercentages = function() private$..showPercentages$value,
        showValidPercentages = function() private$..showValidPercentages$value,
        showCumulative = function() private$..showCumulative$value,
        showValidCumulative = function() private$..showValidCumulative$value,
        includeMissing = function() private$..includeMissing$value,
        missingLabel = function() private$..missingLabel$value,
        percentageDecimals = function() private$..percentageDecimals$value,
        frequencyDecimals = function() private$..frequencyDecimals$value,
        minFrequency = function() private$..minFrequency$value,
        maxCategories = function() private$..maxCategories$value,
        combineRareCategories = function() private$..combineRareCategories$value,
        rareCategoryLabel = function() private$..rareCategoryLabel$value,
        bluesky_integration = function() private$..bluesky_integration$value,
        comprehensive_output = function() private$..comprehensive_output$value,
        clinical_interpretation = function() private$..clinical_interpretation$value,
        dataQualityAssessment = function() private$..dataQualityAssessment$value,
        categoricalDiagnostics = function() private$..categoricalDiagnostics$value,
        exportFormat = function() private$..exportFormat$value,
        includeMethodology = function() private$..includeMethodology$value),
    private = list(
        ..vars = NA,
        ..orderBy = NA,
        ..showDatasetOverview = NA,
        ..showVariableSummary = NA,
        ..showFrequencyTables = NA,
        ..showCombinedSummary = NA,
        ..showPercentages = NA,
        ..showValidPercentages = NA,
        ..showCumulative = NA,
        ..showValidCumulative = NA,
        ..includeMissing = NA,
        ..missingLabel = NA,
        ..percentageDecimals = NA,
        ..frequencyDecimals = NA,
        ..minFrequency = NA,
        ..maxCategories = NA,
        ..combineRareCategories = NA,
        ..rareCategoryLabel = NA,
        ..bluesky_integration = NA,
        ..comprehensive_output = NA,
        ..clinical_interpretation = NA,
        ..dataQualityAssessment = NA,
        ..categoricalDiagnostics = NA,
        ..exportFormat = NA,
        ..includeMethodology = NA)
)

enhancedfrequencyResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfrequencyResults",
    inherit = jmvcore::Group,
    active = list(
        results = function() private$.items[["results"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Frequency Analysis Results")
            self$add(R6::R6Class(
                inherit = jmvcore::Group,
                active = list(
                    instructions = function() private$.items[["instructions"]],
                    datasetOverview = function() private$.items[["datasetOverview"]],
                    variableSummary = function() private$.items[["variableSummary"]],
                    combinedSummary = function() private$.items[["combinedSummary"]],
                    dataQualityReport = function() private$.items[["dataQualityReport"]],
                    categoricalDiagnostics = function() private$.items[["categoricalDiagnostics"]],
                    comprehensiveAnalysisSummary = function() private$.items[["comprehensiveAnalysisSummary"]],
                    clinicalInterpretationGuide = function() private$.items[["clinicalInterpretationGuide"]],
                    methodsExplanation = function() private$.items[["methodsExplanation"]],
                    frequencyDistributionPlot = function() private$.items[["frequencyDistributionPlot"]],
                    dataQualityPlot = function() private$.items[["dataQualityPlot"]],
                    categoryBalancePlot = function() private$.items[["categoryBalancePlot"]]),
                private = list(),
                public=list(
                    initialize=function(options) {
                        super$initialize(
                            options=options,
                            name="results",
                            title="Analysis Results")
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="instructions",
                            title="Instructions",
                            visible=TRUE))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="datasetOverview",
                            title="Dataset Overview",
                            visible="(showDatasetOverview)",
                            columns=list(
                                list(
                                    `name`="characteristic", 
                                    `title`="Characteristic", 
                                    `type`="text"),
                                list(
                                    `name`="value", 
                                    `title`="Value", 
                                    `type`="text"),
                                list(
                                    `name`="description", 
                                    `title`="Description", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="variableSummary",
                            title="Variables Summary",
                            visible="(showVariableSummary)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="type", 
                                    `title`="Type", 
                                    `type`="text"),
                                list(
                                    `name`="categories", 
                                    `title`="Categories", 
                                    `type`="integer"),
                                list(
                                    `name`="valid_n", 
                                    `title`="Valid N", 
                                    `type`="integer"),
                                list(
                                    `name`="missing_n", 
                                    `title`="Missing N", 
                                    `type`="integer"),
                                list(
                                    `name`="missing_pct", 
                                    `title`="Missing %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="most_common", 
                                    `title`="Most Common", 
                                    `type`="text"),
                                list(
                                    `name`="most_common_freq", 
                                    `title`="Most Common Freq", 
                                    `type`="integer"),
                                list(
                                    `name`="least_common", 
                                    `title`="Least Common", 
                                    `type`="text"),
                                list(
                                    `name`="least_common_freq", 
                                    `title`="Least Common Freq", 
                                    `type`="integer"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="combinedSummary",
                            title="Combined Frequency Summary",
                            visible="(showCombinedSummary)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="category", 
                                    `title`="Category", 
                                    `type`="text"),
                                list(
                                    `name`="frequency", 
                                    `title`="Frequency", 
                                    `type`="integer"),
                                list(
                                    `name`="percentage", 
                                    `title`="Percentage", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="valid_percentage", 
                                    `title`="Valid %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="cumulative_percentage", 
                                    `title`="Cumulative %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="valid_cumulative_percentage", 
                                    `title`="Valid Cumulative %", 
                                    `type`="number", 
                                    `format`="zto"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="dataQualityReport",
                            title="Data Quality Assessment",
                            visible="(dataQualityAssessment)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="quality_score", 
                                    `title`="Quality Score", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="completeness", 
                                    `title`="Completeness", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="uniqueness", 
                                    `title`="Uniqueness", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="balance", 
                                    `title`="Category Balance", 
                                    `type`="text"),
                                list(
                                    `name`="recommendations", 
                                    `title`="Recommendations", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="categoricalDiagnostics",
                            title="Categorical Variable Diagnostics",
                            visible="(categoricalDiagnostics)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="entropy", 
                                    `title`="Entropy", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="gini_impurity", 
                                    `title`="Gini Impurity", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="concentration_ratio", 
                                    `title`="Concentration Ratio", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="dominant_category_pct", 
                                    `title`="Dominant Category %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="rare_categories_count", 
                                    `title`="Rare Categories", 
                                    `type`="integer"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="comprehensiveAnalysisSummary",
                            title="Comprehensive Frequency Analysis Summary",
                            visible="(bluesky_integration && comprehensive_output)",
                            columns=list(
                                list(
                                    `name`="measure", 
                                    `title`="Measure", 
                                    `type`="text"),
                                list(
                                    `name`="value", 
                                    `title`="Value", 
                                    `type`="text"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"),
                                list(
                                    `name`="clinical_significance", 
                                    `title`="Clinical Significance", 
                                    `type`="text"))))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="clinicalInterpretationGuide",
                            title="Clinical Application Guidance",
                            visible="(clinical_interpretation)"))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="methodsExplanation",
                            title="Statistical Methods and References",
                            visible="(comprehensive_output)"))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="frequencyDistributionPlot",
                            title="Frequency Distribution Overview",
                            visible="(showFrequencyTables)",
                            renderFun=".plotFrequencyDistribution",
                            width=800,
                            height=600))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="dataQualityPlot",
                            title="Data Quality Assessment Plot",
                            visible="(dataQualityAssessment)",
                            renderFun=".plotDataQuality",
                            width=700,
                            height=500))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="categoryBalancePlot",
                            title="Category Balance Analysis",
                            visible="(categoricalDiagnostics)",
                            renderFun=".plotCategoryBalance",
                            width=800,
                            height=600))}))$new(options=options))}))

enhancedfrequencyBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfrequencyBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "enhancedfrequency",
                version = c(0,0,31),
                options = options,
                results = enhancedfrequencyResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Frequency Analysis with BlueSky Integration
#'
#' Enhanced frequency analysis toolkit with BlueSky integration for 
#' comprehensive
#' categorical data exploration. Includes flexible ordering options (by 
#' frequency, 
#' variable value, or natural order), comprehensive percentage calculations 
#' (valid, 
#' cumulative, missing), and enhanced missing value handling. Perfect for 
#' exploratory 
#' data analysis, categorical variable profiling, and data quality assessment.
#' 
#' @param data The data as a data frame.
#' @param vars Variables for frequency analysis (will be converted to factors
#'   if needed)
#' @param orderBy Ordering method for frequency table categories
#' @param showDatasetOverview Display dataset summary with variable counts and
#'   observations
#' @param showVariableSummary Display summary statistics by variable
#' @param showFrequencyTables Display detailed frequency tables for each
#'   variable
#' @param showCombinedSummary Display all variables in a single summary table
#' @param showPercentages Include percentage columns in frequency tables
#' @param showValidPercentages Include valid percentages (excluding missing
#'   values)
#' @param showCumulative Include cumulative frequencies and percentages
#' @param showValidCumulative Include valid cumulative percentages (excluding
#'   missing values)
#' @param includeMissing Include missing values (NA) in frequency tables
#' @param missingLabel Label to use for missing values in output tables
#' @param percentageDecimals Number of decimal places for percentages
#' @param frequencyDecimals Number of decimal places for frequencies
#' @param minFrequency Hide categories with frequency below this threshold (0
#'   = show all)
#' @param maxCategories Maximum number of categories to display per variable
#' @param combineRareCategories Combine categories below minimum frequency
#'   threshold into "Other"
#' @param rareCategoryLabel Label for combined rare categories
#' @param bluesky_integration Use BlueSky R statistical environment features
#' @param comprehensive_output Include comprehensive statistical details and
#'   diagnostics
#' @param clinical_interpretation Provide clinical context for frequency
#'   analysis results
#' @param dataQualityAssessment Include data quality metrics and
#'   recommendations
#' @param categoricalDiagnostics Include advanced categorical variable
#'   diagnostics
#' @param exportFormat Output format for frequency tables
#' @param includeMethodology Include detailed methodology and references in
#'   output
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$datasetOverview} \tab \tab \tab \tab \tab Summary of dataset characteristics \cr
#'   \code{results$results$variableSummary} \tab \tab \tab \tab \tab Summary statistics for all selected variables \cr
#'   \code{results$results$combinedSummary} \tab \tab \tab \tab \tab All variables combined in a single summary table \cr
#'   \code{results$results$dataQualityReport} \tab \tab \tab \tab \tab Data quality metrics and recommendations \cr
#'   \code{results$results$categoricalDiagnostics} \tab \tab \tab \tab \tab Advanced diagnostics for categorical variables \cr
#'   \code{results$results$comprehensiveAnalysisSummary} \tab \tab \tab \tab \tab Enhanced statistical summary with BlueSky integration \cr
#'   \code{results$results$clinicalInterpretationGuide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$methodsExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$frequencyDistributionPlot} \tab \tab \tab \tab \tab Overview of frequency distributions for all variables \cr
#'   \code{results$results$dataQualityPlot} \tab \tab \tab \tab \tab Visual assessment of data quality metrics \cr
#'   \code{results$results$categoryBalancePlot} \tab \tab \tab \tab \tab Analysis of category distribution balance \cr
#' }
#'
#' @export
enhancedfrequency <- function(
    data,
    vars,
    orderBy = "freq_desc",
    showDatasetOverview = TRUE,
    showVariableSummary = TRUE,
    showFrequencyTables = TRUE,
    showCombinedSummary = FALSE,
    showPercentages = TRUE,
    showValidPercentages = TRUE,
    showCumulative = TRUE,
    showValidCumulative = TRUE,
    includeMissing = TRUE,
    missingLabel = "<Missing>",
    percentageDecimals = 1,
    frequencyDecimals = 0,
    minFrequency = 0,
    maxCategories = 50,
    combineRareCategories = FALSE,
    rareCategoryLabel = "Other",
    bluesky_integration = TRUE,
    comprehensive_output = FALSE,
    clinical_interpretation = TRUE,
    dataQualityAssessment = TRUE,
    categoricalDiagnostics = FALSE,
    exportFormat = "standard",
    includeMethodology = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("enhancedfrequency requires jmvcore to be installed (restart may be required)")

    if ( ! missing(vars)) vars <- jmvcore::resolveQuo(jmvcore::enquo(vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(vars), vars, NULL))


    options <- enhancedfrequencyOptions$new(
        vars = vars,
        orderBy = orderBy,
        showDatasetOverview = showDatasetOverview,
        showVariableSummary = showVariableSummary,
        showFrequencyTables = showFrequencyTables,
        showCombinedSummary = showCombinedSummary,
        showPercentages = showPercentages,
        showValidPercentages = showValidPercentages,
        showCumulative = showCumulative,
        showValidCumulative = showValidCumulative,
        includeMissing = includeMissing,
        missingLabel = missingLabel,
        percentageDecimals = percentageDecimals,
        frequencyDecimals = frequencyDecimals,
        minFrequency = minFrequency,
        maxCategories = maxCategories,
        combineRareCategories = combineRareCategories,
        rareCategoryLabel = rareCategoryLabel,
        bluesky_integration = bluesky_integration,
        comprehensive_output = comprehensive_output,
        clinical_interpretation = clinical_interpretation,
        dataQualityAssessment = dataQualityAssessment,
        categoricalDiagnostics = categoricalDiagnostics,
        exportFormat = exportFormat,
        includeMethodology = includeMethodology)

    analysis <- enhancedfrequencyClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

