
# This file is automatically generated, you probably don't want to edit this

assayoptimizationOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "assayoptimizationOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            response_var = NULL,
            factors = NULL,
            blocking_vars = NULL,
            covariates = NULL,
            design_type = "factorial",
            optimization_goal = "maximize_response",
            target_value = 1,
            power_analysis = TRUE,
            alpha_level = 0.05,
            power_level = 0.8,
            effect_size = 0.5,
            replicates = 3,
            randomization = "complete",
            quality_control = TRUE,
            control_charts = "xbar_r",
            robust_methods = FALSE,
            response_surface = TRUE,
            contour_plots = TRUE,
            optimization_plots = TRUE,
            export_design = FALSE,
            method_validation = FALSE,
            confidence_level = 0.95, ...) {

            super$initialize(
                package="ClinicoPath",
                name="assayoptimization",
                requiresData=FALSE,
                ...)

            private$..response_var <- jmvcore::OptionVariable$new(
                "response_var",
                response_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..factors <- jmvcore::OptionVariables$new(
                "factors",
                factors,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..blocking_vars <- jmvcore::OptionVariables$new(
                "blocking_vars",
                blocking_vars,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..covariates <- jmvcore::OptionVariables$new(
                "covariates",
                covariates,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"),
                default=NULL)
            private$..design_type <- jmvcore::OptionList$new(
                "design_type",
                design_type,
                options=list(
                    "factorial",
                    "fractional",
                    "central_composite",
                    "box_behnken",
                    "optimal",
                    "plackett_burman"),
                default="factorial")
            private$..optimization_goal <- jmvcore::OptionList$new(
                "optimization_goal",
                optimization_goal,
                options=list(
                    "maximize_response",
                    "minimize_response",
                    "target_value",
                    "minimize_variance",
                    "maximize_efficiency",
                    "pareto_optimal"),
                default="maximize_response")
            private$..target_value <- jmvcore::OptionNumber$new(
                "target_value",
                target_value,
                default=1)
            private$..power_analysis <- jmvcore::OptionBool$new(
                "power_analysis",
                power_analysis,
                default=TRUE)
            private$..alpha_level <- jmvcore::OptionNumber$new(
                "alpha_level",
                alpha_level,
                default=0.05,
                min=0.001,
                max=0.1)
            private$..power_level <- jmvcore::OptionNumber$new(
                "power_level",
                power_level,
                default=0.8,
                min=0.5,
                max=0.99)
            private$..effect_size <- jmvcore::OptionNumber$new(
                "effect_size",
                effect_size,
                default=0.5,
                min=0.1,
                max=5)
            private$..replicates <- jmvcore::OptionInteger$new(
                "replicates",
                replicates,
                default=3,
                min=1,
                max=20)
            private$..randomization <- jmvcore::OptionList$new(
                "randomization",
                randomization,
                options=list(
                    "complete",
                    "block",
                    "systematic",
                    "stratified"),
                default="complete")
            private$..quality_control <- jmvcore::OptionBool$new(
                "quality_control",
                quality_control,
                default=TRUE)
            private$..control_charts <- jmvcore::OptionList$new(
                "control_charts",
                control_charts,
                options=list(
                    "xbar_r",
                    "xbar_s",
                    "individual_mr",
                    "cusum",
                    "ewma"),
                default="xbar_r")
            private$..robust_methods <- jmvcore::OptionBool$new(
                "robust_methods",
                robust_methods,
                default=FALSE)
            private$..response_surface <- jmvcore::OptionBool$new(
                "response_surface",
                response_surface,
                default=TRUE)
            private$..contour_plots <- jmvcore::OptionBool$new(
                "contour_plots",
                contour_plots,
                default=TRUE)
            private$..optimization_plots <- jmvcore::OptionBool$new(
                "optimization_plots",
                optimization_plots,
                default=TRUE)
            private$..export_design <- jmvcore::OptionBool$new(
                "export_design",
                export_design,
                default=FALSE)
            private$..method_validation <- jmvcore::OptionBool$new(
                "method_validation",
                method_validation,
                default=FALSE)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.8,
                max=0.99)

            self$.addOption(private$..response_var)
            self$.addOption(private$..factors)
            self$.addOption(private$..blocking_vars)
            self$.addOption(private$..covariates)
            self$.addOption(private$..design_type)
            self$.addOption(private$..optimization_goal)
            self$.addOption(private$..target_value)
            self$.addOption(private$..power_analysis)
            self$.addOption(private$..alpha_level)
            self$.addOption(private$..power_level)
            self$.addOption(private$..effect_size)
            self$.addOption(private$..replicates)
            self$.addOption(private$..randomization)
            self$.addOption(private$..quality_control)
            self$.addOption(private$..control_charts)
            self$.addOption(private$..robust_methods)
            self$.addOption(private$..response_surface)
            self$.addOption(private$..contour_plots)
            self$.addOption(private$..optimization_plots)
            self$.addOption(private$..export_design)
            self$.addOption(private$..method_validation)
            self$.addOption(private$..confidence_level)
        }),
    active = list(
        response_var = function() private$..response_var$value,
        factors = function() private$..factors$value,
        blocking_vars = function() private$..blocking_vars$value,
        covariates = function() private$..covariates$value,
        design_type = function() private$..design_type$value,
        optimization_goal = function() private$..optimization_goal$value,
        target_value = function() private$..target_value$value,
        power_analysis = function() private$..power_analysis$value,
        alpha_level = function() private$..alpha_level$value,
        power_level = function() private$..power_level$value,
        effect_size = function() private$..effect_size$value,
        replicates = function() private$..replicates$value,
        randomization = function() private$..randomization$value,
        quality_control = function() private$..quality_control$value,
        control_charts = function() private$..control_charts$value,
        robust_methods = function() private$..robust_methods$value,
        response_surface = function() private$..response_surface$value,
        contour_plots = function() private$..contour_plots$value,
        optimization_plots = function() private$..optimization_plots$value,
        export_design = function() private$..export_design$value,
        method_validation = function() private$..method_validation$value,
        confidence_level = function() private$..confidence_level$value),
    private = list(
        ..response_var = NA,
        ..factors = NA,
        ..blocking_vars = NA,
        ..covariates = NA,
        ..design_type = NA,
        ..optimization_goal = NA,
        ..target_value = NA,
        ..power_analysis = NA,
        ..alpha_level = NA,
        ..power_level = NA,
        ..effect_size = NA,
        ..replicates = NA,
        ..randomization = NA,
        ..quality_control = NA,
        ..control_charts = NA,
        ..robust_methods = NA,
        ..response_surface = NA,
        ..contour_plots = NA,
        ..optimization_plots = NA,
        ..export_design = NA,
        ..method_validation = NA,
        ..confidence_level = NA)
)

assayoptimizationResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "assayoptimizationResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        design_summary = function() private$.items[["design_summary"]],
        power_analysis = function() private$.items[["power_analysis"]],
        optimization_results = function() private$.items[["optimization_results"]],
        factor_effects = function() private$.items[["factor_effects"]],
        response_surface_summary = function() private$.items[["response_surface_summary"]],
        quality_control_summary = function() private$.items[["quality_control_summary"]],
        validation_metrics = function() private$.items[["validation_metrics"]],
        design_plot = function() private$.items[["design_plot"]],
        effects_plot = function() private$.items[["effects_plot"]],
        response_surface_plot = function() private$.items[["response_surface_plot"]],
        optimization_plot = function() private$.items[["optimization_plot"]],
        control_chart = function() private$.items[["control_chart"]],
        diagnostic_plots = function() private$.items[["diagnostic_plots"]],
        power_plot = function() private$.items[["power_plot"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Assay Optimization & Experimental Design")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="design_summary",
                title="Experimental Design Summary",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="power_analysis",
                title="Power Analysis Results",
                visible="(power_analysis)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="optimization_results",
                title="Optimization Results",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="factor_effects",
                title="Factor Effects Analysis",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="response_surface_summary",
                title="Response Surface Model Summary",
                visible="(response_surface)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="quality_control_summary",
                title="Quality Control Analysis",
                visible="(quality_control)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="validation_metrics",
                title="Method Validation Results",
                visible="(method_validation)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="design_plot",
                title="Experimental Design Visualization",
                width=800,
                height=600,
                renderFun=".plot_design",
                visible=TRUE,
                clearWith=list(
                    "factors",
                    "design_type",
                    "blocking_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="effects_plot",
                title="Factor Effects Plot",
                width=800,
                height=600,
                renderFun=".plot_effects",
                visible=TRUE,
                clearWith=list(
                    "response_var",
                    "factors",
                    "design_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="response_surface_plot",
                title="Response Surface Plot",
                width=800,
                height=600,
                renderFun=".plot_response_surface",
                visible="(response_surface && contour_plots)",
                clearWith=list(
                    "response_var",
                    "factors",
                    "optimization_goal")))
            self$add(jmvcore::Image$new(
                options=options,
                name="optimization_plot",
                title="Optimization Path",
                width=800,
                height=600,
                renderFun=".plot_optimization",
                visible="(optimization_plots)",
                clearWith=list(
                    "response_var",
                    "factors",
                    "optimization_goal")))
            self$add(jmvcore::Image$new(
                options=options,
                name="control_chart",
                title="Quality Control Charts",
                width=800,
                height=600,
                renderFun=".plot_control_chart",
                visible="(quality_control)",
                clearWith=list(
                    "response_var",
                    "control_charts",
                    "blocking_vars")))
            self$add(jmvcore::Image$new(
                options=options,
                name="diagnostic_plots",
                title="Model Diagnostic Plots",
                width=800,
                height=600,
                renderFun=".plot_diagnostics",
                visible=TRUE,
                clearWith=list(
                    "response_var",
                    "factors",
                    "design_type")))
            self$add(jmvcore::Image$new(
                options=options,
                name="power_plot",
                title="Power Analysis Visualization",
                width=800,
                height=600,
                renderFun=".plot_power",
                visible="(power_analysis)",
                clearWith=list(
                    "alpha_level",
                    "power_level",
                    "effect_size",
                    "replicates")))}))

assayoptimizationBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "assayoptimizationBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "assayoptimization",
                version = c(0,0,3),
                options = options,
                results = assayoptimizationResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'na')
        }))

#' Assay Optimization & Experimental Design
#'
#' Laboratory assay optimization and experimental design for clinical 
#' research.
#' Includes power calculations, sample size determination, design 
#' optimization,
#' and quality control for laboratory assays.
#' 
#'
#' @examples
#' # Example: Optimize PCR assay design
#' assayoptimization(
#'     data = pcr_data,
#'     response_var = concentration,
#'     factors = c("primer_conc", "temperature", "cycles"),
#'     optimization_goal = "maximize_efficiency",
#'     design_type = "factorial"
#' )
#'
#' @param response_var Primary assay response variable for optimization
#' @param factors List of experimental factors for optimization
#' @param blocking_vars Variables for experimental blocking
#' @param covariates Covariates to include in the analysis
#' @param design_type Experimental design approach for factor optimization
#' @param optimization_goal Goal for assay optimization
#' @param target_value Target response value for optimization
#' @param power_analysis Whether to perform power analysis
#' @param alpha_level Significance level for hypothesis testing
#' @param power_level Target power for the experimental design
#' @param effect_size Expected effect size for power calculations
#' @param replicates Number of replicates per experimental condition
#' @param randomization Randomization strategy for the experiment
#' @param quality_control Whether to include QC analysis
#' @param control_charts Control chart methodology for QC
#' @param robust_methods Whether to use robust statistical approaches
#' @param response_surface Whether to perform response surface methodology
#' @param contour_plots Whether to generate contour plots
#' @param optimization_plots Whether to generate optimization plots
#' @param export_design Whether to export the design matrix
#' @param method_validation Whether to include validation analysis
#' @param confidence_level Confidence level for statistical intervals
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$design_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$power_analysis} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$optimization_results} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$factor_effects} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$response_surface_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$quality_control_summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$validation_metrics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$design_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$effects_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$response_surface_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$optimization_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$control_chart} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$diagnostic_plots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$power_plot} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' @export
assayoptimization <- function(
    response_var,
    factors,
    blocking_vars = NULL,
    covariates = NULL,
    design_type = "factorial",
    optimization_goal = "maximize_response",
    target_value = 1,
    power_analysis = TRUE,
    alpha_level = 0.05,
    power_level = 0.8,
    effect_size = 0.5,
    replicates = 3,
    randomization = "complete",
    quality_control = TRUE,
    control_charts = "xbar_r",
    robust_methods = FALSE,
    response_surface = TRUE,
    contour_plots = TRUE,
    optimization_plots = TRUE,
    export_design = FALSE,
    method_validation = FALSE,
    confidence_level = 0.95) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("assayoptimization requires jmvcore to be installed (restart may be required)")

    if ( ! missing(response_var)) response_var <- jmvcore::resolveQuo(jmvcore::enquo(response_var))
    if ( ! missing(factors)) factors <- jmvcore::resolveQuo(jmvcore::enquo(factors))
    if ( ! missing(blocking_vars)) blocking_vars <- jmvcore::resolveQuo(jmvcore::enquo(blocking_vars))
    if ( ! missing(covariates)) covariates <- jmvcore::resolveQuo(jmvcore::enquo(covariates))

    options <- assayoptimizationOptions$new(
        response_var = response_var,
        factors = factors,
        blocking_vars = blocking_vars,
        covariates = covariates,
        design_type = design_type,
        optimization_goal = optimization_goal,
        target_value = target_value,
        power_analysis = power_analysis,
        alpha_level = alpha_level,
        power_level = power_level,
        effect_size = effect_size,
        replicates = replicates,
        randomization = randomization,
        quality_control = quality_control,
        control_charts = control_charts,
        robust_methods = robust_methods,
        response_surface = response_surface,
        contour_plots = contour_plots,
        optimization_plots = optimization_plots,
        export_design = export_design,
        method_validation = method_validation,
        confidence_level = confidence_level)

    analysis <- assayoptimizationClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

