
# This file is automatically generated, you probably don't want to edit this

enhancedfactorvariableOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfactorvariableOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            vars = NULL,
            showOnlyTopFactors = TRUE,
            maxTopFactors = 30,
            sortingMethod = "freq_desc",
            showDatasetOverview = TRUE,
            showNominalSummary = TRUE,
            showDetailedLevels = TRUE,
            showCombinedAnalysis = FALSE,
            includePercentages = TRUE,
            includeValidPercentages = TRUE,
            includeCumulativeStats = FALSE,
            includeMissing = TRUE,
            missingLabel = "<Missing>",
            minimumCount = 1,
            minimumPercentage = 0,
            excludeRareFactors = FALSE,
            rareFactorThreshold = 1,
            rareFactorLabel = "Other",
            factorComplexityAnalysis = FALSE,
            levelBalanceAnalysis = FALSE,
            bluesky_integration = TRUE,
            comprehensive_output = FALSE,
            clinical_interpretation = TRUE,
            createVisualizations = TRUE,
            plotTopFactorsOnly = TRUE,
            plotOrientation = "horizontal",
            plotTheme = "clinical",
            outputFormat = "standard",
            includeMethodology = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="enhancedfactorvariable",
                requiresData=TRUE,
                ...)

            private$..vars <- jmvcore::OptionVariables$new(
                "vars",
                vars,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..showOnlyTopFactors <- jmvcore::OptionBool$new(
                "showOnlyTopFactors",
                showOnlyTopFactors,
                default=TRUE)
            private$..maxTopFactors <- jmvcore::OptionInteger$new(
                "maxTopFactors",
                maxTopFactors,
                default=30,
                min=5,
                max=100)
            private$..sortingMethod <- jmvcore::OptionList$new(
                "sortingMethod",
                sortingMethod,
                options=list(
                    "freq_desc",
                    "freq_asc",
                    "name_asc",
                    "name_desc",
                    "original"),
                default="freq_desc")
            private$..showDatasetOverview <- jmvcore::OptionBool$new(
                "showDatasetOverview",
                showDatasetOverview,
                default=TRUE)
            private$..showNominalSummary <- jmvcore::OptionBool$new(
                "showNominalSummary",
                showNominalSummary,
                default=TRUE)
            private$..showDetailedLevels <- jmvcore::OptionBool$new(
                "showDetailedLevels",
                showDetailedLevels,
                default=TRUE)
            private$..showCombinedAnalysis <- jmvcore::OptionBool$new(
                "showCombinedAnalysis",
                showCombinedAnalysis,
                default=FALSE)
            private$..includePercentages <- jmvcore::OptionBool$new(
                "includePercentages",
                includePercentages,
                default=TRUE)
            private$..includeValidPercentages <- jmvcore::OptionBool$new(
                "includeValidPercentages",
                includeValidPercentages,
                default=TRUE)
            private$..includeCumulativeStats <- jmvcore::OptionBool$new(
                "includeCumulativeStats",
                includeCumulativeStats,
                default=FALSE)
            private$..includeMissing <- jmvcore::OptionBool$new(
                "includeMissing",
                includeMissing,
                default=TRUE)
            private$..missingLabel <- jmvcore::OptionString$new(
                "missingLabel",
                missingLabel,
                default="<Missing>")
            private$..minimumCount <- jmvcore::OptionInteger$new(
                "minimumCount",
                minimumCount,
                default=1,
                min=1,
                max=1000)
            private$..minimumPercentage <- jmvcore::OptionNumber$new(
                "minimumPercentage",
                minimumPercentage,
                default=0,
                min=0,
                max=50)
            private$..excludeRareFactors <- jmvcore::OptionBool$new(
                "excludeRareFactors",
                excludeRareFactors,
                default=FALSE)
            private$..rareFactorThreshold <- jmvcore::OptionNumber$new(
                "rareFactorThreshold",
                rareFactorThreshold,
                default=1,
                min=0.1,
                max=10)
            private$..rareFactorLabel <- jmvcore::OptionString$new(
                "rareFactorLabel",
                rareFactorLabel,
                default="Other")
            private$..factorComplexityAnalysis <- jmvcore::OptionBool$new(
                "factorComplexityAnalysis",
                factorComplexityAnalysis,
                default=FALSE)
            private$..levelBalanceAnalysis <- jmvcore::OptionBool$new(
                "levelBalanceAnalysis",
                levelBalanceAnalysis,
                default=FALSE)
            private$..bluesky_integration <- jmvcore::OptionBool$new(
                "bluesky_integration",
                bluesky_integration,
                default=TRUE)
            private$..comprehensive_output <- jmvcore::OptionBool$new(
                "comprehensive_output",
                comprehensive_output,
                default=FALSE)
            private$..clinical_interpretation <- jmvcore::OptionBool$new(
                "clinical_interpretation",
                clinical_interpretation,
                default=TRUE)
            private$..createVisualizations <- jmvcore::OptionBool$new(
                "createVisualizations",
                createVisualizations,
                default=TRUE)
            private$..plotTopFactorsOnly <- jmvcore::OptionBool$new(
                "plotTopFactorsOnly",
                plotTopFactorsOnly,
                default=TRUE)
            private$..plotOrientation <- jmvcore::OptionList$new(
                "plotOrientation",
                plotOrientation,
                options=list(
                    "horizontal",
                    "vertical"),
                default="horizontal")
            private$..plotTheme <- jmvcore::OptionList$new(
                "plotTheme",
                plotTheme,
                options=list(
                    "clinical",
                    "modern",
                    "classic"),
                default="clinical")
            private$..outputFormat <- jmvcore::OptionList$new(
                "outputFormat",
                outputFormat,
                options=list(
                    "standard",
                    "publication",
                    "clinical"),
                default="standard")
            private$..includeMethodology <- jmvcore::OptionBool$new(
                "includeMethodology",
                includeMethodology,
                default=FALSE)

            self$.addOption(private$..vars)
            self$.addOption(private$..showOnlyTopFactors)
            self$.addOption(private$..maxTopFactors)
            self$.addOption(private$..sortingMethod)
            self$.addOption(private$..showDatasetOverview)
            self$.addOption(private$..showNominalSummary)
            self$.addOption(private$..showDetailedLevels)
            self$.addOption(private$..showCombinedAnalysis)
            self$.addOption(private$..includePercentages)
            self$.addOption(private$..includeValidPercentages)
            self$.addOption(private$..includeCumulativeStats)
            self$.addOption(private$..includeMissing)
            self$.addOption(private$..missingLabel)
            self$.addOption(private$..minimumCount)
            self$.addOption(private$..minimumPercentage)
            self$.addOption(private$..excludeRareFactors)
            self$.addOption(private$..rareFactorThreshold)
            self$.addOption(private$..rareFactorLabel)
            self$.addOption(private$..factorComplexityAnalysis)
            self$.addOption(private$..levelBalanceAnalysis)
            self$.addOption(private$..bluesky_integration)
            self$.addOption(private$..comprehensive_output)
            self$.addOption(private$..clinical_interpretation)
            self$.addOption(private$..createVisualizations)
            self$.addOption(private$..plotTopFactorsOnly)
            self$.addOption(private$..plotOrientation)
            self$.addOption(private$..plotTheme)
            self$.addOption(private$..outputFormat)
            self$.addOption(private$..includeMethodology)
        }),
    active = list(
        vars = function() private$..vars$value,
        showOnlyTopFactors = function() private$..showOnlyTopFactors$value,
        maxTopFactors = function() private$..maxTopFactors$value,
        sortingMethod = function() private$..sortingMethod$value,
        showDatasetOverview = function() private$..showDatasetOverview$value,
        showNominalSummary = function() private$..showNominalSummary$value,
        showDetailedLevels = function() private$..showDetailedLevels$value,
        showCombinedAnalysis = function() private$..showCombinedAnalysis$value,
        includePercentages = function() private$..includePercentages$value,
        includeValidPercentages = function() private$..includeValidPercentages$value,
        includeCumulativeStats = function() private$..includeCumulativeStats$value,
        includeMissing = function() private$..includeMissing$value,
        missingLabel = function() private$..missingLabel$value,
        minimumCount = function() private$..minimumCount$value,
        minimumPercentage = function() private$..minimumPercentage$value,
        excludeRareFactors = function() private$..excludeRareFactors$value,
        rareFactorThreshold = function() private$..rareFactorThreshold$value,
        rareFactorLabel = function() private$..rareFactorLabel$value,
        factorComplexityAnalysis = function() private$..factorComplexityAnalysis$value,
        levelBalanceAnalysis = function() private$..levelBalanceAnalysis$value,
        bluesky_integration = function() private$..bluesky_integration$value,
        comprehensive_output = function() private$..comprehensive_output$value,
        clinical_interpretation = function() private$..clinical_interpretation$value,
        createVisualizations = function() private$..createVisualizations$value,
        plotTopFactorsOnly = function() private$..plotTopFactorsOnly$value,
        plotOrientation = function() private$..plotOrientation$value,
        plotTheme = function() private$..plotTheme$value,
        outputFormat = function() private$..outputFormat$value,
        includeMethodology = function() private$..includeMethodology$value),
    private = list(
        ..vars = NA,
        ..showOnlyTopFactors = NA,
        ..maxTopFactors = NA,
        ..sortingMethod = NA,
        ..showDatasetOverview = NA,
        ..showNominalSummary = NA,
        ..showDetailedLevels = NA,
        ..showCombinedAnalysis = NA,
        ..includePercentages = NA,
        ..includeValidPercentages = NA,
        ..includeCumulativeStats = NA,
        ..includeMissing = NA,
        ..missingLabel = NA,
        ..minimumCount = NA,
        ..minimumPercentage = NA,
        ..excludeRareFactors = NA,
        ..rareFactorThreshold = NA,
        ..rareFactorLabel = NA,
        ..factorComplexityAnalysis = NA,
        ..levelBalanceAnalysis = NA,
        ..bluesky_integration = NA,
        ..comprehensive_output = NA,
        ..clinical_interpretation = NA,
        ..createVisualizations = NA,
        ..plotTopFactorsOnly = NA,
        ..plotOrientation = NA,
        ..plotTheme = NA,
        ..outputFormat = NA,
        ..includeMethodology = NA)
)

enhancedfactorvariableResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfactorvariableResults",
    inherit = jmvcore::Group,
    active = list(
        results = function() private$.items[["results"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Enhanced Factor Variable Analysis Results")
            self$add(R6::R6Class(
                inherit = jmvcore::Group,
                active = list(
                    instructions = function() private$.items[["instructions"]],
                    datasetOverview = function() private$.items[["datasetOverview"]],
                    nominalSummary = function() private$.items[["nominalSummary"]],
                    detailedLevelsAnalysis = function() private$.items[["detailedLevelsAnalysis"]],
                    combinedFactorAnalysis = function() private$.items[["combinedFactorAnalysis"]],
                    complexityAnalysis = function() private$.items[["complexityAnalysis"]],
                    levelBalanceAnalysis = function() private$.items[["levelBalanceAnalysis"]],
                    comprehensiveAnalysisSummary = function() private$.items[["comprehensiveAnalysisSummary"]],
                    clinicalInterpretationGuide = function() private$.items[["clinicalInterpretationGuide"]],
                    methodsExplanation = function() private$.items[["methodsExplanation"]],
                    factorDistributionPlot = function() private$.items[["factorDistributionPlot"]],
                    topFactorsPlot = function() private$.items[["topFactorsPlot"]],
                    complexityPlot = function() private$.items[["complexityPlot"]],
                    balanceAnalysisPlot = function() private$.items[["balanceAnalysisPlot"]]),
                private = list(),
                public=list(
                    initialize=function(options) {
                        super$initialize(
                            options=options,
                            name="results",
                            title="Analysis Results")
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="instructions",
                            title="Instructions",
                            visible=TRUE))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="datasetOverview",
                            title="Dataset Overview",
                            visible="(showDatasetOverview)",
                            columns=list(
                                list(
                                    `name`="characteristic", 
                                    `title`="Characteristic", 
                                    `type`="text"),
                                list(
                                    `name`="value", 
                                    `title`="Value", 
                                    `type`="text"),
                                list(
                                    `name`="description", 
                                    `title`="Description", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="nominalSummary",
                            title="Nominal Variable Summary",
                            visible="(showNominalSummary)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="observations", 
                                    `title`="Observations", 
                                    `type`="integer"),
                                list(
                                    `name`="non_nas", 
                                    `title`="Non-NAs", 
                                    `type`="integer"),
                                list(
                                    `name`="nas", 
                                    `title`="NAs", 
                                    `type`="integer"),
                                list(
                                    `name`="missing_percent", 
                                    `title`="Missing %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="factor_levels", 
                                    `title`="Factor Levels", 
                                    `type`="integer"),
                                list(
                                    `name`="most_frequent", 
                                    `title`="Most Frequent", 
                                    `type`="text"),
                                list(
                                    `name`="most_frequent_count", 
                                    `title`="Most Frequent Count", 
                                    `type`="integer"),
                                list(
                                    `name`="least_frequent", 
                                    `title`="Least Frequent", 
                                    `type`="text"),
                                list(
                                    `name`="least_frequent_count", 
                                    `title`="Least Frequent Count", 
                                    `type`="integer"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="detailedLevelsAnalysis",
                            title="Detailed Factor Levels Analysis",
                            visible="(showDetailedLevels)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="factor_level", 
                                    `title`="Factor Level", 
                                    `type`="text"),
                                list(
                                    `name`="count", 
                                    `title`="Count", 
                                    `type`="integer"),
                                list(
                                    `name`="percentage", 
                                    `title`="Percentage", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="valid_percentage", 
                                    `title`="Valid %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="cumulative_count", 
                                    `title`="Cumulative Count", 
                                    `type`="integer"),
                                list(
                                    `name`="cumulative_percentage", 
                                    `title`="Cumulative %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="rank", 
                                    `title`="Rank", 
                                    `type`="integer"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="combinedFactorAnalysis",
                            title="Combined Factor Analysis",
                            visible="(showCombinedAnalysis)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="level", 
                                    `title`="Level", 
                                    `type`="text"),
                                list(
                                    `name`="count", 
                                    `title`="Count", 
                                    `type`="integer"),
                                list(
                                    `name`="percentage", 
                                    `title`="Percentage", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="category_rank", 
                                    `title`="Rank Within Variable", 
                                    `type`="integer"),
                                list(
                                    `name`="global_rank", 
                                    `title`="Global Rank", 
                                    `type`="integer"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="complexityAnalysis",
                            title="Factor Complexity Analysis",
                            visible="(factorComplexityAnalysis)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="shannon_entropy", 
                                    `title`="Shannon Entropy", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="simpson_diversity", 
                                    `title`="Simpson Diversity", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="berger_parker_dominance", 
                                    `title`="Berger-Parker Dominance", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="effective_categories", 
                                    `title`="Effective Categories", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="complexity_score", 
                                    `title`="Complexity Score", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="levelBalanceAnalysis",
                            title="Level Balance Analysis",
                            visible="(levelBalanceAnalysis)",
                            columns=list(
                                list(
                                    `name`="variable", 
                                    `title`="Variable", 
                                    `type`="text"),
                                list(
                                    `name`="gini_coefficient", 
                                    `title`="Gini Coefficient", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="coefficient_variation", 
                                    `title`="Coefficient of Variation", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="balance_ratio", 
                                    `title`="Balance Ratio", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="dominant_level_pct", 
                                    `title`="Dominant Level %", 
                                    `type`="number", 
                                    `format`="zto"),
                                list(
                                    `name`="rare_levels_count", 
                                    `title`="Rare Levels Count", 
                                    `type`="integer"),
                                list(
                                    `name`="balance_category", 
                                    `title`="Balance Category", 
                                    `type`="text"),
                                list(
                                    `name`="recommendation", 
                                    `title`="Recommendation", 
                                    `type`="text"))))
                        self$add(jmvcore::Table$new(
                            options=options,
                            name="comprehensiveAnalysisSummary",
                            title="Comprehensive Factor Analysis Summary",
                            visible="(bluesky_integration && comprehensive_output)",
                            columns=list(
                                list(
                                    `name`="measure", 
                                    `title`="Measure", 
                                    `type`="text"),
                                list(
                                    `name`="value", 
                                    `title`="Value", 
                                    `type`="text"),
                                list(
                                    `name`="interpretation", 
                                    `title`="Interpretation", 
                                    `type`="text"),
                                list(
                                    `name`="clinical_significance", 
                                    `title`="Clinical Significance", 
                                    `type`="text"))))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="clinicalInterpretationGuide",
                            title="Clinical Application Guidance",
                            visible="(clinical_interpretation)"))
                        self$add(jmvcore::Html$new(
                            options=options,
                            name="methodsExplanation",
                            title="Statistical Methods and References",
                            visible="(comprehensive_output)"))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="factorDistributionPlot",
                            title="Factor Distribution Overview",
                            visible="(createVisualizations)",
                            renderFun=".plotFactorDistribution",
                            width=800,
                            height=600))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="topFactorsPlot",
                            title="Top Factor Levels Analysis",
                            visible="(createVisualizations && showOnlyTopFactors)",
                            renderFun=".plotTopFactors",
                            width=700,
                            height=500))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="complexityPlot",
                            title="Factor Complexity Analysis Plot",
                            visible="(factorComplexityAnalysis)",
                            renderFun=".plotComplexity",
                            width=600,
                            height=400))
                        self$add(jmvcore::Image$new(
                            options=options,
                            name="balanceAnalysisPlot",
                            title="Level Balance Analysis Plot",
                            visible="(levelBalanceAnalysis)",
                            renderFun=".plotBalanceAnalysis",
                            width=700,
                            height=500))}))$new(options=options))}))

enhancedfactorvariableBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "enhancedfactorvariableBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "enhancedfactorvariable",
                version = c(0,0,31),
                options = options,
                results = enhancedfactorvariableResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Enhanced Factor Variable Analysis with BlueSky Integration
#'
#' Enhanced factor variable analysis toolkit with BlueSky integration for 
#' comprehensive
#' categorical variable profiling. Includes detailed factor level counting, 
#' top N factor 
#' display, summary statistics, and enhanced visualization capabilities. 
#' Perfect for 
#' exploring categorical pathology variables, biomarker categories, and 
#' clinical 
#' classification systems with advanced filtering and display options.
#' 
#' @param data The data as a data frame.
#' @param vars Factor variables for detailed level analysis (will be converted
#'   to factors if needed)
#' @param showOnlyTopFactors Display only the most frequent factor levels
#'   instead of all levels
#' @param maxTopFactors Number of top factor levels to display when limiting
#'   output
#' @param sortingMethod Method for ordering factor levels in output tables
#' @param showDatasetOverview Display dataset summary with variable counts and
#'   observations
#' @param showNominalSummary Display summary statistics for all factor
#'   variables
#' @param showDetailedLevels Display detailed counts for each factor level
#' @param showCombinedAnalysis Display all factors in a single combined table
#' @param includePercentages Calculate and display percentages for factor
#'   levels
#' @param includeValidPercentages Calculate percentages excluding missing
#'   values
#' @param includeCumulativeStats Calculate and display cumulative frequencies
#'   and percentages
#' @param includeMissing Include missing values (NA) in factor level counts
#' @param missingLabel Label to display for missing factor levels
#' @param minimumCount Hide factor levels with counts below this threshold
#' @param minimumPercentage Hide factor levels with percentages below this
#'   threshold
#' @param excludeRareFactors Group infrequent factor levels into "Other"
#'   category
#' @param rareFactorThreshold Percentage threshold below which factors are
#'   considered rare
#' @param rareFactorLabel Label for grouped rare factor levels
#' @param factorComplexityAnalysis Analyze factor complexity with entropy and
#'   diversity measures
#' @param levelBalanceAnalysis Analyze balance between factor levels with
#'   statistical measures
#' @param bluesky_integration Use BlueSky R statistical environment features
#'   and algorithms
#' @param comprehensive_output Include comprehensive statistical details and
#'   diagnostics
#' @param clinical_interpretation Provide clinical context for factor variable
#'   analysis results
#' @param createVisualizations Generate plots for factor variable analysis
#' @param plotTopFactorsOnly Limit plots to top factor levels only
#' @param plotOrientation Orientation for factor level bar plots
#' @param plotTheme Visual theme for factor analysis plots
#' @param outputFormat Output format style for tables and results
#' @param includeMethodology Include detailed methodology and references in
#'   output
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$datasetOverview} \tab \tab \tab \tab \tab Summary of dataset characteristics for factor analysis \cr
#'   \code{results$results$nominalSummary} \tab \tab \tab \tab \tab Summary statistics for all factor variables \cr
#'   \code{results$results$detailedLevelsAnalysis} \tab \tab \tab \tab \tab Detailed counts and percentages for each factor level \cr
#'   \code{results$results$combinedFactorAnalysis} \tab \tab \tab \tab \tab All factor variables combined in a single analysis table \cr
#'   \code{results$results$complexityAnalysis} \tab \tab \tab \tab \tab Complexity metrics for factor variables including entropy and diversity \cr
#'   \code{results$results$levelBalanceAnalysis} \tab \tab \tab \tab \tab Balance metrics for factor level distributions \cr
#'   \code{results$results$comprehensiveAnalysisSummary} \tab \tab \tab \tab \tab Enhanced statistical summary with BlueSky integration \cr
#'   \code{results$results$clinicalInterpretationGuide} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$methodsExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$results$factorDistributionPlot} \tab \tab \tab \tab \tab Overview of factor level distributions across all variables \cr
#'   \code{results$results$topFactorsPlot} \tab \tab \tab \tab \tab Bar plot showing most frequent factor levels \cr
#'   \code{results$results$complexityPlot} \tab \tab \tab \tab \tab Visualization of factor complexity metrics \cr
#'   \code{results$results$balanceAnalysisPlot} \tab \tab \tab \tab \tab Visualization of factor level balance across variables \cr
#' }
#'
#' @export
enhancedfactorvariable <- function(
    data,
    vars,
    showOnlyTopFactors = TRUE,
    maxTopFactors = 30,
    sortingMethod = "freq_desc",
    showDatasetOverview = TRUE,
    showNominalSummary = TRUE,
    showDetailedLevels = TRUE,
    showCombinedAnalysis = FALSE,
    includePercentages = TRUE,
    includeValidPercentages = TRUE,
    includeCumulativeStats = FALSE,
    includeMissing = TRUE,
    missingLabel = "<Missing>",
    minimumCount = 1,
    minimumPercentage = 0,
    excludeRareFactors = FALSE,
    rareFactorThreshold = 1,
    rareFactorLabel = "Other",
    factorComplexityAnalysis = FALSE,
    levelBalanceAnalysis = FALSE,
    bluesky_integration = TRUE,
    comprehensive_output = FALSE,
    clinical_interpretation = TRUE,
    createVisualizations = TRUE,
    plotTopFactorsOnly = TRUE,
    plotOrientation = "horizontal",
    plotTheme = "clinical",
    outputFormat = "standard",
    includeMethodology = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("enhancedfactorvariable requires jmvcore to be installed (restart may be required)")

    if ( ! missing(vars)) vars <- jmvcore::resolveQuo(jmvcore::enquo(vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(vars), vars, NULL))


    options <- enhancedfactorvariableOptions$new(
        vars = vars,
        showOnlyTopFactors = showOnlyTopFactors,
        maxTopFactors = maxTopFactors,
        sortingMethod = sortingMethod,
        showDatasetOverview = showDatasetOverview,
        showNominalSummary = showNominalSummary,
        showDetailedLevels = showDetailedLevels,
        showCombinedAnalysis = showCombinedAnalysis,
        includePercentages = includePercentages,
        includeValidPercentages = includeValidPercentages,
        includeCumulativeStats = includeCumulativeStats,
        includeMissing = includeMissing,
        missingLabel = missingLabel,
        minimumCount = minimumCount,
        minimumPercentage = minimumPercentage,
        excludeRareFactors = excludeRareFactors,
        rareFactorThreshold = rareFactorThreshold,
        rareFactorLabel = rareFactorLabel,
        factorComplexityAnalysis = factorComplexityAnalysis,
        levelBalanceAnalysis = levelBalanceAnalysis,
        bluesky_integration = bluesky_integration,
        comprehensive_output = comprehensive_output,
        clinical_interpretation = clinical_interpretation,
        createVisualizations = createVisualizations,
        plotTopFactorsOnly = plotTopFactorsOnly,
        plotOrientation = plotOrientation,
        plotTheme = plotTheme,
        outputFormat = outputFormat,
        includeMethodology = includeMethodology)

    analysis <- enhancedfactorvariableClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

