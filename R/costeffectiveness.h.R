
# This file is automatically generated, you probably don't want to edit this

costeffectivenessOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "costeffectivenessOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            strategy = NULL,
            comparator_level = NULL,
            cost = NULL,
            effectiveness = NULL,
            effectiveness_type = "binary",
            effectiveness_label = "Correct Diagnoses",
            calculate_icer = TRUE,
            calculate_incremental = TRUE,
            dominance_analysis = TRUE,
            net_monetary_benefit = TRUE,
            wtp_threshold = 50000,
            multiple_wtp_thresholds = TRUE,
            wtp_range = "0, 25000, 50000, 100000, 150000",
            confidence_intervals = TRUE,
            ci_method = "bootstrap",
            bootstrap_samples = 1000,
            confidence_level = 0.95,
            deterministic_sensitivity = TRUE,
            sensitivity_parameters = "test_cost, follow_up_cost, test_sensitivity, test_specificity",
            sensitivity_range_pct = 20,
            probabilistic_sensitivity = FALSE,
            psa_simulations = 1000,
            cost_distribution = "gamma",
            effect_distribution = "normal",
            voi_analysis = FALSE,
            evpi_population = 10000,
            evppi_parameters = FALSE,
            evppi_focus = "both",
            subgroup_analysis = FALSE,
            subgroup_variable = NULL,
            time_horizon = 1,
            discount_costs = FALSE,
            discount_rate_costs = 3,
            discount_effects = FALSE,
            discount_rate_effects = 3,
            plot_ce_plane = TRUE,
            plot_ce_acceptability = FALSE,
            plot_nmb = TRUE,
            plot_tornado = FALSE,
            plot_incremental_frontier = FALSE,
            perspective = "healthcare",
            include_indirect_costs = FALSE,
            currency = "USD",
            cost_year = 2024,
            handling_missing = "complete",
            random_seed = 12345, ...) {

            super$initialize(
                package="ClinicoPath",
                name="costeffectiveness",
                requiresData=TRUE,
                ...)

            private$..strategy <- jmvcore::OptionVariable$new(
                "strategy",
                strategy,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..comparator_level <- jmvcore::OptionLevel$new(
                "comparator_level",
                comparator_level,
                variable="(strategy)")
            private$..cost <- jmvcore::OptionVariable$new(
                "cost",
                cost,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..effectiveness <- jmvcore::OptionVariable$new(
                "effectiveness",
                effectiveness,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..effectiveness_type <- jmvcore::OptionList$new(
                "effectiveness_type",
                effectiveness_type,
                options=list(
                    "binary",
                    "qaly",
                    "life_years",
                    "events",
                    "custom"),
                default="binary")
            private$..effectiveness_label <- jmvcore::OptionString$new(
                "effectiveness_label",
                effectiveness_label,
                default="Correct Diagnoses")
            private$..calculate_icer <- jmvcore::OptionBool$new(
                "calculate_icer",
                calculate_icer,
                default=TRUE)
            private$..calculate_incremental <- jmvcore::OptionBool$new(
                "calculate_incremental",
                calculate_incremental,
                default=TRUE)
            private$..dominance_analysis <- jmvcore::OptionBool$new(
                "dominance_analysis",
                dominance_analysis,
                default=TRUE)
            private$..net_monetary_benefit <- jmvcore::OptionBool$new(
                "net_monetary_benefit",
                net_monetary_benefit,
                default=TRUE)
            private$..wtp_threshold <- jmvcore::OptionNumber$new(
                "wtp_threshold",
                wtp_threshold,
                default=50000,
                min=0)
            private$..multiple_wtp_thresholds <- jmvcore::OptionBool$new(
                "multiple_wtp_thresholds",
                multiple_wtp_thresholds,
                default=TRUE)
            private$..wtp_range <- jmvcore::OptionString$new(
                "wtp_range",
                wtp_range,
                default="0, 25000, 50000, 100000, 150000")
            private$..confidence_intervals <- jmvcore::OptionBool$new(
                "confidence_intervals",
                confidence_intervals,
                default=TRUE)
            private$..ci_method <- jmvcore::OptionList$new(
                "ci_method",
                ci_method,
                options=list(
                    "bootstrap",
                    "bca",
                    "parametric"),
                default="bootstrap")
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=1000,
                min=100,
                max=10000)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..deterministic_sensitivity <- jmvcore::OptionBool$new(
                "deterministic_sensitivity",
                deterministic_sensitivity,
                default=TRUE)
            private$..sensitivity_parameters <- jmvcore::OptionString$new(
                "sensitivity_parameters",
                sensitivity_parameters,
                default="test_cost, follow_up_cost, test_sensitivity, test_specificity")
            private$..sensitivity_range_pct <- jmvcore::OptionNumber$new(
                "sensitivity_range_pct",
                sensitivity_range_pct,
                default=20,
                min=5,
                max=50)
            private$..probabilistic_sensitivity <- jmvcore::OptionBool$new(
                "probabilistic_sensitivity",
                probabilistic_sensitivity,
                default=FALSE)
            private$..psa_simulations <- jmvcore::OptionInteger$new(
                "psa_simulations",
                psa_simulations,
                default=1000,
                min=100,
                max=10000)
            private$..cost_distribution <- jmvcore::OptionList$new(
                "cost_distribution",
                cost_distribution,
                options=list(
                    "gamma",
                    "lognormal",
                    "normal"),
                default="gamma")
            private$..effect_distribution <- jmvcore::OptionList$new(
                "effect_distribution",
                effect_distribution,
                options=list(
                    "beta",
                    "normal",
                    "binomial"),
                default="normal")
            private$..voi_analysis <- jmvcore::OptionBool$new(
                "voi_analysis",
                voi_analysis,
                default=FALSE)
            private$..evpi_population <- jmvcore::OptionInteger$new(
                "evpi_population",
                evpi_population,
                default=10000,
                min=1,
                max=100000000)
            private$..evppi_parameters <- jmvcore::OptionBool$new(
                "evppi_parameters",
                evppi_parameters,
                default=FALSE)
            private$..evppi_focus <- jmvcore::OptionList$new(
                "evppi_focus",
                evppi_focus,
                options=list(
                    "costs",
                    "effects",
                    "both"),
                default="both")
            private$..subgroup_analysis <- jmvcore::OptionBool$new(
                "subgroup_analysis",
                subgroup_analysis,
                default=FALSE)
            private$..subgroup_variable <- jmvcore::OptionVariable$new(
                "subgroup_variable",
                subgroup_variable,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..time_horizon <- jmvcore::OptionNumber$new(
                "time_horizon",
                time_horizon,
                default=1,
                min=0)
            private$..discount_costs <- jmvcore::OptionBool$new(
                "discount_costs",
                discount_costs,
                default=FALSE)
            private$..discount_rate_costs <- jmvcore::OptionNumber$new(
                "discount_rate_costs",
                discount_rate_costs,
                default=3,
                min=0,
                max=10)
            private$..discount_effects <- jmvcore::OptionBool$new(
                "discount_effects",
                discount_effects,
                default=FALSE)
            private$..discount_rate_effects <- jmvcore::OptionNumber$new(
                "discount_rate_effects",
                discount_rate_effects,
                default=3,
                min=0,
                max=10)
            private$..plot_ce_plane <- jmvcore::OptionBool$new(
                "plot_ce_plane",
                plot_ce_plane,
                default=TRUE)
            private$..plot_ce_acceptability <- jmvcore::OptionBool$new(
                "plot_ce_acceptability",
                plot_ce_acceptability,
                default=FALSE)
            private$..plot_nmb <- jmvcore::OptionBool$new(
                "plot_nmb",
                plot_nmb,
                default=TRUE)
            private$..plot_tornado <- jmvcore::OptionBool$new(
                "plot_tornado",
                plot_tornado,
                default=FALSE)
            private$..plot_incremental_frontier <- jmvcore::OptionBool$new(
                "plot_incremental_frontier",
                plot_incremental_frontier,
                default=FALSE)
            private$..perspective <- jmvcore::OptionList$new(
                "perspective",
                perspective,
                options=list(
                    "healthcare",
                    "provider",
                    "payer",
                    "societal"),
                default="healthcare")
            private$..include_indirect_costs <- jmvcore::OptionBool$new(
                "include_indirect_costs",
                include_indirect_costs,
                default=FALSE)
            private$..currency <- jmvcore::OptionString$new(
                "currency",
                currency,
                default="USD")
            private$..cost_year <- jmvcore::OptionInteger$new(
                "cost_year",
                cost_year,
                default=2024,
                min=2000,
                max=2030)
            private$..handling_missing <- jmvcore::OptionList$new(
                "handling_missing",
                handling_missing,
                options=list(
                    "complete",
                    "mean",
                    "mi"),
                default="complete")
            private$..random_seed <- jmvcore::OptionInteger$new(
                "random_seed",
                random_seed,
                default=12345,
                min=1,
                max=999999)

            self$.addOption(private$..strategy)
            self$.addOption(private$..comparator_level)
            self$.addOption(private$..cost)
            self$.addOption(private$..effectiveness)
            self$.addOption(private$..effectiveness_type)
            self$.addOption(private$..effectiveness_label)
            self$.addOption(private$..calculate_icer)
            self$.addOption(private$..calculate_incremental)
            self$.addOption(private$..dominance_analysis)
            self$.addOption(private$..net_monetary_benefit)
            self$.addOption(private$..wtp_threshold)
            self$.addOption(private$..multiple_wtp_thresholds)
            self$.addOption(private$..wtp_range)
            self$.addOption(private$..confidence_intervals)
            self$.addOption(private$..ci_method)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..deterministic_sensitivity)
            self$.addOption(private$..sensitivity_parameters)
            self$.addOption(private$..sensitivity_range_pct)
            self$.addOption(private$..probabilistic_sensitivity)
            self$.addOption(private$..psa_simulations)
            self$.addOption(private$..cost_distribution)
            self$.addOption(private$..effect_distribution)
            self$.addOption(private$..voi_analysis)
            self$.addOption(private$..evpi_population)
            self$.addOption(private$..evppi_parameters)
            self$.addOption(private$..evppi_focus)
            self$.addOption(private$..subgroup_analysis)
            self$.addOption(private$..subgroup_variable)
            self$.addOption(private$..time_horizon)
            self$.addOption(private$..discount_costs)
            self$.addOption(private$..discount_rate_costs)
            self$.addOption(private$..discount_effects)
            self$.addOption(private$..discount_rate_effects)
            self$.addOption(private$..plot_ce_plane)
            self$.addOption(private$..plot_ce_acceptability)
            self$.addOption(private$..plot_nmb)
            self$.addOption(private$..plot_tornado)
            self$.addOption(private$..plot_incremental_frontier)
            self$.addOption(private$..perspective)
            self$.addOption(private$..include_indirect_costs)
            self$.addOption(private$..currency)
            self$.addOption(private$..cost_year)
            self$.addOption(private$..handling_missing)
            self$.addOption(private$..random_seed)
        }),
    active = list(
        strategy = function() private$..strategy$value,
        comparator_level = function() private$..comparator_level$value,
        cost = function() private$..cost$value,
        effectiveness = function() private$..effectiveness$value,
        effectiveness_type = function() private$..effectiveness_type$value,
        effectiveness_label = function() private$..effectiveness_label$value,
        calculate_icer = function() private$..calculate_icer$value,
        calculate_incremental = function() private$..calculate_incremental$value,
        dominance_analysis = function() private$..dominance_analysis$value,
        net_monetary_benefit = function() private$..net_monetary_benefit$value,
        wtp_threshold = function() private$..wtp_threshold$value,
        multiple_wtp_thresholds = function() private$..multiple_wtp_thresholds$value,
        wtp_range = function() private$..wtp_range$value,
        confidence_intervals = function() private$..confidence_intervals$value,
        ci_method = function() private$..ci_method$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        confidence_level = function() private$..confidence_level$value,
        deterministic_sensitivity = function() private$..deterministic_sensitivity$value,
        sensitivity_parameters = function() private$..sensitivity_parameters$value,
        sensitivity_range_pct = function() private$..sensitivity_range_pct$value,
        probabilistic_sensitivity = function() private$..probabilistic_sensitivity$value,
        psa_simulations = function() private$..psa_simulations$value,
        cost_distribution = function() private$..cost_distribution$value,
        effect_distribution = function() private$..effect_distribution$value,
        voi_analysis = function() private$..voi_analysis$value,
        evpi_population = function() private$..evpi_population$value,
        evppi_parameters = function() private$..evppi_parameters$value,
        evppi_focus = function() private$..evppi_focus$value,
        subgroup_analysis = function() private$..subgroup_analysis$value,
        subgroup_variable = function() private$..subgroup_variable$value,
        time_horizon = function() private$..time_horizon$value,
        discount_costs = function() private$..discount_costs$value,
        discount_rate_costs = function() private$..discount_rate_costs$value,
        discount_effects = function() private$..discount_effects$value,
        discount_rate_effects = function() private$..discount_rate_effects$value,
        plot_ce_plane = function() private$..plot_ce_plane$value,
        plot_ce_acceptability = function() private$..plot_ce_acceptability$value,
        plot_nmb = function() private$..plot_nmb$value,
        plot_tornado = function() private$..plot_tornado$value,
        plot_incremental_frontier = function() private$..plot_incremental_frontier$value,
        perspective = function() private$..perspective$value,
        include_indirect_costs = function() private$..include_indirect_costs$value,
        currency = function() private$..currency$value,
        cost_year = function() private$..cost_year$value,
        handling_missing = function() private$..handling_missing$value,
        random_seed = function() private$..random_seed$value),
    private = list(
        ..strategy = NA,
        ..comparator_level = NA,
        ..cost = NA,
        ..effectiveness = NA,
        ..effectiveness_type = NA,
        ..effectiveness_label = NA,
        ..calculate_icer = NA,
        ..calculate_incremental = NA,
        ..dominance_analysis = NA,
        ..net_monetary_benefit = NA,
        ..wtp_threshold = NA,
        ..multiple_wtp_thresholds = NA,
        ..wtp_range = NA,
        ..confidence_intervals = NA,
        ..ci_method = NA,
        ..bootstrap_samples = NA,
        ..confidence_level = NA,
        ..deterministic_sensitivity = NA,
        ..sensitivity_parameters = NA,
        ..sensitivity_range_pct = NA,
        ..probabilistic_sensitivity = NA,
        ..psa_simulations = NA,
        ..cost_distribution = NA,
        ..effect_distribution = NA,
        ..voi_analysis = NA,
        ..evpi_population = NA,
        ..evppi_parameters = NA,
        ..evppi_focus = NA,
        ..subgroup_analysis = NA,
        ..subgroup_variable = NA,
        ..time_horizon = NA,
        ..discount_costs = NA,
        ..discount_rate_costs = NA,
        ..discount_effects = NA,
        ..discount_rate_effects = NA,
        ..plot_ce_plane = NA,
        ..plot_ce_acceptability = NA,
        ..plot_nmb = NA,
        ..plot_tornado = NA,
        ..plot_incremental_frontier = NA,
        ..perspective = NA,
        ..include_indirect_costs = NA,
        ..currency = NA,
        ..cost_year = NA,
        ..handling_missing = NA,
        ..random_seed = NA)
)

costeffectivenessResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "costeffectivenessResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        strategySummary = function() private$.items[["strategySummary"]],
        incrementalAnalysis = function() private$.items[["incrementalAnalysis"]],
        netBenefit = function() private$.items[["netBenefit"]],
        multipleWTP = function() private$.items[["multipleWTP"]],
        dominanceTable = function() private$.items[["dominanceTable"]],
        subgroupCEA = function() private$.items[["subgroupCEA"]],
        sensitivityAnalysis = function() private$.items[["sensitivityAnalysis"]],
        psaSummary = function() private$.items[["psaSummary"]],
        voiSummary = function() private$.items[["voiSummary"]],
        evppiTable = function() private$.items[["evppiTable"]],
        cePlanePlot = function() private$.items[["cePlanePlot"]],
        ceAcceptabilityCurve = function() private$.items[["ceAcceptabilityCurve"]],
        nmbPlot = function() private$.items[["nmbPlot"]],
        tornadoPlot = function() private$.items[["tornadoPlot"]],
        incrementalFrontierPlot = function() private$.items[["incrementalFrontierPlot"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Cost-Effectiveness Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="strategySummary",
                title="Strategy Summary (Mean Costs and Effects)",
                visible=TRUE,
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="mean_cost", 
                        `title`="Mean Cost", 
                        `type`="number"),
                    list(
                        `name`="cost_ci_lower", 
                        `title`="Cost 95% CI Lower", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"),
                    list(
                        `name`="cost_ci_upper", 
                        `title`="Cost 95% CI Upper", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"),
                    list(
                        `name`="mean_effect", 
                        `title`="Mean Effectiveness", 
                        `type`="number"),
                    list(
                        `name`="effect_ci_lower", 
                        `title`="Effect 95% CI Lower", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"),
                    list(
                        `name`="effect_ci_upper", 
                        `title`="Effect 95% CI Upper", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="incrementalAnalysis",
                title="Incremental Cost-Effectiveness Analysis",
                visible="(calculate_incremental)",
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="incremental_cost", 
                        `title`="Incremental Cost", 
                        `type`="number"),
                    list(
                        `name`="incremental_effect", 
                        `title`="Incremental Effect", 
                        `type`="number"),
                    list(
                        `name`="icer", 
                        `title`="ICER", 
                        `type`="number", 
                        `visible`="(calculate_icer)"),
                    list(
                        `name`="icer_interpretation", 
                        `title`="ICER Interpretation", 
                        `type`="text", 
                        `visible`="(calculate_icer)"),
                    list(
                        `name`="dominance", 
                        `title`="Dominance Status", 
                        `type`="text", 
                        `visible`="(dominance_analysis)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="netBenefit",
                title="Net Monetary Benefit Analysis",
                visible="(net_monetary_benefit)",
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="wtp_threshold", 
                        `title`="WTP Threshold", 
                        `type`="number"),
                    list(
                        `name`="nmb", 
                        `title`="Net Monetary Benefit", 
                        `type`="number"),
                    list(
                        `name`="nmb_ci_lower", 
                        `title`="NMB 95% CI Lower", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"),
                    list(
                        `name`="nmb_ci_upper", 
                        `title`="NMB 95% CI Upper", 
                        `type`="number", 
                        `visible`="(confidence_intervals)"),
                    list(
                        `name`="optimal", 
                        `title`="Optimal at WTP?", 
                        `type`="text"),
                    list(
                        `name`="probability_optimal", 
                        `title`="P(Optimal)", 
                        `type`="number", 
                        `format`="zto,pvalue", 
                        `visible`="(probabilistic_sensitivity)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="multipleWTP",
                title="Cost-Effectiveness at Multiple WTP Thresholds",
                visible="(multiple_wtp_thresholds)",
                columns=list(
                    list(
                        `name`="wtp_threshold", 
                        `title`="WTP Threshold", 
                        `type`="number"),
                    list(
                        `name`="optimal_strategy", 
                        `title`="Optimal Strategy", 
                        `type`="text"),
                    list(
                        `name`="max_nmb", 
                        `title`="Maximum NMB", 
                        `type`="number"),
                    list(
                        `name`="icer_vs_comparator", 
                        `title`="ICER vs. Comparator", 
                        `type`="number"),
                    list(
                        `name`="cost_effective", 
                        `title`="Cost-Effective?", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="dominanceTable",
                title="Dominance Analysis",
                visible="(dominance_analysis)",
                columns=list(
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="dominated", 
                        `title`="Dominated?", 
                        `type`="text"),
                    list(
                        `name`="dominated_by", 
                        `title`="Dominated By", 
                        `type`="text"),
                    list(
                        `name`="reason", 
                        `title`="Reason", 
                        `type`="text"),
                    list(
                        `name`="on_frontier", 
                        `title`="On Efficient Frontier?", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="subgroupCEA",
                title="Subgroup Cost-Effectiveness",
                visible="(subgroup_analysis)",
                columns=list(
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="strategy", 
                        `title`="Strategy", 
                        `type`="text"),
                    list(
                        `name`="n", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="incremental_cost", 
                        `title`="Incremental Cost", 
                        `type`="number"),
                    list(
                        `name`="incremental_effect", 
                        `title`="Incremental Effect", 
                        `type`="number"),
                    list(
                        `name`="icer", 
                        `title`="ICER", 
                        `type`="number"),
                    list(
                        `name`="cost_effective_at_wtp", 
                        `title`="Cost-Effective at WTP?", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityAnalysis",
                title="One-Way Sensitivity Analysis (Deterministic)",
                visible="(deterministic_sensitivity)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="base_value", 
                        `title`="Base Value", 
                        `type`="number"),
                    list(
                        `name`="low_value", 
                        `title`="Low Value", 
                        `type`="number"),
                    list(
                        `name`="high_value", 
                        `title`="High Value", 
                        `type`="number"),
                    list(
                        `name`="icer_at_low", 
                        `title`="ICER (Low)", 
                        `type`="number"),
                    list(
                        `name`="icer_at_high", 
                        `title`="ICER (High)", 
                        `type`="number"),
                    list(
                        `name`="icer_range", 
                        `title`="ICER Range", 
                        `type`="number"),
                    list(
                        `name`="sensitivity_rank", 
                        `title`="Rank (by Impact)", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="psaSummary",
                title="Probabilistic Sensitivity Analysis Summary",
                visible="(probabilistic_sensitivity)",
                rows=1,
                columns=list(
                    list(
                        `name`="n_simulations", 
                        `title`="Simulations", 
                        `type`="integer"),
                    list(
                        `name`="mean_icer", 
                        `title`="Mean ICER", 
                        `type`="number"),
                    list(
                        `name`="median_icer", 
                        `title`="Median ICER", 
                        `type`="number"),
                    list(
                        `name`="icer_ci_lower", 
                        `title`="ICER 95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="icer_ci_upper", 
                        `title`="ICER 95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="prob_cost_effective", 
                        `title`="P(Cost-Effective at WTP)", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="prob_dominant", 
                        `title`="P(Dominant)", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="voiSummary",
                title="Value of Information (EVPI)",
                visible="(voi_analysis)",
                rows=1,
                columns=list(
                    list(
                        `name`="wtp_threshold", 
                        `title`="WTP Threshold", 
                        `type`="number"),
                    list(
                        `name`="evpi_per_person", 
                        `title`="EVPI per Person", 
                        `type`="number"),
                    list(
                        `name`="population_size", 
                        `title`="Population Size", 
                        `type`="integer"),
                    list(
                        `name`="total_evpi", 
                        `title`="Total Population EVPI", 
                        `type`="number"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="evppiTable",
                title="Expected Value of Perfect Parameter Information (EVPPI)",
                visible="(evppi_parameters)",
                columns=list(
                    list(
                        `name`="parameter_group", 
                        `title`="Parameter Group", 
                        `type`="text"),
                    list(
                        `name`="evppi_per_person", 
                        `title`="EVPPI per Person", 
                        `type`="number"),
                    list(
                        `name`="total_evppi", 
                        `title`="Total Population EVPPI", 
                        `type`="number"),
                    list(
                        `name`="percent_of_evpi", 
                        `title`="% of Total EVPI", 
                        `type`="number", 
                        `format`="pc"),
                    list(
                        `name`="research_priority", 
                        `title`="Research Priority", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="cePlanePlot",
                title="Cost-Effectiveness Plane",
                width=600,
                height=500,
                renderFun=".plotCEPlane",
                visible="(plot_ce_plane)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="ceAcceptabilityCurve",
                title="Cost-Effectiveness Acceptability Curve (CEAC)",
                width=600,
                height=500,
                renderFun=".plotCEAC",
                visible="(plot_ce_acceptability)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="nmbPlot",
                title="Net Monetary Benefit by Strategy",
                width=600,
                height=500,
                renderFun=".plotNMB",
                visible="(plot_nmb)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="tornadoPlot",
                title="Tornado Diagram (Sensitivity Analysis)",
                width=600,
                height=600,
                renderFun=".plotTornado",
                visible="(plot_tornado)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="incrementalFrontierPlot",
                title="Incremental Cost-Effectiveness Frontier",
                width=600,
                height=500,
                renderFun=".plotFrontier",
                visible="(plot_incremental_frontier)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Interpretation",
                visible=TRUE))}))

costeffectivenessBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "costeffectivenessBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "costeffectiveness",
                version = c(0,0,32),
                options = options,
                results = costeffectivenessResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Cost-Effectiveness Analysis
#'
#' Cost-Effectiveness Analysis (CEA) for evaluating the economic value of 
#' diagnostic tests, screening programs, and clinical decision strategies. 
#' Calculates Incremental Cost-Effectiveness Ratio (ICER), which represents 
#' the additional cost per additional unit of effectiveness (e.g., cost per 
#' correct diagnosis, cost per QALY gained). The analysis compares new 
#' diagnostic strategies against standard of care or alternative approaches, 
#' visualizing results on the cost-effectiveness plane and calculating net 
#' monetary benefit at various willingness-to-pay thresholds. Essential for 
#' health technology assessment, budget impact analysis, and justifying 
#' adoption of new diagnostic technologies such as multiplex IHC, AI-assisted 
#' pathology, digital pathology platforms, and molecular tests. Supports 
#' deterministic sensitivity analysis (tornado plots) to identify key cost 
#' drivers and probabilistic sensitivity analysis (Monte Carlo simulation) to 
#' quantify uncertainty in cost-effectiveness conclusions. Particularly 
#' valuable for demonstrating value proposition of advanced diagnostics to 
#' hospital administrators, payers, and policy makers.
#' 
#'
#' @examples
#' result <- costeffectiveness(
#'     data = diagnostic_study,
#'     strategy = "test_strategy",
#'     cost = "total_cost",
#'     effectiveness = "correct_diagnoses",
#'     comparator = "standard_care"
#' )
#'
#' @param data The data as a data frame.
#' @param strategy Variable indicating which diagnostic strategy was used for
#'   each observation. Should have at least 2 levels (e.g., "New Test" vs.
#'   "Standard Care").
#' @param comparator_level Which level of strategy variable represents the
#'   comparator (baseline/reference) strategy against which others are compared.
#' @param cost Total cost per patient for the diagnostic strategy. Should
#'   include all relevant costs: test costs, follow-up procedures, treatment
#'   costs, adverse events. Express in consistent currency units (e.g., USD,
#'   EUR).
#' @param effectiveness Effectiveness measure per patient. Can be correct
#'   diagnoses (0/1), QALYs, life-years gained, cancers detected, etc. Higher
#'   values should represent better outcomes.
#' @param effectiveness_type Type of effectiveness measure being analyzed.
#'   Affects interpretation and labeling of ICER results.
#' @param effectiveness_label Custom label for effectiveness measure (e.g.,
#'   "Cancers Detected", "True Positives", "QALYs").
#' @param calculate_icer Calculate Incremental Cost-Effectiveness Ratio. ICER
#'   = (Cost_new - Cost_comparator) / (Effect_new - Effect_comparator).
#'   Represents additional cost per additional unit of effectiveness.
#' @param calculate_incremental Display incremental costs and effects relative
#'   to comparator strategy.
#' @param dominance_analysis Identify dominated strategies (more costly and
#'   less effective) and extended dominance (strategies on inefficient
#'   frontier).
#' @param net_monetary_benefit Calculate Net Monetary Benefit (NMB) at
#'   specified willingness-to-pay thresholds. NMB = (Effectiveness × WTP) -
#'   Cost. Positive NMB indicates cost-effective at that threshold.
#' @param wtp_threshold Willingness-to-pay threshold for primary analysis
#'   (e.g., $50,000 per QALY in US, £20,000-30,000 per QALY in UK). Used for net
#'   benefit calculation.
#' @param multiple_wtp_thresholds Evaluate cost-effectiveness at multiple
#'   willingness-to-pay thresholds to show robustness of conclusions.
#' @param wtp_range Comma-separated list of willingness-to-pay thresholds for
#'   analysis. Example: "0, 20000, 30000, 50000, 100000".
#' @param confidence_intervals Calculate confidence intervals for mean costs,
#'   mean effects, and ICER using bootstrap or parametric methods.
#' @param ci_method Method for confidence interval estimation. Bootstrap is
#'   recommended for cost data (often skewed). BCa (Bias-Corrected Accelerated)
#'   provides better coverage for skewed distributions.
#' @param bootstrap_samples Number of bootstrap resamples for confidence
#'   interval estimation.
#' @param confidence_level Confidence level for interval estimation.
#' @param deterministic_sensitivity One-way sensitivity analysis varying
#'   individual parameters to assess impact on ICER. Creates tornado diagram
#'   showing most influential parameters.
#' @param sensitivity_parameters Comma-separated list of parameter names for
#'   deterministic sensitivity analysis. These should be column names in the
#'   data.
#' @param sensitivity_range_pct Percentage variation around base case for
#'   sensitivity analysis. For example, 20\% means vary parameters from 80\% to
#'   120\% of base value.
#' @param probabilistic_sensitivity Monte Carlo simulation to propagate
#'   uncertainty in all parameters simultaneously. Generates cost-effectiveness
#'   acceptability curve (CEAC) showing probability of cost-effectiveness at
#'   different WTP thresholds.
#' @param psa_simulations Number of Monte Carlo simulations for probabilistic
#'   sensitivity analysis.
#' @param cost_distribution Probability distribution for cost parameter
#'   uncertainty. Gamma is recommended for costs (non-negative, often
#'   right-skewed).
#' @param effect_distribution Probability distribution for effectiveness
#'   parameter uncertainty. Beta is recommended for proportions, normal for
#'   continuous measures.
#' @param voi_analysis Calculate Expected Value of Perfect Information (EVPI)
#'   to quantify the expected cost of uncertainty in the decision. EVPI
#'   represents the maximum value of conducting further research to eliminate
#'   all parameter uncertainty.
#' @param evpi_population Population size affected by the decision over the
#'   relevant time horizon. EVPI is calculated per-person and then multiplied by
#'   population to give total value of eliminating uncertainty.
#' @param evppi_parameters Calculate Expected Value of Perfect Parameter
#'   Information (EVPPI) for specific parameters. Shows which parameters
#'   contribute most to decision uncertainty.
#' @param evppi_focus Which parameters to include in EVPPI calculation. Useful
#'   for identifying whether cost or effectiveness uncertainty drives decision
#'   uncertainty.
#' @param subgroup_analysis Perform cost-effectiveness analysis stratified by
#'   subgroups to identify populations where new strategy is most
#'   cost-effective.
#' @param subgroup_variable Variable defining subgroups for stratified
#'   analysis (e.g., disease stage, age group, risk category).
#' @param time_horizon Time horizon for cost-effectiveness analysis in years.
#'   Short-term for diagnostic tests (1 year), longer for treatments affecting
#'   survival.
#' @param discount_costs Apply discounting to future costs (relevant for
#'   multi-year time horizons).
#' @param discount_rate_costs Annual discount rate for future costs (typically
#'   3-5\% in health economics).
#' @param discount_effects Apply discounting to future health effects (QALYs,
#'   life-years).
#' @param discount_rate_effects Annual discount rate for future effects (often
#'   same as cost discount rate).
#' @param plot_ce_plane Scatter plot showing incremental costs (y-axis) vs.
#'   incremental effects (x-axis). Quadrants indicate dominance relationships.
#'   Willingness-to-pay threshold shown as diagonal line.
#' @param plot_ce_acceptability CEAC showing probability that each strategy is
#'   cost-effective across range of willingness-to-pay thresholds. Requires
#'   probabilistic sensitivity analysis.
#' @param plot_nmb Bar plot showing net monetary benefit for each strategy at
#'   specified WTP threshold. Strategy with highest NMB is optimal.
#' @param plot_tornado Tornado diagram showing one-way sensitivity analysis
#'   results. Parameters ordered by impact on ICER, showing range of ICER values
#'   across parameter uncertainty ranges.
#' @param plot_incremental_frontier Plot showing efficient frontier connecting
#'   non-dominated strategies.
#' @param perspective Perspective for cost-effectiveness analysis determines
#'   which costs are included. Healthcare system includes direct medical costs,
#'   societal includes productivity losses and patient time costs.
#' @param include_indirect_costs Include indirect costs (productivity losses,
#'   patient time) for societal perspective.
#' @param currency Currency for cost reporting (e.g., USD, EUR, GBP, JPY).
#' @param cost_year Reference year for cost values (for inflation adjustment
#'   if needed).
#' @param handling_missing Method for handling missing cost or effectiveness
#'   data.
#' @param random_seed Random seed for bootstrap and Monte Carlo simulations.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$strategySummary} \tab \tab \tab \tab \tab Summary statistics for each diagnostic strategy \cr
#'   \code{results$incrementalAnalysis} \tab \tab \tab \tab \tab Incremental costs, effects, and ICER relative to comparator \cr
#'   \code{results$netBenefit} \tab \tab \tab \tab \tab Net monetary benefit at specified WTP thresholds \cr
#'   \code{results$multipleWTP} \tab \tab \tab \tab \tab NMB and optimal strategy across WTP range \cr
#'   \code{results$dominanceTable} \tab \tab \tab \tab \tab Identification of dominated and extendedly dominated strategies \cr
#'   \code{results$subgroupCEA} \tab \tab \tab \tab \tab ICER by subgroup \cr
#'   \code{results$sensitivityAnalysis} \tab \tab \tab \tab \tab Impact of individual parameter variation on ICER \cr
#'   \code{results$psaSummary} \tab \tab \tab \tab \tab Monte Carlo simulation results \cr
#'   \code{results$voiSummary} \tab \tab \tab \tab \tab Expected value of perfect information analysis \cr
#'   \code{results$evppiTable} \tab \tab \tab \tab \tab Value of information by parameter group \cr
#'   \code{results$cePlanePlot} \tab \tab \tab \tab \tab Incremental costs vs. incremental effects scatter plot \cr
#'   \code{results$ceAcceptabilityCurve} \tab \tab \tab \tab \tab Probability of cost-effectiveness across WTP thresholds \cr
#'   \code{results$nmbPlot} \tab \tab \tab \tab \tab NMB comparison at specified WTP threshold \cr
#'   \code{results$tornadoPlot} \tab \tab \tab \tab \tab One-way sensitivity analysis results \cr
#'   \code{results$incrementalFrontierPlot} \tab \tab \tab \tab \tab Efficient frontier showing non-dominated strategies \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$strategySummary$asDF}
#'
#' \code{as.data.frame(results$strategySummary)}
#'
#' @export
costeffectiveness <- function(
    data,
    strategy,
    comparator_level,
    cost,
    effectiveness,
    effectiveness_type = "binary",
    effectiveness_label = "Correct Diagnoses",
    calculate_icer = TRUE,
    calculate_incremental = TRUE,
    dominance_analysis = TRUE,
    net_monetary_benefit = TRUE,
    wtp_threshold = 50000,
    multiple_wtp_thresholds = TRUE,
    wtp_range = "0, 25000, 50000, 100000, 150000",
    confidence_intervals = TRUE,
    ci_method = "bootstrap",
    bootstrap_samples = 1000,
    confidence_level = 0.95,
    deterministic_sensitivity = TRUE,
    sensitivity_parameters = "test_cost, follow_up_cost, test_sensitivity, test_specificity",
    sensitivity_range_pct = 20,
    probabilistic_sensitivity = FALSE,
    psa_simulations = 1000,
    cost_distribution = "gamma",
    effect_distribution = "normal",
    voi_analysis = FALSE,
    evpi_population = 10000,
    evppi_parameters = FALSE,
    evppi_focus = "both",
    subgroup_analysis = FALSE,
    subgroup_variable,
    time_horizon = 1,
    discount_costs = FALSE,
    discount_rate_costs = 3,
    discount_effects = FALSE,
    discount_rate_effects = 3,
    plot_ce_plane = TRUE,
    plot_ce_acceptability = FALSE,
    plot_nmb = TRUE,
    plot_tornado = FALSE,
    plot_incremental_frontier = FALSE,
    perspective = "healthcare",
    include_indirect_costs = FALSE,
    currency = "USD",
    cost_year = 2024,
    handling_missing = "complete",
    random_seed = 12345) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("costeffectiveness requires jmvcore to be installed (restart may be required)")

    if ( ! missing(strategy)) strategy <- jmvcore::resolveQuo(jmvcore::enquo(strategy))
    if ( ! missing(cost)) cost <- jmvcore::resolveQuo(jmvcore::enquo(cost))
    if ( ! missing(effectiveness)) effectiveness <- jmvcore::resolveQuo(jmvcore::enquo(effectiveness))
    if ( ! missing(subgroup_variable)) subgroup_variable <- jmvcore::resolveQuo(jmvcore::enquo(subgroup_variable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(strategy), strategy, NULL),
            `if`( ! missing(cost), cost, NULL),
            `if`( ! missing(effectiveness), effectiveness, NULL),
            `if`( ! missing(subgroup_variable), subgroup_variable, NULL))

    for (v in strategy) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in subgroup_variable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- costeffectivenessOptions$new(
        strategy = strategy,
        comparator_level = comparator_level,
        cost = cost,
        effectiveness = effectiveness,
        effectiveness_type = effectiveness_type,
        effectiveness_label = effectiveness_label,
        calculate_icer = calculate_icer,
        calculate_incremental = calculate_incremental,
        dominance_analysis = dominance_analysis,
        net_monetary_benefit = net_monetary_benefit,
        wtp_threshold = wtp_threshold,
        multiple_wtp_thresholds = multiple_wtp_thresholds,
        wtp_range = wtp_range,
        confidence_intervals = confidence_intervals,
        ci_method = ci_method,
        bootstrap_samples = bootstrap_samples,
        confidence_level = confidence_level,
        deterministic_sensitivity = deterministic_sensitivity,
        sensitivity_parameters = sensitivity_parameters,
        sensitivity_range_pct = sensitivity_range_pct,
        probabilistic_sensitivity = probabilistic_sensitivity,
        psa_simulations = psa_simulations,
        cost_distribution = cost_distribution,
        effect_distribution = effect_distribution,
        voi_analysis = voi_analysis,
        evpi_population = evpi_population,
        evppi_parameters = evppi_parameters,
        evppi_focus = evppi_focus,
        subgroup_analysis = subgroup_analysis,
        subgroup_variable = subgroup_variable,
        time_horizon = time_horizon,
        discount_costs = discount_costs,
        discount_rate_costs = discount_rate_costs,
        discount_effects = discount_effects,
        discount_rate_effects = discount_rate_effects,
        plot_ce_plane = plot_ce_plane,
        plot_ce_acceptability = plot_ce_acceptability,
        plot_nmb = plot_nmb,
        plot_tornado = plot_tornado,
        plot_incremental_frontier = plot_incremental_frontier,
        perspective = perspective,
        include_indirect_costs = include_indirect_costs,
        currency = currency,
        cost_year = cost_year,
        handling_missing = handling_missing,
        random_seed = random_seed)

    analysis <- costeffectivenessClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

