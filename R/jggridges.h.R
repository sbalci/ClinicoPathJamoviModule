
# This file is automatically generated, you probably don't want to edit this

jggridgesOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggridgesOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            color_var = NULL,
            facet_var = NULL,
            plot_type = "density_ridges",
            scale = 1,
            rel_min_height = 0.01,
            alpha = 0.8,
            bandwidth = "nrd0",
            quantile_lines = FALSE,
            quantiles = "0.25, 0.5, 0.75",
            jittered_points = FALSE,
            point_alpha = 0.5,
            color_palette = "viridis",
            reverse_order = FALSE,
            expand_panel = TRUE,
            theme_style = "theme_ridges",
            x_label = "",
            y_label = "",
            plot_title = "",
            plot_subtitle = "",
            show_mean = FALSE,
            show_statistics = TRUE,
            show_interpretation = TRUE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="jggridges",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..color_var <- jmvcore::OptionVariable$new(
                "color_var",
                color_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..facet_var <- jmvcore::OptionVariable$new(
                "facet_var",
                facet_var,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"),
                default=NULL)
            private$..plot_type <- jmvcore::OptionList$new(
                "plot_type",
                plot_type,
                options=list(
                    "ridgeline",
                    "density_ridges",
                    "density_ridges_gradient",
                    "violin_ridges"),
                default="density_ridges")
            private$..scale <- jmvcore::OptionNumber$new(
                "scale",
                scale,
                default=1,
                min=0.1,
                max=5)
            private$..rel_min_height <- jmvcore::OptionNumber$new(
                "rel_min_height",
                rel_min_height,
                default=0.01,
                min=0.001,
                max=0.1)
            private$..alpha <- jmvcore::OptionNumber$new(
                "alpha",
                alpha,
                default=0.8,
                min=0,
                max=1)
            private$..bandwidth <- jmvcore::OptionList$new(
                "bandwidth",
                bandwidth,
                options=list(
                    "nrd0",
                    "nrd",
                    "ucv",
                    "bcv",
                    "SJ"),
                default="nrd0")
            private$..quantile_lines <- jmvcore::OptionBool$new(
                "quantile_lines",
                quantile_lines,
                default=FALSE)
            private$..quantiles <- jmvcore::OptionString$new(
                "quantiles",
                quantiles,
                default="0.25, 0.5, 0.75")
            private$..jittered_points <- jmvcore::OptionBool$new(
                "jittered_points",
                jittered_points,
                default=FALSE)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                default=0.5,
                min=0,
                max=1)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "viridis",
                    "plasma",
                    "inferno",
                    "magma",
                    "Set1",
                    "Set2",
                    "Dark2",
                    "Paired"),
                default="viridis")
            private$..reverse_order <- jmvcore::OptionBool$new(
                "reverse_order",
                reverse_order,
                default=FALSE)
            private$..expand_panel <- jmvcore::OptionBool$new(
                "expand_panel",
                expand_panel,
                default=TRUE)
            private$..theme_style <- jmvcore::OptionList$new(
                "theme_style",
                theme_style,
                options=list(
                    "theme_ridges",
                    "theme_minimal",
                    "theme_classic",
                    "theme_gray",
                    "theme_bw"),
                default="theme_ridges")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="")
            private$..plot_subtitle <- jmvcore::OptionString$new(
                "plot_subtitle",
                plot_subtitle,
                default="")
            private$..show_mean <- jmvcore::OptionBool$new(
                "show_mean",
                show_mean,
                default=FALSE)
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=TRUE)
            private$..show_interpretation <- jmvcore::OptionBool$new(
                "show_interpretation",
                show_interpretation,
                default=TRUE)

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..color_var)
            self$.addOption(private$..facet_var)
            self$.addOption(private$..plot_type)
            self$.addOption(private$..scale)
            self$.addOption(private$..rel_min_height)
            self$.addOption(private$..alpha)
            self$.addOption(private$..bandwidth)
            self$.addOption(private$..quantile_lines)
            self$.addOption(private$..quantiles)
            self$.addOption(private$..jittered_points)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..reverse_order)
            self$.addOption(private$..expand_panel)
            self$.addOption(private$..theme_style)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..plot_subtitle)
            self$.addOption(private$..show_mean)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..show_interpretation)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        color_var = function() private$..color_var$value,
        facet_var = function() private$..facet_var$value,
        plot_type = function() private$..plot_type$value,
        scale = function() private$..scale$value,
        rel_min_height = function() private$..rel_min_height$value,
        alpha = function() private$..alpha$value,
        bandwidth = function() private$..bandwidth$value,
        quantile_lines = function() private$..quantile_lines$value,
        quantiles = function() private$..quantiles$value,
        jittered_points = function() private$..jittered_points$value,
        point_alpha = function() private$..point_alpha$value,
        color_palette = function() private$..color_palette$value,
        reverse_order = function() private$..reverse_order$value,
        expand_panel = function() private$..expand_panel$value,
        theme_style = function() private$..theme_style$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        plot_title = function() private$..plot_title$value,
        plot_subtitle = function() private$..plot_subtitle$value,
        show_mean = function() private$..show_mean$value,
        show_statistics = function() private$..show_statistics$value,
        show_interpretation = function() private$..show_interpretation$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..color_var = NA,
        ..facet_var = NA,
        ..plot_type = NA,
        ..scale = NA,
        ..rel_min_height = NA,
        ..alpha = NA,
        ..bandwidth = NA,
        ..quantile_lines = NA,
        ..quantiles = NA,
        ..jittered_points = NA,
        ..point_alpha = NA,
        ..color_palette = NA,
        ..reverse_order = NA,
        ..expand_panel = NA,
        ..theme_style = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..plot_title = NA,
        ..plot_subtitle = NA,
        ..show_mean = NA,
        ..show_statistics = NA,
        ..show_interpretation = NA)
)

jggridgesResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggridgesResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        interpretation = function() private$.items[["interpretation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Ridge Plot Results")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE,
                refs=list()))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Ridge Plot",
                width=800,
                height=600,
                renderFun=".plot",
                requiresData=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistics",
                title="Summary Statistics",
                visible="(show_statistics)",
                refs=list()))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Interpretation",
                visible="(show_interpretation)",
                refs=list()))}))

jggridgesBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "jggridgesBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "jggridges",
                version = c(0,0,31),
                options = options,
                results = jggridgesResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Ridge Plot Visualization
#'
#' 
#' @param data R object to use
#' @param x_var Continuous variable for distribution visualization
#' @param y_var Grouping variable for separate ridges
#' @param color_var Variable for color mapping
#' @param facet_var Variable for facetting plots
#' @param plot_type Type of ridge plot to create
#' @param scale Scaling factor for ridge heights
#' @param rel_min_height Minimum height of ridges relative to overall scale
#' @param alpha Transparency level for ridges
#' @param bandwidth Bandwidth selection method for density estimation
#' @param quantile_lines Add quantile lines to ridges
#' @param quantiles Quantiles to display as lines (comma-separated)
#' @param jittered_points Add jittered points below ridges
#' @param point_alpha Transparency for jittered points
#' @param color_palette Color palette for ridges
#' @param reverse_order Reverse the order of groups on Y axis
#' @param expand_panel Remove space around plot area
#' @param theme_style ggplot2 theme style
#' @param x_label Custom label for X axis
#' @param y_label Custom label for Y axis
#' @param plot_title Title for the plot
#' @param plot_subtitle Subtitle for the plot
#' @param show_mean Add vertical lines at group means
#' @param show_statistics Display summary statistics
#' @param show_interpretation Display result interpretation
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
jggridges <- function(
    data,
    x_var,
    y_var,
    color_var = NULL,
    facet_var = NULL,
    plot_type = "density_ridges",
    scale = 1,
    rel_min_height = 0.01,
    alpha = 0.8,
    bandwidth = "nrd0",
    quantile_lines = FALSE,
    quantiles = "0.25, 0.5, 0.75",
    jittered_points = FALSE,
    point_alpha = 0.5,
    color_palette = "viridis",
    reverse_order = FALSE,
    expand_panel = TRUE,
    theme_style = "theme_ridges",
    x_label = "",
    y_label = "",
    plot_title = "",
    plot_subtitle = "",
    show_mean = FALSE,
    show_statistics = TRUE,
    show_interpretation = TRUE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("jggridges requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(color_var)) color_var <- jmvcore::resolveQuo(jmvcore::enquo(color_var))
    if ( ! missing(facet_var)) facet_var <- jmvcore::resolveQuo(jmvcore::enquo(facet_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(color_var), color_var, NULL),
            `if`( ! missing(facet_var), facet_var, NULL))

    for (v in y_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in color_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in facet_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- jggridgesOptions$new(
        x_var = x_var,
        y_var = y_var,
        color_var = color_var,
        facet_var = facet_var,
        plot_type = plot_type,
        scale = scale,
        rel_min_height = rel_min_height,
        alpha = alpha,
        bandwidth = bandwidth,
        quantile_lines = quantile_lines,
        quantiles = quantiles,
        jittered_points = jittered_points,
        point_alpha = point_alpha,
        color_palette = color_palette,
        reverse_order = reverse_order,
        expand_panel = expand_panel,
        theme_style = theme_style,
        x_label = x_label,
        y_label = y_label,
        plot_title = plot_title,
        plot_subtitle = plot_subtitle,
        show_mean = show_mean,
        show_statistics = show_statistics,
        show_interpretation = show_interpretation)

    analysis <- jggridgesClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

