
# This file is automatically generated, you probably don't want to edit this

simonmakuchOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "simonmakuchOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            survivalTime = NULL,
            event = NULL,
            eventLevel = NULL,
            timeDepVariable = NULL,
            timeDepTime = NULL,
            timeDepStatus = NULL,
            exposedLevel = NULL,
            enableMultipleTimeDep = FALSE,
            additionalTimeDepVars = NULL,
            analysisType = "comprehensive",
            confidenceLevel = 0.95,
            performLandmarkAnalysis = FALSE,
            landmarkTimes = "6, 12, 24",
            landmarkWindow = 1,
            performTimeDependentCox = FALSE,
            timeDependentCovariates = NULL,
            testTimeVaryingEffect = FALSE,
            assessImmortalTimeBias = FALSE,
            naiveComparison = FALSE,
            showSimonMakuchPlot = TRUE,
            showLandmarkPlots = FALSE,
            showCumulativeIncidencePlot = FALSE,
            plotTimeRange = "auto",
            showConfidenceIntervals = TRUE,
            showRiskTables = TRUE,
            plotExposureStatus = FALSE,
            performLogRankTest = TRUE,
            performMantelByarTest = FALSE,
            performTimeDepLRTest = FALSE,
            handleTieBreaking = "efron",
            robustVariance = FALSE,
            clusterVariable = NULL,
            showSurvivalEstimates = TRUE,
            showHazardRatios = TRUE,
            showLandmarkResults = FALSE,
            showExposurePatterns = FALSE,
            showModelDiagnostics = FALSE,
            performBootstrapValidation = FALSE,
            bootstrapSamples = 500,
            performSensitivityAnalysis = FALSE,
            showExplanations = TRUE,
            showMethodologyNotes = FALSE,
            includeClinicalGuidance = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="simonmakuch",
                requiresData=TRUE,
                ...)

            private$..survivalTime <- jmvcore::OptionVariable$new(
                "survivalTime",
                survivalTime,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..event <- jmvcore::OptionVariable$new(
                "event",
                event,
                suggested=list(
                    "ordinal",
                    "nominal",
                    "continuous"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..eventLevel <- jmvcore::OptionLevel$new(
                "eventLevel",
                eventLevel,
                variable="(event)")
            private$..timeDepVariable <- jmvcore::OptionVariable$new(
                "timeDepVariable",
                timeDepVariable,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..timeDepTime <- jmvcore::OptionVariable$new(
                "timeDepTime",
                timeDepTime,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..timeDepStatus <- jmvcore::OptionVariable$new(
                "timeDepStatus",
                timeDepStatus,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..exposedLevel <- jmvcore::OptionLevel$new(
                "exposedLevel",
                exposedLevel,
                variable="(timeDepStatus)")
            private$..enableMultipleTimeDep <- jmvcore::OptionBool$new(
                "enableMultipleTimeDep",
                enableMultipleTimeDep,
                default=FALSE)
            private$..additionalTimeDepVars <- jmvcore::OptionVariables$new(
                "additionalTimeDepVars",
                additionalTimeDepVars,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..analysisType <- jmvcore::OptionList$new(
                "analysisType",
                analysisType,
                options=list(
                    "basic",
                    "comprehensive",
                    "landmark",
                    "publication"),
                default="comprehensive")
            private$..confidenceLevel <- jmvcore::OptionNumber$new(
                "confidenceLevel",
                confidenceLevel,
                min=0.8,
                max=0.99,
                default=0.95)
            private$..performLandmarkAnalysis <- jmvcore::OptionBool$new(
                "performLandmarkAnalysis",
                performLandmarkAnalysis,
                default=FALSE)
            private$..landmarkTimes <- jmvcore::OptionString$new(
                "landmarkTimes",
                landmarkTimes,
                default="6, 12, 24")
            private$..landmarkWindow <- jmvcore::OptionNumber$new(
                "landmarkWindow",
                landmarkWindow,
                default=1)
            private$..performTimeDependentCox <- jmvcore::OptionBool$new(
                "performTimeDependentCox",
                performTimeDependentCox,
                default=FALSE)
            private$..timeDependentCovariates <- jmvcore::OptionVariables$new(
                "timeDependentCovariates",
                timeDependentCovariates,
                suggested=list(
                    "continuous",
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..testTimeVaryingEffect <- jmvcore::OptionBool$new(
                "testTimeVaryingEffect",
                testTimeVaryingEffect,
                default=FALSE)
            private$..assessImmortalTimeBias <- jmvcore::OptionBool$new(
                "assessImmortalTimeBias",
                assessImmortalTimeBias,
                default=FALSE)
            private$..naiveComparison <- jmvcore::OptionBool$new(
                "naiveComparison",
                naiveComparison,
                default=FALSE)
            private$..showSimonMakuchPlot <- jmvcore::OptionBool$new(
                "showSimonMakuchPlot",
                showSimonMakuchPlot,
                default=TRUE)
            private$..showLandmarkPlots <- jmvcore::OptionBool$new(
                "showLandmarkPlots",
                showLandmarkPlots,
                default=FALSE)
            private$..showCumulativeIncidencePlot <- jmvcore::OptionBool$new(
                "showCumulativeIncidencePlot",
                showCumulativeIncidencePlot,
                default=FALSE)
            private$..plotTimeRange <- jmvcore::OptionString$new(
                "plotTimeRange",
                plotTimeRange,
                default="auto")
            private$..showConfidenceIntervals <- jmvcore::OptionBool$new(
                "showConfidenceIntervals",
                showConfidenceIntervals,
                default=TRUE)
            private$..showRiskTables <- jmvcore::OptionBool$new(
                "showRiskTables",
                showRiskTables,
                default=TRUE)
            private$..plotExposureStatus <- jmvcore::OptionBool$new(
                "plotExposureStatus",
                plotExposureStatus,
                default=FALSE)
            private$..performLogRankTest <- jmvcore::OptionBool$new(
                "performLogRankTest",
                performLogRankTest,
                default=TRUE)
            private$..performMantelByarTest <- jmvcore::OptionBool$new(
                "performMantelByarTest",
                performMantelByarTest,
                default=FALSE)
            private$..performTimeDepLRTest <- jmvcore::OptionBool$new(
                "performTimeDepLRTest",
                performTimeDepLRTest,
                default=FALSE)
            private$..handleTieBreaking <- jmvcore::OptionList$new(
                "handleTieBreaking",
                handleTieBreaking,
                options=list(
                    "efron",
                    "breslow",
                    "exact"),
                default="efron")
            private$..robustVariance <- jmvcore::OptionBool$new(
                "robustVariance",
                robustVariance,
                default=FALSE)
            private$..clusterVariable <- jmvcore::OptionVariable$new(
                "clusterVariable",
                clusterVariable,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..showSurvivalEstimates <- jmvcore::OptionBool$new(
                "showSurvivalEstimates",
                showSurvivalEstimates,
                default=TRUE)
            private$..showHazardRatios <- jmvcore::OptionBool$new(
                "showHazardRatios",
                showHazardRatios,
                default=TRUE)
            private$..showLandmarkResults <- jmvcore::OptionBool$new(
                "showLandmarkResults",
                showLandmarkResults,
                default=FALSE)
            private$..showExposurePatterns <- jmvcore::OptionBool$new(
                "showExposurePatterns",
                showExposurePatterns,
                default=FALSE)
            private$..showModelDiagnostics <- jmvcore::OptionBool$new(
                "showModelDiagnostics",
                showModelDiagnostics,
                default=FALSE)
            private$..performBootstrapValidation <- jmvcore::OptionBool$new(
                "performBootstrapValidation",
                performBootstrapValidation,
                default=FALSE)
            private$..bootstrapSamples <- jmvcore::OptionNumber$new(
                "bootstrapSamples",
                bootstrapSamples,
                min=100,
                max=2000,
                default=500)
            private$..performSensitivityAnalysis <- jmvcore::OptionBool$new(
                "performSensitivityAnalysis",
                performSensitivityAnalysis,
                default=FALSE)
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=TRUE)
            private$..showMethodologyNotes <- jmvcore::OptionBool$new(
                "showMethodologyNotes",
                showMethodologyNotes,
                default=FALSE)
            private$..includeClinicalGuidance <- jmvcore::OptionBool$new(
                "includeClinicalGuidance",
                includeClinicalGuidance,
                default=FALSE)

            self$.addOption(private$..survivalTime)
            self$.addOption(private$..event)
            self$.addOption(private$..eventLevel)
            self$.addOption(private$..timeDepVariable)
            self$.addOption(private$..timeDepTime)
            self$.addOption(private$..timeDepStatus)
            self$.addOption(private$..exposedLevel)
            self$.addOption(private$..enableMultipleTimeDep)
            self$.addOption(private$..additionalTimeDepVars)
            self$.addOption(private$..analysisType)
            self$.addOption(private$..confidenceLevel)
            self$.addOption(private$..performLandmarkAnalysis)
            self$.addOption(private$..landmarkTimes)
            self$.addOption(private$..landmarkWindow)
            self$.addOption(private$..performTimeDependentCox)
            self$.addOption(private$..timeDependentCovariates)
            self$.addOption(private$..testTimeVaryingEffect)
            self$.addOption(private$..assessImmortalTimeBias)
            self$.addOption(private$..naiveComparison)
            self$.addOption(private$..showSimonMakuchPlot)
            self$.addOption(private$..showLandmarkPlots)
            self$.addOption(private$..showCumulativeIncidencePlot)
            self$.addOption(private$..plotTimeRange)
            self$.addOption(private$..showConfidenceIntervals)
            self$.addOption(private$..showRiskTables)
            self$.addOption(private$..plotExposureStatus)
            self$.addOption(private$..performLogRankTest)
            self$.addOption(private$..performMantelByarTest)
            self$.addOption(private$..performTimeDepLRTest)
            self$.addOption(private$..handleTieBreaking)
            self$.addOption(private$..robustVariance)
            self$.addOption(private$..clusterVariable)
            self$.addOption(private$..showSurvivalEstimates)
            self$.addOption(private$..showHazardRatios)
            self$.addOption(private$..showLandmarkResults)
            self$.addOption(private$..showExposurePatterns)
            self$.addOption(private$..showModelDiagnostics)
            self$.addOption(private$..performBootstrapValidation)
            self$.addOption(private$..bootstrapSamples)
            self$.addOption(private$..performSensitivityAnalysis)
            self$.addOption(private$..showExplanations)
            self$.addOption(private$..showMethodologyNotes)
            self$.addOption(private$..includeClinicalGuidance)
        }),
    active = list(
        survivalTime = function() private$..survivalTime$value,
        event = function() private$..event$value,
        eventLevel = function() private$..eventLevel$value,
        timeDepVariable = function() private$..timeDepVariable$value,
        timeDepTime = function() private$..timeDepTime$value,
        timeDepStatus = function() private$..timeDepStatus$value,
        exposedLevel = function() private$..exposedLevel$value,
        enableMultipleTimeDep = function() private$..enableMultipleTimeDep$value,
        additionalTimeDepVars = function() private$..additionalTimeDepVars$value,
        analysisType = function() private$..analysisType$value,
        confidenceLevel = function() private$..confidenceLevel$value,
        performLandmarkAnalysis = function() private$..performLandmarkAnalysis$value,
        landmarkTimes = function() private$..landmarkTimes$value,
        landmarkWindow = function() private$..landmarkWindow$value,
        performTimeDependentCox = function() private$..performTimeDependentCox$value,
        timeDependentCovariates = function() private$..timeDependentCovariates$value,
        testTimeVaryingEffect = function() private$..testTimeVaryingEffect$value,
        assessImmortalTimeBias = function() private$..assessImmortalTimeBias$value,
        naiveComparison = function() private$..naiveComparison$value,
        showSimonMakuchPlot = function() private$..showSimonMakuchPlot$value,
        showLandmarkPlots = function() private$..showLandmarkPlots$value,
        showCumulativeIncidencePlot = function() private$..showCumulativeIncidencePlot$value,
        plotTimeRange = function() private$..plotTimeRange$value,
        showConfidenceIntervals = function() private$..showConfidenceIntervals$value,
        showRiskTables = function() private$..showRiskTables$value,
        plotExposureStatus = function() private$..plotExposureStatus$value,
        performLogRankTest = function() private$..performLogRankTest$value,
        performMantelByarTest = function() private$..performMantelByarTest$value,
        performTimeDepLRTest = function() private$..performTimeDepLRTest$value,
        handleTieBreaking = function() private$..handleTieBreaking$value,
        robustVariance = function() private$..robustVariance$value,
        clusterVariable = function() private$..clusterVariable$value,
        showSurvivalEstimates = function() private$..showSurvivalEstimates$value,
        showHazardRatios = function() private$..showHazardRatios$value,
        showLandmarkResults = function() private$..showLandmarkResults$value,
        showExposurePatterns = function() private$..showExposurePatterns$value,
        showModelDiagnostics = function() private$..showModelDiagnostics$value,
        performBootstrapValidation = function() private$..performBootstrapValidation$value,
        bootstrapSamples = function() private$..bootstrapSamples$value,
        performSensitivityAnalysis = function() private$..performSensitivityAnalysis$value,
        showExplanations = function() private$..showExplanations$value,
        showMethodologyNotes = function() private$..showMethodologyNotes$value,
        includeClinicalGuidance = function() private$..includeClinicalGuidance$value),
    private = list(
        ..survivalTime = NA,
        ..event = NA,
        ..eventLevel = NA,
        ..timeDepVariable = NA,
        ..timeDepTime = NA,
        ..timeDepStatus = NA,
        ..exposedLevel = NA,
        ..enableMultipleTimeDep = NA,
        ..additionalTimeDepVars = NA,
        ..analysisType = NA,
        ..confidenceLevel = NA,
        ..performLandmarkAnalysis = NA,
        ..landmarkTimes = NA,
        ..landmarkWindow = NA,
        ..performTimeDependentCox = NA,
        ..timeDependentCovariates = NA,
        ..testTimeVaryingEffect = NA,
        ..assessImmortalTimeBias = NA,
        ..naiveComparison = NA,
        ..showSimonMakuchPlot = NA,
        ..showLandmarkPlots = NA,
        ..showCumulativeIncidencePlot = NA,
        ..plotTimeRange = NA,
        ..showConfidenceIntervals = NA,
        ..showRiskTables = NA,
        ..plotExposureStatus = NA,
        ..performLogRankTest = NA,
        ..performMantelByarTest = NA,
        ..performTimeDepLRTest = NA,
        ..handleTieBreaking = NA,
        ..robustVariance = NA,
        ..clusterVariable = NA,
        ..showSurvivalEstimates = NA,
        ..showHazardRatios = NA,
        ..showLandmarkResults = NA,
        ..showExposurePatterns = NA,
        ..showModelDiagnostics = NA,
        ..performBootstrapValidation = NA,
        ..bootstrapSamples = NA,
        ..performSensitivityAnalysis = NA,
        ..showExplanations = NA,
        ..showMethodologyNotes = NA,
        ..includeClinicalGuidance = NA)
)

simonmakuchResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "simonmakuchResults",
    inherit = jmvcore::Group,
    active = list(
        welcomeMessage = function() private$.items[["welcomeMessage"]],
        simonMakuchExplanation = function() private$.items[["simonMakuchExplanation"]],
        exposurePatterns = function() private$.items[["exposurePatterns"]],
        survivalEstimates = function() private$.items[["survivalEstimates"]],
        timeDependentCox = function() private$.items[["timeDependentCox"]],
        hazardRatios = function() private$.items[["hazardRatios"]],
        statisticalTests = function() private$.items[["statisticalTests"]],
        landmarkResults = function() private$.items[["landmarkResults"]],
        immortalTimeBias = function() private$.items[["immortalTimeBias"]],
        timeVaryingEffects = function() private$.items[["timeVaryingEffects"]],
        modelDiagnostics = function() private$.items[["modelDiagnostics"]],
        bootstrapValidation = function() private$.items[["bootstrapValidation"]],
        sensitivityAnalysis = function() private$.items[["sensitivityAnalysis"]],
        landmarkAnalysisExplanation = function() private$.items[["landmarkAnalysisExplanation"]],
        immortalTimeBiasExplanation = function() private$.items[["immortalTimeBiasExplanation"]],
        timeDependentCoxExplanation = function() private$.items[["timeDependentCoxExplanation"]],
        clinicalGuidance = function() private$.items[["clinicalGuidance"]],
        methodologyNotes = function() private$.items[["methodologyNotes"]],
        simonMakuchPlotExplanation = function() private$.items[["simonMakuchPlotExplanation"]],
        simonMakuchPlot = function() private$.items[["simonMakuchPlot"]],
        landmarkPlots = function() private$.items[["landmarkPlots"]],
        cumulativeIncidencePlot = function() private$.items[["cumulativeIncidencePlot"]],
        exposureStatusPlot = function() private$.items[["exposureStatusPlot"]],
        diagnosticPlots = function() private$.items[["diagnosticPlots"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Simon-Makuch Time-Dependent Survival Analysis",
                refs=list(
                    "simon1984",
                    "makuch1982",
                    "therneau2000",
                    "survival",
                    "survminer",
                    "ggplot2",
                    "timereg"))
            self$add(jmvcore::Html$new(
                options=options,
                name="welcomeMessage",
                title="Welcome to Simon-Makuch Analysis",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable")))
            self$add(jmvcore::Html$new(
                options=options,
                name="simonMakuchExplanation",
                title="Understanding Simon-Makuch Analysis",
                visible="(showExplanations)",
                clearWith=list(
                    "showExplanations")))
            self$add(jmvcore::Table$new(
                options=options,
                name="exposurePatterns",
                title="Time-Dependent Exposure Patterns",
                visible="(showExposurePatterns)",
                clearWith=list(
                    "timeDepVariable",
                    "timeDepTime",
                    "timeDepStatus",
                    "showExposurePatterns"),
                columns=list(
                    list(
                        `name`="Pattern", 
                        `title`="Exposure Pattern", 
                        `type`="text"),
                    list(
                        `name`="N", 
                        `title`="N", 
                        `type`="integer"),
                    list(
                        `name`="Percentage", 
                        `title`="Percentage", 
                        `type`="text"),
                    list(
                        `name`="MedianTimeToExposure", 
                        `title`="Median Time to Exposure", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="MedianExposureDuration", 
                        `title`="Median Exposure Duration", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="survivalEstimates",
                title="Simon-Makuch Survival Estimates",
                visible="(showSurvivalEstimates)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "eventLevel",
                    "timeDepVariable",
                    "timeDepStatus",
                    "exposedLevel"),
                columns=list(
                    list(
                        `name`="TimePoint", 
                        `title`="Time", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="ExposureStatus", 
                        `title`="Exposure Status", 
                        `type`="text"),
                    list(
                        `name`="N_Risk", 
                        `title`="N at Risk", 
                        `type`="integer"),
                    list(
                        `name`="N_Events", 
                        `title`="Events", 
                        `type`="integer"),
                    list(
                        `name`="Survival", 
                        `title`="Survival", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="timeDependentCox",
                title="Time-Dependent Cox Regression",
                visible="(performTimeDependentCox)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "eventLevel",
                    "timeDepVariable",
                    "timeDepStatus",
                    "exposedLevel",
                    "timeDependentCovariates"),
                columns=list(
                    list(
                        `name`="Variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="HazardRatio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="SE", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Z_Value", 
                        `title`="Z", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hazardRatios",
                title="Time-Dependent Hazard Ratios",
                visible="(showHazardRatios)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable",
                    "timeDepStatus",
                    "performTimeDependentCox"),
                columns=list(
                    list(
                        `name`="Comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="HazardRatio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="statisticalTests",
                title="Statistical Tests for Time-Dependent Survival",
                visible="(performLogRankTest || performMantelByarTest)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable",
                    "timeDepStatus"),
                columns=list(
                    list(
                        `name`="Test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="Statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Method", 
                        `title`="Method", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="landmarkResults",
                title="Landmark Analysis Results",
                visible="(performLandmarkAnalysis && showLandmarkResults)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable",
                    "landmarkTimes",
                    "performLandmarkAnalysis"),
                columns=list(
                    list(
                        `name`="LandmarkTime", 
                        `title`="Landmark Time", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="N_Eligible", 
                        `title`="N Eligible", 
                        `type`="integer"),
                    list(
                        `name`="N_Exposed", 
                        `title`="N Exposed", 
                        `type`="integer"),
                    list(
                        `name`="N_Unexposed", 
                        `title`="N Unexposed", 
                        `type`="integer"),
                    list(
                        `name`="HazardRatio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="immortalTimeBias",
                title="Immortal Time Bias Assessment",
                visible="(assessImmortalTimeBias)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable",
                    "assessImmortalTimeBias"),
                columns=list(
                    list(
                        `name`="Analysis", 
                        `title`="Analysis Type", 
                        `type`="text"),
                    list(
                        `name`="HazardRatio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="BiasDirection", 
                        `title`="Bias Direction", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="timeVaryingEffects",
                title="Test for Time-Varying Effects",
                visible="(testTimeVaryingEffect)",
                clearWith=list(
                    "timeDepVariable",
                    "testTimeVaryingEffect"),
                columns=list(
                    list(
                        `name`="Variable", 
                        `title`="Variable", 
                        `type`="text"),
                    list(
                        `name`="ChiSquare", 
                        `title`="Chi-Square", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="df", 
                        `title`="df", 
                        `type`="integer"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Conclusion", 
                        `title`="Conclusion", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelDiagnostics",
                title="Time-Dependent Model Diagnostics",
                visible="(showModelDiagnostics && performTimeDependentCox)",
                clearWith=list(
                    "performTimeDependentCox",
                    "showModelDiagnostics"),
                columns=list(
                    list(
                        `name`="Diagnostic", 
                        `title`="Diagnostic Test", 
                        `type`="text"),
                    list(
                        `name`="Statistic", 
                        `title`="Test Statistic", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"),
                    list(
                        `name`="Interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="bootstrapValidation",
                title="Bootstrap Validation Results",
                visible="(performBootstrapValidation)",
                clearWith=list(
                    "performBootstrapValidation",
                    "bootstrapSamples"),
                columns=list(
                    list(
                        `name`="Parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="Original", 
                        `title`="Original", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Bootstrap_Mean", 
                        `title`="Bootstrap Mean", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Bootstrap_SE", 
                        `title`="Bootstrap SE", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Bias", 
                        `title`="Bias", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="Biascorrected", 
                        `title`="Bias-Corrected", 
                        `type`="number", 
                        `format`="zto"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivityAnalysis",
                title="Sensitivity Analysis",
                visible="(performSensitivityAnalysis)",
                clearWith=list(
                    "performSensitivityAnalysis"),
                columns=list(
                    list(
                        `name`="Scenario", 
                        `title`="Scenario", 
                        `type`="text"),
                    list(
                        `name`="HazardRatio", 
                        `title`="Hazard Ratio", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Lower", 
                        `title`="95% CI Lower", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="CI_Upper", 
                        `title`="95% CI Upper", 
                        `type`="number", 
                        `format`="zto"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number", 
                        `format`="zto,pvalue"))))
            self$add(jmvcore::Html$new(
                options=options,
                name="landmarkAnalysisExplanation",
                title="Understanding Landmark Analysis",
                visible="(performLandmarkAnalysis && showExplanations)",
                clearWith=list(
                    "performLandmarkAnalysis",
                    "showExplanations")))
            self$add(jmvcore::Html$new(
                options=options,
                name="immortalTimeBiasExplanation",
                title="Understanding Immortal Time Bias",
                visible="(assessImmortalTimeBias && showExplanations)",
                clearWith=list(
                    "assessImmortalTimeBias",
                    "showExplanations")))
            self$add(jmvcore::Html$new(
                options=options,
                name="timeDependentCoxExplanation",
                title="Understanding Time-Dependent Cox Regression",
                visible="(performTimeDependentCox && showExplanations)",
                clearWith=list(
                    "performTimeDependentCox",
                    "showExplanations")))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinicalGuidance",
                title="Clinical Interpretation of Time-Dependent Survival Analysis",
                visible="(includeClinicalGuidance)",
                clearWith=list(
                    "includeClinicalGuidance")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodologyNotes",
                title="Simon-Makuch Methodology Notes",
                visible="(showMethodologyNotes)",
                clearWith=list(
                    "showMethodologyNotes")))
            self$add(jmvcore::Html$new(
                options=options,
                name="simonMakuchPlotExplanation",
                title="Interpreting Simon-Makuch Plots",
                visible="(showSimonMakuchPlot && showExplanations)",
                clearWith=list(
                    "showSimonMakuchPlot",
                    "showExplanations")))
            self$add(jmvcore::Image$new(
                options=options,
                name="simonMakuchPlot",
                title="Simon-Makuch Survival Curves",
                width=800,
                height=600,
                renderFun=".plotSimonMakuch",
                visible="(showSimonMakuchPlot)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "eventLevel",
                    "timeDepVariable",
                    "timeDepStatus",
                    "exposedLevel",
                    "showSimonMakuchPlot",
                    "plotTimeRange",
                    "showConfidenceIntervals",
                    "showRiskTables")))
            self$add(jmvcore::Image$new(
                options=options,
                name="landmarkPlots",
                title="Landmark Survival Analysis Plots",
                width=800,
                height=600,
                renderFun=".plotLandmarkAnalysis",
                visible="(showLandmarkPlots && performLandmarkAnalysis)",
                clearWith=list(
                    "survivalTime",
                    "event",
                    "timeDepVariable",
                    "landmarkTimes",
                    "performLandmarkAnalysis",
                    "showLandmarkPlots")))
            self$add(jmvcore::Image$new(
                options=options,
                name="cumulativeIncidencePlot",
                title="Cumulative Incidence of Time-Dependent Exposure",
                width=800,
                height=500,
                renderFun=".plotCumulativeIncidence",
                visible="(showCumulativeIncidencePlot)",
                clearWith=list(
                    "timeDepVariable",
                    "timeDepTime",
                    "timeDepStatus",
                    "showCumulativeIncidencePlot")))
            self$add(jmvcore::Image$new(
                options=options,
                name="exposureStatusPlot",
                title="Exposure Status Changes Over Time",
                width=800,
                height=500,
                renderFun=".plotExposureStatus",
                visible="(plotExposureStatus)",
                clearWith=list(
                    "timeDepVariable",
                    "timeDepTime",
                    "timeDepStatus",
                    "plotExposureStatus")))
            self$add(jmvcore::Image$new(
                options=options,
                name="diagnosticPlots",
                title="Time-Dependent Cox Model Diagnostics",
                width=800,
                height=600,
                renderFun=".plotModelDiagnostics",
                visible="(showModelDiagnostics && performTimeDependentCox)",
                clearWith=list(
                    "performTimeDependentCox",
                    "showModelDiagnostics")))}))

simonmakuchBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "simonmakuchBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "simonmakuch",
                version = c(0,0,1),
                options = options,
                results = simonmakuchResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Simon-Makuch Time-Dependent Survival Analysis
#'
#' Performs comprehensive survival analysis with time-dependent variables 
#' using the Simon-Makuch method. This specialized analysis addresses the 
#' critical challenge of immortal time bias when studying treatments, 
#' biomarkers, or exposures that change during patient follow-up.
#' **Clinical Applications:** - Treatment effectiveness when therapy timing 
#' varies (e.g., adjuvant therapy, targeted agents) - Biomarker evolution 
#' studies (e.g., mutation status, protein expression changes) - Disease 
#' progression impact on outcomes (e.g., metastasis development, grade 
#' progression) - Healthcare intervention timing effects (e.g., surgery, 
#' radiation, supportive care)
#' **Key Statistical Methods:** - Simon-Makuch plots: Modified Kaplan-Meier 
#' curves for time-dependent exposures - Landmark analysis: Conditional 
#' survival from fixed time points - Time-dependent Cox regression: Hazard 
#' ratios accounting for exposure timing - Immortal time bias assessment: 
#' Comparison of naive vs. proper methods - Mantel-Byar testing: Specialized 
#' tests for time-dependent comparisons
#' **Why Use Simon-Makuch Analysis:** Standard survival analysis assumes fixed 
#' baseline characteristics, leading to immortal time bias when exposures 
#' change during follow-up. Simon-Makuch methods properly account for the 
#' timing of exposure changes, providing unbiased survival estimates and valid 
#' statistical comparisons.
#'
#' @examples
#' # Load example data
#' data("simon_makuch_simple")
#'
#' # Example 1: Basic Simon-Makuch Analysis
#' # Analyzing survival with time-dependent treatment
#' simonmakuch(
#'     data = simon_makuch_simple,
#'     survivalTime = "follow_up_months",
#'     event = "death_status",
#'     eventLevel = 1,
#'     timeDepVariable = "treatment_exposure",
#'     timeDepTime = "treatment_start_time_clean",
#'     timeDepStatus = "baseline_treatment_status",
#'     exposedLevel = "On-treatment",
#'     showSimonMakuchPlot = TRUE,
#'     showExplanations = TRUE
#' )
#'
#' # Example 2: Comprehensive Analysis with Landmark
#' simonmakuch(
#'     data = simon_makuch_simple,
#'     survivalTime = "follow_up_months",
#'     event = "death_status_factor",
#'     eventLevel = "Dead",
#'     timeDepVariable = "treatment_exposure",
#'     timeDepTime = "treatment_start_time_clean",
#'     timeDepStatus = "baseline_treatment_status",
#'     exposedLevel = "Eventually",
#'     analysisType = "comprehensive",
#'     performLandmarkAnalysis = TRUE,
#'     landmarkTimes = "6, 12, 24",
#'     performTimeDependentCox = TRUE,
#'     assessImmortalTimeBias = TRUE,
#'     showLandmarkPlots = TRUE,
#'     includeClinicalGuidance = TRUE
#' )
#'
#' # Example 3: Publication-Ready Analysis
#' simonmakuch(
#'     data = simon_makuch_simple,
#'     survivalTime = "follow_up_months",
#'     event = "death_status",
#'     eventLevel = 1,
#'     timeDepVariable = "treatment_received",
#'     timeDepTime = "treatment_start_time_clean",
#'     timeDepStatus = "baseline_treatment_status",
#'     exposedLevel = "Yes",
#'     analysisType = "publication",
#'     showSimonMakuchPlot = TRUE,
#'     showConfidenceIntervals = TRUE,
#'     showRiskTables = TRUE,
#'     performLogRankTest = TRUE,
#'     performMantelByarTest = TRUE,
#'     showSurvivalEstimates = TRUE,
#'     showHazardRatios = TRUE,
#'     performBootstrapValidation = TRUE,
#'     showMethodologyNotes = TRUE
#' )
#'
#' @param data The dataset containing survival and time-dependent variable
#'   information.
#' @param survivalTime Time to event or censoring in consistent units (months
#'   recommended). This should be the total follow-up time from study entry.
#' @param event Event indicator (1 = event occurred, 0 = censored) or factor
#'   with event levels. For overall survival, this represents death from any
#'   cause.
#' @param eventLevel The level indicating event occurrence when using factor
#'   variables.
#' @param timeDepVariable The main time-dependent variable of interest (e.g.,
#'   treatment status, biomarker status, disease progression). This variable can
#'   change during follow-up.
#' @param timeDepTime Time when the time-dependent variable changes status.
#'   Use 0 for baseline status, and actual time for when the variable changes
#'   (e.g., time of treatment initiation, biomarker conversion).
#' @param timeDepStatus Status of the time-dependent variable at each time
#'   point. For example: "Unexposed", "Exposed", or "Pre-treatment",
#'   "Post-treatment".
#' @param exposedLevel The level that represents the "exposed" or "active"
#'   status of the time-dependent variable.
#' @param enableMultipleTimeDep Enable analysis of multiple time-dependent
#'   variables simultaneously. Useful for complex exposure patterns or multiple
#'   biomarkers.
#' @param additionalTimeDepVars Additional time-dependent variables to include
#'   in the analysis. Each should have corresponding time and status variables.
#' @param analysisType Type of Simon-Makuch analysis to perform. Comprehensive
#'   includes all methods for thorough time-dependent survival analysis.
#' @param confidenceLevel Confidence level for survival estimates and
#'   statistical tests.
#' @param performLandmarkAnalysis Perform landmark analysis at specified time
#'   points. This method analyzes survival from specific landmark times,
#'   avoiding immortal time bias when studying time-dependent exposures.
#' @param landmarkTimes Comma-separated list of landmark time points for
#'   analysis. Patients must survive to each landmark time to be included in
#'   that analysis.
#' @param landmarkWindow Time window around landmark time for determining
#'   exposure status. Exposure status is determined within this window before
#'   the landmark.
#' @param performTimeDependentCox Perform Cox regression with time-dependent
#'   covariates. This provides hazard ratios that properly account for changing
#'   exposure status.
#' @param timeDependentCovariates Additional covariates to include in
#'   time-dependent Cox regression. These can be baseline variables or other
#'   time-dependent variables.
#' @param testTimeVaryingEffect Test whether the effect of the time-dependent
#'   variable changes over time (non-proportional hazards for time-dependent
#'   covariates).
#' @param assessImmortalTimeBias Assess and correct for immortal time bias in
#'   the analysis. Compares naive analysis (without proper time-dependent
#'   handling) with corrected Simon-Makuch analysis.
#' @param naiveComparison Include comparison with naive analysis that ignores
#'   the time-dependent nature of the exposure. This demonstrates the importance
#'   of proper time-dependent analysis.
#' @param showSimonMakuchPlot Display Simon-Makuch survival curves that
#'   properly account for time-dependent exposure status changes during
#'   follow-up.
#' @param showLandmarkPlots Display survival curves from each landmark time
#'   point, showing how the effect of exposure varies with timing.
#' @param showCumulativeIncidencePlot Display cumulative incidence curves for
#'   time-dependent exposures, useful for understanding exposure patterns over
#'   time.
#' @param plotTimeRange Maximum time for survival plots. Use "auto" for
#'   automatic range or specify maximum months (e.g., "60" for 5-year
#'   follow-up).
#' @param showConfidenceIntervals Display confidence intervals around survival
#'   curves.
#' @param showRiskTables Display at-risk tables below survival curves,
#'   stratified by time-dependent exposure status.
#' @param plotExposureStatus Display plot showing how exposure status changes
#'   over time for the study population.
#' @param performLogRankTest Perform log-rank test comparing survival between
#'   exposure groups, properly accounting for time-dependent nature.
#' @param performMantelByarTest Perform Mantel-Byar test, which is
#'   specifically designed for comparing survival with time-dependent exposures.
#' @param performTimeDepLRTest Perform time-dependent log-rank test that
#'   allows for changing effects of exposure over time.
#' @param handleTieBreaking Method for handling tied event times in Cox
#'   regression.
#' @param robustVariance Use robust (sandwich) variance estimation for Cox
#'   regression to account for potential model misspecification.
#' @param clusterVariable Variable identifying clusters for robust variance
#'   estimation (e.g., hospital, physician, family).
#' @param showSurvivalEstimates Display table with survival estimates at key
#'   time points, stratified by time-dependent exposure status.
#' @param showHazardRatios Display hazard ratios from time-dependent Cox
#'   regression with confidence intervals and p-values.
#' @param showLandmarkResults Display detailed results from landmark analysis
#'   at each specified time point.
#' @param showExposurePatterns Display summary of exposure patterns, including
#'   time to exposure, exposure duration, and switching patterns.
#' @param showModelDiagnostics Display diagnostic plots and statistics for
#'   time-dependent Cox regression models.
#' @param performBootstrapValidation Perform bootstrap validation to assess
#'   stability of results and provide bias-corrected estimates.
#' @param bootstrapSamples Number of bootstrap samples for validation
#'   analysis.
#' @param performSensitivityAnalysis Perform sensitivity analysis with
#'   different assumptions about exposure timing and immortal time handling.
#' @param showExplanations Include detailed explanations for Simon-Makuch
#'   methodology and interpretation of results.
#' @param showMethodologyNotes Display detailed notes on the statistical
#'   methods used and their appropriate interpretation.
#' @param includeClinicalGuidance Include guidance for clinical interpretation
#'   of time-dependent survival analysis results.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$welcomeMessage} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$simonMakuchExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$exposurePatterns} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survivalEstimates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$timeDependentCox} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hazardRatios} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$statisticalTests} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$landmarkResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$immortalTimeBias} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$timeVaryingEffects} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelDiagnostics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$bootstrapValidation} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivityAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$landmarkAnalysisExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$immortalTimeBiasExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$timeDependentCoxExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$clinicalGuidance} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodologyNotes} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$simonMakuchPlotExplanation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$simonMakuchPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$landmarkPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cumulativeIncidencePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$exposureStatusPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$diagnosticPlots} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$exposurePatterns$asDF}
#'
#' \code{as.data.frame(results$exposurePatterns)}
#'
#' @export
simonmakuch <- function(
    data,
    survivalTime,
    event,
    eventLevel,
    timeDepVariable,
    timeDepTime,
    timeDepStatus,
    exposedLevel,
    enableMultipleTimeDep = FALSE,
    additionalTimeDepVars,
    analysisType = "comprehensive",
    confidenceLevel = 0.95,
    performLandmarkAnalysis = FALSE,
    landmarkTimes = "6, 12, 24",
    landmarkWindow = 1,
    performTimeDependentCox = FALSE,
    timeDependentCovariates,
    testTimeVaryingEffect = FALSE,
    assessImmortalTimeBias = FALSE,
    naiveComparison = FALSE,
    showSimonMakuchPlot = TRUE,
    showLandmarkPlots = FALSE,
    showCumulativeIncidencePlot = FALSE,
    plotTimeRange = "auto",
    showConfidenceIntervals = TRUE,
    showRiskTables = TRUE,
    plotExposureStatus = FALSE,
    performLogRankTest = TRUE,
    performMantelByarTest = FALSE,
    performTimeDepLRTest = FALSE,
    handleTieBreaking = "efron",
    robustVariance = FALSE,
    clusterVariable,
    showSurvivalEstimates = TRUE,
    showHazardRatios = TRUE,
    showLandmarkResults = FALSE,
    showExposurePatterns = FALSE,
    showModelDiagnostics = FALSE,
    performBootstrapValidation = FALSE,
    bootstrapSamples = 500,
    performSensitivityAnalysis = FALSE,
    showExplanations = TRUE,
    showMethodologyNotes = FALSE,
    includeClinicalGuidance = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("simonmakuch requires jmvcore to be installed (restart may be required)")

    if ( ! missing(survivalTime)) survivalTime <- jmvcore::resolveQuo(jmvcore::enquo(survivalTime))
    if ( ! missing(event)) event <- jmvcore::resolveQuo(jmvcore::enquo(event))
    if ( ! missing(timeDepVariable)) timeDepVariable <- jmvcore::resolveQuo(jmvcore::enquo(timeDepVariable))
    if ( ! missing(timeDepTime)) timeDepTime <- jmvcore::resolveQuo(jmvcore::enquo(timeDepTime))
    if ( ! missing(timeDepStatus)) timeDepStatus <- jmvcore::resolveQuo(jmvcore::enquo(timeDepStatus))
    if ( ! missing(additionalTimeDepVars)) additionalTimeDepVars <- jmvcore::resolveQuo(jmvcore::enquo(additionalTimeDepVars))
    if ( ! missing(timeDependentCovariates)) timeDependentCovariates <- jmvcore::resolveQuo(jmvcore::enquo(timeDependentCovariates))
    if ( ! missing(clusterVariable)) clusterVariable <- jmvcore::resolveQuo(jmvcore::enquo(clusterVariable))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(survivalTime), survivalTime, NULL),
            `if`( ! missing(event), event, NULL),
            `if`( ! missing(timeDepVariable), timeDepVariable, NULL),
            `if`( ! missing(timeDepTime), timeDepTime, NULL),
            `if`( ! missing(timeDepStatus), timeDepStatus, NULL),
            `if`( ! missing(additionalTimeDepVars), additionalTimeDepVars, NULL),
            `if`( ! missing(timeDependentCovariates), timeDependentCovariates, NULL),
            `if`( ! missing(clusterVariable), clusterVariable, NULL))

    for (v in timeDepVariable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in timeDepStatus) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in additionalTimeDepVars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in clusterVariable) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- simonmakuchOptions$new(
        survivalTime = survivalTime,
        event = event,
        eventLevel = eventLevel,
        timeDepVariable = timeDepVariable,
        timeDepTime = timeDepTime,
        timeDepStatus = timeDepStatus,
        exposedLevel = exposedLevel,
        enableMultipleTimeDep = enableMultipleTimeDep,
        additionalTimeDepVars = additionalTimeDepVars,
        analysisType = analysisType,
        confidenceLevel = confidenceLevel,
        performLandmarkAnalysis = performLandmarkAnalysis,
        landmarkTimes = landmarkTimes,
        landmarkWindow = landmarkWindow,
        performTimeDependentCox = performTimeDependentCox,
        timeDependentCovariates = timeDependentCovariates,
        testTimeVaryingEffect = testTimeVaryingEffect,
        assessImmortalTimeBias = assessImmortalTimeBias,
        naiveComparison = naiveComparison,
        showSimonMakuchPlot = showSimonMakuchPlot,
        showLandmarkPlots = showLandmarkPlots,
        showCumulativeIncidencePlot = showCumulativeIncidencePlot,
        plotTimeRange = plotTimeRange,
        showConfidenceIntervals = showConfidenceIntervals,
        showRiskTables = showRiskTables,
        plotExposureStatus = plotExposureStatus,
        performLogRankTest = performLogRankTest,
        performMantelByarTest = performMantelByarTest,
        performTimeDepLRTest = performTimeDepLRTest,
        handleTieBreaking = handleTieBreaking,
        robustVariance = robustVariance,
        clusterVariable = clusterVariable,
        showSurvivalEstimates = showSurvivalEstimates,
        showHazardRatios = showHazardRatios,
        showLandmarkResults = showLandmarkResults,
        showExposurePatterns = showExposurePatterns,
        showModelDiagnostics = showModelDiagnostics,
        performBootstrapValidation = performBootstrapValidation,
        bootstrapSamples = bootstrapSamples,
        performSensitivityAnalysis = performSensitivityAnalysis,
        showExplanations = showExplanations,
        showMethodologyNotes = showMethodologyNotes,
        includeClinicalGuidance = includeClinicalGuidance)

    analysis <- simonmakuchClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

