
# This file is automatically generated, you probably don't want to edit this

distributionfitOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "distributionfitOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            elapsedtime = NULL,
            outcome = NULL,
            explanatory = NULL,
            outcomeLevel = "1",
            test_weibull = TRUE,
            test_exponential = TRUE,
            test_lognormal = TRUE,
            test_loglogistic = TRUE,
            test_gamma = TRUE,
            test_gengamma = FALSE,
            test_genf = FALSE,
            selection_method = "aic",
            gof_tests = "all_tests",
            confidence_level = 0.95,
            bootstrap_gof = TRUE,
            bootstrap_samples = 1000,
            show_comparison_table = TRUE,
            show_gof_table = TRUE,
            show_parameter_table = TRUE,
            show_survival_plot = TRUE,
            show_hazard_plot = TRUE,
            show_pp_plot = TRUE,
            show_qq_plot = TRUE,
            showSummaries = FALSE,
            showExplanations = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="distributionfit",
                requiresData=FALSE,
                ...)

            private$..elapsedtime <- jmvcore::OptionVariable$new(
                "elapsedtime",
                elapsedtime,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..outcome <- jmvcore::OptionVariable$new(
                "outcome",
                outcome,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..explanatory <- jmvcore::OptionVariables$new(
                "explanatory",
                explanatory,
                suggested=list(
                    "continuous",
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..outcomeLevel <- jmvcore::OptionString$new(
                "outcomeLevel",
                outcomeLevel,
                default="1")
            private$..test_weibull <- jmvcore::OptionBool$new(
                "test_weibull",
                test_weibull,
                default=TRUE)
            private$..test_exponential <- jmvcore::OptionBool$new(
                "test_exponential",
                test_exponential,
                default=TRUE)
            private$..test_lognormal <- jmvcore::OptionBool$new(
                "test_lognormal",
                test_lognormal,
                default=TRUE)
            private$..test_loglogistic <- jmvcore::OptionBool$new(
                "test_loglogistic",
                test_loglogistic,
                default=TRUE)
            private$..test_gamma <- jmvcore::OptionBool$new(
                "test_gamma",
                test_gamma,
                default=TRUE)
            private$..test_gengamma <- jmvcore::OptionBool$new(
                "test_gengamma",
                test_gengamma,
                default=FALSE)
            private$..test_genf <- jmvcore::OptionBool$new(
                "test_genf",
                test_genf,
                default=FALSE)
            private$..selection_method <- jmvcore::OptionList$new(
                "selection_method",
                selection_method,
                options=list(
                    "aic",
                    "bic",
                    "aic_corrected",
                    "likelihood_ratio",
                    "all_criteria"),
                default="aic")
            private$..gof_tests <- jmvcore::OptionList$new(
                "gof_tests",
                gof_tests,
                options=list(
                    "anderson_darling",
                    "kolmogorov_smirnov",
                    "cramer_von_mises",
                    "likelihood_ratio",
                    "all_tests"),
                default="all_tests")
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..bootstrap_gof <- jmvcore::OptionBool$new(
                "bootstrap_gof",
                bootstrap_gof,
                default=TRUE)
            private$..bootstrap_samples <- jmvcore::OptionInteger$new(
                "bootstrap_samples",
                bootstrap_samples,
                default=1000,
                min=100,
                max=10000)
            private$..show_comparison_table <- jmvcore::OptionBool$new(
                "show_comparison_table",
                show_comparison_table,
                default=TRUE)
            private$..show_gof_table <- jmvcore::OptionBool$new(
                "show_gof_table",
                show_gof_table,
                default=TRUE)
            private$..show_parameter_table <- jmvcore::OptionBool$new(
                "show_parameter_table",
                show_parameter_table,
                default=TRUE)
            private$..show_survival_plot <- jmvcore::OptionBool$new(
                "show_survival_plot",
                show_survival_plot,
                default=TRUE)
            private$..show_hazard_plot <- jmvcore::OptionBool$new(
                "show_hazard_plot",
                show_hazard_plot,
                default=TRUE)
            private$..show_pp_plot <- jmvcore::OptionBool$new(
                "show_pp_plot",
                show_pp_plot,
                default=TRUE)
            private$..show_qq_plot <- jmvcore::OptionBool$new(
                "show_qq_plot",
                show_qq_plot,
                default=TRUE)
            private$..showSummaries <- jmvcore::OptionBool$new(
                "showSummaries",
                showSummaries,
                default=FALSE)
            private$..showExplanations <- jmvcore::OptionBool$new(
                "showExplanations",
                showExplanations,
                default=FALSE)

            self$.addOption(private$..elapsedtime)
            self$.addOption(private$..outcome)
            self$.addOption(private$..explanatory)
            self$.addOption(private$..outcomeLevel)
            self$.addOption(private$..test_weibull)
            self$.addOption(private$..test_exponential)
            self$.addOption(private$..test_lognormal)
            self$.addOption(private$..test_loglogistic)
            self$.addOption(private$..test_gamma)
            self$.addOption(private$..test_gengamma)
            self$.addOption(private$..test_genf)
            self$.addOption(private$..selection_method)
            self$.addOption(private$..gof_tests)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..bootstrap_gof)
            self$.addOption(private$..bootstrap_samples)
            self$.addOption(private$..show_comparison_table)
            self$.addOption(private$..show_gof_table)
            self$.addOption(private$..show_parameter_table)
            self$.addOption(private$..show_survival_plot)
            self$.addOption(private$..show_hazard_plot)
            self$.addOption(private$..show_pp_plot)
            self$.addOption(private$..show_qq_plot)
            self$.addOption(private$..showSummaries)
            self$.addOption(private$..showExplanations)
        }),
    active = list(
        elapsedtime = function() private$..elapsedtime$value,
        outcome = function() private$..outcome$value,
        explanatory = function() private$..explanatory$value,
        outcomeLevel = function() private$..outcomeLevel$value,
        test_weibull = function() private$..test_weibull$value,
        test_exponential = function() private$..test_exponential$value,
        test_lognormal = function() private$..test_lognormal$value,
        test_loglogistic = function() private$..test_loglogistic$value,
        test_gamma = function() private$..test_gamma$value,
        test_gengamma = function() private$..test_gengamma$value,
        test_genf = function() private$..test_genf$value,
        selection_method = function() private$..selection_method$value,
        gof_tests = function() private$..gof_tests$value,
        confidence_level = function() private$..confidence_level$value,
        bootstrap_gof = function() private$..bootstrap_gof$value,
        bootstrap_samples = function() private$..bootstrap_samples$value,
        show_comparison_table = function() private$..show_comparison_table$value,
        show_gof_table = function() private$..show_gof_table$value,
        show_parameter_table = function() private$..show_parameter_table$value,
        show_survival_plot = function() private$..show_survival_plot$value,
        show_hazard_plot = function() private$..show_hazard_plot$value,
        show_pp_plot = function() private$..show_pp_plot$value,
        show_qq_plot = function() private$..show_qq_plot$value,
        showSummaries = function() private$..showSummaries$value,
        showExplanations = function() private$..showExplanations$value),
    private = list(
        ..elapsedtime = NA,
        ..outcome = NA,
        ..explanatory = NA,
        ..outcomeLevel = NA,
        ..test_weibull = NA,
        ..test_exponential = NA,
        ..test_lognormal = NA,
        ..test_loglogistic = NA,
        ..test_gamma = NA,
        ..test_gengamma = NA,
        ..test_genf = NA,
        ..selection_method = NA,
        ..gof_tests = NA,
        ..confidence_level = NA,
        ..bootstrap_gof = NA,
        ..bootstrap_samples = NA,
        ..show_comparison_table = NA,
        ..show_gof_table = NA,
        ..show_parameter_table = NA,
        ..show_survival_plot = NA,
        ..show_hazard_plot = NA,
        ..show_pp_plot = NA,
        ..show_qq_plot = NA,
        ..showSummaries = NA,
        ..showExplanations = NA)
)

distributionfitResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "distributionfitResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        modelComparison = function() private$.items[["modelComparison"]],
        goodnessOfFit = function() private$.items[["goodnessOfFit"]],
        parameterEstimates = function() private$.items[["parameterEstimates"]],
        distributionSummary = function() private$.items[["distributionSummary"]],
        survivalPlot = function() private$.items[["survivalPlot"]],
        hazardPlot = function() private$.items[["hazardPlot"]],
        ppPlot = function() private$.items[["ppPlot"]],
        qqPlot = function() private$.items[["qqPlot"]],
        diagnosticPlots = function() private$.items[["diagnosticPlots"]],
        analysisSummary = function() private$.items[["analysisSummary"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Distribution Selection and Goodness-of-Fit",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "flexsurv"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Analysis",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelComparison",
                title="Model Comparison",
                visible="(show_comparison_table)",
                columns=list(
                    list(
                        `name`="distribution", 
                        `title`="Distribution", 
                        `type`="text"),
                    list(
                        `name`="parameters", 
                        `title`="Parameters", 
                        `type`="integer"),
                    list(
                        `name`="loglik", 
                        `title`="Log-likelihood", 
                        `type`="number"),
                    list(
                        `name`="aic", 
                        `title`="AIC", 
                        `type`="number"),
                    list(
                        `name`="bic", 
                        `title`="BIC", 
                        `type`="number"),
                    list(
                        `name`="aicc", 
                        `title`="AIC_c", 
                        `type`="number"),
                    list(
                        `name`="delta_aic", 
                        `title`="\u0394 AIC", 
                        `type`="number"),
                    list(
                        `name`="aic_weight", 
                        `title`="AIC Weight", 
                        `type`="number"),
                    list(
                        `name`="rank", 
                        `title`="Rank", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="goodnessOfFit",
                title="Goodness-of-Fit Tests",
                visible="(show_gof_table)",
                columns=list(
                    list(
                        `name`="distribution", 
                        `title`="Distribution", 
                        `type`="text"),
                    list(
                        `name`="test", 
                        `title`="Test", 
                        `type`="text"),
                    list(
                        `name`="statistic", 
                        `title`="Statistic", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="p-value", 
                        `type`="number"),
                    list(
                        `name`="critical_value", 
                        `title`="Critical Value", 
                        `type`="number"),
                    list(
                        `name`="decision", 
                        `title`="Decision", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="parameterEstimates",
                title="Parameter Estimates - Best Model",
                visible="(show_parameter_table)",
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number"),
                    list(
                        `name`="lower_ci", 
                        `title`="Lower CI", 
                        `type`="number"),
                    list(
                        `name`="upper_ci", 
                        `title`="Upper CI", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="distributionSummary",
                title="Distribution Characteristics",
                visible=TRUE,
                columns=list(
                    list(
                        `name`="distribution", 
                        `title`="Distribution", 
                        `type`="text"),
                    list(
                        `name`="convergence", 
                        `title`="Convergence", 
                        `type`="text"),
                    list(
                        `name`="hazard_shape", 
                        `title`="Hazard Shape", 
                        `type`="text"),
                    list(
                        `name`="median_survival", 
                        `title`="Median Survival", 
                        `type`="number"),
                    list(
                        `name`="mean_survival", 
                        `title`="Mean Survival", 
                        `type`="number"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="survivalPlot",
                title="Survival Function Comparison",
                visible="(show_survival_plot)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="hazardPlot",
                title="Hazard Function Comparison",
                visible="(show_hazard_plot)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="ppPlot",
                title="P-P Plot - Best Model",
                visible="(show_pp_plot)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="qqPlot",
                title="Q-Q Plot - Best Model",
                visible="(show_qq_plot)"))
            self$add(jmvcore::Image$new(
                options=options,
                name="diagnosticPlots",
                title="Model Diagnostic Plots",
                visible=TRUE))
            self$add(jmvcore::Html$new(
                options=options,
                name="analysisSummary",
                title="Analysis Summary",
                visible="(showSummaries)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Methodology",
                visible="(showExplanations)"))}))

distributionfitBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "distributionfitBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "distributionfit",
                version = c(1,0,0),
                options = options,
                results = distributionfitResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'na')
        }))

#' Distribution Selection and Goodness-of-Fit
#'
#' 
#' @param elapsedtime Time to event or censoring
#' @param outcome Event indicator (1 = event, 0 = censored)
#' @param explanatory Explanatory variables for modeling
#' @param outcomeLevel Level indicating event occurrence
#' @param test_weibull Include Weibull distribution in comparison
#' @param test_exponential Include Exponential distribution in comparison
#' @param test_lognormal Include Log-normal distribution in comparison
#' @param test_loglogistic Include Log-logistic distribution in comparison
#' @param test_gamma Include Gamma distribution in comparison
#' @param test_gengamma Include Generalized Gamma distribution in comparison
#' @param test_genf Include Generalized F distribution in comparison
#' @param selection_method Model selection criterion
#' @param gof_tests Goodness-of-fit tests to perform
#' @param confidence_level Confidence level for intervals and tests
#' @param bootstrap_gof Use bootstrap for goodness-of-fit tests
#' @param bootstrap_samples Number of bootstrap samples
#' @param show_comparison_table Display model comparison statistics
#' @param show_gof_table Display goodness-of-fit test results
#' @param show_parameter_table Display parameter estimates for best model
#' @param show_survival_plot Display survival curves for all distributions
#' @param show_hazard_plot Display hazard curves for all distributions
#' @param show_pp_plot Display probability-probability plots
#' @param show_qq_plot Display quantile-quantile plots
#' @param showSummaries Generate natural language summaries
#' @param showExplanations Show methodology explanations
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$goodnessOfFit} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$parameterEstimates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$distributionSummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survivalPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$hazardPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$ppPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$qqPlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$diagnosticPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$analysisSummary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelComparison$asDF}
#'
#' \code{as.data.frame(results$modelComparison)}
#'
#' @export
distributionfit <- function(
    elapsedtime,
    outcome,
    explanatory,
    outcomeLevel = "1",
    test_weibull = TRUE,
    test_exponential = TRUE,
    test_lognormal = TRUE,
    test_loglogistic = TRUE,
    test_gamma = TRUE,
    test_gengamma = FALSE,
    test_genf = FALSE,
    selection_method = "aic",
    gof_tests = "all_tests",
    confidence_level = 0.95,
    bootstrap_gof = TRUE,
    bootstrap_samples = 1000,
    show_comparison_table = TRUE,
    show_gof_table = TRUE,
    show_parameter_table = TRUE,
    show_survival_plot = TRUE,
    show_hazard_plot = TRUE,
    show_pp_plot = TRUE,
    show_qq_plot = TRUE,
    showSummaries = FALSE,
    showExplanations = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("distributionfit requires jmvcore to be installed (restart may be required)")

    if ( ! missing(elapsedtime)) elapsedtime <- jmvcore::resolveQuo(jmvcore::enquo(elapsedtime))
    if ( ! missing(outcome)) outcome <- jmvcore::resolveQuo(jmvcore::enquo(outcome))
    if ( ! missing(explanatory)) explanatory <- jmvcore::resolveQuo(jmvcore::enquo(explanatory))

    options <- distributionfitOptions$new(
        elapsedtime = elapsedtime,
        outcome = outcome,
        explanatory = explanatory,
        outcomeLevel = outcomeLevel,
        test_weibull = test_weibull,
        test_exponential = test_exponential,
        test_lognormal = test_lognormal,
        test_loglogistic = test_loglogistic,
        test_gamma = test_gamma,
        test_gengamma = test_gengamma,
        test_genf = test_genf,
        selection_method = selection_method,
        gof_tests = gof_tests,
        confidence_level = confidence_level,
        bootstrap_gof = bootstrap_gof,
        bootstrap_samples = bootstrap_samples,
        show_comparison_table = show_comparison_table,
        show_gof_table = show_gof_table,
        show_parameter_table = show_parameter_table,
        show_survival_plot = show_survival_plot,
        show_hazard_plot = show_hazard_plot,
        show_pp_plot = show_pp_plot,
        show_qq_plot = show_qq_plot,
        showSummaries = showSummaries,
        showExplanations = showExplanations)

    analysis <- distributionfitClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

