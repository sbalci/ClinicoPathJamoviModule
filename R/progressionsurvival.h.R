
# This file is automatically generated, you probably don't want to edit this

progressionsurvivalOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "progressionsurvivalOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            time_var = NULL,
            progression_var = NULL,
            death_var = NULL,
            treatment_var = NULL,
            stratification_vars = NULL,
            patient_id = NULL,
            baseline_vars = NULL,
            analysis_type = "standard_pfs",
            progression_definition = "recist",
            censoring_mechanism = "administrative",
            survival_method = "kaplan_meier",
            comparison_test = "logrank",
            regression_model = "cox_ph",
            landmark_times = "6,12,18,24",
            rmst_tau = 24,
            confidence_level = 0.95,
            alpha_spending = "obrien_fleming",
            kaplan_meier_curves = TRUE,
            cumulative_incidence = FALSE,
            landmark_analysis_plot = FALSE,
            progression_patterns = FALSE,
            treatment_effect_estimation = TRUE,
            subgroup_analysis = FALSE,
            biomarker_interaction = FALSE,
            sensitivity_analysis = FALSE,
            interim_monitoring = FALSE,
            progression_velocity = FALSE,
            clinical_significance = TRUE,
            regulatory_endpoints = FALSE,
            health_economic_outcomes = FALSE,
            plot_theme = "publication",
            risk_tables = TRUE,
            median_survival_lines = TRUE,
            confidence_bands = TRUE,
            generate_report = FALSE,
            regulatory_tables = FALSE,
            consort_diagram = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="progressionsurvival",
                requiresData=TRUE,
                ...)

            private$..time_var <- jmvcore::OptionVariable$new(
                "time_var",
                time_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..progression_var <- jmvcore::OptionVariable$new(
                "progression_var",
                progression_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..death_var <- jmvcore::OptionVariable$new(
                "death_var",
                death_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..treatment_var <- jmvcore::OptionVariable$new(
                "treatment_var",
                treatment_var,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..stratification_vars <- jmvcore::OptionVariables$new(
                "stratification_vars",
                stratification_vars,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor"))
            private$..patient_id <- jmvcore::OptionVariable$new(
                "patient_id",
                patient_id,
                suggested=list(
                    "nominal"),
                permitted=list(
                    "factor",
                    "id"))
            private$..baseline_vars <- jmvcore::OptionVariables$new(
                "baseline_vars",
                baseline_vars,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"))
            private$..analysis_type <- jmvcore::OptionList$new(
                "analysis_type",
                analysis_type,
                options=list(
                    "standard_pfs",
                    "competing_risks",
                    "landmark_analysis",
                    "treatment_switching",
                    "biomarker_subgroup"),
                default="standard_pfs")
            private$..progression_definition <- jmvcore::OptionList$new(
                "progression_definition",
                progression_definition,
                options=list(
                    "recist",
                    "irrecist",
                    "clinical",
                    "biochemical",
                    "radiological",
                    "composite"),
                default="recist")
            private$..censoring_mechanism <- jmvcore::OptionList$new(
                "censoring_mechanism",
                censoring_mechanism,
                options=list(
                    "administrative",
                    "lost_followup",
                    "informative",
                    "competing_event"),
                default="administrative")
            private$..survival_method <- jmvcore::OptionList$new(
                "survival_method",
                survival_method,
                options=list(
                    "kaplan_meier",
                    "fleming_harrington",
                    "nelson_aalen",
                    "parametric"),
                default="kaplan_meier")
            private$..comparison_test <- jmvcore::OptionList$new(
                "comparison_test",
                comparison_test,
                options=list(
                    "logrank",
                    "weighted_logrank",
                    "fleming_harrington_test",
                    "maxcombo",
                    "rmst"),
                default="logrank")
            private$..regression_model <- jmvcore::OptionList$new(
                "regression_model",
                regression_model,
                options=list(
                    "cox_ph",
                    "aft_weibull",
                    "aft_lognormal",
                    "fine_gray",
                    "cause_specific"),
                default="cox_ph")
            private$..landmark_times <- jmvcore::OptionString$new(
                "landmark_times",
                landmark_times,
                default="6,12,18,24")
            private$..rmst_tau <- jmvcore::OptionNumber$new(
                "rmst_tau",
                rmst_tau,
                default=24,
                min=1)
            private$..confidence_level <- jmvcore::OptionNumber$new(
                "confidence_level",
                confidence_level,
                default=0.95,
                min=0.5,
                max=0.99)
            private$..alpha_spending <- jmvcore::OptionList$new(
                "alpha_spending",
                alpha_spending,
                options=list(
                    "obrien_fleming",
                    "pocock",
                    "lan_demets",
                    "none"),
                default="obrien_fleming")
            private$..kaplan_meier_curves <- jmvcore::OptionBool$new(
                "kaplan_meier_curves",
                kaplan_meier_curves,
                default=TRUE)
            private$..cumulative_incidence <- jmvcore::OptionBool$new(
                "cumulative_incidence",
                cumulative_incidence,
                default=FALSE)
            private$..landmark_analysis_plot <- jmvcore::OptionBool$new(
                "landmark_analysis_plot",
                landmark_analysis_plot,
                default=FALSE)
            private$..progression_patterns <- jmvcore::OptionBool$new(
                "progression_patterns",
                progression_patterns,
                default=FALSE)
            private$..treatment_effect_estimation <- jmvcore::OptionBool$new(
                "treatment_effect_estimation",
                treatment_effect_estimation,
                default=TRUE)
            private$..subgroup_analysis <- jmvcore::OptionBool$new(
                "subgroup_analysis",
                subgroup_analysis,
                default=FALSE)
            private$..biomarker_interaction <- jmvcore::OptionBool$new(
                "biomarker_interaction",
                biomarker_interaction,
                default=FALSE)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=FALSE)
            private$..interim_monitoring <- jmvcore::OptionBool$new(
                "interim_monitoring",
                interim_monitoring,
                default=FALSE)
            private$..progression_velocity <- jmvcore::OptionBool$new(
                "progression_velocity",
                progression_velocity,
                default=FALSE)
            private$..clinical_significance <- jmvcore::OptionBool$new(
                "clinical_significance",
                clinical_significance,
                default=TRUE)
            private$..regulatory_endpoints <- jmvcore::OptionBool$new(
                "regulatory_endpoints",
                regulatory_endpoints,
                default=FALSE)
            private$..health_economic_outcomes <- jmvcore::OptionBool$new(
                "health_economic_outcomes",
                health_economic_outcomes,
                default=FALSE)
            private$..plot_theme <- jmvcore::OptionList$new(
                "plot_theme",
                plot_theme,
                options=list(
                    "publication",
                    "clinical",
                    "presentation"),
                default="publication")
            private$..risk_tables <- jmvcore::OptionBool$new(
                "risk_tables",
                risk_tables,
                default=TRUE)
            private$..median_survival_lines <- jmvcore::OptionBool$new(
                "median_survival_lines",
                median_survival_lines,
                default=TRUE)
            private$..confidence_bands <- jmvcore::OptionBool$new(
                "confidence_bands",
                confidence_bands,
                default=TRUE)
            private$..generate_report <- jmvcore::OptionBool$new(
                "generate_report",
                generate_report,
                default=FALSE)
            private$..regulatory_tables <- jmvcore::OptionBool$new(
                "regulatory_tables",
                regulatory_tables,
                default=FALSE)
            private$..consort_diagram <- jmvcore::OptionBool$new(
                "consort_diagram",
                consort_diagram,
                default=FALSE)

            self$.addOption(private$..time_var)
            self$.addOption(private$..progression_var)
            self$.addOption(private$..death_var)
            self$.addOption(private$..treatment_var)
            self$.addOption(private$..stratification_vars)
            self$.addOption(private$..patient_id)
            self$.addOption(private$..baseline_vars)
            self$.addOption(private$..analysis_type)
            self$.addOption(private$..progression_definition)
            self$.addOption(private$..censoring_mechanism)
            self$.addOption(private$..survival_method)
            self$.addOption(private$..comparison_test)
            self$.addOption(private$..regression_model)
            self$.addOption(private$..landmark_times)
            self$.addOption(private$..rmst_tau)
            self$.addOption(private$..confidence_level)
            self$.addOption(private$..alpha_spending)
            self$.addOption(private$..kaplan_meier_curves)
            self$.addOption(private$..cumulative_incidence)
            self$.addOption(private$..landmark_analysis_plot)
            self$.addOption(private$..progression_patterns)
            self$.addOption(private$..treatment_effect_estimation)
            self$.addOption(private$..subgroup_analysis)
            self$.addOption(private$..biomarker_interaction)
            self$.addOption(private$..sensitivity_analysis)
            self$.addOption(private$..interim_monitoring)
            self$.addOption(private$..progression_velocity)
            self$.addOption(private$..clinical_significance)
            self$.addOption(private$..regulatory_endpoints)
            self$.addOption(private$..health_economic_outcomes)
            self$.addOption(private$..plot_theme)
            self$.addOption(private$..risk_tables)
            self$.addOption(private$..median_survival_lines)
            self$.addOption(private$..confidence_bands)
            self$.addOption(private$..generate_report)
            self$.addOption(private$..regulatory_tables)
            self$.addOption(private$..consort_diagram)
        }),
    active = list(
        time_var = function() private$..time_var$value,
        progression_var = function() private$..progression_var$value,
        death_var = function() private$..death_var$value,
        treatment_var = function() private$..treatment_var$value,
        stratification_vars = function() private$..stratification_vars$value,
        patient_id = function() private$..patient_id$value,
        baseline_vars = function() private$..baseline_vars$value,
        analysis_type = function() private$..analysis_type$value,
        progression_definition = function() private$..progression_definition$value,
        censoring_mechanism = function() private$..censoring_mechanism$value,
        survival_method = function() private$..survival_method$value,
        comparison_test = function() private$..comparison_test$value,
        regression_model = function() private$..regression_model$value,
        landmark_times = function() private$..landmark_times$value,
        rmst_tau = function() private$..rmst_tau$value,
        confidence_level = function() private$..confidence_level$value,
        alpha_spending = function() private$..alpha_spending$value,
        kaplan_meier_curves = function() private$..kaplan_meier_curves$value,
        cumulative_incidence = function() private$..cumulative_incidence$value,
        landmark_analysis_plot = function() private$..landmark_analysis_plot$value,
        progression_patterns = function() private$..progression_patterns$value,
        treatment_effect_estimation = function() private$..treatment_effect_estimation$value,
        subgroup_analysis = function() private$..subgroup_analysis$value,
        biomarker_interaction = function() private$..biomarker_interaction$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value,
        interim_monitoring = function() private$..interim_monitoring$value,
        progression_velocity = function() private$..progression_velocity$value,
        clinical_significance = function() private$..clinical_significance$value,
        regulatory_endpoints = function() private$..regulatory_endpoints$value,
        health_economic_outcomes = function() private$..health_economic_outcomes$value,
        plot_theme = function() private$..plot_theme$value,
        risk_tables = function() private$..risk_tables$value,
        median_survival_lines = function() private$..median_survival_lines$value,
        confidence_bands = function() private$..confidence_bands$value,
        generate_report = function() private$..generate_report$value,
        regulatory_tables = function() private$..regulatory_tables$value,
        consort_diagram = function() private$..consort_diagram$value),
    private = list(
        ..time_var = NA,
        ..progression_var = NA,
        ..death_var = NA,
        ..treatment_var = NA,
        ..stratification_vars = NA,
        ..patient_id = NA,
        ..baseline_vars = NA,
        ..analysis_type = NA,
        ..progression_definition = NA,
        ..censoring_mechanism = NA,
        ..survival_method = NA,
        ..comparison_test = NA,
        ..regression_model = NA,
        ..landmark_times = NA,
        ..rmst_tau = NA,
        ..confidence_level = NA,
        ..alpha_spending = NA,
        ..kaplan_meier_curves = NA,
        ..cumulative_incidence = NA,
        ..landmark_analysis_plot = NA,
        ..progression_patterns = NA,
        ..treatment_effect_estimation = NA,
        ..subgroup_analysis = NA,
        ..biomarker_interaction = NA,
        ..sensitivity_analysis = NA,
        ..interim_monitoring = NA,
        ..progression_velocity = NA,
        ..clinical_significance = NA,
        ..regulatory_endpoints = NA,
        ..health_economic_outcomes = NA,
        ..plot_theme = NA,
        ..risk_tables = NA,
        ..median_survival_lines = NA,
        ..confidence_bands = NA,
        ..generate_report = NA,
        ..regulatory_tables = NA,
        ..consort_diagram = NA)
)

progressionsurvivalResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "progressionsurvivalResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        pfs_summary = function() private$.items[["pfs_summary"]],
        survival_estimates = function() private$.items[["survival_estimates"]],
        treatment_effects = function() private$.items[["treatment_effects"]],
        competing_risks_analysis = function() private$.items[["competing_risks_analysis"]],
        landmark_results = function() private$.items[["landmark_results"]],
        subgroup_analysis_table = function() private$.items[["subgroup_analysis_table"]],
        progression_patterns = function() private$.items[["progression_patterns"]],
        sensitivity_analysis_table = function() private$.items[["sensitivity_analysis_table"]],
        biomarker_interaction_table = function() private$.items[["biomarker_interaction_table"]],
        interim_monitoring_table = function() private$.items[["interim_monitoring_table"]],
        clinical_significance_table = function() private$.items[["clinical_significance_table"]],
        km_plot = function() private$.items[["km_plot"]],
        cif_plot = function() private$.items[["cif_plot"]],
        landmark_plot = function() private$.items[["landmark_plot"]],
        forest_plot = function() private$.items[["forest_plot"]],
        progression_pattern_plot = function() private$.items[["progression_pattern_plot"]],
        consort_flow = function() private$.items[["consort_flow"]],
        clinical_interpretation = function() private$.items[["clinical_interpretation"]],
        regulatory_summary = function() private$.items[["regulatory_summary"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Progression-Free Survival Analysis")
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="pfs_summary",
                title="PFS Analysis Summary",
                rows=1,
                visible=TRUE,
                columns=list(
                    list(
                        `name`="analysis_type", 
                        `title`="Analysis Type", 
                        `type`="text"),
                    list(
                        `name`="n_patients", 
                        `title`="Patients (N)", 
                        `type`="integer"),
                    list(
                        `name`="n_events", 
                        `title`="Events (N)", 
                        `type`="integer"),
                    list(
                        `name`="median_followup", 
                        `title`="Median Follow-up", 
                        `type`="number"),
                    list(
                        `name`="progression_definition", 
                        `title`="Progression Criteria", 
                        `type`="text"),
                    list(
                        `name`="censoring_rate", 
                        `title`="Censoring Rate (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="survival_estimates",
                title="Survival Estimates",
                rows=0,
                visible="(kaplan_meier_curves)",
                columns=list(
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="n_risk", 
                        `title`="N at Risk", 
                        `type`="integer"),
                    list(
                        `name`="events", 
                        `title`="Events", 
                        `type`="integer"),
                    list(
                        `name`="median_pfs", 
                        `title`="Median PFS", 
                        `type`="number"),
                    list(
                        `name`="median_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="median_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="pfs_6m", 
                        `title`="6-month PFS (%)", 
                        `type`="number"),
                    list(
                        `name`="pfs_12m", 
                        `title`="12-month PFS (%)", 
                        `type`="number"),
                    list(
                        `name`="pfs_24m", 
                        `title`="24-month PFS (%)", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="treatment_effects",
                title="Treatment Effect Analysis",
                rows=0,
                visible="(treatment_effect_estimation)",
                columns=list(
                    list(
                        `name`="comparison", 
                        `title`="Comparison", 
                        `type`="text"),
                    list(
                        `name`="hr", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="test_statistic", 
                        `title`="Test Statistic", 
                        `type`="number"),
                    list(
                        `name`="clinical_interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="competing_risks_analysis",
                title="Competing Risks Analysis",
                rows=0,
                visible="(cumulative_incidence)",
                columns=list(
                    list(
                        `name`="endpoint", 
                        `title`="Endpoint", 
                        `type`="text"),
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="cif_6m", 
                        `title`="6-month CIF (%)", 
                        `type`="number"),
                    list(
                        `name`="cif_12m", 
                        `title`="12-month CIF (%)", 
                        `type`="number"),
                    list(
                        `name`="cif_24m", 
                        `title`="24-month CIF (%)", 
                        `type`="number"),
                    list(
                        `name`="subdist_hr", 
                        `title`="Subdistribution HR", 
                        `type`="number"),
                    list(
                        `name`="shr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="shr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="landmark_results",
                title="Landmark Analysis Results",
                rows=0,
                visible="(landmark_analysis_plot)",
                columns=list(
                    list(
                        `name`="landmark_time", 
                        `title`="Landmark Time", 
                        `type`="number"),
                    list(
                        `name`="group", 
                        `title`="Group", 
                        `type`="text"),
                    list(
                        `name`="n_risk", 
                        `title`="N at Risk", 
                        `type`="integer"),
                    list(
                        `name`="conditional_pfs", 
                        `title`="Conditional PFS (%)", 
                        `type`="number"),
                    list(
                        `name`="cond_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="cond_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="updated_hr", 
                        `title`="Updated HR", 
                        `type`="number"),
                    list(
                        `name`="updated_p", 
                        `title`="P-value", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="subgroup_analysis_table",
                title="Subgroup Analysis",
                rows=0,
                visible="(subgroup_analysis)",
                columns=list(
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="n_patients", 
                        `title`="N Patients", 
                        `type`="integer"),
                    list(
                        `name`="n_events", 
                        `title`="N Events", 
                        `type`="integer"),
                    list(
                        `name`="hr", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="p_interaction", 
                        `title`="P-interaction", 
                        `type`="number"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="progression_patterns",
                title="Progression Patterns Analysis",
                rows=0,
                visible="(progression_patterns)",
                columns=list(
                    list(
                        `name`="pattern_type", 
                        `title`="Pattern Type", 
                        `type`="text"),
                    list(
                        `name`="frequency", 
                        `title`="Frequency (N)", 
                        `type`="integer"),
                    list(
                        `name`="percentage", 
                        `title`="Percentage (%)", 
                        `type`="number"),
                    list(
                        `name`="median_time", 
                        `title`="Median Time to Event", 
                        `type`="number"),
                    list(
                        `name`="median_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="median_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="clinical_notes", 
                        `title`="Clinical Notes", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="sensitivity_analysis_table",
                title="Sensitivity Analysis",
                rows=0,
                visible="(sensitivity_analysis)",
                columns=list(
                    list(
                        `name`="scenario", 
                        `title`="Scenario", 
                        `type`="text"),
                    list(
                        `name`="assumption", 
                        `title`="Assumption", 
                        `type`="text"),
                    list(
                        `name`="hr", 
                        `title`="Hazard Ratio", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="impact_assessment", 
                        `title`="Impact Assessment", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="biomarker_interaction_table",
                title="Biomarker Interaction Analysis",
                rows=0,
                visible="(biomarker_interaction)",
                columns=list(
                    list(
                        `name`="biomarker", 
                        `title`="Biomarker", 
                        `type`="text"),
                    list(
                        `name`="subgroup", 
                        `title`="Subgroup", 
                        `type`="text"),
                    list(
                        `name`="n_patients", 
                        `title`="N Patients", 
                        `type`="integer"),
                    list(
                        `name`="treatment_hr", 
                        `title`="Treatment HR", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_lower", 
                        `title`="95% CI Lower", 
                        `type`="number"),
                    list(
                        `name`="hr_ci_upper", 
                        `title`="95% CI Upper", 
                        `type`="number"),
                    list(
                        `name`="p_value", 
                        `title`="P-value", 
                        `type`="number"),
                    list(
                        `name`="interaction_p", 
                        `title`="P-interaction", 
                        `type`="number"),
                    list(
                        `name`="predictive_value", 
                        `title`="Predictive Value", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="interim_monitoring_table",
                title="Interim Monitoring Analysis",
                rows=0,
                visible="(interim_monitoring)",
                columns=list(
                    list(
                        `name`="analysis_time", 
                        `title`="Analysis Time", 
                        `type`="text"),
                    list(
                        `name`="information_fraction", 
                        `title`="Information Fraction", 
                        `type`="number"),
                    list(
                        `name`="observed_events", 
                        `title`="Observed Events", 
                        `type`="integer"),
                    list(
                        `name`="boundary_efficacy", 
                        `title`="Efficacy Boundary", 
                        `type`="number"),
                    list(
                        `name`="boundary_futility", 
                        `title`="Futility Boundary", 
                        `type`="number"),
                    list(
                        `name`="test_statistic", 
                        `title`="Test Statistic", 
                        `type`="number"),
                    list(
                        `name`="conditional_power", 
                        `title`="Conditional Power", 
                        `type`="number"),
                    list(
                        `name`="recommendation", 
                        `title`="Recommendation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="clinical_significance_table",
                title="Clinical Significance Assessment",
                rows=0,
                visible="(clinical_significance)",
                columns=list(
                    list(
                        `name`="endpoint", 
                        `title`="Endpoint", 
                        `type`="text"),
                    list(
                        `name`="observed_benefit", 
                        `title`="Observed Benefit", 
                        `type`="text"),
                    list(
                        `name`="clinical_threshold", 
                        `title`="Clinical Threshold", 
                        `type`="text"),
                    list(
                        `name`="meets_threshold", 
                        `title`="Meets Threshold", 
                        `type`="text"),
                    list(
                        `name`="confidence", 
                        `title`="Confidence Level", 
                        `type`="text"),
                    list(
                        `name`="clinical_interpretation", 
                        `title`="Clinical Interpretation", 
                        `type`="text"),
                    list(
                        `name`="regulatory_perspective", 
                        `title`="Regulatory Perspective", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="km_plot",
                title="Kaplan-Meier Survival Curves",
                width=600,
                height=450,
                visible="(kaplan_meier_curves)",
                renderFun=".plot_pfs_curves"))
            self$add(jmvcore::Image$new(
                options=options,
                name="cif_plot",
                title="Cumulative Incidence Functions",
                width=600,
                height=450,
                visible="(cumulative_incidence)",
                renderFun=".plot_cumulative_incidence"))
            self$add(jmvcore::Image$new(
                options=options,
                name="landmark_plot",
                title="Landmark Analysis Plot",
                width=600,
                height=450,
                visible="(landmark_analysis_plot)",
                renderFun=".plot_landmark_analysis"))
            self$add(jmvcore::Image$new(
                options=options,
                name="forest_plot",
                title="Subgroup Forest Plot",
                width=600,
                height=450,
                visible="(subgroup_analysis)",
                renderFun=".plot_subgroup_forest"))
            self$add(jmvcore::Image$new(
                options=options,
                name="progression_pattern_plot",
                title="Progression Pattern Visualization",
                width=600,
                height=450,
                visible="(progression_patterns)",
                renderFun=".plot_progression_patterns"))
            self$add(jmvcore::Image$new(
                options=options,
                name="consort_flow",
                title="CONSORT Flow Diagram",
                width=600,
                height=600,
                visible="(consort_diagram)",
                renderFun=".plot_consort_diagram"))
            self$add(jmvcore::Html$new(
                options=options,
                name="clinical_interpretation",
                title="Clinical Interpretation and Recommendations",
                visible="(clinical_significance)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="regulatory_summary",
                title="Regulatory Summary",
                visible="(regulatory_endpoints)"))}))

progressionsurvivalBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "progressionsurvivalBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "progressionsurvival",
                version = c(1,0,0),
                options = options,
                results = progressionsurvivalResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Progression-Free Survival Analysis
#'
#' Specialized progression-free survival (PFS) analysis designed for oncology 
#' research.
#' Provides comprehensive analysis of time-to-progression endpoints with 
#' competing risks
#' considerations, landmark analysis, and treatment effect estimation. 
#' Includes analysis
#' of progression patterns, censoring mechanisms, and clinical interpretation 
#' specific
#' to cancer clinical trials and observational studies.
#' 
#'
#' @examples
#' data('cancer_trial')
#'
#' progressionsurvival(
#'     data = cancer_trial,
#'     time_var = "pfs_time",
#'     progression_var = "progression",
#'     death_var = "death",
#'     treatment_var = "treatment",
#'     stratification_vars = c("stage", "histology")
#' )
#'
#' @param data the data as a data frame
#' @param time_var Time to progression or censoring (PFS time)
#' @param progression_var Progression indicator (1=progression, 0=censored)
#' @param death_var Death indicator (1=death, 0=alive) for competing risks
#'   analysis
#' @param treatment_var Treatment or intervention variable
#' @param stratification_vars Variables for stratified analysis (e.g., stage,
#'   histology, biomarkers)
#' @param patient_id Patient identifier for longitudinal data
#' @param baseline_vars Baseline covariates for adjusted analysis
#' @param analysis_type Type of progression-free survival analysis
#' @param progression_definition Definition of disease progression used
#' @param censoring_mechanism Primary censoring mechanism in the data
#' @param survival_method Method for survival function estimation
#' @param comparison_test Statistical test for group comparisons
#' @param regression_model Regression model for treatment effect estimation
#' @param landmark_times Landmark time points in months (comma-separated)
#' @param rmst_tau Restriction time for RMST analysis (months)
#' @param confidence_level Confidence level for intervals
#' @param alpha_spending Alpha spending function for interim analyses
#' @param kaplan_meier_curves Generate Kaplan-Meier survival curves
#' @param cumulative_incidence Calculate cumulative incidence functions
#'   (competing risks)
#' @param landmark_analysis_plot Generate landmark analysis visualizations
#' @param progression_patterns Analyze patterns and timing of disease
#'   progression
#' @param treatment_effect_estimation Estimate treatment effects with
#'   confidence intervals
#' @param subgroup_analysis Perform pre-specified subgroup analyses
#' @param biomarker_interaction Test for biomarker-treatment interactions
#' @param sensitivity_analysis Perform sensitivity analyses for assumptions
#' @param interim_monitoring Analysis for interim monitoring and early
#'   stopping
#' @param progression_velocity Analyze velocity and acceleration of disease
#'   progression
#' @param clinical_significance Assess clinical significance of findings
#' @param regulatory_endpoints Analysis aligned with regulatory requirements
#'   (FDA/EMA)
#' @param health_economic_outcomes Calculate health economic outcome measures
#' @param plot_theme Visual theme for plots
#' @param risk_tables Include risk tables below survival curves
#' @param median_survival_lines Add median survival reference lines
#' @param confidence_bands Show confidence bands on survival curves
#' @param generate_report Generate comprehensive clinical analysis report
#' @param regulatory_tables Generate regulatory submission-ready tables
#' @param consort_diagram Generate CONSORT-style patient flow diagram
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$pfs_summary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$survival_estimates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$treatment_effects} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$competing_risks_analysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$landmark_results} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$subgroup_analysis_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$progression_patterns} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$sensitivity_analysis_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$biomarker_interaction_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$interim_monitoring_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$clinical_significance_table} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$km_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$cif_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$landmark_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$forest_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$progression_pattern_plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$consort_flow} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$clinical_interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$regulatory_summary} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$pfs_summary$asDF}
#'
#' \code{as.data.frame(results$pfs_summary)}
#'
#' @export
progressionsurvival <- function(
    data,
    time_var,
    progression_var,
    death_var,
    treatment_var,
    stratification_vars,
    patient_id,
    baseline_vars,
    analysis_type = "standard_pfs",
    progression_definition = "recist",
    censoring_mechanism = "administrative",
    survival_method = "kaplan_meier",
    comparison_test = "logrank",
    regression_model = "cox_ph",
    landmark_times = "6,12,18,24",
    rmst_tau = 24,
    confidence_level = 0.95,
    alpha_spending = "obrien_fleming",
    kaplan_meier_curves = TRUE,
    cumulative_incidence = FALSE,
    landmark_analysis_plot = FALSE,
    progression_patterns = FALSE,
    treatment_effect_estimation = TRUE,
    subgroup_analysis = FALSE,
    biomarker_interaction = FALSE,
    sensitivity_analysis = FALSE,
    interim_monitoring = FALSE,
    progression_velocity = FALSE,
    clinical_significance = TRUE,
    regulatory_endpoints = FALSE,
    health_economic_outcomes = FALSE,
    plot_theme = "publication",
    risk_tables = TRUE,
    median_survival_lines = TRUE,
    confidence_bands = TRUE,
    generate_report = FALSE,
    regulatory_tables = FALSE,
    consort_diagram = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("progressionsurvival requires jmvcore to be installed (restart may be required)")

    if ( ! missing(time_var)) time_var <- jmvcore::resolveQuo(jmvcore::enquo(time_var))
    if ( ! missing(progression_var)) progression_var <- jmvcore::resolveQuo(jmvcore::enquo(progression_var))
    if ( ! missing(death_var)) death_var <- jmvcore::resolveQuo(jmvcore::enquo(death_var))
    if ( ! missing(treatment_var)) treatment_var <- jmvcore::resolveQuo(jmvcore::enquo(treatment_var))
    if ( ! missing(stratification_vars)) stratification_vars <- jmvcore::resolveQuo(jmvcore::enquo(stratification_vars))
    if ( ! missing(patient_id)) patient_id <- jmvcore::resolveQuo(jmvcore::enquo(patient_id))
    if ( ! missing(baseline_vars)) baseline_vars <- jmvcore::resolveQuo(jmvcore::enquo(baseline_vars))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(time_var), time_var, NULL),
            `if`( ! missing(progression_var), progression_var, NULL),
            `if`( ! missing(death_var), death_var, NULL),
            `if`( ! missing(treatment_var), treatment_var, NULL),
            `if`( ! missing(stratification_vars), stratification_vars, NULL),
            `if`( ! missing(patient_id), patient_id, NULL),
            `if`( ! missing(baseline_vars), baseline_vars, NULL))

    for (v in progression_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in death_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in treatment_var) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in stratification_vars) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- progressionsurvivalOptions$new(
        time_var = time_var,
        progression_var = progression_var,
        death_var = death_var,
        treatment_var = treatment_var,
        stratification_vars = stratification_vars,
        patient_id = patient_id,
        baseline_vars = baseline_vars,
        analysis_type = analysis_type,
        progression_definition = progression_definition,
        censoring_mechanism = censoring_mechanism,
        survival_method = survival_method,
        comparison_test = comparison_test,
        regression_model = regression_model,
        landmark_times = landmark_times,
        rmst_tau = rmst_tau,
        confidence_level = confidence_level,
        alpha_spending = alpha_spending,
        kaplan_meier_curves = kaplan_meier_curves,
        cumulative_incidence = cumulative_incidence,
        landmark_analysis_plot = landmark_analysis_plot,
        progression_patterns = progression_patterns,
        treatment_effect_estimation = treatment_effect_estimation,
        subgroup_analysis = subgroup_analysis,
        biomarker_interaction = biomarker_interaction,
        sensitivity_analysis = sensitivity_analysis,
        interim_monitoring = interim_monitoring,
        progression_velocity = progression_velocity,
        clinical_significance = clinical_significance,
        regulatory_endpoints = regulatory_endpoints,
        health_economic_outcomes = health_economic_outcomes,
        plot_theme = plot_theme,
        risk_tables = risk_tables,
        median_survival_lines = median_survival_lines,
        confidence_bands = confidence_bands,
        generate_report = generate_report,
        regulatory_tables = regulatory_tables,
        consort_diagram = consort_diagram)

    analysis <- progressionsurvivalClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

