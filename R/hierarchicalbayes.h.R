
# This file is automatically generated, you probably don't want to edit this

hierarchicalbayesOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hierarchicalbayesOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            tp = NULL,
            fp = NULL,
            fn = NULL,
            tn = NULL,
            study_id = NULL,
            study_covariates = NULL,
            model_type = "bivariate_normal",
            correlation_model = "unstructured",
            prior_specification = "weakly_informative",
            mcmc_chains = 4,
            mcmc_iterations = 20000,
            warmup_iterations = 10000,
            thin_interval = 1,
            adapt_delta = 0.95,
            max_treedepth = 15,
            credible_level = 0.95,
            prediction_interval = TRUE,
            cross_validation = FALSE,
            posterior_predictive = TRUE,
            convergence_diagnostics = TRUE,
            model_comparison = TRUE,
            forest_plots = TRUE,
            sroc_curves = TRUE,
            trace_plots = FALSE,
            density_plots = TRUE,
            pairs_plots = FALSE,
            shrinkage_plots = FALSE,
            meta_regression = FALSE,
            outlier_detection = TRUE,
            sensitivity_analysis = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="hierarchicalbayes",
                requiresData=FALSE,
                ...)

            private$..tp <- jmvcore::OptionVariable$new(
                "tp",
                tp,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..fp <- jmvcore::OptionVariable$new(
                "fp",
                fp,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..fn <- jmvcore::OptionVariable$new(
                "fn",
                fn,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..tn <- jmvcore::OptionVariable$new(
                "tn",
                tn,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..study_id <- jmvcore::OptionVariable$new(
                "study_id",
                study_id,
                suggested=list(
                    "nominal",
                    "id"),
                permitted=list(
                    "factor",
                    "id"))
            private$..study_covariates <- jmvcore::OptionVariables$new(
                "study_covariates",
                study_covariates,
                suggested=list(
                    "continuous",
                    "nominal"),
                permitted=list(
                    "numeric",
                    "factor"),
                default=NULL)
            private$..model_type <- jmvcore::OptionList$new(
                "model_type",
                model_type,
                options=list(
                    "bivariate_normal",
                    "hsroc",
                    "trivariate",
                    "mixture_model",
                    "zero_inflated"),
                default="bivariate_normal")
            private$..correlation_model <- jmvcore::OptionList$new(
                "correlation_model",
                correlation_model,
                options=list(
                    "unstructured",
                    "independent",
                    "fixed_positive",
                    "fixed_negative"),
                default="unstructured")
            private$..prior_specification <- jmvcore::OptionList$new(
                "prior_specification",
                prior_specification,
                options=list(
                    "weakly_informative",
                    "non_informative",
                    "informative",
                    "empirical_bayes",
                    "expert_elicited"),
                default="weakly_informative")
            private$..mcmc_chains <- jmvcore::OptionInteger$new(
                "mcmc_chains",
                mcmc_chains,
                default=4,
                min=2,
                max=8)
            private$..mcmc_iterations <- jmvcore::OptionInteger$new(
                "mcmc_iterations",
                mcmc_iterations,
                default=20000,
                min=5000,
                max=100000)
            private$..warmup_iterations <- jmvcore::OptionInteger$new(
                "warmup_iterations",
                warmup_iterations,
                default=10000,
                min=2500,
                max=50000)
            private$..thin_interval <- jmvcore::OptionInteger$new(
                "thin_interval",
                thin_interval,
                default=1,
                min=1,
                max=10)
            private$..adapt_delta <- jmvcore::OptionNumber$new(
                "adapt_delta",
                adapt_delta,
                default=0.95,
                min=0.8,
                max=0.999)
            private$..max_treedepth <- jmvcore::OptionInteger$new(
                "max_treedepth",
                max_treedepth,
                default=15,
                min=10,
                max=20)
            private$..credible_level <- jmvcore::OptionNumber$new(
                "credible_level",
                credible_level,
                default=0.95,
                min=0.8,
                max=0.99)
            private$..prediction_interval <- jmvcore::OptionBool$new(
                "prediction_interval",
                prediction_interval,
                default=TRUE)
            private$..cross_validation <- jmvcore::OptionBool$new(
                "cross_validation",
                cross_validation,
                default=FALSE)
            private$..posterior_predictive <- jmvcore::OptionBool$new(
                "posterior_predictive",
                posterior_predictive,
                default=TRUE)
            private$..convergence_diagnostics <- jmvcore::OptionBool$new(
                "convergence_diagnostics",
                convergence_diagnostics,
                default=TRUE)
            private$..model_comparison <- jmvcore::OptionBool$new(
                "model_comparison",
                model_comparison,
                default=TRUE)
            private$..forest_plots <- jmvcore::OptionBool$new(
                "forest_plots",
                forest_plots,
                default=TRUE)
            private$..sroc_curves <- jmvcore::OptionBool$new(
                "sroc_curves",
                sroc_curves,
                default=TRUE)
            private$..trace_plots <- jmvcore::OptionBool$new(
                "trace_plots",
                trace_plots,
                default=FALSE)
            private$..density_plots <- jmvcore::OptionBool$new(
                "density_plots",
                density_plots,
                default=TRUE)
            private$..pairs_plots <- jmvcore::OptionBool$new(
                "pairs_plots",
                pairs_plots,
                default=FALSE)
            private$..shrinkage_plots <- jmvcore::OptionBool$new(
                "shrinkage_plots",
                shrinkage_plots,
                default=FALSE)
            private$..meta_regression <- jmvcore::OptionBool$new(
                "meta_regression",
                meta_regression,
                default=FALSE)
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=TRUE)
            private$..sensitivity_analysis <- jmvcore::OptionBool$new(
                "sensitivity_analysis",
                sensitivity_analysis,
                default=FALSE)

            self$.addOption(private$..tp)
            self$.addOption(private$..fp)
            self$.addOption(private$..fn)
            self$.addOption(private$..tn)
            self$.addOption(private$..study_id)
            self$.addOption(private$..study_covariates)
            self$.addOption(private$..model_type)
            self$.addOption(private$..correlation_model)
            self$.addOption(private$..prior_specification)
            self$.addOption(private$..mcmc_chains)
            self$.addOption(private$..mcmc_iterations)
            self$.addOption(private$..warmup_iterations)
            self$.addOption(private$..thin_interval)
            self$.addOption(private$..adapt_delta)
            self$.addOption(private$..max_treedepth)
            self$.addOption(private$..credible_level)
            self$.addOption(private$..prediction_interval)
            self$.addOption(private$..cross_validation)
            self$.addOption(private$..posterior_predictive)
            self$.addOption(private$..convergence_diagnostics)
            self$.addOption(private$..model_comparison)
            self$.addOption(private$..forest_plots)
            self$.addOption(private$..sroc_curves)
            self$.addOption(private$..trace_plots)
            self$.addOption(private$..density_plots)
            self$.addOption(private$..pairs_plots)
            self$.addOption(private$..shrinkage_plots)
            self$.addOption(private$..meta_regression)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..sensitivity_analysis)
        }),
    active = list(
        tp = function() private$..tp$value,
        fp = function() private$..fp$value,
        fn = function() private$..fn$value,
        tn = function() private$..tn$value,
        study_id = function() private$..study_id$value,
        study_covariates = function() private$..study_covariates$value,
        model_type = function() private$..model_type$value,
        correlation_model = function() private$..correlation_model$value,
        prior_specification = function() private$..prior_specification$value,
        mcmc_chains = function() private$..mcmc_chains$value,
        mcmc_iterations = function() private$..mcmc_iterations$value,
        warmup_iterations = function() private$..warmup_iterations$value,
        thin_interval = function() private$..thin_interval$value,
        adapt_delta = function() private$..adapt_delta$value,
        max_treedepth = function() private$..max_treedepth$value,
        credible_level = function() private$..credible_level$value,
        prediction_interval = function() private$..prediction_interval$value,
        cross_validation = function() private$..cross_validation$value,
        posterior_predictive = function() private$..posterior_predictive$value,
        convergence_diagnostics = function() private$..convergence_diagnostics$value,
        model_comparison = function() private$..model_comparison$value,
        forest_plots = function() private$..forest_plots$value,
        sroc_curves = function() private$..sroc_curves$value,
        trace_plots = function() private$..trace_plots$value,
        density_plots = function() private$..density_plots$value,
        pairs_plots = function() private$..pairs_plots$value,
        shrinkage_plots = function() private$..shrinkage_plots$value,
        meta_regression = function() private$..meta_regression$value,
        outlier_detection = function() private$..outlier_detection$value,
        sensitivity_analysis = function() private$..sensitivity_analysis$value),
    private = list(
        ..tp = NA,
        ..fp = NA,
        ..fn = NA,
        ..tn = NA,
        ..study_id = NA,
        ..study_covariates = NA,
        ..model_type = NA,
        ..correlation_model = NA,
        ..prior_specification = NA,
        ..mcmc_chains = NA,
        ..mcmc_iterations = NA,
        ..warmup_iterations = NA,
        ..thin_interval = NA,
        ..adapt_delta = NA,
        ..max_treedepth = NA,
        ..credible_level = NA,
        ..prediction_interval = NA,
        ..cross_validation = NA,
        ..posterior_predictive = NA,
        ..convergence_diagnostics = NA,
        ..model_comparison = NA,
        ..forest_plots = NA,
        ..sroc_curves = NA,
        ..trace_plots = NA,
        ..density_plots = NA,
        ..pairs_plots = NA,
        ..shrinkage_plots = NA,
        ..meta_regression = NA,
        ..outlier_detection = NA,
        ..sensitivity_analysis = NA)
)

hierarchicalbayesResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hierarchicalbayesResults",
    inherit = jmvcore::Group,
    active = list(
        instructions = function() private$.items[["instructions"]],
        modelSpecification = function() private$.items[["modelSpecification"]],
        studySummary = function() private$.items[["studySummary"]],
        pooledEstimates = function() private$.items[["pooledEstimates"]],
        hierarchicalParameters = function() private$.items[["hierarchicalParameters"]],
        heterogeneityAssessment = function() private$.items[["heterogeneityAssessment"]],
        correlationAnalysis = function() private$.items[["correlationAnalysis"]],
        metaRegressionResults = function() private$.items[["metaRegressionResults"]],
        outlierAnalysis = function() private$.items[["outlierAnalysis"]],
        convergenceDiagnostics = function() private$.items[["convergenceDiagnostics"]],
        modelComparison = function() private$.items[["modelComparison"]],
        posteriorPredictive = function() private$.items[["posteriorPredictive"]],
        forestPlotSensitivity = function() private$.items[["forestPlotSensitivity"]],
        forestPlotSpecificity = function() private$.items[["forestPlotSpecificity"]],
        srocCurvePlot = function() private$.items[["srocCurvePlot"]],
        tracePlots = function() private$.items[["tracePlots"]],
        densityPlots = function() private$.items[["densityPlots"]],
        pairsPlots = function() private$.items[["pairsPlots"]],
        shrinkagePlots = function() private$.items[["shrinkagePlots"]],
        methodExplanation = function() private$.items[["methodExplanation"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Hierarchical Bayesian Diagnostic Models",
                refs=list(
                    "ClinicoPathJamoviModule"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Analysis Instructions",
                visible=TRUE))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelSpecification",
                title="Model Specification",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "model_type",
                    "correlation_model",
                    "prior_specification"),
                columns=list(
                    list(
                        `name`="component", 
                        `title`="Component", 
                        `type`="text"),
                    list(
                        `name`="specification", 
                        `title`="Specification", 
                        `type`="text"),
                    list(
                        `name`="parameters", 
                        `title`="Parameters", 
                        `type`="text"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="studySummary",
                title="Study-Level Summary",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "tp",
                    "fp",
                    "fn",
                    "tn",
                    "study_id"),
                columns=list(
                    list(
                        `name`="study", 
                        `title`="Study", 
                        `type`="text"),
                    list(
                        `name`="n_diseased", 
                        `title`="Disease +", 
                        `type`="integer"),
                    list(
                        `name`="n_non_diseased", 
                        `title`="Disease -", 
                        `type`="integer"),
                    list(
                        `name`="sensitivity", 
                        `title`="Sensitivity", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="specificity", 
                        `title`="Specificity", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="dor", 
                        `title`="DOR", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="prevalence", 
                        `title`="Prevalence", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="pooledEstimates",
                title="Pooled Diagnostic Accuracy",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "model_type",
                    "correlation_model"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Post. Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Post. SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="prediction_lower", 
                        `title`="Pred Lower", 
                        `type`="number", 
                        `format`="zto:4", 
                        `visible`="(prediction_interval)"),
                    list(
                        `name`="prediction_upper", 
                        `title`="Pred Upper", 
                        `type`="number", 
                        `format`="zto:4", 
                        `visible`="(prediction_interval)"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="hierarchicalParameters",
                title="Hierarchical Model Parameters",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "model_type",
                    "correlation_model"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Post. Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Post. SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="rhat", 
                        `title`="R\u0302", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="ess_bulk", 
                        `title`="ESS Bulk", 
                        `type`="integer"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="heterogeneityAssessment",
                title="Between-Study Heterogeneity",
                visible=TRUE,
                rows=1,
                clearWith=list(
                    "model_type",
                    "correlation_model"),
                columns=list(
                    list(
                        `name`="component", 
                        `title`="Component", 
                        `type`="text"),
                    list(
                        `name`="tau_squared", 
                        `title`="\u03C4\u00B2", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="tau_squared_lower", 
                        `title`="\u03C4\u00B2 Lower", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="tau_squared_upper", 
                        `title`="\u03C4\u00B2 Upper", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="i_squared", 
                        `title`="I\u00B2", 
                        `type`="number", 
                        `format`="zto:1"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="correlationAnalysis",
                title="Sensitivity-Specificity Correlation",
                visible="(correlation_model:unstructured)",
                rows=1,
                clearWith=list(
                    "correlation_model",
                    "model_type"),
                columns=list(
                    list(
                        `name`="correlation_type", 
                        `title`="Correlation", 
                        `type`="text"),
                    list(
                        `name`="posterior_mean", 
                        `title`="Post. Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="posterior_sd", 
                        `title`="Post. SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="prob_positive", 
                        `title`="P(\u03C1 > 0)", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="metaRegressionResults",
                title="Meta-Regression Results",
                visible="(meta_regression)",
                rows=1,
                clearWith=list(
                    "study_covariates",
                    "meta_regression"),
                columns=list(
                    list(
                        `name`="covariate", 
                        `title`="Covariate", 
                        `type`="text"),
                    list(
                        `name`="outcome", 
                        `title`="Outcome", 
                        `type`="text"),
                    list(
                        `name`="coefficient", 
                        `title`="Coefficient", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="coefficient_sd", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_lower", 
                        `title`="Lower CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="credible_upper", 
                        `title`="Upper CrI", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="prob_direction", 
                        `title`="P(Direction)", 
                        `type`="number", 
                        `format`="zto:4"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="outlierAnalysis",
                title="Outlier Analysis",
                visible="(outlier_detection)",
                rows=1,
                clearWith=list(
                    "outlier_detection"),
                columns=list(
                    list(
                        `name`="study", 
                        `title`="Study", 
                        `type`="text"),
                    list(
                        `name`="mahalanobis_distance", 
                        `title`="Mahalanobis D", 
                        `type`="number", 
                        `format`="zto:3"),
                    list(
                        `name`="leverage", 
                        `title`="Leverage", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="influence_sensitivity", 
                        `title`="Influence (Sens)", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="influence_specificity", 
                        `title`="Influence (Spec)", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="outlier_probability", 
                        `title`="P(Outlier)", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="outlier_flag", 
                        `title`="Outlier", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="convergenceDiagnostics",
                title="MCMC Convergence Diagnostics",
                visible="(convergence_diagnostics)",
                rows=1,
                clearWith=list(
                    "mcmc_chains",
                    "mcmc_iterations"),
                columns=list(
                    list(
                        `name`="parameter", 
                        `title`="Parameter", 
                        `type`="text"),
                    list(
                        `name`="rhat", 
                        `title`="R\u0302", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="ess_bulk", 
                        `title`="ESS Bulk", 
                        `type`="integer"),
                    list(
                        `name`="ess_tail", 
                        `title`="ESS Tail", 
                        `type`="integer"),
                    list(
                        `name`="mcmc_se", 
                        `title`="MCMC SE", 
                        `type`="number", 
                        `format`="zto:6"),
                    list(
                        `name`="convergence_status", 
                        `title`="Status", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="modelComparison",
                title="Model Comparison Metrics",
                visible="(model_comparison)",
                rows=1,
                clearWith=list(
                    "model_type",
                    "model_comparison"),
                columns=list(
                    list(
                        `name`="metric", 
                        `title`="Metric", 
                        `type`="text"),
                    list(
                        `name`="estimate", 
                        `title`="Estimate", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="se", 
                        `title`="SE", 
                        `type`="number", 
                        `format`="zto:2"),
                    list(
                        `name`="description", 
                        `title`="Description", 
                        `type`="text"))))
            self$add(jmvcore::Table$new(
                options=options,
                name="posteriorPredictive",
                title="Posterior Predictive Checks",
                visible="(posterior_predictive)",
                rows=1,
                clearWith=list(
                    "posterior_predictive"),
                columns=list(
                    list(
                        `name`="statistic", 
                        `title`="Test Statistic", 
                        `type`="text"),
                    list(
                        `name`="observed", 
                        `title`="Observed", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="predicted_mean", 
                        `title`="Pred. Mean", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="predicted_sd", 
                        `title`="Pred. SD", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="bayesian_p", 
                        `title`="Bayesian p", 
                        `type`="number", 
                        `format`="zto:4"),
                    list(
                        `name`="interpretation", 
                        `title`="Interpretation", 
                        `type`="text"))))
            self$add(jmvcore::Image$new(
                options=options,
                name="forestPlotSensitivity",
                title="Forest Plot - Sensitivity",
                visible="(forest_plots)",
                requiresData=TRUE,
                width=900,
                height=700,
                renderFun=".plotForestSensitivity",
                clearWith=list(
                    "tp",
                    "fn",
                    "study_id")))
            self$add(jmvcore::Image$new(
                options=options,
                name="forestPlotSpecificity",
                title="Forest Plot - Specificity",
                visible="(forest_plots)",
                requiresData=TRUE,
                width=900,
                height=700,
                renderFun=".plotForestSpecificity",
                clearWith=list(
                    "fp",
                    "tn",
                    "study_id")))
            self$add(jmvcore::Image$new(
                options=options,
                name="srocCurvePlot",
                title="Hierarchical SROC Curve",
                visible="(sroc_curves)",
                requiresData=TRUE,
                width=800,
                height=800,
                renderFun=".plotSROCCurve",
                clearWith=list(
                    "model_type",
                    "correlation_model")))
            self$add(jmvcore::Image$new(
                options=options,
                name="tracePlots",
                title="MCMC Trace Plots",
                visible="(trace_plots)",
                requiresData=TRUE,
                width=1000,
                height=800,
                renderFun=".plotTraces",
                clearWith=list(
                    "mcmc_chains",
                    "mcmc_iterations")))
            self$add(jmvcore::Image$new(
                options=options,
                name="densityPlots",
                title="Posterior Density Plots",
                visible="(density_plots)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotPosteriorDensities",
                clearWith=list(
                    "model_type",
                    "density_plots")))
            self$add(jmvcore::Image$new(
                options=options,
                name="pairsPlots",
                title="Parameter Correlation (Pairs) Plot",
                visible="(pairs_plots)",
                requiresData=TRUE,
                width=900,
                height=900,
                renderFun=".plotPairs",
                clearWith=list(
                    "pairs_plots")))
            self$add(jmvcore::Image$new(
                options=options,
                name="shrinkagePlots",
                title="Study Shrinkage Plot",
                visible="(shrinkage_plots)",
                requiresData=TRUE,
                width=800,
                height=600,
                renderFun=".plotShrinkage",
                clearWith=list(
                    "shrinkage_plots")))
            self$add(jmvcore::Html$new(
                options=options,
                name="methodExplanation",
                title="Method and Interpretation",
                visible=TRUE))}))

hierarchicalbayesBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hierarchicalbayesBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "hierarchicalbayes",
                version = c(0,0,3),
                options = options,
                results = hierarchicalbayesResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'na')
        }))

#' Hierarchical Bayesian Diagnostic Models
#'
#' Hierarchical Bayesian models for multi-center diagnostic studies.
#' Implements bivariate meta-analysis of diagnostic accuracy with
#' between-study heterogeneity and correlation structures.
#' 
#'
#' @examples
#' # Example: Hierarchical Bayesian diagnostic meta-analysis
#' hierarchicalbayes(
#'     data = multicenter_data,
#'     tp = true_positives,
#'     fp = false_positives,
#'     fn = false_negatives,
#'     tn = true_negatives,
#'     study_id = center,
#'     model_type = "bivariate_normal"
#' )
#'
#' @param tp True positive counts by study/center
#' @param fp False positive counts by study/center
#' @param fn False negative counts by study/center
#' @param tn True negative counts by study/center
#' @param study_id Unique identifier for each study/center
#' @param study_covariates Covariates explaining between-study heterogeneity
#' @param model_type Statistical model for hierarchical meta-analysis
#' @param correlation_model Assumed correlation between diagnostic measures
#' @param prior_specification Method for specifying prior distributions
#' @param mcmc_chains Parallel chains for convergence assessment
#' @param mcmc_iterations Total iterations including warmup
#' @param warmup_iterations Burn-in period for MCMC sampling
#' @param thin_interval Thinning to reduce autocorrelation
#' @param adapt_delta Controls step size adaptation in HMC
#' @param max_treedepth Controls exploration in NUTS algorithm
#' @param credible_level Level for Bayesian credible intervals
#' @param prediction_interval Whether to compute predictive distributions
#' @param cross_validation Whether to perform cross-validation
#' @param posterior_predictive Whether to perform posterior predictive
#'   checking
#' @param convergence_diagnostics Whether to assess MCMC convergence
#' @param model_comparison Whether to compute model comparison metrics
#' @param forest_plots Whether to create forest plots
#' @param sroc_curves Whether to plot SROC curves
#' @param trace_plots Whether to create MCMC trace plots
#' @param density_plots Whether to create posterior density plots
#' @param pairs_plots Whether to create parameter correlation plots
#' @param shrinkage_plots Whether to plot shrinkage effects
#' @param meta_regression Whether to conduct meta-regression
#' @param outlier_detection Whether to perform outlier analysis
#' @param sensitivity_analysis Whether to perform sensitivity analysis
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$modelSpecification} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$studySummary} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$pooledEstimates} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$hierarchicalParameters} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$heterogeneityAssessment} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$correlationAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$metaRegressionResults} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$outlierAnalysis} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$convergenceDiagnostics} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$modelComparison} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$posteriorPredictive} \tab \tab \tab \tab \tab a table \cr
#'   \code{results$forestPlotSensitivity} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$forestPlotSpecificity} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$srocCurvePlot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$tracePlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$densityPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$pairsPlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$shrinkagePlots} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$methodExplanation} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' Tables can be converted to data frames with \code{asDF} or \code{\link{as.data.frame}}. For example:
#'
#' \code{results$modelSpecification$asDF}
#'
#' \code{as.data.frame(results$modelSpecification)}
#'
#' @export
hierarchicalbayes <- function(
    tp,
    fp,
    fn,
    tn,
    study_id,
    study_covariates = NULL,
    model_type = "bivariate_normal",
    correlation_model = "unstructured",
    prior_specification = "weakly_informative",
    mcmc_chains = 4,
    mcmc_iterations = 20000,
    warmup_iterations = 10000,
    thin_interval = 1,
    adapt_delta = 0.95,
    max_treedepth = 15,
    credible_level = 0.95,
    prediction_interval = TRUE,
    cross_validation = FALSE,
    posterior_predictive = TRUE,
    convergence_diagnostics = TRUE,
    model_comparison = TRUE,
    forest_plots = TRUE,
    sroc_curves = TRUE,
    trace_plots = FALSE,
    density_plots = TRUE,
    pairs_plots = FALSE,
    shrinkage_plots = FALSE,
    meta_regression = FALSE,
    outlier_detection = TRUE,
    sensitivity_analysis = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("hierarchicalbayes requires jmvcore to be installed (restart may be required)")

    if ( ! missing(tp)) tp <- jmvcore::resolveQuo(jmvcore::enquo(tp))
    if ( ! missing(fp)) fp <- jmvcore::resolveQuo(jmvcore::enquo(fp))
    if ( ! missing(fn)) fn <- jmvcore::resolveQuo(jmvcore::enquo(fn))
    if ( ! missing(tn)) tn <- jmvcore::resolveQuo(jmvcore::enquo(tn))
    if ( ! missing(study_id)) study_id <- jmvcore::resolveQuo(jmvcore::enquo(study_id))
    if ( ! missing(study_covariates)) study_covariates <- jmvcore::resolveQuo(jmvcore::enquo(study_covariates))

    options <- hierarchicalbayesOptions$new(
        tp = tp,
        fp = fp,
        fn = fn,
        tn = tn,
        study_id = study_id,
        study_covariates = study_covariates,
        model_type = model_type,
        correlation_model = correlation_model,
        prior_specification = prior_specification,
        mcmc_chains = mcmc_chains,
        mcmc_iterations = mcmc_iterations,
        warmup_iterations = warmup_iterations,
        thin_interval = thin_interval,
        adapt_delta = adapt_delta,
        max_treedepth = max_treedepth,
        credible_level = credible_level,
        prediction_interval = prediction_interval,
        cross_validation = cross_validation,
        posterior_predictive = posterior_predictive,
        convergence_diagnostics = convergence_diagnostics,
        model_comparison = model_comparison,
        forest_plots = forest_plots,
        sroc_curves = sroc_curves,
        trace_plots = trace_plots,
        density_plots = density_plots,
        pairs_plots = pairs_plots,
        shrinkage_plots = shrinkage_plots,
        meta_regression = meta_regression,
        outlier_detection = outlier_detection,
        sensitivity_analysis = sensitivity_analysis)

    analysis <- hierarchicalbayesClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

