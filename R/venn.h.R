
# This file is automatically generated, you probably don't want to edit this

vennOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "vennOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            var1 = NULL,
            var1true = NULL,
            var2 = NULL,
            var2true = NULL,
            var3 = NULL,
            var3true = NULL,
            var4 = NULL,
            var4true = NULL, ...) {

            super$initialize(
                package="ClinicoPath",
                name="venn",
                requiresData=TRUE,
                ...)

            private$..var1 <- jmvcore::OptionVariable$new(
                "var1",
                var1,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..var1true <- jmvcore::OptionLevel$new(
                "var1true",
                var1true,
                variable="(var1)")
            private$..var2 <- jmvcore::OptionVariable$new(
                "var2",
                var2,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..var2true <- jmvcore::OptionLevel$new(
                "var2true",
                var2true,
                variable="(var2)")
            private$..var3 <- jmvcore::OptionVariable$new(
                "var3",
                var3,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..var3true <- jmvcore::OptionLevel$new(
                "var3true",
                var3true,
                variable="(var3)")
            private$..var4 <- jmvcore::OptionVariable$new(
                "var4",
                var4,
                suggested=list(
                    "ordinal",
                    "nominal"),
                permitted=list(
                    "factor"))
            private$..var4true <- jmvcore::OptionLevel$new(
                "var4true",
                var4true,
                variable="(var4)")

            self$.addOption(private$..var1)
            self$.addOption(private$..var1true)
            self$.addOption(private$..var2)
            self$.addOption(private$..var2true)
            self$.addOption(private$..var3)
            self$.addOption(private$..var3true)
            self$.addOption(private$..var4)
            self$.addOption(private$..var4true)
        }),
    active = list(
        var1 = function() private$..var1$value,
        var1true = function() private$..var1true$value,
        var2 = function() private$..var2$value,
        var2true = function() private$..var2true$value,
        var3 = function() private$..var3$value,
        var3true = function() private$..var3true$value,
        var4 = function() private$..var4$value,
        var4true = function() private$..var4true$value),
    private = list(
        ..var1 = NA,
        ..var1true = NA,
        ..var2 = NA,
        ..var2true = NA,
        ..var3 = NA,
        ..var3true = NA,
        ..var4 = NA,
        ..var4true = NA)
)

vennResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "vennResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]],
        plot2 = function() private$.items[["plot2"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Venn Diagram",
                refs=list(
                    "ClinicoPathJamoviModule"),
                clearWith=list(
                    "var1",
                    "var2",
                    "var3",
                    "var4",
                    "var1true",
                    "var2true",
                    "var3true",
                    "var4true"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="To Do"))
            self$add(jmvcore::Image$new(
                options=options,
                title="Venn Diagram",
                name="plot",
                width=700,
                height=450,
                renderFun=".plot",
                requiresData=TRUE,
                refs=list(
                    "venn")))
            self$add(jmvcore::Image$new(
                options=options,
                title="Upset Diagram",
                name="plot2",
                width=700,
                height=450,
                renderFun=".plot2",
                requiresData=TRUE,
                refs=list(
                    "upset")))}))

vennBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "vennBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "venn",
                version = c(1,0,0),
                options = options,
                results = vennResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Venn Diagram
#'
#' 
#' @param data The data as a data frame.
#' @param var1 a string naming the variable from \code{data} that contains the
#'   the first variable used for the report
#' @param var1true a string naming the level from \code{var1} that contains
#'   the the true level
#' @param var2 a string naming the variable from \code{data} that contains the
#'   the second variable used for the report
#' @param var2true a string naming the level from \code{var2} that contains
#'   the the true level
#' @param var3 a string naming the variable from \code{data} that contains the
#'   the third variable used for the report
#' @param var3true a string naming the level from \code{var3} that contains
#'   the the true level
#' @param var4 a string naming the variable from \code{data} that contains the
#'   the fourth variable used for the report
#' @param var4true a string naming the level from \code{var4} that contains
#'   the the true level
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$plot2} \tab \tab \tab \tab \tab an image \cr
#' }
#'
#' @export
venn <- function(
    data,
    var1,
    var1true,
    var2,
    var2true,
    var3,
    var3true,
    var4,
    var4true) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("venn requires jmvcore to be installed (restart may be required)")

    if ( ! missing(var1)) var1 <- jmvcore::resolveQuo(jmvcore::enquo(var1))
    if ( ! missing(var2)) var2 <- jmvcore::resolveQuo(jmvcore::enquo(var2))
    if ( ! missing(var3)) var3 <- jmvcore::resolveQuo(jmvcore::enquo(var3))
    if ( ! missing(var4)) var4 <- jmvcore::resolveQuo(jmvcore::enquo(var4))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(var1), var1, NULL),
            `if`( ! missing(var2), var2, NULL),
            `if`( ! missing(var3), var3, NULL),
            `if`( ! missing(var4), var4, NULL))

    for (v in var1) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in var2) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in var3) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])
    for (v in var4) if (v %in% names(data)) data[[v]] <- as.factor(data[[v]])

    options <- vennOptions$new(
        var1 = var1,
        var1true = var1true,
        var2 = var2,
        var2true = var2true,
        var3 = var3,
        var3true = var3true,
        var4 = var4,
        var4true = var4true)

    analysis <- vennClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

