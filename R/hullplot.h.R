
# This file is automatically generated, you probably don't want to edit this

hullplotOptions <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hullplotOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            x_var = NULL,
            y_var = NULL,
            group_var = NULL,
            color_var = NULL,
            size_var = NULL,
            hull_concavity = 2,
            hull_alpha = 0.3,
            show_labels = TRUE,
            point_size = 2,
            point_alpha = 0.7,
            color_palette = "default",
            plot_theme = "minimal",
            plot_title = "Hull Plot - Group Visualization",
            x_label = "",
            y_label = "",
            hull_expand = 0.05,
            show_statistics = FALSE,
            outlier_detection = FALSE,
            confidence_ellipses = FALSE,
            show_summary = FALSE,
            show_assumptions = FALSE, ...) {

            super$initialize(
                package="ClinicoPath",
                name="hullplot",
                requiresData=TRUE,
                ...)

            private$..x_var <- jmvcore::OptionVariable$new(
                "x_var",
                x_var,
                default=NULL,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..y_var <- jmvcore::OptionVariable$new(
                "y_var",
                y_var,
                default=NULL,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"))
            private$..group_var <- jmvcore::OptionVariable$new(
                "group_var",
                group_var,
                default=NULL,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"))
            private$..color_var <- jmvcore::OptionVariable$new(
                "color_var",
                color_var,
                suggested=list(
                    "nominal",
                    "ordinal"),
                permitted=list(
                    "factor",
                    "numeric"),
                default=NULL)
            private$..size_var <- jmvcore::OptionVariable$new(
                "size_var",
                size_var,
                suggested=list(
                    "continuous"),
                permitted=list(
                    "numeric"),
                default=NULL)
            private$..hull_concavity <- jmvcore::OptionNumber$new(
                "hull_concavity",
                hull_concavity,
                min=0,
                max=2,
                default=2)
            private$..hull_alpha <- jmvcore::OptionNumber$new(
                "hull_alpha",
                hull_alpha,
                min=0,
                max=1,
                default=0.3)
            private$..show_labels <- jmvcore::OptionBool$new(
                "show_labels",
                show_labels,
                default=TRUE)
            private$..point_size <- jmvcore::OptionNumber$new(
                "point_size",
                point_size,
                min=0.5,
                max=10,
                default=2)
            private$..point_alpha <- jmvcore::OptionNumber$new(
                "point_alpha",
                point_alpha,
                min=0,
                max=1,
                default=0.7)
            private$..color_palette <- jmvcore::OptionList$new(
                "color_palette",
                color_palette,
                options=list(
                    "default",
                    "viridis",
                    "set1",
                    "set2",
                    "dark2",
                    "clinical"),
                default="default")
            private$..plot_theme <- jmvcore::OptionList$new(
                "plot_theme",
                plot_theme,
                options=list(
                    "minimal",
                    "classic",
                    "light",
                    "dark",
                    "clinical"),
                default="minimal")
            private$..plot_title <- jmvcore::OptionString$new(
                "plot_title",
                plot_title,
                default="Hull Plot - Group Visualization")
            private$..x_label <- jmvcore::OptionString$new(
                "x_label",
                x_label,
                default="")
            private$..y_label <- jmvcore::OptionString$new(
                "y_label",
                y_label,
                default="")
            private$..hull_expand <- jmvcore::OptionNumber$new(
                "hull_expand",
                hull_expand,
                min=0,
                max=1,
                default=0.05)
            private$..show_statistics <- jmvcore::OptionBool$new(
                "show_statistics",
                show_statistics,
                default=FALSE)
            private$..outlier_detection <- jmvcore::OptionBool$new(
                "outlier_detection",
                outlier_detection,
                default=FALSE)
            private$..confidence_ellipses <- jmvcore::OptionBool$new(
                "confidence_ellipses",
                confidence_ellipses,
                default=FALSE)
            private$..show_summary <- jmvcore::OptionBool$new(
                "show_summary",
                show_summary,
                default=FALSE)
            private$..show_assumptions <- jmvcore::OptionBool$new(
                "show_assumptions",
                show_assumptions,
                default=FALSE)

            self$.addOption(private$..x_var)
            self$.addOption(private$..y_var)
            self$.addOption(private$..group_var)
            self$.addOption(private$..color_var)
            self$.addOption(private$..size_var)
            self$.addOption(private$..hull_concavity)
            self$.addOption(private$..hull_alpha)
            self$.addOption(private$..show_labels)
            self$.addOption(private$..point_size)
            self$.addOption(private$..point_alpha)
            self$.addOption(private$..color_palette)
            self$.addOption(private$..plot_theme)
            self$.addOption(private$..plot_title)
            self$.addOption(private$..x_label)
            self$.addOption(private$..y_label)
            self$.addOption(private$..hull_expand)
            self$.addOption(private$..show_statistics)
            self$.addOption(private$..outlier_detection)
            self$.addOption(private$..confidence_ellipses)
            self$.addOption(private$..show_summary)
            self$.addOption(private$..show_assumptions)
        }),
    active = list(
        x_var = function() private$..x_var$value,
        y_var = function() private$..y_var$value,
        group_var = function() private$..group_var$value,
        color_var = function() private$..color_var$value,
        size_var = function() private$..size_var$value,
        hull_concavity = function() private$..hull_concavity$value,
        hull_alpha = function() private$..hull_alpha$value,
        show_labels = function() private$..show_labels$value,
        point_size = function() private$..point_size$value,
        point_alpha = function() private$..point_alpha$value,
        color_palette = function() private$..color_palette$value,
        plot_theme = function() private$..plot_theme$value,
        plot_title = function() private$..plot_title$value,
        x_label = function() private$..x_label$value,
        y_label = function() private$..y_label$value,
        hull_expand = function() private$..hull_expand$value,
        show_statistics = function() private$..show_statistics$value,
        outlier_detection = function() private$..outlier_detection$value,
        confidence_ellipses = function() private$..confidence_ellipses$value,
        show_summary = function() private$..show_summary$value,
        show_assumptions = function() private$..show_assumptions$value),
    private = list(
        ..x_var = NA,
        ..y_var = NA,
        ..group_var = NA,
        ..color_var = NA,
        ..size_var = NA,
        ..hull_concavity = NA,
        ..hull_alpha = NA,
        ..show_labels = NA,
        ..point_size = NA,
        ..point_alpha = NA,
        ..color_palette = NA,
        ..plot_theme = NA,
        ..plot_title = NA,
        ..x_label = NA,
        ..y_label = NA,
        ..hull_expand = NA,
        ..show_statistics = NA,
        ..outlier_detection = NA,
        ..confidence_ellipses = NA,
        ..show_summary = NA,
        ..show_assumptions = NA)
)

hullplotResults <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hullplotResults",
    inherit = jmvcore::Group,
    active = list(
        todo = function() private$.items[["todo"]],
        plot = function() private$.items[["plot"]],
        statistics = function() private$.items[["statistics"]],
        outliers = function() private$.items[["outliers"]],
        interpretation = function() private$.items[["interpretation"]],
        summary = function() private$.items[["summary"]],
        assumptions = function() private$.items[["assumptions"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Hull Plot",
                refs=list(
                    "ClinicoPathJamoviModule",
                    "ggforce"))
            self$add(jmvcore::Html$new(
                options=options,
                name="todo",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Image$new(
                options=options,
                name="plot",
                title="Hull Plot",
                width=800,
                height=600,
                renderFun=".plot"))
            self$add(jmvcore::Html$new(
                options=options,
                name="statistics",
                title="Group Statistics",
                visible="(show_statistics)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="outliers",
                title="Outlier Analysis",
                visible="(outlier_detection)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="interpretation",
                title="Interpretation Guide"))
            self$add(jmvcore::Html$new(
                options=options,
                name="summary",
                title="Natural Language Summary",
                visible="(show_summary)"))
            self$add(jmvcore::Html$new(
                options=options,
                name="assumptions",
                title="Assumptions & Guidelines",
                visible="(show_assumptions)"))}))

hullplotBase <- if (requireNamespace("jmvcore", quietly=TRUE)) R6::R6Class(
    "hullplotBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = "ClinicoPath",
                name = "hullplot",
                version = c(0,0,31),
                options = options,
                results = hullplotResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE,
                weightsSupport = 'auto')
        }))

#' Hull Plot
#'
#' Creates Hull plots to visualize clusters and groups in scatter plots using 
#' ggforce.
#' Hull plots draw polygonal boundaries around data points grouped by 
#' categorical variables,
#' making it easy to identify customer segments, group membership, and data 
#' clusters.
#' Based on the geom_mark_hull() function from ggforce package.
#' 
#'
#' @examples
#' \donttest{
#' # Example:
#' # 1. Load your data frame with continuous variables for x and y axes.
#' # 2. Select x and y variables for the scatter plot.
#' # 3. Choose a grouping variable to define hull boundaries.
#' # 4. Customize hull appearance and plot aesthetics.
#' # 5. Run the hull plot to visualize group clusters.
#'}
#' @param data The data as a data frame.
#' @param x_var Continuous variable for the X-axis of the scatter plot.
#' @param y_var Continuous variable for the Y-axis of the scatter plot.
#' @param group_var Categorical variable that defines the groups for hull
#'   boundaries. Each group will have its own hull polygon.
#' @param color_var Optional variable for coloring points. If not specified,
#'   uses the grouping variable.
#' @param size_var Optional continuous variable for sizing points based on
#'   values.
#' @param hull_concavity Controls the concavity of hull polygons. Lower values
#'   create more concave hulls, higher values create more convex hulls. Range:
#'   0-2, default: 2.
#' @param hull_alpha Transparency level for hull polygons. 0 = completely
#'   transparent, 1 = opaque.
#' @param show_labels If TRUE, displays group labels inside hull regions.
#' @param point_size Size of scatter plot points.
#' @param point_alpha Transparency level for scatter plot points.
#' @param color_palette Color palette for hulls and points.
#' @param plot_theme Overall visual theme for the plot.
#' @param plot_title Custom title for the hull plot.
#' @param x_label Custom label for X-axis. If empty, uses variable name.
#' @param y_label Custom label for Y-axis. If empty, uses variable name.
#' @param hull_expand Amount to expand hull boundaries beyond data points.
#'   Higher values create larger hulls.
#' @param show_statistics If TRUE, displays summary statistics for each group
#'   in the output.
#' @param outlier_detection If TRUE, identifies and highlights potential
#'   outliers within groups.
#' @param confidence_ellipses If TRUE, adds confidence ellipses in addition to
#'   hull polygons.
#' @param show_summary If TRUE, displays a plain-language summary of the
#'   results with copy-ready text.
#' @param show_assumptions If TRUE, displays data requirements, assumptions,
#'   and usage guidelines.
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$todo} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$plot} \tab \tab \tab \tab \tab an image \cr
#'   \code{results$statistics} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$outliers} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$interpretation} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$summary} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$assumptions} \tab \tab \tab \tab \tab a html \cr
#' }
#'
#' @export
hullplot <- function(
    data,
    x_var = NULL,
    y_var = NULL,
    group_var = NULL,
    color_var = NULL,
    size_var = NULL,
    hull_concavity = 2,
    hull_alpha = 0.3,
    show_labels = TRUE,
    point_size = 2,
    point_alpha = 0.7,
    color_palette = "default",
    plot_theme = "minimal",
    plot_title = "Hull Plot - Group Visualization",
    x_label = "",
    y_label = "",
    hull_expand = 0.05,
    show_statistics = FALSE,
    outlier_detection = FALSE,
    confidence_ellipses = FALSE,
    show_summary = FALSE,
    show_assumptions = FALSE) {

    if ( ! requireNamespace("jmvcore", quietly=TRUE))
        stop("hullplot requires jmvcore to be installed (restart may be required)")

    if ( ! missing(x_var)) x_var <- jmvcore::resolveQuo(jmvcore::enquo(x_var))
    if ( ! missing(y_var)) y_var <- jmvcore::resolveQuo(jmvcore::enquo(y_var))
    if ( ! missing(group_var)) group_var <- jmvcore::resolveQuo(jmvcore::enquo(group_var))
    if ( ! missing(color_var)) color_var <- jmvcore::resolveQuo(jmvcore::enquo(color_var))
    if ( ! missing(size_var)) size_var <- jmvcore::resolveQuo(jmvcore::enquo(size_var))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(x_var), x_var, NULL),
            `if`( ! missing(y_var), y_var, NULL),
            `if`( ! missing(group_var), group_var, NULL),
            `if`( ! missing(color_var), color_var, NULL),
            `if`( ! missing(size_var), size_var, NULL))


    options <- hullplotOptions$new(
        x_var = x_var,
        y_var = y_var,
        group_var = group_var,
        color_var = color_var,
        size_var = size_var,
        hull_concavity = hull_concavity,
        hull_alpha = hull_alpha,
        show_labels = show_labels,
        point_size = point_size,
        point_alpha = point_alpha,
        color_palette = color_palette,
        plot_theme = plot_theme,
        plot_title = plot_title,
        x_label = x_label,
        y_label = y_label,
        hull_expand = hull_expand,
        show_statistics = show_statistics,
        outlier_detection = outlier_detection,
        confidence_ellipses = confidence_ellipses,
        show_summary = show_summary,
        show_assumptions = show_assumptions)

    analysis <- hullplotClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}

