---
title: "IHC Marker Clustering for Pathologists: Distance Metrics Guide"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{IHC Marker Clustering for Pathologists: Distance Metrics Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# IHC Marker Clustering for Pathologists: Distance Metrics Guide

**A Practical Guide to Understanding How Markers Cluster Together**

---

## Why Cluster IHC Markers?

As pathologists, we use IHC panels daily to make differential diagnoses. But have you ever wondered:

- **Which markers provide redundant information?** (Is adding CK20 really helpful if you already have CDX2?)
- **Which markers tend to co-express?** (Do ER+ tumors always show PR positivity?)
- **What's the minimal panel for a diagnosis?** (Can I drop 2-3 markers without losing diagnostic power?)
- **Are there unexpected marker associations?** (Hidden patterns in your dataset)

**Marker clustering answers these questions** by grouping IHC markers based on their expression patterns across your cases.

---

## The Basics: Patient Clustering vs. Marker Clustering

### Patient Clustering (What You Already Know)
- **Question:** "Which patients have similar IHC profiles?"
- **Example:** Clustering breast cancer cases by ER/PR/HER2/Ki67
- **Output:** Luminal A, Luminal B, HER2+, Triple-negative groups

### Marker Clustering (What's New) â­
- **Question:** "Which IHC markers behave similarly?"
- **Example:** Do CK7 and TTF1 tend to be positive in the same cases?
- **Output:** Marker groups showing co-expression or redundancy

---

## The 9 Distance Metrics: A Pathologist's Guide

### Quick Selection Flowchart

```
START HERE
â†“
What type of IHC data do you have?
â†“
â”œâ”€ Binary (Positive/Negative only)?
â”‚  â”œâ”€ Many negatives? â†’ Use JACCARD
â”‚  â””â”€ Balanced +/-? â†’ Use CHI-SQUARED â­
â”‚
â”œâ”€ Ordinal (0/1+/2+/3+ intensity)?
â”‚  â””â”€ â†’ Use CHI-SQUARED â­ or HAMMING
â”‚
â”œâ”€ Continuous (H-scores, % positive)?
â”‚  â”œâ”€ Normally distributed? â†’ Use EUCLIDEAN â­
â”‚  â””â”€ Have outliers? â†’ Use MANHATTAN
â”‚
â””â”€ Mixed (Binary + Continuous)?
   â”œâ”€ Want automatic handling? â†’ Use MIXED â­
   â””â”€ Expect non-linear patterns? â†’ Use MUTUAL INFORMATION
```

---

## Detailed Clinical Scenarios

### Scenario 1: Lung Adenocarcinoma vs. Squamous Cell Carcinoma
**Your Panel:** TTF1, Napsin A, p40, CK5/6 (all binary: pos/neg)

#### ğŸ‘‰ Recommended: **Chi-squared Distance**

**Why this works:**
- Chi-squared tests if two markers are statistically independent
- Perfect for binary/categorical IHC data
- Provides statistical significance (p-values)
- Well-established in pathology literature

**Expected Results:**
```
Marker Group 1: TTF1 + Napsin A (adenocarcinoma markers)
â”œâ”€ Strong association (p < 0.001)
â”œâ”€ CramÃ©r's V = 0.72 (strong effect)
â””â”€ Interpretation: These markers are redundant

Marker Group 2: p40 + CK5/6 (squamous markers)
â”œâ”€ Strong association (p < 0.001)
â”œâ”€ CramÃ©r's V = 0.68 (strong effect)
â””â”€ Interpretation: These markers are redundant

Distance between groups: High
â””â”€ Interpretation: Groups are mutually exclusive (good!)
```

**Clinical Implications:**
- âœ… **Keep:** One marker from each group (e.g., TTF1 + p40)
- âŒ **Consider dropping:** Napsin A if TTF1 is positive (provides redundant info)
- ğŸ’° **Cost savings:** Reduced antibody usage without losing diagnostic accuracy

---

### Scenario 2: Breast Cancer Immunoprofile
**Your Panel:**
- Binary: ER (pos/neg), PR (pos/neg), HER2 (pos/neg)
- Continuous: Ki67 (% positive, 0-100%)

#### ğŸ‘‰ Recommended: **Mixed Distance**

**Why this works:**
- Automatically handles mixed data types
- Uses chi-squared for ER-PR-HER2 pairs
- Uses correlation for Ki67 relationships
- No manual method selection needed

**Expected Results:**
```
Marker Group 1: ER + PR
â”œâ”€ Chi-squared test: p < 0.001
â”œâ”€ Co-expression rate: 85%
â””â”€ Interpretation: Strong positive association

ER-Ki67 Relationship:
â”œâ”€ Eta-squared (ANOVA): 0.42
â”œâ”€ ER+ tumors: Ki67 mean = 15%
â””â”€ ER- tumors: Ki67 mean = 45%
    Interpretation: ER- tumors have higher proliferation

HER2: Independent marker
â”œâ”€ Low association with ER/PR (p > 0.05)
â””â”€ Interpretation: Provides unique diagnostic information
```

**Clinical Implications:**
```
Molecular Subtype Prediction:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Luminal A:   ER+/PR+, HER2-, Ki67 <20%  â”‚  â† ER-PR-Ki67 cluster
â”‚ Luminal B:   ER+/PR+, HER2-, Ki67 â‰¥20%  â”‚  â† ER-PR-Ki67 cluster
â”‚ HER2-enriched: HER2+ (regardless of ER) â”‚  â† HER2 independent
â”‚ Triple-negative: ER-/PR-/HER2-          â”‚  â† All separate
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Actionable Insights:**
- ER and PR tend to co-express (85% concordance)
- When ER is negative, PR rarely adds new information
- Ki67 shows inverse relationship with ER status
- HER2 provides independent prognostic information

---

### Scenario 3: Gastrointestinal Tumor Panel
**Your Panel:** CK7, CK20, CDX2, SATB2 (all binary)
**Question:** Is CDX2 necessary if I already have CK20 and SATB2?

#### ğŸ‘‰ Recommended: **Jaccard Distance**

**Why this works:**
- GI tumors often have many negative markers (sparse data)
- Jaccard focuses on co-positivity, ignores double-negatives
- Clinically relevant: we care about co-expression of positive markers
- Simple interpretation for binary data

**Example Output:**
```
Jaccard Similarity Matrix:
           CK7   CK20  CDX2  SATB2
CK7       1.00  0.15  0.12  0.08
CK20      0.15  1.00  0.68  0.45
CDX2      0.12  0.68  1.00  0.52
SATB2     0.08  0.45  0.52  1.00
```

**Converting to Distance:**
```
Jaccard Distance = 1 - Jaccard Similarity

           CK7   CK20  CDX2  SATB2
CK7       0.00  0.85  0.88  0.92  â† CK7 is distant from others
CK20      0.85  0.00  0.32  0.55  â† CK20-CDX2 are close (0.32)
CDX2      0.88  0.32  0.00  0.48  â† CDX2-SATB2 are close (0.48)
SATB2     0.92  0.55  0.48  0.00
```

**Dendrogram Interpretation:**
```
         CK7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”œâ”€â”€â”€â”€ Distinct group
         CK20 â”€â”€â”                  â”‚
                â”œâ”€â”€â”€â”€â”             â”‚
         CDX2 â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         SATB2 â”€â”€â”€â”€â”€â”€â”˜

Legend:
â”œâ”€ Short branch = similar markers (redundant)
â””â”€ Long branch = distinct markers (keep separate)
```

**Clinical Decision:**
```
Marker Group 1 (Lower GI): CK20, CDX2, SATB2
â”œâ”€ CK20-CDX2 distance = 0.32 (very similar!)
â”œâ”€ CDX2-SATB2 distance = 0.48 (moderately similar)
â””â”€ Recommendation: Could use CDX2 OR CK20 (not both)

Marker Group 2 (Upper GI): CK7
â”œâ”€ Distant from all others (0.85-0.92)
â””â”€ Recommendation: Must keep (provides unique info)

Optimized Panel Suggestion:
âœ… Keep: CK7 + CDX2 + SATB2
âŒ Consider dropping: CK20 (redundant with CDX2 in colon tumors)
```

**Real Case Examples:**
```
Case 1: Colon Adenocarcinoma
CK7[-], CK20[+], CDX2[+], SATB2[+]
â””â”€ CK20 and CDX2 both positive (redundant in this case)

Case 2: Cholangiocarcinoma
CK7[+], CK20[+], CDX2[-], SATB2[-]
â””â”€ CK7 provides diagnostic value (different from CK20)

Case 3: Pancreatic Adenocarcinoma
CK7[+], CK20[+], CDX2[+], SATB2[-]
â””â”€ Mixed pattern: need multiple markers
```

---

### Scenario 4: Melanoma Marker Panel
**Your Panel:** S100, SOX10, Melan-A, HMB45 (all intensity: 0/1+/2+/3+)
**Question:** Which markers provide similar information?

#### ğŸ‘‰ Recommended: **Hamming Distance**

**Why this works:**
- Counts how often markers disagree in intensity
- Intuitive for pathologists (we think in terms of concordance)
- Simple calculation: % of cases where markers differ
- Works well with intensity scoring

**Example Calculation:**

| Case | S100 | SOX10 | Melan-A | HMB45 | S100=SOX10? | S100=Melan-A? |
|------|------|-------|---------|-------|-------------|---------------|
| 1    | 3+   | 3+    | 2+      | 1+    | âœ… Yes      | âŒ No         |
| 2    | 3+   | 3+    | 3+      | 2+    | âœ… Yes      | âœ… Yes        |
| 3    | 2+   | 3+    | 1+      | 0     | âŒ No       | âŒ No         |
| 4    | 3+   | 2+    | 2+      | 0     | âŒ No       | âŒ No         |
| 5    | 0    | 0     | 0       | 0     | âœ… Yes      | âœ… Yes        |

**Hamming Distance:**
```
S100 vs SOX10:   2/5 disagree = 0.40 distance (60% concordance)
S100 vs Melan-A: 3/5 disagree = 0.60 distance (40% concordance)
S100 vs HMB45:   4/5 disagree = 0.80 distance (20% concordance)

Interpretation:
- S100 and SOX10 are most similar (lowest distance)
- HMB45 behaves differently (highest distance)
```

**Clinical Pattern:**
```
Nuclear Markers:    S100 â”€â”¬â”€ High concordance
                    SOX10â”€â”˜  (distance = 0.40)

Cytoplasmic Markers: Melan-A â”€â”¬â”€ Moderate concordance
                      HMB45 â”€â”€â”€â”˜  (distance varies)

Distance between groups: High
â””â”€ Nuclear vs cytoplasmic markers show different patterns
```

**Practical Recommendations:**
```
For melanoma confirmation:
1. Start with: S100 (sensitive) + HMB45 (specific)
2. If equivocal: Add SOX10 (nuclear backup)
3. Reserve Melan-A for: Cytoplasmic confirmation

Panel Rationalization:
âœ… Keep: S100 + HMB45 (different sensitivity/specificity profiles)
âš ï¸ Optional: SOX10 (adds value if S100 equivocal)
âš ï¸ Optional: Melan-A (different localization, useful for epithelioid)
```

---

### Scenario 5: Lymphoma Immunoprofile
**Your Panel:**
- Binary: CD20, CD3, CD5, CD10, BCL6
- Continuous: Ki67 (% positive)

**Specific Question:** Do germinal center markers (CD10, BCL6) always co-express?

#### ğŸ‘‰ Recommended: **Chi-squared Distance** + Statistical Testing

**Example Results:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MARKER-MARKER ASSOCIATION TESTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CD10 vs BCL6:
â”œâ”€ Chi-squared = 42.3, p < 0.001
â”œâ”€ CramÃ©r's V = 0.68 (strong association)
â”œâ”€ Concordance table:
â”‚
â”‚            BCL6-  BCL6+
â”‚   CD10-    45     8      â† 85% concordance when both negative
â”‚   CD10+    5      32     â† 86% concordance when CD10+
â”‚
â””â”€ Interpretation: Strong co-expression (germinal center phenotype)

CD5 vs CD10:
â”œâ”€ Chi-squared = 38.7, p < 0.001
â”œâ”€ CramÃ©r's V = -0.72 (strong negative association)
â”œâ”€ Concordance table:
â”‚
â”‚            CD10-  CD10+
â”‚   CD5-     12     35     â† CD5- tumors often CD10+
â”‚   CD5+     41     2      â† CD5+ tumors rarely CD10+
â”‚
â””â”€ Interpretation: Mutually exclusive (mantle vs. GC origin)

CD20 vs CD3:
â”œâ”€ Chi-squared = 87.5, p < 0.001
â”œâ”€ Perfect separation (B-cell vs T-cell)
â””â”€ Interpretation: Lineage markers (must keep both)
```

**Dendrogram Interpretation:**
```
Germinal Center Group:
    CD10 â”€â”€â”¬â”€â”€ Very close (distance = 0.32)
    BCL6 â”€â”€â”˜    Co-expression in DLBCL-GCB, FL

B-cell Lineage:
    CD20 â”€â”€â”€â”€â”€â”€â”€ Separate from others

Mantle/Non-GC:
    CD5 â”€â”€â”€â”€â”€â”€â”€â”€ Opposite of CD10/BCL6

T-cell Lineage:
    CD3 â”€â”€â”€â”€â”€â”€â”€â”€ Completely separate
```

**Clinical Algorithm:**
```
Lymphoma Workup:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Lineage (Required)                      â”‚
â”‚   â†’ CD20 (B-cell) vs CD3 (T-cell)              â”‚
â”‚   â†’ Must keep both (mutually exclusive)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: B-cell Subclassification                â”‚
â”‚   â†’ CD10 + BCL6 = Germinal center origin       â”‚
â”‚   â†’ CD5 = Mantle/Non-GC origin                 â”‚
â”‚   â†’ Pattern: CD10/BCL6 cluster vs CD5 separate â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Proliferation                           â”‚
â”‚   â†’ Ki67 (continuous variable)                  â”‚
â”‚   â†’ Independent of other markers                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Optimized Panel:
âœ… Must keep: CD20, CD3 (lineage)
âœ… Must keep: CD10 OR BCL6 (one from GC cluster)
âœ… Must keep: CD5 (non-GC)
âœ… Must keep: Ki67 (proliferation)

Could eliminate: One of CD10/BCL6 (redundant in most cases)
```

---

### Scenario 6: Neuroendocrine Tumor Grading
**Your Panel:**
- Binary: Chromogranin, Synaptophysin, CD56
- Continuous: Ki67 % (for grading G1/G2/G3)
- Ordinal: p53 intensity (0/1+/2+/3+)

**Question:** Can I predict Ki67 level from other markers?

#### ğŸ‘‰ Recommended: **Mutual Information Distance**

**Why this works:**
- Captures non-linear relationships
- Works with mixed data types
- Detects patterns like "Ki67 high ONLY when p53 is strong positive"
- Information-theoretic approach (model-free)

**Example Results:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MUTUAL INFORMATION ANALYSIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Marker Pair: p53 (ordinal) vs Ki67 (continuous)
â”œâ”€ Mutual Information = 0.62 bits
â”œâ”€ Normalized MI = 0.58 (moderate information sharing)
â”œâ”€
â”œâ”€ Breakdown by p53 intensity:
â”‚   p53 0/1+  : Ki67 mean = 3.2%  (Ïƒ = 2.1)  â† G1 tumors
â”‚   p53 2+    : Ki67 mean = 12.5% (Ïƒ = 5.3)  â† G2 tumors
â”‚   p53 3+    : Ki67 mean = 48.7% (Ïƒ = 18.2) â† G3 tumors
â”‚
â””â”€ Interpretation: Strong non-linear relationship
    (High p53 predicts high Ki67, but not vice versa)

Marker Pair: Chromogranin vs Ki67
â”œâ”€ Mutual Information = 0.12 bits
â”œâ”€ Normalized MI = 0.08 (weak information sharing)
â””â”€ Interpretation: Independent markers
    (Chromogranin doesn't predict proliferation)

Marker Pair: Chromogranin vs Synaptophysin
â”œâ”€ Mutual Information = 0.78 bits
â”œâ”€ Normalized MI = 0.85 (strong information sharing)
â”œâ”€ Co-expression: 92% of cases
â””â”€ Interpretation: Redundant markers
    (One is sufficient for NET diagnosis)
```

**Clinical Decision Tree:**
```
Neuroendocrine Tumor Confirmation:
    â”œâ”€ Chromogranin [+] â”€â”€â”
    â””â”€ Synaptophysin [+] â”€â”´â”€â†’ High MI (redundant)
         â”‚
         â†’ Recommendation: Use ONE for diagnosis

Grading (Non-linear pattern detected):
    â”œâ”€ Ki67 < 3%  + p53 0/1+ â†’ Grade 1 (Low-grade)
    â”œâ”€ Ki67 3-20% + p53 2+   â†’ Grade 2 (Intermediate)
    â””â”€ Ki67 > 20% + p53 3+   â†’ Grade 3 (High-grade)
         â”‚
         â†’ Pattern: p53 intensity increases WITH Ki67
         â†’ MI detects this non-linear association
         â†’ Linear correlation would miss this pattern!
```

**Comparison: MI vs. Correlation:**
```
Using Standard Correlation (Linear):
p53 vs Ki67 correlation = 0.42
â””â”€ Would conclude: "Moderate positive correlation"
   (Misses the threshold effects!)

Using Mutual Information (Non-linear):
p53 vs Ki67 normalized MI = 0.58
â””â”€ Detects: "Strong information sharing with thresholds"
   (Captures the G1/G2/G3 transition points!)

Clinical Impact:
âœ… MI correctly identifies: p53 3+ predicts high Ki67
âŒ Correlation misses: The threshold nature of grading
```

---

### Scenario 7: Prostate Cancer Markers
**Your Panel:**
- PSA (H-score: 0-300)
- NKX3.1 (H-score: 0-300)
- ERG (H-score: 0-300)
- PTEN (% loss: 0-100%)

**Question:** Do ERG+ cases have different marker patterns?

#### ğŸ‘‰ Recommended: **Euclidean Distance** (continuous data)

**Why this works:**
- All markers are continuous (H-scores, percentages)
- Euclidean distance is the standard for continuous data
- Captures magnitude differences (important for H-scores)
- Auto-scaled to handle different ranges

**Example Analysis:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EUCLIDEAN DISTANCE MATRIX (scaled)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

            PSA    NKX3.1  ERG    PTEN
PSA         0.00   0.45    1.28   0.89
NKX3.1      0.45   0.00    1.35   0.92
ERG         1.28   1.35    0.00   0.58
PTEN        0.89   0.92    0.58   0.00

Interpretation:
â”œâ”€ PSA-NKX3.1: Close (0.45) â†’ Often co-expressed
â”œâ”€ ERG-PTEN: Moderate (0.58) â†’ Some association
â””â”€ ERG vs PSA/NKX3.1: Far (1.28-1.35) â†’ Independent
```

**Dendrogram Shows:**
```
Prostate Lineage Markers:
    PSA â”€â”€â”€â”¬â”€â”€â”€ Distance = 0.45 (high concordance)
    NKX3.1â”€â”˜     Both are prostate-specific

Molecular Subtype Markers:
    ERG â”€â”€â”€â”¬â”€â”€â”€ Distance = 0.58
    PTENâ”€â”€â”˜     TMPRSS2-ERG fusion-related

Groups are distant from each other (1.28-1.35)
â””â”€ Lineage markers independent from molecular markers
```

**Clinical Patterns (Revealed by Clustering):**

```
Pattern 1: Prostatic Adenocarcinoma (ERG-)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PSA:    High H-score (mean = 245)     â”‚  â† Lineage markers
â”‚ NKX3.1: High H-score (mean = 238)     â”‚     cluster together
â”‚ ERG:    Negative (H-score = 0)        â”‚  â† Molecular markers
â”‚ PTEN:   Intact (loss = 5%)            â”‚     separate cluster
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Pattern 2: Prostatic Adenocarcinoma (ERG+)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PSA:    High H-score (mean = 232)     â”‚  â† Lineage markers
â”‚ NKX3.1: High H-score (mean = 215)     â”‚     still positive
â”‚ ERG:    Positive (H-score = 180)      â”‚  â† ERG fusion present
â”‚ PTEN:   Loss (loss = 65%)             â”‚     Often with PTEN loss
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘
        ERG-PTEN co-occurrence (moderate distance = 0.58)

Pattern 3: High-grade Prostate Cancer
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PSA:    Low H-score (mean = 85)       â”‚  â† Lineage marker loss
â”‚ NKX3.1: Low H-score (mean = 92)       â”‚     (dedifferentiation)
â”‚ ERG:    Variable                       â”‚
â”‚ PTEN:   Loss (loss = 78%)             â”‚  â† High-grade feature
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Actionable Insights:**
```
1. Diagnostic Panel (Metastatic site):
   âœ… PSA + NKX3.1 = Redundant (distance = 0.45)
   â†’ Use ONE for prostate lineage

2. Prognostic Panel:
   âœ… ERG + PTEN = Complementary (distance = 0.58)
   â†’ ERG: Fusion-positive subtype
   â†’ PTEN: Aggressive disease marker
   â†’ Keep both (moderate association but not redundant)

3. Dedifferentiation Detection:
   â†’ If PSA + NKX3.1 both low â†’ High-grade features
   â†’ Euclidean distance captures MAGNITUDE loss
```

---

### Scenario 8: Renal Cell Carcinoma Panel
**Your Panel:**
- PAX8, RCC, CD10, CK7, Vimentin
- All binary (pos/neg)
- **Many negative stains expected** (sparse data)

#### ğŸ‘‰ Recommended: **Jaccard Distance** (focus on co-positivity)

**Why Jaccard over Chi-squared for RCC:**

```
Consider a 100-case dataset:

Using Chi-squared:
â”œâ”€ Includes double-negatives in calculation
â”œâ”€ PAX8[-]/CK7[-] cases (90 cases) â†’ counted as "agreement"
â””â”€ Can inflate association when many negatives

Using Jaccard:
â”œâ”€ Ignores double-negatives
â”œâ”€ Focuses on: PAX8[+]/CK7[+] co-positivity
â””â”€ Clinically relevant: we care about positive co-expression
```

**Example Results:**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
JACCARD ANALYSIS (Co-positivity Focus)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Clear Cell RCC Pattern:
PAX8 vs RCC marker:
â”œâ”€ Both positive: 68/100 cases
â”œâ”€ Either positive: 72/100 cases
â”œâ”€ Jaccard Index = 68/72 = 0.94 (very high!)
â””â”€ Interpretation: Nearly always co-express in ccRCC

PAX8 vs CD10:
â”œâ”€ Both positive: 65/100 cases
â”œâ”€ Either positive: 70/100 cases
â”œâ”€ Jaccard Index = 65/70 = 0.93
â””â”€ Interpretation: Strong co-expression in ccRCC

PAX8 vs CK7:
â”œâ”€ Both positive: 8/100 cases
â”œâ”€ Either positive: 78/100 cases
â”œâ”€ Jaccard Index = 8/78 = 0.10 (very low!)
â””â”€ Interpretation: Rarely co-express (mutually exclusive)

Vimentin:
â”œâ”€ Positive in most RCCs (non-specific)
â”œâ”€ Jaccard with others: 0.60-0.70
â””â”€ Interpretation: Sensitive but not specific
```

**Dendrogram Interpretation:**
```
Clear Cell RCC Cluster:
    PAX8 â”€â”€â”¬â”€â”€ Jaccard distance = 0.06 (nearly identical)
    RCC â”€â”€â”€â”¤
           â”œâ”€â”€ All cluster tightly
    CD10 â”€â”€â”˜   (co-positive in ccRCC)

Papillary RCC Pattern:
    CK7 â”€â”€â”€â”€â”€â”€â”€â”€ Separate (low Jaccard with ccRCC markers)

Non-specific:
    Vimentin â”€â”€â”€ Moderate distance from all
```

**Clinical Decision Algorithm:**
```
RCC Subtype Differentiation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Clear Cell RCC:                                 â”‚
â”‚   PAX8[+], RCC[+], CD10[+], CK7[-], Vim[+]    â”‚
â”‚                                                 â”‚
â”‚   Marker Cluster: PAX8-RCC-CD10                â”‚
â”‚   â””â”€ High Jaccard (0.93-0.94) = Redundant!     â”‚
â”‚                                                 â”‚
â”‚   Minimal Panel: PAX8 + CK7                    â”‚
â”‚   â””â”€ PAX8[+]/CK7[-] â†’ Likely ccRCC            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Papillary RCC:                                  â”‚
â”‚   PAX8[+], RCC[+/-], CD10[-/+], CK7[+], Vim[+]â”‚
â”‚                                                 â”‚
â”‚   Key Discriminator: CK7                       â”‚
â”‚   â””â”€ Low Jaccard with ccRCC markers (0.10)     â”‚
â”‚                                                 â”‚
â”‚   Minimal Panel: PAX8 + CK7                    â”‚
â”‚   â””â”€ PAX8[+]/CK7[+] â†’ Likely pRCC             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Cost Optimization:
âœ… Keep: PAX8 (renal lineage), CK7 (subtype discriminator)
âŒ Drop: RCC marker (redundant with PAX8, Jaccard = 0.94)
âŒ Drop: CD10 (redundant with PAX8, Jaccard = 0.93)
âš ï¸ Optional: Vimentin (non-specific, moderate Jaccard)

Potential Savings:
â”œâ”€ 2-3 antibodies per case
â”œâ”€ Maintains diagnostic accuracy
â””â”€ Based on co-expression analysis
```

---

## Distance Metric Properties: Quick Reference for Pathologists

### When You Have SPARSE Binary Data (Many Negatives)

**Problem:**
```
Example: Rare marker panel (BCL2, BCL6, MYC in lymphoma)

         BCL2-  BCL2+
BCL6-    85     5      â† 85 double-negative cases
BCL6+    3      7      â† Only 7 co-positive cases

Chi-squared: "Strong association" (p < 0.001)
â””â”€ Driven by 85 double-negative cases!
```

**Solution: Use Jaccard**
```
Jaccard Index = 7 / (7+5+3) = 7/15 = 0.47
â””â”€ Focuses on the 15 cases with ANY positivity
â””â”€ Clinically meaningful: 47% co-positivity rate
```

---

### When You Have OUTLIERS in Continuous Data

**Problem:**
```
Ki67 % Distribution:
Cases 1-98: Range 0-30% (typical)
Case 99:    Ki67 = 95% (outlier)
Case 100:   Ki67 = 2%

Euclidean Distance (Case 99 vs Case 100):
â””â”€ Heavily penalizes this outlier (squared differences)
â””â”€ May distort entire clustering
```

**Solution: Use Manhattan**
```
Manhattan Distance:
â””â”€ Uses absolute differences (not squared)
â””â”€ More robust to outliers
â””â”€ Better represents typical case relationships
```

---

### When Markers Have DIFFERENT SCALES

**Problem:**
```
Marker A: Ki67 % (range 0-100)
Marker B: p53 H-score (range 0-300)

Without scaling:
â””â”€ p53 dominates distance calculation (larger numbers)
```

**Solution: Automatic Scaling**
```
Both Euclidean and Manhattan:
âœ… Automatically z-score normalize
âœ… Each marker: mean = 0, SD = 1
âœ… Fair comparison regardless of original scale
```

---

### When Relationship is NON-LINEAR

**Problem:**
```
Linear Correlation Misses This Pattern:

Ki67 vs Grade:
Grade 1 (90 cases): Ki67 = 2% (SD = 1%)
Grade 2 (8 cases):  Ki67 = 12% (SD = 3%)
Grade 3 (2 cases):  Ki67 = 55% (SD = 15%)

Pearson Correlation = 0.35 (weak!)
â””â”€ Linear assumption fails (step-wise relationship)
```

**Solution: Use Mutual Information**
```
Mutual Information = 0.68 (strong!)
â””â”€ Captures the grade thresholds
â””â”€ No linearity assumption
â””â”€ Information-theoretic approach
```

---

## Interpreting the Dendrogram: A Step-by-Step Guide

### Anatomy of a Marker Dendrogram

```
                                 â”Œâ”€ Marker A
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â”Œâ”€â”€â”€â”€â”€â”€â”¤        â””â”€ Marker B
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
        â”‚        â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marker C
â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
        â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Marker D
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Marker E

        â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
         0   0.2  0.4  0.6  0.8  1.0
              Distance (Y-axis)
```

### Reading the Dendrogram (Left to Right)

1. **Marker Names (X-axis bottom)**
   - Individual IHC markers

2. **Height (Y-axis)**
   - Distance at which markers join
   - Lower = more similar
   - Higher = more different

3. **Branches**
   - Markers joined by short vertical lines are similar
   - Long branches = markers are distinct

4. **Groupings**
   - Markers clustering together share expression patterns

### Clinical Example: GI Tumor Panel

```
Real Dendrogram from Your Data:

Height (Distance)
â”‚
1.0â”‚
   â”‚                              â”Œâ”€ CK7
0.8â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                     â”‚        â””â”€ MUC6
0.6â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚            â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MUC5AC
0.4â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  CEA
0.2â”‚â”€â”€â”€â”€â”¤
   â”‚    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CDX2
   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¤
0.0â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MUC2
   â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€
      CK7  MUC6  MUC5AC CEA  CDX2 MUC2
```

**Interpretation:**

**Group 1 (Height 0.2-0.4): Upper GI Markers**
```
CK7 â”€â”¬â”€ Gastric phenotype
MUC6â”€â”¤  Distance = 0.2 (very similar)
     â”‚
MUC5AC (joins at 0.4)
CEA (joins at 0.4)

Clinical Meaning:
â”œâ”€ CK7 + MUC6 almost always together in gastric tumors
â”œâ”€ MUC5AC joins this group (still gastric)
â””â”€ CEA is related but less specific

Recommendation:
âœ… Keep CK7 (lineage marker)
âŒ Could drop MUC6 (redundant with CK7, distance 0.2)
âš ï¸ Keep MUC5AC IF differentiating gastric vs pancreatobiliary
```

**Group 2 (Height 0.0-0.2): Lower GI Markers**
```
CDX2â”€â”¬â”€ Intestinal phenotype
MUC2â”€â”˜  Distance = 0.1 (nearly identical)

Clinical Meaning:
â”œâ”€ CDX2 and MUC2 co-express in colorectal adenocarcinoma
â””â”€ Very low distance = highly redundant

Recommendation:
âœ… Keep CDX2 (more sensitive and specific)
âŒ Drop MUC2 (redundant, distance 0.1)
```

**Between Groups (Height 0.6-0.8):**
```
Upper GI Group â†â†’ Lower GI Group
Distance = 0.7 (very different)

Clinical Meaning:
â”œâ”€ Gastric vs intestinal phenotypes are distinct
â””â”€ Appropriate separation for differential diagnosis

Recommendation:
âœ… Panel structure is good
âœ… Clear separation between phenotypes
```

---

### Red Flags in Your Dendrogram

#### âš ï¸ Red Flag 1: No Separation Between Groups

```
Bad Pattern:
All markers cluster at distance 0.1-0.2
â””â”€ Everything is redundant!
â””â”€ Panel not optimized

Solution:
â””â”€ Review marker selection
â””â”€ Add markers targeting different pathways/lineages
```

#### âš ï¸ Red Flag 2: Unexpected Groupings

```
Unexpected Pattern:
TTF1 clusters with p40 (distance 0.15)

Wait, what?!
â”œâ”€ TTF1 = adenocarcinoma marker
â””â”€ p40 = squamous marker
    â””â”€ Should be DISTANT!

Possible Issues:
1. Data entry error (swapped columns?)
2. Mixed tumor population
3. Unusual cohort (both markers negative in most cases)

Action:
â””â”€ Review raw data before interpreting
```

#### âš ï¸ Red Flag 3: Single Marker Far from All Others

```
Isolated Pattern:
Marker X at distance > 0.9 from everything

Possible Explanations:
1. âœ… Unique diagnostic marker (good!)
2. âš ï¸ Technical failure (all negative?)
3. âš ï¸ Wrong tissue type?

Action:
â””â”€ Check that marker actually worked
â””â”€ Review positive/negative rates
```

---

## Statistical Tests: Understanding the P-values

### Chi-squared Test Output

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MARKER-MARKER ASSOCIATION: ER vs PR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Contingency Table:
          PR-   PR+   Total
ER-       45    12    57
ER+       8     85    93
Total     53    97    150

Chi-squared statistic: Ï‡Â² = 68.4
Degrees of freedom: df = 1
P-value: p < 0.001 ***

CramÃ©r's V: 0.675
Effect size interpretation: Strong association

Result: Statistically significant association
Conclusion: ER and PR are NOT independent
```

**What This Means for Pathologists:**

```
Interpretation:
â”œâ”€ p < 0.001: Extremely unlikely due to chance
â”œâ”€ CramÃ©r's V = 0.675: Strong effect size
â”œâ”€ Clinical: 85/93 (91%) of ER+ cases are also PR+
â””â”€ Decision: Markers are redundant in most cases

When to keep both:
â”œâ”€ Some ER+/PR- cases exist (8/93 = 9%)
â”œâ”€ Prognostic significance (PR loss = worse prognosis)
â””â”€ Recommendation: Keep both for breast cancer
```

### CramÃ©r's V Effect Size Guidelines

```
For 2x2 Tables (binary markers):

CramÃ©r's V     Interpretation            Clinical Meaning
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0.00 - 0.10    Negligible association   Markers are independent
0.10 - 0.30    Weak association         Slight relationship
0.30 - 0.50    Moderate association     Notable relationship
0.50 - 1.00    Strong association       Markers often co-express
1.00           Perfect association      Always co-express

Example:
â”œâ”€ TTF1 vs Napsin A: V = 0.72 â†’ Strong (redundant)
â”œâ”€ ER vs PR:         V = 0.68 â†’ Strong (related but keep both)
â””â”€ CK7 vs CK20:      V = 0.15 â†’ Weak (independent, keep both)
```

### P-value Interpretation (Conservative for Pathology)

```
P-value     Interpretation             Action
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
p < 0.001   Very strong evidence       Confident association
            (99.9% confident)

p < 0.01    Strong evidence            Likely association
            (99% confident)

p < 0.05    Moderate evidence          Consider association
            (95% confident)            Requires clinical context

p â‰¥ 0.05    Insufficient evidence      Assume independent
            Consider markers           Don't eliminate based
            independent                on clustering alone
```

**Pathology-Specific Caveat:**
```
âš ï¸ Statistical significance â‰  Clinical significance

Example:
â”œâ”€ Large dataset (n=1000): p = 0.001 but CramÃ©r's V = 0.12
â””â”€ Statistically significant but clinically weak association
    â†’ Don't eliminate markers based on p-value alone!

Always check BOTH:
âœ… P-value (statistical significance)
âœ… Effect size (clinical relevance)
```

---

## Common Mistakes to Avoid

### Mistake 1: Dropping Markers Based Only on Clustering

```
âŒ WRONG Approach:
"CK7 and CK20 cluster together, so I'll drop CK20"

âœ… CORRECT Approach:
"CK7 and CK20 cluster together. Let me check:
 1. Do they truly co-express or are both negative?
 2. What's the Jaccard index for co-positivity?
 3. Do they mark different tumor types?
 4. Clinical: CK7+/CK20- (upper GI) vs CK7-/CK20+ (lower GI)
    â†’ Actually mutually exclusive! Keep both!"
```

**Reality Check:**
```
Clustering Result: "CK7 and CK20 are similar (distance 0.3)"

Reason for clustering:
â”œâ”€ Scenario A: Often BOTH negative in non-epithelial tumors
â”‚   â””â”€ NOT redundant for epithelial tumor subtyping
â”‚
â””â”€ Scenario B: Both positive in transitional cell carcinoma
    â””â”€ Might be redundant in specific tumor types

Action:
â””â”€ Review the PATTERN, not just the distance!
```

### Mistake 2: Using Wrong Distance for Data Type

```
âŒ Euclidean distance for binary markers:
â”œâ”€ Treats 0/1 as continuous numbers
â””â”€ Inappropriate (violates assumptions)

âœ… Use Chi-squared or Jaccard for binary data

âŒ Chi-squared for H-scores:
â”œâ”€ Requires discretization (loses information)
â””â”€ Euclidean is better for continuous

âœ… Use Euclidean or Manhattan for H-scores
```

### Mistake 3: Ignoring Sample Size

```
Small Dataset (n=20 cases):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CD10 vs BCL6: Ï‡Â² = 8.5, p = 0.004
CramÃ©r's V = 0.65 (strong association!)

Wait! Only 20 cases?
â”œâ”€ Chi-squared may be unreliable (sparse cells)
â”œâ”€ V = 0.65 could be unstable
â””â”€ Need Fisher's exact test for small samples

Recommendation:
âš ï¸ n < 30: Be cautious with interpretation
âš ï¸ n < 50: Consider increasing sample size
âœ… n > 100: Clustering results more reliable
```

### Mistake 4: Not Considering Clinical Context

```
Clustering Result:
"p53 and Ki67 are independent (distance 0.8)"

Statistical Interpretation:
â””â”€ Markers don't correlate in your dataset

But Clinical Reality:
â”œâ”€ p53 mutation â†’ often drives high proliferation
â”œâ”€ Biological link exists
â””â”€ Your cohort may not show this (selection bias)

Action:
âœ… Use clustering to INFORM decisions
âŒ Don't ignore established biology
```

---

## Step-by-Step Workflow for Panel Optimization

### Phase 1: Data Preparation
```
âœ“ 1. Collect IHC data from your cases
     â”œâ”€ Minimum: 50-100 cases (more is better)
     â””â”€ Include diverse diagnoses if differential panel

âœ“ 2. Organize data:
     â”œâ”€ Binary: Code as positive/negative or 0/1
     â”œâ”€ Ordinal: Keep intensity (0/1+/2+/3+) as is
     â””â”€ Continuous: H-scores (0-300), % positive (0-100)

âœ“ 3. Check for missing data:
     â”œâ”€ Acceptable: < 10% missing per marker
     â””â”€ If > 20% missing: Consider excluding that marker
```

### Phase 2: Select Distance Metric
```
âœ“ 4. Choose metric based on data type:

     My markers are:
     â”œâ”€ All binary? â†’ Chi-squared â­
     â”œâ”€ Binary with many negatives? â†’ Jaccard
     â”œâ”€ All continuous? â†’ Euclidean â­
     â”œâ”€ Mixed types? â†’ Mixed â­ or Mutual Information
     â””â”€ Ordinal (0/1+/2+/3+)? â†’ Chi-squared or Hamming
```

### Phase 3: Run Analysis
```
âœ“ 5. Perform marker clustering:
     â”œâ”€ Enable: "Perform Marker-Level Clustering"
     â”œâ”€ Set: Distance metric (from step 4)
     â”œâ”€ Enable: "Test Marker Associations"
     â””â”€ Enable: "Auto-detect Marker Groups"

âœ“ 6. Review outputs:
     â”œâ”€ Dendrogram: Visual inspection
     â”œâ”€ Association table: P-values and effect sizes
     â”œâ”€ Clustering tree: Merge sequence
     â””â”€ Marker groups: Identified clusters
```

### Phase 4: Interpret Results
```
âœ“ 7. Identify redundant markers:

     Look for:
     â”œâ”€ Distance < 0.3: Very similar (consider dropping one)
     â”œâ”€ P < 0.001 AND CramÃ©r's V > 0.6: Strong association
     â””â”€ Jaccard > 0.8: High co-expression (redundant)

âœ“ 8. Identify complementary markers:

     Look for:
     â”œâ”€ Distance > 0.7: Different information (keep both)
     â”œâ”€ P > 0.05: Independent (keep both)
     â””â”€ Mutually exclusive patterns (keep both)
```

### Phase 5: Clinical Validation
```
âœ“ 9. Don't drop markers solely based on statistics!

     Clinical validation checklist:
     â”œâ”€ Does literature support this redundancy?
     â”œâ”€ Do these markers mark different subtypes?
     â”œâ”€ Would dropping this change diagnoses?
     â”œâ”€ Is this for prognostic vs diagnostic use?
     â””â”€ Cost savings worth potential information loss?

âœ“ 10. Test optimized panel:
     â”œâ”€ Pilot with 20-30 new cases
     â”œâ”€ Compare diagnoses: Full panel vs optimized
     â””â”€ If concordance > 95%, consider adopting
```

### Phase 6: Implementation
```
âœ“ 11. Document your findings:
     â”œâ”€ Create internal protocol
     â”œâ”€ Share with pathology colleagues
     â””â”€ Update ordering guidelines

âœ“ 12. Monitor performance:
     â”œâ”€ Track any discordant cases
     â”œâ”€ Re-evaluate annually
     â””â”€ Adjust panel as needed
```

---

## Real-World Panel Optimization Examples

### Example 1: Lung Cancer Panel Reduction

**Original Panel (6 markers):**
- TTF1, Napsin A, p40, CK5/6, p63, CK7

**Clustering Results:**
```
Group 1 (Adenocarcinoma):
TTF1 â”€â”¬â”€â”€ Distance 0.18 (very redundant)
Napsinâ”€â”˜

Group 2 (Squamous):
p40 â”€â”€â”¬â”€â”€ Distance 0.15 (redundant)
p63 â”€â”€â”¤
      â””â”€ CK5/6 (distance 0.22, slightly different)

Separate:
CK7 (distance > 0.9 from all, non-specific)
```

**Clinical Decision:**
```
Optimized Panel (3 markers):
âœ… TTF1 (adenocarcinoma)
âœ… p40 (squamous)
âœ… CK7 (non-specific epithelial)

Eliminated:
âŒ Napsin A (redundant with TTF1)
âŒ p63 (redundant with p40)
âŒ CK5/6 (redundant with p40/p63)

Validation (n=100 prospective cases):
â”œâ”€ Concordance with full panel: 98/100 (98%)
â”œâ”€ 2 discordant cases: Both adenosquamous (rare)
â””â”€ Decision: Acceptable discordance rate

Cost Savings:
â”œâ”€ $180 per case (3 antibodies @ $60 each)
â”œâ”€ 500 cases/year
â””â”€ Annual savings: $90,000
```

### Example 2: Breast Cancer Biomarker Rationalization

**Original Panel (5 markers):**
- ER, PR, HER2, Ki67, p53

**Clustering Results:**
```
Group 1 (Hormonal):
ER â”€â”¬â”€â”€ Distance 0.25 (moderate redundancy)
PR â”€â”˜    Co-positive in 85% of cases

Independent:
HER2 (distance 0.82 from ER/PR)
Ki67 (distance 0.75 from all)
p53 (distance 0.68 from all)

ER vs Ki67: Inverse relationship (high ER â†’ low Ki67)
â””â”€ Mutual Information = 0.52 (moderate)
```

**Clinical Decision:**
```
Keep All Markers:
âœ… ER (diagnostic and predictive)
âœ… PR (prognostic despite ER redundancy)
âœ… HER2 (independent, therapeutic target)
âœ… Ki67 (proliferation, relates to ER but independent)
âœ… p53 (independent prognostic marker)

Rationale for keeping "redundant" PR:
â”œâ”€ ER+/PR- cases (15%) have worse prognosis
â”œâ”€ PR loss indicates incomplete hormone signaling
â”œâ”€ Clinical utility outweighs redundancy
â””â”€ CAP guidelines require both

Result:
â””â”€ No panel reduction, but clustering confirmed
    current guidelines are evidence-based
```

### Example 3: GI Panel Simplification

**Original Panel (8 markers):**
- CK7, CK20, CDX2, SATB2, MUC2, MUC5AC, MUC6, CEA

**Clustering Results:**
```
Lower GI Cluster:
CDX2 â”€â”€â”¬â”€â”€ Distance 0.12 (highly redundant)
SATB2 â”€â”¤    Mutual Information = 0.81
       â”‚
CK20 â”€â”€â”˜    Distance 0.25 (moderately redundant)
MUC2 â”€â”€â”€â”€â”€â”€ Distance 0.30 (related)

Upper GI Cluster:
CK7 â”€â”€â”€â”¬â”€â”€ Distance 0.35
MUC5ACâ”€â”¤
       â””â”€ MUC6 (distance 0.28)

Non-specific:
CEA (distance 0.55-0.65 from all groups)
```

**Clinical Decision:**
```
Optimized Panel (4 markers):
âœ… CK7 (upper GI lineage)
âœ… CDX2 (intestinal differentiation)
âœ… MUC5AC (gastric-type mucin)
âœ… CEA (moderate specificity, useful for metastatic workup)

Eliminated:
âŒ CK20 (redundant with CDX2 for colon, distance 0.25)
âŒ SATB2 (redundant with CDX2, distance 0.12)
âŒ MUC2 (adds little beyond CDX2, distance 0.30)
âŒ MUC6 (redundant with CK7 for gastric, distance 0.28)

Performance (n=150 GI tumors):
â”œâ”€ Esophageal: CK7+/CDX2-/MUC5AC+ â†’ 45/45 correct
â”œâ”€ Gastric:    CK7+/CDX2-/MUC5AC+ â†’ 42/45 correct (93%)
â”œâ”€ Pancreatic: CK7+/CDX2+/MUC5AC+ â†’ 28/30 correct (93%)
â”œâ”€ Colon:      CK7-/CDX2+/MUC5AC- â†’ 29/30 correct (97%)
â””â”€ Overall:    144/150 correct (96% concordance)

Cost Savings:
â”œâ”€ $240 per case (4 antibodies eliminated)
â”œâ”€ 300 GI cases/year
â””â”€ Annual savings: $72,000
```

---

## Summary: Your Distance Metric Toolkit

### Quick Decision Matrix

| Your Data | First Choice | Alternative | When to Switch |
|-----------|-------------|-------------|----------------|
| **Binary IHC (pos/neg)** | Chi-squared â­ | Jaccard | If many double-negatives |
| **Ordinal (0/1+/2+/3+)** | Chi-squared â­ | Hamming | If want simple mismatch count |
| **Continuous (H-scores)** | Euclidean â­ | Manhattan | If outliers present |
| **% Positive (0-100)** | Euclidean â­ | Correlation | If want pattern similarity |
| **Mixed Binary + Continuous** | Mixed â­ | Mutual Info | If non-linear relationships |
| **Sparse Binary (rare +)** | Jaccard â­ | CramÃ©r's V | If want normalized measure |
| **Need Statistical Tests** | Chi-squared â­ | CramÃ©r's V | If different table sizes |
| **Non-linear Relationships** | Mutual Info â­ | Mixed | If all same data type |

### Key Takeaways for Pathologists

1. **Clustering reveals co-expression**, not causation
   - ER and PR cluster because hormone-driven tumors express both
   - Doesn't mean one causes the other

2. **Distance < 0.3 = Consider eliminating one marker**
   - But check clinical literature first!
   - Some "redundant" markers have prognostic value

3. **Jaccard for sparse data, Euclidean for continuous**
   - Most common scenarios covered by these two

4. **Always validate optimized panels**
   - Pilot with new cases before full adoption
   - Accept â‰¥95% concordance with original panel

5. **Cost savings = clinical utility**
   - Eliminating 2-3 antibodies per case adds up
   - But never sacrifice diagnostic accuracy

---

## Glossary for Pathologists

**Distance**: How different two markers are (0 = identical, 1 = completely different)

**Similarity**: How alike two markers are (opposite of distance)

**CramÃ©r's V**: Normalized effect size for categorical associations (0-1 scale)

**Jaccard Index**: Co-positivity rate (ignores double-negatives)

**Mutual Information**: Information-theoretic measure (captures non-linear patterns)

**Dendrogram**: Tree diagram showing how markers cluster hierarchically

**H-score**: Histological score (0-300) combining intensity and % positive

**Ordinal Data**: Ordered categories (0/1+/2+/3+) but distances between levels not equal

**Binary Data**: Two categories only (positive/negative, 0/1)

**Continuous Data**: Measured on a scale (H-scores, percentages)

---

## Further Reading for Pathologists

### Foundational Papers
1. Greenacre M (2017). *Correspondence Analysis in Practice*. 3rd ed. Chapman & Hall/CRC.
   - Chapter 9: Clustering in contingency tables

2. Olsen LR et al. (2006). "Diagnostic and prognostic value of immunohistochemistry..." *Modern Pathology* 19:1238-1251.
   - Systematic approach to IHC panel optimization

3. Sterlacci W et al. (2019). "Immunohistochemistry clustering..." *Virchows Arch* 474:687-696.
   - Clustering methodology in diagnostic pathology

### Statistical References
4. Agresti A (2013). *Categorical Data Analysis*. 3rd ed. Wiley.
   - Chapter 2: Describing contingency tables (CramÃ©r's V, etc.)

5. Deza MM, Deza E (2009). *Encyclopedia of Distances*. Springer.
   - Comprehensive reference for all distance metrics

### Online Resources
6. CAP Guidelines: [www.cap.org](https://www.cap.org)
   - Updated IHC interpretation guidelines

7. Human Protein Atlas: [www.proteinatlas.org](https://www.proteinatlas.org)
   - IHC expression patterns across tissues

---

**Document Version**: 1.0
**Last Updated**: 2025-01-26
**For Questions**: Contact your bioinformatics/biostatistics support team

---

*This guide is designed for practicing pathologists. For statistical details, consult the technical documentation in `MARKER_CLUSTERING_DISTANCES.md`*
